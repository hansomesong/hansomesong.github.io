<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rennesong.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="声明：本文主要内容借鉴以下文章: YANG FOR DUMMIES, By David Barroso, 08-14-2017 对YANG的解读(一), By ljyfree, 02-11-2018 YANG 的诞生 YANG 是出于配合IETF定义的NETCONF协议的工作而诞生的。NETCONF 是一种允许网络管理员通过网络来远程管理配置网络设备的控制协议。不可避免地，NETCONF 需要对网">
<meta property="og:type" content="article">
<meta property="og:title" content="深入浅出理解 YANG 模型">
<meta property="og:url" content="http://rennesong.com/2019/07/13/yang-model-tuto/index.html">
<meta property="og:site_name" content="Rennesong&#39;s blog">
<meta property="og:description" content="声明：本文主要内容借鉴以下文章: YANG FOR DUMMIES, By David Barroso, 08-14-2017 对YANG的解读(一), By ljyfree, 02-11-2018 YANG 的诞生 YANG 是出于配合IETF定义的NETCONF协议的工作而诞生的。NETCONF 是一种允许网络管理员通过网络来远程管理配置网络设备的控制协议。不可避免地，NETCONF 需要对网">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-07-12T16:28:41.000Z">
<meta property="article:modified_time" content="2019-07-12T23:03:47.944Z">
<meta property="article:author" content="rennsong">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://rennesong.com/2019/07/13/yang-model-tuto/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>深入浅出理解 YANG 模型 | Rennesong's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Rennesong's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Blog my life from now on!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/07/13/yang-model-tuto/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          深入浅出理解 YANG 模型
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-07-13 00:28:41 / 修改时间：07:03:47" itemprop="dateCreated datePublished" datetime="2019-07-13T00:28:41+08:00">2019-07-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>声明：本文主要内容借鉴以下文章: <a href="https://napalm-automation.net/yang-for-dummies/" target="_blank" rel="noopener">YANG FOR DUMMIES, By David Barroso, 08-14-2017</a> <a href="https://www.jianshu.com/p/ca7f5fe11fae" target="_blank" rel="noopener">对YANG的解读(一), By ljyfree, 02-11-2018</a></p>
<h1 id="yang-的诞生">YANG 的诞生</h1>
<p>YANG 是出于配合IETF定义的NETCONF协议的工作而诞生的。NETCONF 是一种允许网络管理员通过网络来远程管理配置网络设备的控制协议。不可避免地，NETCONF 需要对网络设备的配置数据(configuration)和运行状态(state)做操作，例如编辑配置，获取状态。因此需要一种数据建模语言(data model language)来对configuration, operational state, 甚至操作(operations)进行建模。建好的YANG data模型，最后以XML的形式进行实例化, 通过NETCONF协议在网络设备和控制器之间就行传递。打个比方，我需要向领导请假，领导说你写个请假单，包含请假人的姓名，请假的起止时间，请假事由和代理人。于是我做了一个表格，包含了上述要求，并根据实际情况填入了真实信息。那么领导的描述，就可以理解为“建模”，而我最后提交的填好内容的表格，就是将模型实例化了。</p>
<h1 id="yang-的主要概念">Yang 的主要概念</h1>
<p>这部分我们主要解释下常见的YANG相关的概念，我们不追求面面俱到，但求通过以下介绍，能让读者能读懂大部分YANG文件</p>
<h2 id="modulesubmodule">module/submodule</h2>
<p>module的header主要是一些描述信息，而body就是data model定义的地方。module可以分为submodule。模块化的好处就是方便引用。</p>
<h2 id="四种基本建模数据结构">四种基本建模数据结构</h2>
<h3 id="leaf-node">leaf node/</h3>
<p>一个leaf node包含且只包含一个value，可以是数字或是字符串，具体是什么，看关键字&quot;type&quot;后面跟什么。leaf node下面不能挂子节点。例如： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">    leaf host-name &#123;</span><br><span class="line">        type string;</span><br><span class="line">        description &quot;Hostname for this system&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example:</span><br><span class="line">    &lt;host-name&gt;my.example.com&lt;&#x2F;host-name&gt;</span><br></pre></td></tr></table></figure> 此处用YANG定义了一个名为host-name的leaf，它包含对自己的description，有一个string类型的值。那么当用XML实例化这个leaf的时候，就需要对host-name进行具体的赋值。换句话说，YANG是挖坑的，XML是填坑的，但是XML填坑用的材料的“形状”，要和YANG定义的一样。</p>
<h3 id="leaf-list-node">leaf-list node</h3>
<p>与上面的Leaf Nodes“一字之差”，多了一个“-list”。可以认为Leaf-List Nodes表示的是一个“数组”，“数组”中的元素的值的type必须保持一致，而且不能重复。例如： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">    leaf-list domain-search &#123;</span><br><span class="line">        type string;</span><br><span class="line">        description &quot;List of domain names to search&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example:</span><br><span class="line">    &lt;domain-search&gt;high.example.com&lt;&#x2F;domain-search&gt;</span><br><span class="line">    &lt;domain-search&gt;low.example.com&lt;&#x2F;domain-search&gt;</span><br><span class="line">    &lt;domain-search&gt;everywhere.example.com&lt;&#x2F;domain-search&gt;</span><br></pre></td></tr></table></figure> 和leaf node一样，它也只定义一个value，但是可以有一系列同类型的值。例子中<domain-serarch>的值有多个，但是定义和类型都是统一的。</domain-serarch></p>
<h3 id="container-node">container node</h3>
<p>“Container”可以翻译成“集装箱”。真正有价值的，是集装箱里面装的货物，而不是集装箱本身。但是如果没有集装箱，那么里面的货物就散了。Container的作用就是将数据层次化组织起来，呈现出subtree的样式。特别需要注意的是： * 一个空的集装箱也是能“卖钱”的，因为毕竟是铁皮做的，但是一个container自身是没有“value”的； * 一个集装箱容量是有限的，但是一个container可以装多少node并没有限制，而且这些node可以在leaf/list/leaf-list甚至是container(想起了俄罗斯套娃)中任意选取。</p>
<p>来看一个例子： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">    container system &#123;</span><br><span class="line">        container login &#123;</span><br><span class="line">            leaf message &#123;</span><br><span class="line">                type string;</span><br><span class="line">                description</span><br><span class="line">                    &quot;Message given at start of login session&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example:</span><br><span class="line">    &lt;system&gt;</span><br><span class="line">        &lt;login&gt;</span><br><span class="line">            &lt;message&gt;Good morning&lt;&#x2F;message&gt;</span><br><span class="line">        &lt;&#x2F;login&gt;</span><br><span class="line">    &lt;&#x2F;system&gt;</span><br></pre></td></tr></table></figure> container system里面装了一个container login，然后login里面有一个leaf node，就是类型为string的<code>message</code>。</p>
<h3 id="list-nodes">list nodes</h3>
<p>一个List node可以包含多个child node，而且这些node可以在leaf/leaf-list/container中任意选取。List必须指明这些child中的一个node为key。例如: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">list user &#123;</span><br><span class="line">    key &quot;name&quot;;</span><br><span class="line">    leaf name &#123;</span><br><span class="line">        type string;</span><br><span class="line">    &#125;</span><br><span class="line">    leaf full-name &#123;</span><br><span class="line">        type string;</span><br><span class="line">    &#125;</span><br><span class="line">    leaf class &#123;</span><br><span class="line">        type string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example:</span><br><span class="line">     &lt;user&gt;</span><br><span class="line">        &lt;name&gt;glocks&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;full-name&gt;Goldie Locks&lt;&#x2F;full-name&gt;</span><br><span class="line">        &lt;class&gt;intruder&lt;&#x2F;class&gt;</span><br><span class="line">     &lt;&#x2F;user&gt;</span><br><span class="line">     &lt;user&gt;</span><br><span class="line">        &lt;name&gt;snowey&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;full-name&gt;Snow White&lt;&#x2F;full-name&gt;</span><br><span class="line">        &lt;class&gt;free-loader&lt;&#x2F;class&gt;</span><br><span class="line">     &lt;&#x2F;user&gt;</span><br><span class="line">     &lt;user&gt;</span><br><span class="line">        &lt;name&gt;rzell&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;full-name&gt;Rapun Zell&lt;&#x2F;full-name&gt;</span><br><span class="line">        &lt;class&gt;tower&lt;&#x2F;class&gt;</span><br><span class="line">     &lt;&#x2F;user&gt;</span><br></pre></td></tr></table></figure> 定义了一个名为“user”的list，这个list中包含三个leaf：name/full-name/class。其中name被指定为key。实例化的时候，key的值(也就是&quot;name&quot;的值)是必须不同的，其它的值(full-name/class)没有这个要求。随后xml实例化了三个user，都包含YANG定义的name/full-name/class，而且name都是不同的。</p>
<p>在实际工作中，我们见到的YANG文件，基本上都是以上四中基本数据结构的各种组合。</p>
<h2 id="resuable-node-groups-grouping">Resuable node groups (grouping)</h2>
<p>grouping其实不是一种数据类型，它存在的意义只是方便在“编程”的时候被引用。所以它本身是没有value的。grouping可以在本module被引用，或是被其它module引用。例如： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">     grouping target &#123;</span><br><span class="line">         leaf address &#123;</span><br><span class="line">             type inet:ip-address;</span><br><span class="line">             description &quot;Target IP address&quot;;</span><br><span class="line">         &#125;</span><br><span class="line">         leaf port &#123;</span><br><span class="line">             type inet:port-number;</span><br><span class="line">             description &quot;Target port number&quot;;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     container peer &#123;</span><br><span class="line">         container destination &#123;</span><br><span class="line">             uses target;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">-----------------------</span><br><span class="line">   NETCONF XML Example:</span><br><span class="line"></span><br><span class="line">     &lt;peer&gt;</span><br><span class="line">       &lt;destination&gt;</span><br><span class="line">         &lt;address&gt;192.0.2.1&lt;&#x2F;address&gt;</span><br><span class="line">         &lt;port&gt;830&lt;&#x2F;port&gt;</span><br><span class="line">       &lt;&#x2F;destination&gt;</span><br><span class="line">     &lt;&#x2F;peer&gt;</span><br></pre></td></tr></table></figure> 回想一下，当一台主机对外提供服务的时候，客户端需要知道提供服务主机的的IP和端口信息。所以这边可以定义一个grouping target，在里面定义leaf address和leaf port。下面的container peer来uses(调用grouping的关键字)这个grouping。当对<peer>实例化的时候，就需要将grouping target中包含的address和port都进行赋值。这里的830端口，是在RFC6242(Using the NETCONF Protocol over Secure Shell)中定义的基于ssh的netconf服务端口。 这里的users可以理解为copy，即把grouping的整个内容都复制到了这个schema tree。grouping本身是没有绑定到任何namespace的，直到某个module uses了这个grouping，那么这个grouping就被绑定到这个module了。 grouping还有一个非常好用的特性就是refine，例如要建立连接，既需要server的IP+port，也需要client的IP+port。因为这两个的数据结构是完全一样的，所以可以复用，并用更准确的description来覆盖grouping定义时候设置的description。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">YANG Example:</span><br><span class="line"></span><br><span class="line">     container connection &#123;</span><br><span class="line">      container source &#123;</span><br><span class="line">          uses target &#123;</span><br><span class="line">              refine &quot;address&quot; &#123;</span><br><span class="line">                  description &quot;Source IP address&quot;;</span><br><span class="line">              &#125;</span><br><span class="line">              refine &quot;port&quot; &#123;</span><br><span class="line">                  description &quot;Source port number&quot;;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      container destination &#123;</span><br><span class="line">          uses target &#123;</span><br><span class="line">              refine &quot;address&quot; &#123;</span><br><span class="line">                  description &quot;Destination IP address&quot;;</span><br><span class="line">              &#125;</span><br><span class="line">              refine &quot;port&quot; &#123;</span><br><span class="line">                  description &quot;Destination port number&quot;;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure> ## Choices &quot;choice&quot;+&quot;case&quot;用来描述互斥的内容。一个choice可以包含多个case，每个case可以包含多个node。一般来说在一个choice里，一个case下面的node不应该和其他case下面的node重复。 在YANG模型和schema中可以看到choice下的所有case，而当对它实例化之后，只会出现一个case下面的nodes了。例如: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">     container food &#123;</span><br><span class="line">       choice snack &#123;</span><br><span class="line">           case sports-arena &#123;</span><br><span class="line">               leaf pretzel &#123;</span><br><span class="line">                   type empty;</span><br><span class="line">               &#125;</span><br><span class="line">               leaf beer &#123;</span><br><span class="line">                   type empty;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           case late-night &#123;</span><br><span class="line">               leaf chocolate &#123;</span><br><span class="line">                   type enumeration &#123;</span><br><span class="line">                       enum dark;</span><br><span class="line">                       enum milk;</span><br><span class="line">                       enum first-available;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example:</span><br><span class="line">    &lt;food&gt;</span><br><span class="line">        &lt;pretzel&#x2F;&gt;</span><br><span class="line">        &lt;beer&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;food&gt;</span><br></pre></td></tr></table></figure> ## Configuration 以及 State Data 的区分 NETCONF 需要区分 configuration data 和 operational state data 的, 在YANG建模的时候，对于state data需要加上 &quot;config false&quot;. 例如： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">list interface &#123;</span><br><span class="line">    key &quot;name&quot;;</span><br><span class="line"></span><br><span class="line">    leaf name &#123;</span><br><span class="line">        type string;</span><br><span class="line">    &#125;</span><br><span class="line">    leaf speed &#123;</span><br><span class="line">        type enumeration &#123;</span><br><span class="line">            enum 10m;</span><br><span class="line">            enum 100m;</span><br><span class="line">            enum auto;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    leaf observed-speed &#123;</span><br><span class="line">        type uint32;</span><br><span class="line">        config false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 在list interface中。speed的value type是枚举类型，就是说实例化的时候只能从这里列出的三种中选择一个。对于leaf observed-speed,因为包含&quot;config false&quot;，因此这个leaf记录的是state value，不可以配置。对应于netconf的操作，leaf speed可以<get-config>，而leaf observed-speed只能<get>。</get></get-config></peer></p>
<h2 id="extending-data-models-augment">Extending Data Models (augment)</h2>
<p>YANG允许向data module插入新的节点。这是一个非常有用的特性，例如厂商想在公共yang上插入自己的特殊参数，那么augment就可以实现这个需求。&quot;when&quot;后面跟的是条件，即为满足这个条件，就插入新的node。例如 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">     augment &#x2F;system&#x2F;login&#x2F;user &#123;</span><br><span class="line">         when &quot;class !&#x3D; &#39;wheel&#39;&quot;;</span><br><span class="line">         leaf uid &#123;</span><br><span class="line">             type uint16 &#123;</span><br><span class="line">                 range &quot;1000 .. 30000&quot;;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example 1:</span><br><span class="line">     &lt;user&gt;</span><br><span class="line">       &lt;name&gt;alicew&lt;&#x2F;name&gt;</span><br><span class="line">       &lt;full-name&gt;Alice N. Wonderland&lt;&#x2F;full-name&gt;</span><br><span class="line">       &lt;class&gt;drop-out&lt;&#x2F;class&gt;</span><br><span class="line">       &lt;other:uid&gt;1024&lt;&#x2F;other:uid&gt;</span><br><span class="line">     &lt;&#x2F;user&gt;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example 2:</span><br><span class="line">     &lt;user&gt;</span><br><span class="line">       &lt;name&gt;jerryr&lt;&#x2F;name&gt;</span><br><span class="line">       &lt;full-name&gt;Jerry K. Roma&lt;&#x2F;full-name&gt;</span><br><span class="line">       &lt;class&gt;wheel&lt;&#x2F;class&gt;</span><br><span class="line">     &lt;&#x2F;user&gt;</span><br></pre></td></tr></table></figure> Example 1 中因为class不是&quot;wheel&quot;，因此插入uid; Example 2中class是&quot;wheel&quot;，所以不插入uid。</p>
<h2 id="rpc-definitions">RPC Definitions</h2>
<p>YANG可以用来定义netconf的rpc，包括rpc输入的参数，输出的参数，例如： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">     rpc activate-software-image &#123;</span><br><span class="line">         input &#123;</span><br><span class="line">             leaf image-name &#123;</span><br><span class="line">                 type string;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         output &#123;</span><br><span class="line">             leaf status &#123;</span><br><span class="line">                 type string;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example:</span><br><span class="line">     &lt;rpc message-id&#x3D;&quot;101&quot;</span><br><span class="line">          xmlns&#x3D;&quot;urn:ietf:params:xml:ns:netconf:base:1.0&quot;&gt;</span><br><span class="line">       &lt;activate-software-image xmlns&#x3D;&quot;http:&#x2F;&#x2F;acme.example.com&#x2F;system&quot;&gt;</span><br><span class="line">         &lt;image-name&gt;acmefw-2.3&lt;&#x2F;image-name&gt;</span><br><span class="line">      &lt;&#x2F;activate-software-image&gt;</span><br><span class="line">     &lt;&#x2F;rpc&gt;</span><br><span class="line"></span><br><span class="line">     &lt;rpc-reply message-id&#x3D;&quot;101&quot;</span><br><span class="line">                xmlns&#x3D;&quot;urn:ietf:params:xml:ns:netconf:base:1.0&quot;&gt;</span><br><span class="line">       &lt;status xmlns&#x3D;&quot;http:&#x2F;&#x2F;acme.example.com&#x2F;system&quot;&gt;</span><br><span class="line">         The image acmefw-2.3 is being installed.</span><br><span class="line">       &lt;&#x2F;status&gt;</span><br><span class="line">     &lt;&#x2F;rpc-reply&gt;</span><br></pre></td></tr></table></figure> 定义一种叫做&quot;activate-software-image&quot;的rpc。当Client发送rpc的时候，需要加上image-name，交换机发回rpc-reply的时候，需要加上activate的结果，本例中可以看到操作是成功了。</p>
<h2 id="notification-definitions">Notification Definitions</h2>
<p>Notification是一种通告机制，当交换机上出现特性event(事件)，交换机会主动发给已经建立netconf连接并订阅了Notification的client。YANG可以定义notification，例如` <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">    notification link-failure &#123;</span><br><span class="line">        description &quot;A link failure has been detected&quot;;</span><br><span class="line">        leaf if-name &#123;</span><br><span class="line">            type leafref &#123;</span><br><span class="line">             path &quot;&#x2F;interface&#x2F;name&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        leaf if-admin-status &#123;</span><br><span class="line">            type admin-status;</span><br><span class="line">        &#125;</span><br><span class="line">        leaf if-oper-status &#123;</span><br><span class="line">            type oper-status;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example:</span><br><span class="line">     &lt;notification</span><br><span class="line">         xmlns&#x3D;&quot;urn:ietf:params:netconf:capability:notification:1.0&quot;&gt;</span><br><span class="line">       &lt;eventTime&gt;2007-09-01T10:00:00Z&lt;&#x2F;eventTime&gt;</span><br><span class="line">       &lt;link-failure xmlns&#x3D;&quot;http:&#x2F;&#x2F;acme.example.com&#x2F;system&quot;&gt;</span><br><span class="line">         &lt;if-name&gt;so-1&#x2F;2&#x2F;3.0&lt;&#x2F;if-name&gt;</span><br><span class="line">         &lt;if-admin-status&gt;up&lt;&#x2F;if-admin-status&gt;</span><br><span class="line">         &lt;if-oper-status&gt;down&lt;&#x2F;if-oper-status&gt;</span><br><span class="line">       &lt;&#x2F;link-failure&gt;</span><br><span class="line">     &lt;&#x2F;notification&gt;</span><br></pre></td></tr></table></figure> 这样无论是接口的admin状态(shutdown或是no shutdonw)，还是链路状态(down/up)发送改变的时候，都可以发送notification给client，并且带上了当前的状态信息。</p>
<h1 id="要点总结">要点总结</h1>
<p>节点带有&quot;config false&quot;标签时，他的子结构就打上了state data的标签，不可配置，能通过netconf操作获取</p>
<ul>
<li>typedef :定义衍生类型</li>
<li>grouping :可重用节点组. 一种可重用的schema nodes的集合。该集合可能在定义处的module中被使用，也可能在包含它的modules中使用，还可能在导入它的modules中被使用。grouping不会生成任何节点，可以看成一种临时树干。</li>
<li>refine :重定义, 重写特定的声明覆盖原有grouping的定义</li>
<li>choice case :申明分离不相容的节点，类似于java中的switch case</li>
<li>argument :“augment”声明定义了在数据模型树形结构中，新的节点插入的位置。“when”声明了新节点生效的条件。　　</li>
<li>rpc (Remote Procedure Call) :yang文件可以定义声明RPC的输入输出参数</li>
<li>notification :yang可以用来为netconf的notification做内容建模</li>
<li>ordered-by user :It only requires the order to be maintained if <code>ordered-by user</code> is configured in the YANG module. It will maintain YANG schema order so the objects will be returned in the correct order according to the YANG module.</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/07/08/odl-l2switch-adaption/" rel="prev" title="odl-l2switch-adaption">
      <i class="fa fa-chevron-left"></i> odl-l2switch-adaption
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/07/13/maven-tuto/" rel="next" title="maven-tuto">
      maven-tuto <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#yang-的诞生"><span class="nav-number">1.</span> <span class="nav-text">YANG 的诞生</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#yang-的主要概念"><span class="nav-number">2.</span> <span class="nav-text">Yang 的主要概念</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#modulesubmodule"><span class="nav-number">2.1.</span> <span class="nav-text">module&#x2F;submodule</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四种基本建模数据结构"><span class="nav-number">2.2.</span> <span class="nav-text">四种基本建模数据结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#leaf-node"><span class="nav-number">2.2.1.</span> <span class="nav-text">leaf node&#x2F;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#leaf-list-node"><span class="nav-number">2.2.2.</span> <span class="nav-text">leaf-list node</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#container-node"><span class="nav-number">2.2.3.</span> <span class="nav-text">container node</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#list-nodes"><span class="nav-number">2.2.4.</span> <span class="nav-text">list nodes</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#resuable-node-groups-grouping"><span class="nav-number">2.3.</span> <span class="nav-text">Resuable node groups (grouping)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#extending-data-models-augment"><span class="nav-number">2.4.</span> <span class="nav-text">Extending Data Models (augment)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rpc-definitions"><span class="nav-number">2.5.</span> <span class="nav-text">RPC Definitions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#notification-definitions"><span class="nav-number">2.6.</span> <span class="nav-text">Notification Definitions</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#要点总结"><span class="nav-number">3.</span> <span class="nav-text">要点总结</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">rennsong</p>
  <div class="site-description" itemprop="description">Personal blog site, to note technique and life related articles</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">68</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hansomesong" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hansomesong" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rennsong</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
