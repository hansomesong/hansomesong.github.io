<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rennesong.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="http:&#x2F;&#x2F;sdnhub.org&#x2F;tutorials&#x2F;opendaylight&#x2F; 虽然有点老，但是这个教程也不失为一个比较好的 OpenDaylight 开发教程 我看了下 其内容还是比较系统全面的 ODL controller 直接发送数据包给 OVS 交换机 两种思路: ODL controller 直接发送数据包到网络中 ODL controller 直接发包, 其本质上并不是contro">
<meta property="og:type" content="article">
<meta property="og:title" content="opendaylight-dev">
<meta property="og:url" content="http://rennesong.com/2019/05/20/opendaylight-dev/index.html">
<meta property="og:site_name" content="Rennesong&#39;s blog">
<meta property="og:description" content="http:&#x2F;&#x2F;sdnhub.org&#x2F;tutorials&#x2F;opendaylight&#x2F; 虽然有点老，但是这个教程也不失为一个比较好的 OpenDaylight 开发教程 我看了下 其内容还是比较系统全面的 ODL controller 直接发送数据包给 OVS 交换机 两种思路: ODL controller 直接发送数据包到网络中 ODL controller 直接发包, 其本质上并不是contro">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-05-20T08:13:03.000Z">
<meta property="article:modified_time" content="2019-10-23T09:00:52.000Z">
<meta property="article:author" content="rennsong">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://rennesong.com/2019/05/20/opendaylight-dev/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>opendaylight-dev | Rennesong's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Rennesong's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Blog my life from now on!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/05/20/opendaylight-dev/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          opendaylight-dev
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-20 16:13:03" itemprop="dateCreated datePublished" datetime="2019-05-20T16:13:03+08:00">2019-05-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-23 17:00:52" itemprop="dateModified" datetime="2019-10-23T17:00:52+08:00">2019-10-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>http://sdnhub.org/tutorials/opendaylight/ 虽然有点老，但是这个教程也不失为一个比较好的 OpenDaylight 开发教程 我看了下 其内容还是比较系统全面的</p>
<h1 id="odl-controller-直接发送数据包给-ovs-交换机">ODL controller 直接发送数据包给 OVS 交换机</h1>
<p>两种思路:</p>
<h1 id="odl-controller-直接发送数据包到网络中">ODL controller 直接发送数据包到网络中</h1>
<p>ODL controller 直接发包, 其本质上并不是controller本身可以发送想要的数据包给某个目的地址。而是通过Openflow PacketOut message, 将要发包的指令传递给指定的发送设备，后者负责将包发出去，发送的方式多种多样，比如: 1. 可以通过PacketOut message指定要发送的信息(payload), 负责发送信息的设备(支持OpenFlow的设备，大多数情况下就是OVS交换机), 以及 ingress port。这种模式，相当于通过PacktOut信息传递给发送设备该设备认为是其指定的ingress port收到了一条信息，之后可以通过openflow rules就行一些列处理并且发送出去。 2. 可以通过PacketOut message指定要发送的信息(payload), 负责发送信息的设备(支持OpenFlow的设备，大多数情况下就是OVS交换机), 以及 egress port。这种模式就是告诉网络设备直接从某个端口发送一个包出去，而不会经过设备中已经存储的openflow rules的处理了。</p>
<h1 id="为啥通过-maven-archetype-创建的project都有个karaf">为啥通过 maven archetype 创建的project都有个karaf</h1>
<h1 id="odl-开发需要的基础知识">ODL 开发需要的基础知识</h1>
<p>ODL 依赖以下技术： * OSGI: 框架运行于ODL后台，它允许动态加载bundles和jar包，并且为了信息交换将bundle捆绑在一起。 * Karaf: 构建在OSGi框架上的应用程序容器，它简化了各方面的组包和安装应用程序操作。 * YANG: 一种数据建模语言，由RFC6020以及RFC6021定义, 通过应用,远程过程调用(PRC)以及通知消息(Notification)来操作模型配置和数据状态。</p>
<p>比较好的 ODL 开发教程，如下： https://www.sdnlab.com/community/article/odl/974 https://www.sdnlab.com/community/article/odl/978</p>
<p>很老的教程，但是可以拿来参考 http://www.muzixing.com/pages/2014/08/06/opendaylightzhong-kai-fa-mo-kuai-ping.html</p>
<p>https://www.sdnlab.com/18092.html</p>
<h1 id="osgi">OSGi</h1>
<p>仔细阅读这个资料并整理： https://www.cnblogs.com/jingmoxukong/p/4546947.html https://segmentfault.com/a/1190000007420617</p>
<p>这个教程 也是很不错：https://www.jianshu.com/p/2c0c8091e3de</p>
<p>https://www.tianmaying.com/tutorial/osgi-blueprint</p>
<h1 id="源码编译-odl">源码编译 ODL</h1>
<p>编译之后，生成的文件是会放在项目根目录之下的<code>karaf</code>文件夹之内的。</p>
<h1 id="odl-开发中的日志管理">ODL 开发中的日志管理</h1>
<p>It is not a bundle name you specify with the set <code>log level</code> command but a fully-qualified Java package or class name. You can also just edit <code>etc/org.ops4j.pax.logging.cfg</code> directly to set the log levels for packages/classes, for example: <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log4j<span class="selector-class">.logger</span><span class="selector-class">.org</span><span class="selector-class">.opendaylight</span>.mypackage=DEBUG</span><br></pre></td></tr></table></figure> In code you create Logger instances per class, for example: <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.opendaylight.mypackage;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = LoggerFactory.getLogger(MyClass.class);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> Log output goes to <code>data/log/karaf.log</code>.</p>
<p>也可以通过karaf console来操作: <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path<span class="regexp">/to/</span>client -u karaf -p karaf</span><br></pre></td></tr></table></figure> 查看目前log设置 <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lo</span><span class="variable">g:list</span></span><br></pre></td></tr></table></figure> 比如我们想改变某个java package log设置为DEBUG模式 <figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">log</span>:<span class="keyword">set</span> <span class="keyword">DEBUG</span> org.opendaylight.sfc.sbrest.json</span><br></pre></td></tr></table></figure> 最后我们发现，相应地，<code>etc/org.ops4j.pax.logging.cfg</code>中的配置也发生了变化。神奇！</p>
<p>https://svn.apache.org/repos/asf/karaf/site/production/manual/latest-3.0.x/log.html</p>
<p>https://logging.apache.org/log4j/2.x/manual/layouts.html https://howtodoinjava.com/log4j2/useful-conversion-pattern-examples/</p>
<h1 id="integration-项目">Integration 项目</h1>
<p>Integration 是一个框架性的工程，所有自己开发和修改的部分（包括controller、openflowPlugin&amp;Java三个工程）编译为包后，都可以放在该工程的目录下一起执行。注意，如果是自己开发的包，则可以直接放到该目录下。但是如果是修改的原本工程，然后编译的包要替换掉上面目录中原来的包，这里有个问题是 integration 的 plugin目录下的包名和 controller， openflowplugin， openflowjava 中编译出来的包命名方式有点小差别，复制过去之前先重命名下，使之和目录下的原来包文件名一致，再复制替换。（参考自@jason-zhou童鞋的《OpenDaylight开发学习笔记基础之Controller篇》）。将各个工程的jar包copy到integration里后，运用mvn clean install 编译integration。工程所在目录：</p>
<h1 id="odl-开发中必用的-karaf-指令">ODL 开发中必用的 Karaf 指令</h1>
<ul>
<li>feature:list -i 命令可以查看已经安装的功能模块</li>
<li>feature:install <feature> 命令可以安装想要的feature。</li>
<li>system:shutdown 退出ODL控制器</li>
</ul>
<p>To uninstall a feature, you must shut down OpenDaylight, delete the data directory, and start OpenDaylight up again. Uninstalling a feature using the Karaf <code>feature:uninstall</code> command is not supported and can cause unexpected and undesirable behavior.</p>
<h1 id="rpc-机制">RPC 机制</h1>
<p>在传统的开发模式中，我们通常将系统的各个服务部署在单台机器，随着服务的扩展，这种方式已经完全无法满足系统大规模的扩展需要，分布式系统由此诞生，在分布式系统中，最重要就是各个服务之间的 RPC 调用。</p>
<p>RPC 全称 Remote Procedure Call——远程过程调用，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的方式。简单一点就是：通过一定协议和方法使得调用远程计算机上的服务，就像调用本地服务一样。</p>
<h2 id="rpc-调用分类">RPC 调用分类</h2>
<p>从底层网络协议分: * 基于 HTTP 的RPC * 基于 二进制 RPC * 基于 TCP RPC 从是否跨平台可以分为: * 单语言 RPC (如RMI) * 跨平台 RPC, 如 Google protobuffer, RESTFul JSON, HTTP XML</p>
<p>从调用过程来看: * 同步通信 RPC: 指的是客户端发起调用后，必须等待调用执行完成并返回结果； * 异步通信 RPC: 指客户方调用后不关心执行结果返回，如果客户端需要结果，可用通过提供异步 callback 回调获取返回信息。大部分 RPC 框架都同时支持这两种方式的调用。</p>
<h1 id="sfc-项目">sfc 项目</h1>
<p>通过 git/gerrit 下载的代码来看，sfc 项目本身亦是由一个个Maven子项目构成的, 因为在其根目录下并没有pom.xml文件 pom.xml 主要描述了项目的maven坐标，依赖关系，开发者需要遵循的规则，缺陷管理系统，组织和licenses，以及其他所有的项目相关因素，是项目级别的配置文件 。</p>
<p>注意：setting.xml主要用于配置maven的运行环境等一系列通用的属性，是全局级别的配置文件；</p>
<h1 id="a-required-class-was-missing...javaxxmlbindjaxbexception...">A required class was missing...javax/xml/bind/JAXBException...</h1>
<p>解决方案：https://stackoverflow.com/questions/43574426/how-to-resolve-java-lang-noclassdeffounderror-javax-xml-bind-jaxbexception-in-j</p>
<h1 id="karaf-在虚拟机共享文件夹中启动的问题">karaf 在虚拟机共享文件夹中启动的问题</h1>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vagrant@odldev:<span class="regexp">/vagrant/</span>topology<span class="regexp">/karaf$ target/</span>assembly<span class="regexp">/bin/</span>karaf</span><br><span class="line">Apache Karaf starting up. Press Enter to open the shell now...</span><br><span class="line">  <span class="number">2</span>% [=&gt;                                                                      ]log4j:ERROR setFile(<span class="keyword">null</span>,<span class="keyword">true</span>) <span class="keyword">call</span> failed.</span><br><span class="line">java.io.FileNotFoundException: <span class="regexp">/home/</span>qsong<span class="regexp">/Documents/</span>odl_dev_tuto<span class="regexp">/topology/</span>karaf<span class="regexp">/target/</span>assembly<span class="regexp">/data/</span>log/karaf.log (No such <span class="keyword">file</span> or directory)</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span><br><span class="line"> <span class="number">89</span>% [================================================================&gt;       ]FATAL: PWC5963: The scratchDir you specified: <span class="regexp">/home/</span>qsong<span class="regexp">/Documents/</span>odl_dev_tuto<span class="regexp">/topology/</span>karaf<span class="regexp">/target/</span>assembly<span class="regexp">/data/</span>pax-web-jsp/moon is unusable.</span><br><span class="line"> <span class="number">90</span>% [================================================================&gt;       ]FATAL: PWC5963: The scratchDir you specified: <span class="regexp">/home/</span>qsong<span class="regexp">/Documents/</span>odl_dev_tuto<span class="regexp">/topology/</span>karaf<span class="regexp">/target/</span>assembly<span class="regexp">/data/</span>pax-web-jsp/oauth2 is unusable.</span><br><span class="line"> <span class="number">91</span>% [=================================================================&gt;      ]FATAL: PWC5963: The scratchDir you specified: <span class="regexp">/home/</span>qsong<span class="regexp">/Documents/</span>odl_dev_tuto<span class="regexp">/topology/</span>karaf<span class="regexp">/target/</span>assembly<span class="regexp">/data/</span>pax-web-jsp/auth is unusable.</span><br><span class="line"> <span class="number">96</span>% [=====================================================================&gt;  ]FATAL: PWC5963: The scratchDir you specified: <span class="regexp">/home/</span>qsong<span class="regexp">/Documents/</span>odl_dev_tuto<span class="regexp">/topology/</span>karaf<span class="regexp">/target/</span>assembly<span class="regexp">/data/</span>pax-web-jsp/restconf is unusable.</span><br><span class="line">FATAL: PWC5963: The scratchDir you specified: <span class="regexp">/home/</span>qsong<span class="regexp">/Documents/</span>odl_dev_tuto<span class="regexp">/topology/</span>karaf<span class="regexp">/target/</span>assembly<span class="regexp">/data/</span>pax-web-jsp/apidoc is unusable.</span><br><span class="line"><span class="number">100</span>% [========================================================================]</span><br></pre></td></tr></table></figure>
<p>以上信息为在vagrant启动的虚拟机中启动karaf的时候，报出的错误信息。karaf 是在 Host machine中编译通过的，<code>/home/qsong/Documents/odl_dev_tuto/</code> 在虚拟机中挂载为<code>/vagrant</code>文件夹。从上面的报错信息来看，因为是在主机中编译的，所以在启动karaf的时候会出现log日志文件找不到，某些路径找不到的问题。那么如果我们在虚拟机下直接编译，还会出现这种问题么？</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">ERROR</span>] Failed to execute goal org.apache.maven.plugins:maven-clean-<span class="keyword">plugin</span>:3.0.0:clean (default-clean) <span class="keyword">on</span> project topology-karaf: Failed to clean project: Failed to delete /vagrant/topology/karaf/target/assembly/data/cache/org.eclipse.osgi/bundles -&gt; [<span class="keyword">Help</span> 1]</span><br><span class="line">[<span class="keyword">ERROR</span>]</span><br><span class="line">[<span class="keyword">ERROR</span>] To see the full <span class="keyword">stack</span> trace of the errors, re-<span class="keyword">run</span> Maven with the -<span class="keyword">e</span> switch.</span><br><span class="line">[<span class="keyword">ERROR</span>] Re-<span class="keyword">run</span> Maven using the -X switch to enable full debug logging.</span><br><span class="line">[<span class="keyword">ERROR</span>]</span><br><span class="line">[<span class="keyword">ERROR</span>] <span class="keyword">For</span> <span class="keyword">more</span> information <span class="keyword">about</span> the errors and possible solutions, please <span class="keyword">read</span> the following articles:</span><br><span class="line">[<span class="keyword">ERROR</span>] [<span class="keyword">Help</span> 1] http:<span class="comment">//cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException</span></span><br><span class="line">[<span class="keyword">ERROR</span>]</span><br><span class="line">[<span class="keyword">ERROR</span>] After correcting the problems, you can resume the build with the command</span><br><span class="line">[<span class="keyword">ERROR</span>]   mvn &lt;goals&gt; -rf :topology-karaf</span><br></pre></td></tr></table></figure>
<p>这是因为我在另一个terminal里面还开着karaf console，所以导致 maven clean plugin 无法清扫然后编译。关闭console之后，再编译就没有这个问题了。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">opendaylight</span>-user@root&gt;bundle:list | grep topology</span><br><span class="line"><span class="attribute">109</span> | Active      |  <span class="number">80</span> | <span class="number">2013</span>.<span class="number">10</span>.<span class="number">21</span>.<span class="number">10</span>_<span class="number">2</span>-Carbon              | ietf-topology</span><br><span class="line"><span class="attribute">110</span> | Active      |  <span class="number">80</span> | <span class="number">2013</span>.<span class="number">10</span>.<span class="number">21</span>.<span class="number">10</span>_<span class="number">2</span>-Carbon              | ietf-topology-isis</span><br><span class="line"><span class="attribute">111</span> | Active      |  <span class="number">80</span> | <span class="number">2013</span>.<span class="number">10</span>.<span class="number">21</span>.<span class="number">10</span>_<span class="number">2</span>-Carbon              | ietf-topology-ospf</span><br><span class="line"><span class="attribute">112</span> | Active      |  <span class="number">80</span> | <span class="number">2013</span>.<span class="number">10</span>.<span class="number">21</span>.<span class="number">10</span>_<span class="number">2</span>-Carbon              | ietf-topology-l<span class="number">3</span>-unicast-igp</span><br><span class="line"><span class="attribute">213</span> | Active      |  <span class="number">80</span> | <span class="number">1</span>.<span class="number">5</span>.<span class="number">2</span>.Carbon                        | org.opendaylight.controller.model.model-topology</span><br><span class="line"><span class="attribute">226</span> | GracePeriod |  <span class="number">80</span> | <span class="number">0</span>.<span class="number">4</span>.<span class="number">2</span>.Carbon                        | topology-lldp-discovery</span><br><span class="line"><span class="attribute">227</span> | GracePeriod |  <span class="number">80</span> | <span class="number">0</span>.<span class="number">4</span>.<span class="number">2</span>.Carbon                        | topology-manager</span><br><span class="line"><span class="attribute">229</span> | Active      |  <span class="number">80</span> | <span class="number">0</span>.<span class="number">1</span>.<span class="number">0</span>.SNAPSHOT                      | ODL :: org.opendaylight.topology :: topology-api</span><br><span class="line"><span class="attribute">230</span> | GracePeriod |  <span class="number">80</span> | <span class="number">0</span>.<span class="number">1</span>.<span class="number">0</span>.SNAPSHOT                      | ODL :: org.opendaylight.topology :: topology-impl</span><br></pre></td></tr></table></figure>
<p>我们注意到，有数个bundle处于<code>GracePeriod</code>状态。该状态的通俗解释是&quot;time out that happens at start up stage&quot;. 我们再打开执行： <figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">opendaylight-user@root&gt;bundle:diag</span><br><span class="line"><span class="section">mdsal-eos-binding-adapter (158)</span></span><br><span class="line"><span class="section">-------------------------------</span></span><br><span class="line">Status: GracePeriod</span><br><span class="line">Blueprint</span><br><span class="line">6/16/19 2:27 AM</span><br><span class="line">Missing dependencies:</span><br><span class="line">(objectClass=org.opendaylight.mdsal.binding.dom.codec.api.BindingNormalizedNodeSerializer) (objectClass=org.opendaylight.mdsal.eos.dom.api.DOMEntityOwnershipService)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">mdsal-singleton-dom-impl (160)</span></span><br><span class="line"><span class="section">------------------------------</span></span><br><span class="line">Status: GracePeriod</span><br><span class="line">Blueprint</span><br><span class="line">6/16/19 2:27 AM</span><br><span class="line">Missing dependencies:</span><br><span class="line">(objectClass=org.opendaylight.mdsal.eos.dom.api.DOMEntityOwnershipService)</span><br><span class="line">(以下省略内容若干)</span><br><span class="line"></span><br><span class="line"><span class="section">org.opendaylight.aaa.aaa-shiro (281)</span></span><br><span class="line"><span class="section">------------------------------------</span></span><br><span class="line">Status: GracePeriod</span><br><span class="line">Blueprint</span><br><span class="line">6/16/19 2:28 AM</span><br><span class="line">Missing dependencies:</span><br><span class="line">(objectClass=org.opendaylight.aaa.cert.api.ICertificateManager) (objectClass=org.opendaylight.controller.md.sal.binding.api.DataBroker)</span><br></pre></td></tr></table></figure> 看到这些错误顿时觉得头大，毫无思路。毕竟这个命令只能告诉我们有什么错误，但并没有告诉我们进一步的错误信息。我们打开karaf日志文件看下: <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">06</span>-<span class="number">16</span> <span class="number">02</span>:<span class="number">27</span>:<span class="number">27</span>,<span class="number">853</span> | INFO  | Event Dispatcher | ServiceRecipe                    | <span class="number">15</span> - org.apache.aries.blueprint.core - <span class="number">1.6</span>.<span class="number">1</span> | Unable to create a proxy object <span class="keyword">for</span> the service .component-<span class="number">1</span> defined <span class="keyword">in</span> bundle org.apache.karaf.deployer.features/<span class="number">3.0</span>.<span class="number">8</span> with id. Returning the original object instead.</span><br><span class="line">org.apache.aries.proxy.UnableToProxyException: java.lang.ClassFormatError: Duplicate interface name <span class="string">&quot;org/apache/felix/fileinstall/ArtifactListener&quot;</span> <span class="keyword">in</span> class file Proxy7b9686ca_d0a4_4af2_9328_ec2785aa891b</span><br><span class="line">        at org.apache.aries.proxy.impl.interfaces.ProxyClassLoader.createProxyClass(ProxyClassLoader.java:<span class="number">165</span>)</span><br><span class="line">(以下省略内容若干)</span><br><span class="line"><span class="number">2019</span>-<span class="number">06</span>-<span class="number">16</span> <span class="number">02</span>:<span class="number">27</span>:<span class="number">49</span>,<span class="number">087</span> | ERROR | ult-dispatcher-<span class="number">3</span> | OneForOneStrategy                | <span class="number">179</span> - com.typesafe.akka.slf4j - <span class="number">2.4</span>.<span class="number">18</span> | IO error: <span class="regexp">/vagrant/</span>topology<span class="regexp">/karaf/</span>target<span class="regexp">/assembly/</span>journal/MANIFEST-<span class="number">000001</span>: Invalid argument</span><br><span class="line">akka.actor.ActorInitializationException: akka:<span class="regexp">//</span>opendaylight-cluster-data<span class="regexp">/system/</span>akka.persistence.journal.leveldb: exception during creation</span><br><span class="line">        at akka.actor.ActorInitializationException$.apply(Actor.scala:<span class="number">180</span>)[<span class="number">178</span>:com.typesafe.akka.actor:<span class="number">2.4</span>.<span class="number">18</span>]</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">Caused by: org.fusesource.leveldbjni.internal.NativeDB<span class="variable">$DBException</span>: IO error: <span class="regexp">/vagrant/</span>topology<span class="regexp">/karaf/</span>target<span class="regexp">/assembly/</span>journal/MANIFEST-<span class="number">000001</span>: Invalid argument</span><br></pre></td></tr></table></figure> 日志中这么多错误，让人感觉绝望。这么多bundle没有正确启动，日志里这么多异常信息，感觉真的是无从下手。冷静下来稍微思考之后，经验告诉我，虽然爆出来这么多错误信息，但是最应该关注的其实就是第一次出现错误的地方，很有可能，之后出现的所有的错误都是因为前几错误诱发的。</p>
<p>我发现似乎在虚拟机中, <code>levelDB</code>启动有问题(异常参数)。我就通过谷歌搜索看是否有人遇到过类似问题(不一定是在OpenDaylight开发过程中遇到)。结果还真是大有所获！<code>https://groups.google.com/forum/#!topic/leveldb/MjFwXk6_RgY</code> <code>https://github.com/Level/levelup/issues/222</code>, <code>https://github.com/google/leveldb/issues/281</code></p>
<p>网友们推测，出现上述问题的根源在于Virtualbox文件系统的Bug(并不在于levelDB)。Virtualbox和主机之间创建的共享文件夹使用的<code>vboxvfs</code>文件系统。 这两种解决办法： * 在 non-shared folder 中启动karaf没有这个问题，比如我们把<code>target</code>中生成的类似于<code>karaf.tar.gz</code>的文件解压缩到另一个non-shared文件夹下 启动karaf就没有这种问题了 * 在 <code>Vagrantfile</code> 中挂载共享文件夹的时候，采用<code>nfs</code>文件系统。采用以下语句: <figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.vm.synced_folder <span class="string">&quot;/your/local/path&quot;</span>, <span class="string">&quot;/home/vagrant/share&quot;</span>, <span class="attr">id</span>: <span class="string">&quot;core&quot;</span>, :<span class="function"><span class="params">nfs</span> =&gt;</span> <span class="literal">true</span>,  :<span class="function"><span class="params">mount_options</span>   =&gt;</span> [<span class="string">&#x27;nolock,vers=3,udp&#x27;</span>]</span><br></pre></td></tr></table></figure></p>
<h1 id="安装-odl-sfc-statistics-feature-失败">安装 odl-sfc-statistics feature 失败</h1>
<p>我发现有些 sfc feature 其实是处于 installed状态的。The state of <code>installed</code> means that the bundle is installed but not yet resolved. A bundle is in the INSTALLED state when it has been installed in the Framework but is not or cannot be resolved. The state of <code>Resolved</code> means that the bundle is resolved and is able to be started. A bundle is in the <code>RESOLVED</code> state when the Framework has successfully resolved the bundle's code dependencies.</p>
<p>通过查看 <code>bundle:diag</code>，输出全是跟 Genius 有关： <figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">opendaylight-user@root&gt;bundle:diag</span><br><span class="line"><span class="section">ODL :: genius :: interfacemanager-api (246)</span></span><br><span class="line"><span class="section">-------------------------------------------</span></span><br><span class="line">Status: Installed</span><br><span class="line">Unsatisfied Requirements:</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.genius.infra)(&amp;(version&gt;=0.7.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.genius.interfacemanager.exceptions)&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.genius.interfacemanager.globals)&quot;</span><br><span class="line"><span class="bullet">...</span></span><br><span class="line"><span class="bullet"></span></span><br><span class="line"><span class="bullet"></span><span class="section">ODL :: genius :: itm-api (248)</span></span><br><span class="line"><span class="section">------------------------------</span></span><br><span class="line">Status: Installed</span><br><span class="line">Unsatisfied Requirements:</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.yang.gen.v1.urn.opendaylight.genius.interfacemanager.rev160406)(&amp;(version&gt;=0.7.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.yang.gen.v1.urn.opendaylight.genius.itm.config.rev160406)&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.yang.gen.v1.urn.opendaylight.genius.itm.config.rev160406.itm.config)&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.yang.gen.v1.urn.opendaylight.genius.itm.config.rev160406.vtep.config.schemas)&quot;</span><br><span class="line"><span class="code">....</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">org.opendaylight.sfc.sfc-genius-utils (368)</span></span><br><span class="line"><span class="code">-------------------------------------------</span></span><br><span class="line">Status: Installed</span><br><span class="line">Unsatisfied Requirements:</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.genius.mdsalutil)(&amp;(version&gt;=0.7.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.sfc.genius.util)&quot;</span><br><span class="line"><span class="bullet">...</span></span><br><span class="line"><span class="bullet"></span></span><br><span class="line"><span class="bullet"></span><span class="section">org.opendaylight.sfc.sfc-openflow-renderer (370)</span></span><br><span class="line"><span class="section">------------------------------------------------</span></span><br><span class="line">Status: Installed</span><br><span class="line">Unsatisfied Requirements:</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.sfc.genius.util)(&amp;(version&gt;=0.10.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.sfc.genius.util.appcoexistence)(&amp;(version&gt;=0.10.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.sfc.renderers.openflow.listeners)&quot;</span><br><span class="line"><span class="bullet">...</span></span><br><span class="line"><span class="bullet"></span></span><br><span class="line"><span class="bullet"></span><span class="section">org.opendaylight.sfc.sfc-scf-openflow (375)</span></span><br><span class="line"><span class="section">-------------------------------------------</span></span><br><span class="line">Status: Installed</span><br><span class="line">Unsatisfied Requirements:</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.sfc.genius.util)(&amp;(version&gt;=0.10.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.pack</span><br></pre></td></tr></table></figure></p>
<p>有上述错误信息可以看出，所有的错误均跟 OpenDayLight Genius 有关。继续打开错误日志，会发现如下错误： <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">2019-06-16T20:30:39,353 | <span class="builtin-name">ERROR</span> | Karaf ssh<span class="built_in"> console user </span>karaf | support.ShellUtil                | 129 - org.apache.karaf.shell.core - 4.2.2 | Exception caught <span class="keyword">while</span> executing command</span><br><span class="line">org.apache.karaf.features.internal.util.MultiException: <span class="builtin-name">Error</span> restarting bundles:</span><br><span class="line">        Could <span class="keyword">not</span> resolve module: org.opendaylight.genius.mdsalutil-api [250]</span><br><span class="line">  Bundle was <span class="keyword">not</span> resolved because of a uses contraint violation.</span><br><span class="line">  org.osgi.service.resolver.ResolutionException: Uses constraint violation. Unable <span class="keyword">to</span> resolve<span class="built_in"> resource </span>org.opendaylight.genius.mdsalutil-api [osgi.identity; osgi.<span class="attribute">identity</span>=<span class="string">&quot;org.opendaylight.genius.mdsalutil-api&quot;</span>; <span class="attribute">type</span>=<span class="string">&quot;osgi.bundle&quot;</span>; version:<span class="attribute">Version</span>=<span class="string">&quot;0.7.0.SNAPSHOT&quot;</span>] because it is exposed <span class="keyword">to</span> package <span class="string">&#x27;javax.annotation&#x27;</span> <span class="keyword">from</span> resources javax.annotation-api [osgi.identity; osgi.<span class="attribute">identity</span>=<span class="string">&quot;javax.annotation-api&quot;</span>; <span class="attribute">type</span>=<span class="string">&quot;osgi.bundle&quot;</span>; version:<span class="attribute">Version</span>=<span class="string">&quot;1.2.0&quot;</span>] <span class="keyword">and</span> org.eclipse.osgi [osgi.identity; osgi.<span class="attribute">identity</span>=<span class="string">&quot;org.eclipse.osgi&quot;</span>; <span class="attribute">type</span>=<span class="string">&quot;osgi.bundle&quot;</span>; version:<span class="attribute">Version</span>=<span class="string">&quot;3.12.100.v20180210-1608&quot;</span>; singleton:=<span class="string">&quot;true&quot;</span>] via two dependency chains.</span><br><span class="line"><span class="built_in">..</span>.</span><br><span class="line">Chain 1:</span><br><span class="line">  org.opendaylight.genius.mdsalutil-api [osgi.identity; osgi.<span class="attribute">identity</span>=<span class="string">&quot;org.opendaylight.genius.mdsalutil-api&quot;</span>; <span class="attribute">type</span>=<span class="string">&quot;osgi.bundle&quot;</span>; version:<span class="attribute">Version</span>=<span class="string">&quot;0.7.0.SNAPSHOT&quot;</span>]</span><br><span class="line">    import: (&amp;(osgi.wiring.<span class="attribute">package</span>=javax.annotation)(&amp;(version&gt;=1.2.0)(!(version&gt;=2.0.0))))</span><br><span class="line"><span class="built_in">..</span>.</span><br><span class="line">Chain 2:</span><br><span class="line">  org.opendaylight.genius.mdsalutil-api [osgi.identity; osgi.<span class="attribute">identity</span>=<span class="string">&quot;org.opendaylight.genius.mdsalutil-api&quot;</span>;</span><br></pre></td></tr></table></figure></p>
<p>我曾经试验过，如果不安装这个feature的话， <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">bundle</span>:list</span><br><span class="line"><span class="attribute">368</span> ? Active   ?  <span class="number">80</span> ? <span class="number">0</span>.<span class="number">10</span>.<span class="number">0</span>.SNAPSHOT                        ? org.opendaylight.sfc.sfc-genius-utils</span><br><span class="line"><span class="attribute">369</span> ? Active   ?  <span class="number">80</span> ? <span class="number">0</span>.<span class="number">10</span>.<span class="number">0</span>.SNAPSHOT                        ? org.opendaylight.sfc.sfc-model</span><br><span class="line"><span class="attribute">370</span> ? Active   ?  <span class="number">80</span> ? <span class="number">0</span>.<span class="number">10</span>.<span class="number">0</span>.SNAPSHOT                        ? org.opendaylight.sfc.sfc-openflow-renderer</span><br><span class="line"><span class="attribute">371</span> ? Active   ?  <span class="number">80</span> ? <span class="number">0</span>.<span class="number">10</span>.<span class="number">0</span>.SNAPSHOT                        ? org.opendaylight.sfc.sfc-openflow-utils</span><br><span class="line"><span class="attribute">372</span> ? Active   ?  <span class="number">80</span> ? <span class="number">0</span>.<span class="number">10</span>.<span class="number">0</span>.SNAPSHOT                        ? org.opendaylight.sfc.sfc-ovs</span><br><span class="line"><span class="attribute">373</span> ? Active   ?  <span class="number">80</span> ? <span class="number">0</span>.<span class="number">10</span>.<span class="number">0</span>.SNAPSHOT                        ? org.opendaylight.sfc.sfc-provider</span><br><span class="line"><span class="attribute">374</span> ? Active   ?  <span class="number">80</span> ? <span class="number">0</span>.<span class="number">10</span>.<span class="number">0</span>.SNAPSHOT                        ? org.opendaylight.sfc.sfc-sb-rest</span><br><span class="line"><span class="attribute">375</span> ? Active   ?  <span class="number">80</span> ? <span class="number">0</span>.<span class="number">10</span>.<span class="number">0</span>.SNAPSHOT                        ? org.opendaylight.sfc.sfc-scf-openflow</span><br></pre></td></tr></table></figure> 所有的bundle都是active状态，<code>bundle:diag</code> has no error information. We are sure that installation of <code>odl-sfc-statistics</code> lead to error, render bundle such as <code>org.opendaylight.sfc.sfc-genius-utils</code> and <code>org.opendaylight.sfc.sfc-scf-openflow</code> into state of <code>installed</code>.</p>
<p>最后终于找到原因了： &gt; The dependent features would result in bundle refresh which could lead to bundle resolution problems and it is recommended to install the features together (feature:install x y z...rather than feature:install x feaure:install y so on) in karaf 4.0 (which is being used in Oxygen,ie,0.8)</p>
<p>https://docs.opendaylight.org/en/stable-oxygen/release-notes/projects/distribution.html#known-issues https://jira.opendaylight.org/browse/OPNFLWPLUG-1029</p>
<p>此外只要重启karaf进程，之前安装的feature就不存在了。。。而且虽然我使用java11运行ODL 但对结果并没影响。</p>
<p>此时执行: <figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant<span class="variable">@odl</span><span class="symbol">:/vagrant</span><span class="variable">$ </span>curl -i -H <span class="string">&quot;Content-Type: application/json&quot;</span> -H <span class="string">&quot;Cache-Control: no-cache&quot;</span> --data <span class="string">&#x27;&#123; &quot;input&quot;: &#123; &#125; &#125;&#x27;</span> -X POST --user <span class="symbol">admin:</span>admin <span class="symbol">http:</span>/<span class="regexp">/localhost:8181/restconf</span><span class="regexp">/operations/sfc</span>-statistics-<span class="symbol">operations:</span>get-rsp-statistics</span><br></pre></td></tr></table></figure> 得到回复： <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>JSESSIONID=node01t7wy9hmts7paqj22cwr5tpjq10.node0;Path=/</span><br><span class="line"><span class="attribute">Expires</span><span class="punctuation">: </span>Thu, 01 Jan 1970 00:00:00 GMT</span><br><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>rememberMe=deleteMe; Path=/; Max-Age=0; Expires=Sun, 16-Jun-2019 13:36:49 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/yang.operation+json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>365</span><br><span class="line"></span><br><span class="line"><span class="json">&#123;<span class="attr">&quot;output&quot;</span>:&#123;<span class="attr">&quot;statistics&quot;</span>:[&#123;<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;SFP1-Path-1&quot;</span>,<span class="attr">&quot;statistic-by-timestamp&quot;</span>:[&#123;<span class="attr">&quot;timestamp&quot;</span>:<span class="number">1560778609224</span>,<span class="attr">&quot;service-statistic&quot;</span>:&#123;<span class="attr">&quot;packets-in&quot;</span>:<span class="number">10</span>,<span class="attr">&quot;packets-out&quot;</span>:<span class="number">10</span>,<span class="attr">&quot;bytes-out&quot;</span>:<span class="number">1750</span>,<span class="attr">&quot;bytes-in&quot;</span>:<span class="number">1360</span>&#125;&#125;]&#125;,&#123;<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;SFP1-Path-1-Reverse&quot;</span>,<span class="attr">&quot;statistic-by-timestamp&quot;</span>:[&#123;<span class="attr">&quot;timestamp&quot;</span>:<span class="number">1560778609228</span>,<span class="attr">&quot;service-statistic&quot;</span>:&#123;<span class="attr">&quot;packets-in&quot;</span>:<span class="number">8</span>,<span class="attr">&quot;packets-out&quot;</span>:<span class="number">8</span>,<span class="attr">&quot;bytes-out&quot;</span>:<span class="number">1673</span>,<span class="attr">&quot;bytes-in&quot;</span>:<span class="number">1088</span>&#125;&#125;]&#125;]&#125;&#125;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="扩展-yang-data-model">扩展 YANG data model</h1>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">sending service <span class="keyword">function</span> chains</span><br><span class="line">PUT http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">1.5</span>:<span class="number">8181</span><span class="regexp">/restconf/</span>config<span class="regexp">/service-function-chain:service-function-chains/</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;service-function-chains&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;service-function-chain&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;SFC1&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sfc-service-function&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;dpi-abstract1&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;dpi&quot;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;firewall-abstract1&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;firewall&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                <span class="string">&quot;sig-gen-param&quot;</span>: <span class="string">&quot;type a\nq 8780710799663312522437781984754049815806883199414208211028653399266475630880222957078625179422662221423155858769582317459277713367317481324925129998224791\nh 12016012264891146079388821366740534204802954401251311822919615131047207289359704531102844802183906537786776\nr 730750818665451621361119245571504901405976559617\nexp2 159\nexp1 107\nsign1 1\nsign0 1&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;<span class="string">&quot;errors&quot;</span>:&#123;<span class="string">&quot;error&quot;</span>:[&#123;<span class="string">&quot;error-type&quot;</span>:<span class="string">&quot;protocol&quot;</span>,<span class="string">&quot;error-tag&quot;</span>:<span class="string">&quot;malformed-message&quot;</span>,<span class="string">&quot;error-message&quot;</span>:<span class="string">&quot;Error parsing input: Schema node with name sig-gen-param was not found under (urn:cisco:params:xml:ns:yang:sfc-sfc?revision=2014-07-01)service-function-chain.&quot;</span>,<span class="string">&quot;error-info&quot;</span>:<span class="string">&quot;Schema node with name sig-gen-param was not found under (urn:cisco:params:xml:ns:yang:sfc-sfc?revision=2014-07-01)service-function-chain.&quot;</span>&#125;]&#125;&#125;</span><br><span class="line">HTTP PUT <span class="regexp">/restconf/</span>config<span class="regexp">/service-function-chain:service-function-chains/</span></span><br><span class="line">result: <span class="number">400</span></span><br></pre></td></tr></table></figure>
<p>原因是，我编译之后，很愚蠢地忘记将编译好的文件移动到$HOME/sfc/karaf/target/assembly文件夹下面了。所以在demo中执行的karaf中并没有最新的Yang model...</p>
<h1 id="启动karaf-安装sfc-feature-报错">启动karaf 安装sfc feature 报错！</h1>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">opendaylight-<span class="keyword">user</span>@root&gt;feature:install odl-sfc-model odl-sfc-provider-rest odl-sfc-sb-rest odl-sfc-openflow-renderer odl-sfc-scf-openflow odl-sfc-ovs odl-sfc-<span class="keyword">statistics</span></span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable <span class="keyword">to</span> resolve root: missing requirement [root] osgi.<span class="keyword">identity</span>; osgi.<span class="keyword">identity</span>=odl-sfc-ovs; <span class="keyword">type</span>=karaf.feature; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; <span class="keyword">filter</span>:=&quot;(&amp;(osgi.identity=odl-sfc-ovs)(type=karaf.feature)(version&gt;=0.10.0.SNAPSHOT)(version&lt;=0.10.0.SNAPSHOT))&quot; [caused <span class="keyword">by</span>: Unable <span class="keyword">to</span> resolve odl-sfc-ovs/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>: missing requirement [odl-sfc-ovs/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>] osgi.<span class="keyword">identity</span>; osgi.<span class="keyword">identity</span>=odl-ovsdb-southbound-impl; <span class="keyword">type</span>=karaf.feature; version=&quot;[1.9.0.SNAPSHOT,1.9.0.SNAPSHOT]&quot; [caused <span class="keyword">by</span>: Unable <span class="keyword">to</span> resolve odl-ovsdb-southbound-impl/<span class="number">1.9</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>: missing requirement [odl-ovsdb-southbound-impl/<span class="number">1.9</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>] osgi.<span class="keyword">identity</span>; osgi.<span class="keyword">identity</span>=odl-ovsdb-library; <span class="keyword">type</span>=karaf.feature; version=&quot;[1.9.0.SNAPSHOT,1.9.0.SNAPSHOT]&quot; [caused <span class="keyword">by</span>: Unable <span class="keyword">to</span> resolve odl-ovsdb-library/<span class="number">1.9</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>: missing requirement [odl-ovsdb-library/<span class="number">1.9</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>] osgi.<span class="keyword">identity</span>; osgi.<span class="keyword">identity</span>=odl-aaa-cert; <span class="keyword">type</span>=karaf.feature; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot; [caused <span class="keyword">by</span>: Unable <span class="keyword">to</span> resolve odl-aaa-cert/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>: missing requirement [odl-aaa-cert/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>] osgi.<span class="keyword">identity</span>; osgi.<span class="keyword">identity</span>=org.opendaylight.aaa.cert; <span class="keyword">type</span>=osgi.bundle; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; resolution:=mandatory [caused <span class="keyword">by</span>: Unable <span class="keyword">to</span> resolve org.opendaylight.aaa.cert/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>: missing requirement [org.opendaylight.aaa.cert/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>] osgi.wiring.package; <span class="keyword">filter</span>:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.mdsal.binding.api)(version&gt;=3.0.0)(!(version&gt;=4.0.0)))&quot;]]]]]</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:<span class="number">1343</span>)</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.doResolve(ResolverImpl.java:<span class="number">392</span>)</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:<span class="number">378</span>)</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:<span class="number">332</span>)</span><br><span class="line">    at org.apache.karaf.features.internal.region.SubsystemResolver.resolve(SubsystemResolver.java:<span class="number">257</span>)</span><br><span class="line">    at org.apache.karaf.features.internal.service.Deployer.deploy(Deployer.java:<span class="number">388</span>)</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.doProvision(FeaturesServiceImpl.java:<span class="number">1025</span>)</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.lambda$doProvisionInThread$<span class="pgsql"><span class="number">13</span>(FeaturesServiceImpl.java:<span class="number">964</span>)</span></span><br><span class="line"><span class="pgsql">    at java.util.concurrent.FutureTask.run(FutureTask.java:<span class="number">266</span>)</span></span><br><span class="line"><span class="pgsql">    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class="number">1149</span>)</span></span><br><span class="line"><span class="pgsql">    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class="number">624</span>)</span></span><br><span class="line"><span class="pgsql">    at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span></span><br><span class="line"><span class="pgsql">Caused <span class="keyword">by</span>: org.apache.felix.resolver.reason.ReasonException: Unable <span class="keyword">to</span> resolve odl-sfc-ovs/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>: missing requirement [odl-sfc-ovs/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>] osgi.<span class="keyword">identity</span>; osgi.<span class="keyword">identity</span>=odl-ovsdb-southbound-impl; <span class="keyword">type</span>=karaf.feature; version=&quot;[1.9.0.SNAPSHOT,1.9.0.SNAPSHOT]&quot; [caused <span class="keyword">by</span>: Unable <span class="keyword">to</span> resolve odl-ovsdb-southbound-impl/<span class="number">1.9</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>: missing requirement [odl-ovsdb-southbound-impl/<span class="number">1.9</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>] osgi.<span class="keyword">identity</span>; osgi.<span class="keyword">identity</span>=odl-ovsdb-library; <span class="keyword">type</span>=karaf.feature; version=&quot;[1.9.0.SNAPSHOT,1.9.0.SNAPSHOT]&quot; [caused <span class="keyword">by</span>: Unable <span class="keyword">to</span> resolve odl-ovsdb-library/<span class="number">1.9</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>: missing requirement [odl-ovsdb-library/<span class="number">1.9</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>] osgi.<span class="keyword">identity</span>; osgi.<span class="keyword">identity</span>=odl-aaa-cert; <span class="keyword">type</span>=karaf.feature; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot; [caused <span class="keyword">by</span>: Unable <span class="keyword">to</span> resolve odl-aaa-cert/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>: missing requirement [odl-aaa-cert/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>] osgi.<span class="keyword">identity</span>; osgi.<span class="keyword">identity</span>=org.opendaylight.aaa.cert; <span class="keyword">type</span>=osgi.bundle; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; resolution:=mandatory [caused <span class="keyword">by</span>: Unable <span class="keyword">to</span> resolve org.opendaylight.aaa.cert/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>: missing requirement [org.opendaylight.aaa.cert/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>] osgi.wiring.package; <span class="keyword">filter</span>:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.mdsal.binding.api)(version&gt;=3.0.0)(!(version&gt;=4.0.0)))&quot;]]]]</span></span><br><span class="line"><span class="pgsql">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:<span class="number">1343</span>)</span></span><br></pre></td></tr></table></figure>
<h1 id="删除.m2repository所有内容之后编译反而无法通过了">删除.m2/repository所有内容之后，编译反而无法通过了。。。</h1>
<p>神奇！我执行 <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin <span class="literal">master</span></span><br></pre></td></tr></table></figure> 最后居然没有改变我在我本地端的改变，只获取了我没有动过的文件的update...</p>
<p>更神奇的是，我本地端还有修改还没有git add/git commit呢，结果上述命令直接把我origin弄下来的更新 merge/add/commit了！！！</p>
<p>可能是，我修改过的代码，远程端的文件压根没有改变过，所以git认为我本地的改变更新？ 没有出现，origin从方向1改变，而我朝方向2改变，这就没有构成冲突？？</p>
<p>最后顺利编译通过，没有错误，运行起来也没有任何错误，demo 也顺利执行了！神奇！！！</p>
<h1 id="清空了sfckaraftargetassembly文件之后将新编译好的文件解压之后直接放在这里当试图去关闭karaf进程的时候会出现无法关闭的情况-失败的信息非常的奇怪第一个错误提示的应该是karaf-console-shell-ssh进程无法被连接上">清空了sfc/karaf/target/assembly文件之后，将新编译好的文件解压之后直接放在这里，当试图去关闭karaf进程的时候，会出现无法关闭的情况 失败的信息非常的奇怪，第一个错误提示的应该是karaf console shell ssh进程无法被连接上。</h1>
<h1 id="为什么要同时有-service-function-chain-service-function-paths-rendered-service-paths-三种概念">为什么要同时有 service-function-chain, service-function-paths, rendered-service-paths 三种概念？</h1>
<p>这三种概念一层比一层递进 为什么会有这种设计？？</p>
<h1 id="section"></h1>
<p>org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI 实际负责具体的RSP的创建 我需要在这个类里做具体扩展</p>
<h1 id="section-1"></h1>
<p>在编译sfc项目的时候，子项目sfc-provider出了问题，改正错误之后，采用命令 <figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mvn</span> dependency:go-offline -rf sfc-provider install -nsu -DskipTests</span><br></pre></td></tr></table></figure> 编译安装，但是最后发现karaf启动异常，疑似出现data model缺失的情况，我怀疑可能是之前我可能执行过 <code>mvn clean</code> 之类的东西。</p>
<h1 id="section-2"></h1>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="builtin-name">INFO</span>] --- spotbugs-maven-plugin:3.1.11:check (analyze-compile) @ sfc-provider ---</span><br><span class="line">[<span class="builtin-name">INFO</span>] BugInstance size is 1</span><br><span class="line">[<span class="builtin-name">INFO</span>] <span class="builtin-name">Error</span> size is 0</span><br><span class="line">[<span class="builtin-name">INFO</span>] Total bugs: 1</span><br><span class="line">[<span class="builtin-name">ERROR</span>] Dead store <span class="keyword">to</span> sfServicePathList <span class="keyword">in</span> org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI.createRenderedServicePathEntry(ServiceFunctionPath, String, SfcServiceFunctionSchedulerAPI) [org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI] At SfcProviderRenderedPathAPI.java:[line 500] DLS_DEAD_LOCAL_STORE</span><br><span class="line">[<span class="builtin-name">INFO</span>]</span><br></pre></td></tr></table></figure>
<p>在编译的时候，之所以会报这个错误，是因为定义与赋值之后的变量 sfServicePathList 在后续根本没有被调用过。</p>
<h1 id="python-process-中-如何重启-thread">Python process 中 如何重启 thread?</h1>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">INFO:sfc/sfc_agent.<span class="keyword">py</span>:Received request <span class="keyword">for</span> SF creation: dpi-<span class="number">1</span></span><br><span class="line">INFO:sfc/sfc_agent.<span class="keyword">py</span>:Received request from ODL <span class="keyword">to</span> create SF. local_sf_topo content i<span class="variable">s:</span> &#123;<span class="string">&#x27;dpi-1&#x27;</span>: &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;dpi-1&#x27;</span>, <span class="string">&#x27;sf-data-plane-locator&#x27;</span>: [&#123;<span class="string">&#x27;ip&#x27;</span>: <span class="string">&#x27;192.168.1.11&#x27;</span>, <span class="string">&#x27;port&#x27;</span>: <span class="number">6633</span>, <span class="string">&#x27;service-function-forwarder&#x27;</span>: <span class="string">&#x27;SFF1&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;dpi-1-dpl&#x27;</span>, <span class="string">&#x27;transport&#x27;</span>: <span class="string">&#x27;service-locator:vxlan-gpe&#x27;</span>&#125;], <span class="string">&#x27;ip-mgmt-address&#x27;</span>: <span class="string">&#x27;192.168.1.11&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;service-function-type:dpi&#x27;</span>, <span class="string">&#x27;rest-uri&#x27;</span>: <span class="string">&#x27;http://192.168.1.11:5000&#x27;</span>&#125;&#125;</span><br><span class="line">INFO:sfc.common.launcher:Starting Service Function: dpi-<span class="number">1</span></span><br><span class="line">ERROR:__main__:Exception <span class="keyword">on</span> /config/service-<span class="function"><span class="keyword">function</span>:<span class="title">service</span>-<span class="title">functions</span>/<span class="title">service</span>-<span class="title">function</span>/<span class="title">dpi</span>-1 [<span class="title">PUT</span>]</span></span><br><span class="line">Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>):</span><br><span class="line">  File <span class="string">&quot;/usr/local/lib/python3.5/dist-packages/flask/app.py&quot;</span>, <span class="built_in">line</span> <span class="number">1817</span>, in wsgi_app</span><br><span class="line">    response = self.full_dispatch_request()</span><br><span class="line">  File <span class="string">&quot;/usr/local/lib/python3.5/dist-packages/flask/app.py&quot;</span>, <span class="built_in">line</span> <span class="number">1477</span>, in full_dispatch_request</span><br><span class="line">    <span class="keyword">rv</span> = self.handle_user_exception(<span class="keyword">e</span>)</span><br><span class="line">  File <span class="string">&quot;/usr/local/lib/python3.5/dist-packages/flask/app.py&quot;</span>, <span class="built_in">line</span> <span class="number">1381</span>, in handle_user_exception</span><br><span class="line">    reraise(exc_type, exc_value, tb)</span><br><span class="line">  File <span class="string">&quot;/usr/local/lib/python3.5/dist-packages/flask/_compat.py&quot;</span>, <span class="built_in">line</span> <span class="number">33</span>, in reraise</span><br><span class="line">    raise value</span><br><span class="line">  File <span class="string">&quot;/usr/local/lib/python3.5/dist-packages/flask/app.py&quot;</span>, <span class="built_in">line</span> <span class="number">1475</span>, in full_dispatch_request</span><br><span class="line">    <span class="keyword">rv</span> = self.dispatch_request()</span><br><span class="line">  File <span class="string">&quot;/usr/local/lib/python3.5/dist-packages/flask/app.py&quot;</span>, <span class="built_in">line</span> <span class="number">1461</span>, in dispatch_request</span><br><span class="line">    <span class="keyword">return</span> self.view_functions[rule.endpoint](**req.view_args)</span><br><span class="line">  File <span class="string">&quot;sfc/sfc_agent.py&quot;</span>, <span class="built_in">line</span> <span class="number">303</span>, in create_sf</span><br><span class="line">    start_sf(sfname, sf_ip, sf_port, sf_type)</span><br><span class="line">  File <span class="string">&quot;/sfc/sfc-py/sfc/common/launcher.py&quot;</span>, <span class="built_in">line</span> <span class="number">229</span>, in start_sf</span><br><span class="line">    stop_service(sf_type, sf_name)</span><br><span class="line">  File <span class="string">&quot;/sfc/sfc-py/sfc/common/launcher.py&quot;</span>, <span class="built_in">line</span> <span class="number">209</span>, in stop_service</span><br><span class="line">    (service_type.upper(), service_name))</span><br><span class="line">TimeoutError: Failed <span class="keyword">to</span> <span class="keyword">stop</span> DPI <span class="string">&quot;dpi-1&quot;</span>: service thread <span class="keyword">is</span> still running after <span class="number">10</span>s</span><br><span class="line">INFO:werkzeu<span class="variable">g:192</span>.<span class="number">168.1</span>.<span class="number">5</span> - - [<span class="number">19</span>/Jun/<span class="number">2019</span> <span class="number">20</span>:<span class="number">26</span>:<span class="number">51</span>] <span class="string">&quot;PUT /config/service-function:service-functions/service-function/dpi-1 HTTP/1.1&quot;</span> <span class="number">500</span> -</span><br></pre></td></tr></table></figure>
<h1 id="section-3"></h1>
<p><code>sfc_agent.py</code> 启动以后，一个flask app 也随之被驱动，支持RESTFul API。比如service function 的创建，就是在收到<code>http:&lt;sf-ip-addr&gt;:6000/config/service-function:service-functions/service-function/&lt;sfname&gt;</code> 根据传递而来的JSON文件而创建(在进程中创建一个新 Thread)的。也即是，在一个service node上，<code>sfc_agent.py</code> 起到了一个前端proxy的作用，而随后创建的service funciton 其实只是一个运行在该进程中的一个 thread.</p>
<p>如果希望 service function 后续可以收到关于OMS加密的一些参数，那么需要注意: * 收到RESTFul API的时候，最好是在原有 Thread 不能停止运行的情况下，将 OMS 相关的参数传递给对应的 Thread. 实在不行 那就先kill掉，再创建一个新的 Thread。这么做的话，这个重启thread的速度需要尽量的快。比如一个 SFC 有变化，势必会诱发 OMS 参数的重新计算以及重新分配 (这样的话 一定要有DataChange event发生！相关的参数一定要写到DataStore里, 哪怕只写一个都行。。。) 如果一个SF只参与了一个SFC 且这个链条发生了变化，那么即使代表SF的thread重启了也没有关系，但是如果一个SF同时参与多个链条，那么这个时候SF需要重启可能就会对既有的SFC产生影响。。。</p>
<h1 id="section-4"></h1>
<p>SfcProviderServiceFunctionAPI 这个类中提供了方法: readServiceFunction 这个方法是向SfcDataStore中读取 ServiceFunction 对象出来的！！！而且我们看到, 在DataStore tree上，其母节点为 ServiceFunctions!!!</p>
<h1 id="section-5"></h1>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">2019</span>-<span class="number">06</span>-<span class="number">20</span>T<span class="number">01</span>:<span class="number">30</span>:<span class="number">26</span>,<span class="number">046</span> | ERROR | opendaylight-cluster-data-notification-dispatcher-<span class="number">41</span> | DataTreeChangeListenerActor      | org.opendaylight.controller.sal-clustering-commons | dataChanged(:<span class="number">83</span>): member-<span class="number">1</span>-shard-default-config: Error notifying listener org.opendaylight.sfc.provider.listeners.ServiceFunctionPathListener@<span class="number">48</span>c<span class="number">28</span>b<span class="number">2</span></span><br><span class="line"><span class="attribute">java</span>.lang.NullPointerException: null</span><br><span class="line">        <span class="attribute">at</span> org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI.createRenderedServicePathEntry(SfcProviderRenderedPathAPI.java:<span class="number">514</span>) ~[<span class="number">379</span>:org.opendaylight.sfc.provider:<span class="number">0</span>.<span class="number">10</span>.<span class="number">0</span>.SNAPSHOT]</span><br><span class="line">        <span class="attribute">at</span> org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI.createRenderedServicePathInConfig(SfcProviderRenderedPathAPI.java:<span class="number">143</span>) ~[<span class="number">379</span>:org.opendaylight.sfc.provider:<span class="number">0</span>.<span class="number">10</span>.<span class="number">0</span>.SNAPSHOT]</span><br><span class="line">        <span class="attribute">at</span> org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI.createRenderedServicePathInConfig(SfcProviderRenderedPathAPI.java:<span class="number">137</span>) ~[<span class="number">379</span>:org.opendaylight.sfc.provider:<span class="number">0</span>.<span class="number">10</span>.<span class="number">0</span>.SNAPSHOT]</span><br><span class="line">        <span class="attribute">at</span> org.opendaylight.sfc.provider.listeners.ServiceFunctionPathListener.add(ServiceFunctionPathListener.java:<span class="number">54</span>) ~[<span class="number">379</span>:org.opendaylight.sfc.provider:<span class="number">0</span>.<span class="number">10</span>.<span class="number">0</span>.SNAPSHOT]</span><br><span class="line">        <span class="attribute">at</span> org.opendaylight.sfc.provider.listeners.ServiceFunctionPathListener.add(ServiceFunctionPathListener.java:<span class="number">36</span>) ~[<span class="number">379</span>:org.opendaylight.sfc.provider:<span class="number">0</span>.<span class="number">10</span>.<span class="number">0</span>.SNAPSHOT]</span><br><span class="line">        <span class="attribute">at</span> org.opendaylight.serviceutils.tools.mdsal.listener.DataTreeChangeListenerActions.onDataTreeChanged(DataTreeChangeListenerActions.java:<span class="number">67</span>) ~[<span class="number">372</span>:org.opendaylight.serviceutils.tools-api:<span class="number">0</span>.<span class="number">4</span>.<span class="number">0</span>.SNAPSHOT]</span><br><span class="line">        <span class="attribute">at</span> org.opendaylight.serviceutils.tools.mdsal.listener.AbstractSyncDataTreeChangeListener.onDataTreeChanged(AbstractSyncDataTreeChangeListener.java:<span class="number">52</span>) ~[<span class="number">372</span>:org.opendaylight.serviceutils.tools-api:<span class="number">0</span>.<span class="number">4</span>.<span class="number">0</span>.SNAPSHOT]</span><br><span class="line">        <span class="attribute">at</span> org.opendaylight.controller.md.sal.binding.impl.BindingDOMDataTreeChangeListenerAdapter.onDataTreeChanged(BindingDOMDataTreeChangeListenerAdapter.java:<span class="number">42</span>) ~[<span class="number">225</span>:org.opendaylight.controller.sal-binding-broker-impl:<span class="number">1</span>.<span class="number">10</span>.<span class="number">0</span>.SNAPSHOT]</span><br><span class="line">        <span class="attribute">at</span> org.opendaylight.controller.sal.core.compat.AbstractLegacyDOMDataBrokerAdapter$ProxyListener.onDataTreeChanged(AbstractLegacyDOMDataBrokerAdapter.java:<span class="number">359</span>) ~[<span class="number">235</span>:org.opendaylight.controller.sal-core-compat:<span class="number">1</span>.<span class="number">10</span>.<span class="number">0</span>.SNAPSHOT]</span><br><span class="line">        <span class="attribute">at</span> org.opendaylight.controller.cluster.datastore.DataTreeChangeListenerActor.dataChanged(DataTreeChangeListenerActor.java:<span class="number">81</span>) ~[<span class="number">237</span>:org.opendaylight.controller.sal-distributed-datastore:<span class="number">1</span>.<span class="number">10</span>.<span class="number">0</span>.SNAPSHOT]</span><br><span class="line">        <span class="attribute">at</span> org.opendaylight.controller.cluster.datastore.DataTreeChangeListenerActor.handleReceive(DataTreeChangeListenerActor.java:<span class="number">42</span>) ~[<span class="number">237</span>:org.opendaylight.controller.sal-distributed-datastore:<span class="number">1</span>.<span class="number">10</span>.<span class="number">0</span>.SNAPSHOT]</span><br></pre></td></tr></table></figure>
<p><code>java.lang.NullPointerException: null at org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI.createRenderedServicePathEntry(sfcProviderRenderedPathAPI.java:514)</code> 仔细观察这个信息，你会发现，这是一个java coding过程中很常见的一个错误信息。原因是想访问一个并没有被创建的对象。</p>
<h1 id="如何添加并没有被-maven-repository-的jar文件">如何添加并没有被 <code>Maven repository</code> 的jar文件？</h1>
<p>Many Java applications have dependencies that aren’t available in a public or private Maven repository. Sometimes you may have just a third party java library, packaged as a jar, that you need to put in your local repository for use in your builds. This is a very common scenario.</p>
<p>chagne to the uncompressed file of jPBC project, and type the following command respectively for <code>jpbc-api-2.0.0.jar</code> and <code>jpbc-plaf-2.0.0.jar</code>. The installation order matters, because <code>jpbc-plaf-2.0.0.jar</code> has a dependency relationship on <code>jpbc-api-2.0.0.jar</code>. I on We observe the following output and confirm that these two<br />
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn install:install-<span class="built_in">file</span> -Dfile=&lt;path-<span class="keyword">to</span>-<span class="built_in">file</span>&gt; -DpomFile=&lt;path-<span class="keyword">to</span>-pomfile&gt;</span><br></pre></td></tr></table></figure> <figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[INFO] --- maven-install-plugin:<span class="number">2.4</span>:install-<span class="keyword">file</span> (<span class="keyword">default</span>-cli) @ jpbc ---</span><br><span class="line">[INFO] Installing <span class="regexp">/home/</span>qsong<span class="regexp">/Documents/</span>jpbc-<span class="number">2.0</span>.<span class="number">0</span><span class="regexp">/jars/</span>jpbc-plaf-<span class="number">2.0</span>.<span class="number">0</span>.jar to <span class="regexp">/home/</span>qsong<span class="regexp">/.m2/</span>repository<span class="regexp">/it/u</span>nisa<span class="regexp">/dia/g</span>as<span class="regexp">/jpbc-plaf/</span><span class="number">2.0</span>.<span class="number">0</span>/jpbc-plaf-<span class="number">2.0</span>.<span class="number">0</span>.jar</span><br><span class="line">[INFO] Installing <span class="regexp">/home/</span>qsong<span class="regexp">/Documents/</span>jpbc-<span class="number">2.0</span>.<span class="number">0</span><span class="regexp">/jpbc-plaf/</span>pom.xml to <span class="regexp">/home/</span>qsong<span class="regexp">/.m2/</span>repository<span class="regexp">/it/u</span>nisa<span class="regexp">/dia/g</span>as<span class="regexp">/jpbc-plaf/</span><span class="number">2.0</span>.<span class="number">0</span>/jpbc-plaf-<span class="number">2.0</span>.<span class="number">0</span>.pom</span><br></pre></td></tr></table></figure></p>
<p>还遇到了一个问题。。。解决方案： https://stackoverflow.com/questions/1355548/maven-including-jar-not-found-in-public-repository 大意就是 我们需要在依赖声明中，将某个jar文件的scope声明成system, 同时必须给出systemPath的属性，指明需要使用的jar文件的路径。 参考文献： 1. https://maven.apache.org/guides/mini/guide-3rd-party-jars-local.html 2. https://stackoverflow.com/questions/4955635/how-to-add-local-jar-files-to-a-maven-project 3. https://cleanprogrammer.net/adding-3rd-party-jar-to-maven-projects/</p>
<h1 id="还是添加第三方java-jar问题">还是添加第三方java jar问题</h1>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">INFO</span>] Running org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] Tests run: <span class="number">1</span>, Failures: <span class="number">0</span>, Errors: <span class="number">1</span>, Skipped: <span class="number">0</span>, <span class="type">Time</span> elapsed: <span class="number">26.15</span> s &lt;&lt;&lt; FAILURE! - <span class="keyword">in</span> org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] installFeatureCatchAndLog(org.opendaylight.odlparent.featuretest.SingleFeatureTest)[repoUrl: file:/home/qsong/Documents/sfc-patch/features/odl-sfc-provider/target/feature/feature.xml, Feature: odl-sfc-provider <span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>]  <span class="type">Time</span> elapsed: <span class="number">23.92</span> s  &lt;&lt;&lt; ERROR!</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable <span class="keyword">to</span> resolve org.opendaylight.sfc.provider/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>: missing requirement [org.opendaylight.sfc.provider/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>] osgi.wiring.package; <span class="keyword">filter</span>:=&quot;(osgi.wiring.package=it.unisa.dia.gas.jpbc)&quot;</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:<span class="number">1343</span>)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:<span class="number">1343</span>)</span><br></pre></td></tr></table></figure>
<p>我最后将jpbc project编译成bundle, 并且不用scop以及systemPath之后 (Using system scope may work but it is not recommended even in the Maven specification. it is not portable.)，编译出现这个错误！ <figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ERROR</span>] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 30.51 s &lt;&lt;&lt; FAILURE! - <span class="meta">in</span> org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[<span class="meta">ERROR</span>] installFeatureCatchAn<span class="meta">dLog(</span>org.opendaylight.odlparent.featuretest.SingleFeatureTest)[repoUrl: <span class="meta">file</span>:/home/qsong/Documents/sfc-patch/features/odl-sfc-provider/target/feature/feature.xml, Feature: odl-sfc-provider 0.10.0.SNAPSHOT]  Time elapsed: 28.683 s  &lt;&lt;&lt; <span class="meta">ERROR</span>!</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve org.opendaylight.sfc.provider/0.10.0.SNAPSHOT: <span class="meta">missing</span> requirement [org.opendaylight.sfc.provider/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=<span class="string">&quot;(&amp;(osgi.wiring.package=it.unisa.dia.gas.jpbc)(version&gt;=2.0.0)(!(version&gt;=3.0.0)))&quot;</span></span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toExcepti<span class="meta">on(</span>Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toExcepti<span class="meta">on(</span>Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toExcepti<span class="meta">on(</span>Candidates.java:1343)</span><br></pre></td></tr></table></figure> 为啥会出现 <code>version&gt;=3.0.0</code>? 我怀疑原因是我在 <code>features/odl-sfc-provider</code> 这个文件下的 <code>pom.xml</code> 中指明了scope=system以及systemPath的。取消了这两项之后，虽然还是报错，内容如下: <figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ERROR</span>] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 33.486 s &lt;&lt;&lt; FAILURE! - <span class="meta">in</span> org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[<span class="meta">ERROR</span>] installFeatureCatchAn<span class="meta">dLog(</span>org.opendaylight.odlparent.featuretest.SingleFeatureTest)[repoUrl: <span class="meta">file</span>:/home/qsong/Documents/sfc-patch/features/odl-sfc-provider/target/feature/feature.xml, Feature: odl-sfc-provider 0.10.0.SNAPSHOT]  Time elapsed: 26.74 s  &lt;&lt;&lt; <span class="meta">ERROR</span>!</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve org.opendaylight.sfc.provider/0.10.0.SNAPSHOT: <span class="meta">missing</span> requirement [org.opendaylight.sfc.provider/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=<span class="string">&quot;(osgi.wiring.package=it.unisa.dia.gas.plaf.jpbc.pairing)&quot;</span></span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toExcepti<span class="meta">on(</span>Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toExcepti<span class="meta">on(</span>Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toExcepti<span class="meta">on(</span>Candidates.java:1343)</span><br></pre></td></tr></table></figure> 这次找不到的是<code>it.unisa.dia.gas.plaf.jpbc.pairing</code>了 而不再是找不到 <code>it.unisa.dia.gas.plaf.jpbc</code> 了。</p>
<p>当我把 <code>features/odl-sfc-provider/pom.xml</code> 中关于 <code>sfc-jpbc</code>的依赖都删除之后，再编译错误又不一样了。。。首先，这个文件中确实不应该出现关于<code>sfc-jpbc</code>的依赖，因为正常的话，<code>sfc-jpbc</code>已经被收录进<code>sfc-provider</code>中了，而依赖 <code>sfc-provider</code> 已经在 <code>features/odl-sfc-provider/pom.xml</code> 声明过了。 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">INFO</span>] Running org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[<span class="builtin-name">ERROR</span>] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 27.418 s &lt;&lt;&lt; FAILURE! - <span class="keyword">in</span> org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[<span class="builtin-name">ERROR</span>] installFeatureCatchAndLog(org.opendaylight.odlparent.featuretest.SingleFeatureTest)[repoUrl: file:/home/qsong/Documents/sfc-patch/features/odl-sfc-provider/target/feature/feature.xml, Feature: odl-sfc-provider 0.10.0.SNAPSHOT]  Time elapsed: 23.186 s  &lt;&lt;&lt; ERROR!</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable <span class="keyword">to</span> resolve it.unisa.dia.gas.jpbc-plaf/2.0.0: missing requirement [it.unisa.dia.gas.jpbc-plaf/2.0.0] osgi.wiring.package; filter:=<span class="string">&quot;(osgi.wiring.package=it.unisa.dia.gas.plaf.jpbc.mm.clt13.pairing)&quot;</span></span><br><span class="line">    at org.apache.felix.resolver.Candidates<span class="variable">$MissingRequirementError</span>.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates<span class="variable">$MissingRequirementError</span>.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates<span class="variable">$MissingRequirementError</span>.toException(Candidates.java:1343)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">INFO</span>] Running org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[<span class="builtin-name">ERROR</span>] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 31.129 s &lt;&lt;&lt; FAILURE! - <span class="keyword">in</span> org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[<span class="builtin-name">ERROR</span>] installFeatureCatchAndLog(org.opendaylight.odlparent.featuretest.SingleFeatureTest)[repoUrl: file:/home/qsong/Documents/sfc-patch/features/odl-sfc-provider/target/feature/feature.xml, Feature: odl-sfc-provider 0.10.0.SNAPSHOT]  Time elapsed: 29.362 s  &lt;&lt;&lt; ERROR!</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable <span class="keyword">to</span> resolve it.unisa.dia.gas.jpbc-plaf/2.0.0: missing requirement [it.unisa.dia.gas.jpbc-plaf/2.0.0] osgi.wiring.package; filter:=<span class="string">&quot;(osgi.wiring.package=it.unisa.dia.gas.plaf.jpbc.mm.clt13.pairing)&quot;</span></span><br><span class="line">    at org.apache.felix.resolver.Candidates<span class="variable">$MissingRequirementError</span>.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates<span class="variable">$MissingRequirementError</span>.toException(Candidates.java:1343)</span><br></pre></td></tr></table></figure>
<h1 id="编译过程中出现-packetprocessingservice-找不到的情况">编译过程中出现 <code>PacketProcessingService</code> 找不到的情况</h1>
<ol type="1">
<li>https://yinqingwang.wordpress.com/2016/11/14/how-to-send-raw-packet-from-odls-controller-to-network-datapath/</li>
<li>https://ask.opendaylight.org/question/3872/opendaylight-plugin-send-packet-from-given-switch-and-given-port/</li>
<li>https://github.com/opendaylight/openflowplugin/blob/master/model/model-flow-service/src/main/yang/packet-processing.yang</li>
</ol>
<p>通过以上几个链接可以只知道，这个<code>PacketProcessingService</code> 接口实际上是在项目 <code>openflowplugin</code> 中的 <code>model</code> 中定义的。如果需要import这个接口，需要在我定义的项目的<code>pom.xml</code>文件中，添加如下依赖： <figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.opendaylight.openflowplugin.model<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>model-flow-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;feature.openflowplugin.version&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<h1 id="blueprint-文件编写有误">Blueprint 文件编写有误</h1>
<p>编译完毕，启动<code>karaf</code>, <code>features</code> 被安装完毕之后，执行 <code>bundle:diag</code>, 发现如下问题： <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">opendaylight-user@root&gt;bundle:diag</span><br><span class="line">org<span class="selector-class">.opendaylight</span><span class="selector-class">.sfc</span><span class="selector-class">.sfc-sfp-checker</span> (<span class="number">386</span>)</span><br><span class="line">------------------------------------------</span><br><span class="line">Status: Failure</span><br><span class="line">Declarative Services</span><br><span class="line">Blueprint</span><br><span class="line"><span class="number">7</span>/<span class="number">2</span>/<span class="number">19</span>, <span class="number">10</span>:<span class="number">37</span> AM</span><br><span class="line">Exception:</span><br><span class="line">Unresolved ref/idref to component: delaycollectorConfig</span><br><span class="line">org<span class="selector-class">.osgi</span><span class="selector-class">.service</span><span class="selector-class">.blueprint</span><span class="selector-class">.container</span><span class="selector-class">.ComponentDefinitionException</span>: Unresolved ref/idref to component: delaycollectorConfig</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.aries</span><span class="selector-class">.blueprint</span><span class="selector-class">.container</span><span class="selector-class">.BlueprintRepository</span><span class="selector-class">.validate</span>(BlueprintRepository<span class="selector-class">.java</span>:<span class="number">376</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.aries</span><span class="selector-class">.blueprint</span><span class="selector-class">.container</span><span class="selector-class">.RecipeBuilder</span><span class="selector-class">.createRepository</span>(RecipeBuilder<span class="selector-class">.java</span>:<span class="number">94</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.aries</span><span class="selector-class">.blueprint</span><span class="selector-class">.container</span><span class="selector-class">.BlueprintContainerImpl</span><span class="selector-class">.getRepository</span>(BlueprintContainerImpl<span class="selector-class">.java</span>:<span class="number">504</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.aries</span><span class="selector-class">.blueprint</span><span class="selector-class">.container</span><span class="selector-class">.BlueprintContainerImpl</span><span class="selector-class">.doRun</span>(BlueprintContainerImpl<span class="selector-class">.java</span>:<span class="number">361</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.aries</span><span class="selector-class">.blueprint</span><span class="selector-class">.container</span><span class="selector-class">.BlueprintContainerImpl</span><span class="selector-class">.run</span>(BlueprintContainerImpl<span class="selector-class">.java</span>:<span class="number">278</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.aries</span><span class="selector-class">.blueprint</span><span class="selector-class">.container</span><span class="selector-class">.BlueprintExtender</span><span class="selector-class">.createContainer</span>(BlueprintExtender<span class="selector-class">.java</span>:<span class="number">299</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.aries</span><span class="selector-class">.blueprint</span><span class="selector-class">.container</span><span class="selector-class">.BlueprintExtender</span><span class="selector-class">.createContainer</span>(BlueprintExtender<span class="selector-class">.java</span>:<span class="number">268</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.aries</span><span class="selector-class">.blueprint</span><span class="selector-class">.container</span><span class="selector-class">.BlueprintExtender</span><span class="selector-class">.createContainer</span>(BlueprintExtender<span class="selector-class">.java</span>:<span class="number">264</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.aries</span><span class="selector-class">.blueprint</span><span class="selector-class">.container</span><span class="selector-class">.BlueprintExtender</span><span class="selector-class">.modifiedBundle</span>(BlueprintExtender<span class="selector-class">.java</span>:<span class="number">254</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.aries</span><span class="selector-class">.util</span><span class="selector-class">.tracker</span><span class="selector-class">.hook</span>.BundleHookBundleTracker<span class="variable">$Tracked</span><span class="selector-class">.customizerModified</span>(BundleHookBundleTracker<span class="selector-class">.java</span>:<span class="number">500</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.aries</span><span class="selector-class">.util</span><span class="selector-class">.tracker</span><span class="selector-class">.hook</span>.BundleHookBundleTracker<span class="variable">$Tracked</span><span class="selector-class">.customizerModified</span>(BundleHookBundleTracker<span class="selector-class">.java</span>:<span class="number">433</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.aries</span><span class="selector-class">.util</span><span class="selector-class">.tracker</span><span class="selector-class">.hook</span>.BundleHookBundleTracker<span class="variable">$AbstractTracked</span><span class="selector-class">.track</span>(BundleHookBundleTracker<span class="selector-class">.java</span>:<span class="number">725</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.aries</span><span class="selector-class">.util</span><span class="selector-class">.tracker</span><span class="selector-class">.hook</span>.BundleHookBundleTracker<span class="variable">$Tracked</span><span class="selector-class">.bundleChanged</span>(BundleHookBundleTracker<span class="selector-class">.java</span>:<span class="number">463</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.aries</span><span class="selector-class">.util</span><span class="selector-class">.tracker</span><span class="selector-class">.hook</span>.BundleHookBundleTracker<span class="variable">$BundleEventHook</span><span class="selector-class">.event</span>(BundleHookBundleTracker<span class="selector-class">.java</span>:<span class="number">422</span>)</span><br><span class="line">    at org<span class="selector-class">.eclipse</span><span class="selector-class">.osgi</span><span class="selector-class">.internal</span><span class="selector-class">.framework</span>.EquinoxEventPublisher$<span class="number">2</span><span class="selector-class">.call</span>(EquinoxEventPublisher<span class="selector-class">.java</span>:<span class="number">239</span>)</span><br><span class="line">    at org<span class="selector-class">.eclipse</span><span class="selector-class">.osgi</span><span class="selector-class">.internal</span><span class="selector-class">.serviceregistry</span><span class="selector-class">.ServiceRegistry</span><span class="selector-class">.notifyHookPrivileged</span>(ServiceRegistry<span class="selector-class">.java</span>:<span class="number">1298</span>)</span><br><span class="line">    at org<span class="selector-class">.eclipse</span><span class="selector-class">.osgi</span><span class="selector-class">.internal</span><span class="selector-class">.serviceregistry</span><span class="selector-class">.ServiceRegistry</span><span class="selector-class">.notifyHooksPrivileged</span>(ServiceRegistry<span class="selector-class">.java</span>:<span class="number">1278</span>)</span><br><span class="line">    at org<span class="selector-class">.eclipse</span><span class="selector-class">.osgi</span><span class="selector-class">.internal</span><span class="selector-class">.framework</span><span class="selector-class">.EquinoxEventPublisher</span><span class="selector-class">.notifyEventHooksPrivileged</span>(EquinoxEventPublisher<span class="selector-class">.java</span>:<span class="number">236</span>)</span><br><span class="line">    at org<span class="selector-class">.eclipse</span><span class="selector-class">.osgi</span><span class="selector-class">.internal</span><span class="selector-class">.framework</span><span class="selector-class">.EquinoxEventPublisher</span><span class="selector-class">.publishBundleEventPrivileged</span>(EquinoxEventPublisher<span class="selector-class">.java</span>:<span class="number">194</span>)</span><br><span class="line">    at org<span class="selector-class">.eclipse</span><span class="selector-class">.osgi</span><span class="selector-class">.internal</span><span class="selector-class">.framework</span><span class="selector-class">.EquinoxEventPublisher</span><span class="selector-class">.publishBundleEvent</span>(EquinoxEventPublisher<span class="selector-class">.java</span>:<span class="number">120</span>)</span><br><span class="line">    at org<span class="selector-class">.eclipse</span><span class="selector-class">.osgi</span><span class="selector-class">.internal</span><span class="selector-class">.framework</span><span class="selector-class">.EquinoxEventPublisher</span><span class="selector-class">.publishBundleEvent</span>(EquinoxEventPublisher<span class="selector-class">.java</span>:<span class="number">112</span>)</span><br><span class="line">    at org<span class="selector-class">.eclipse</span><span class="selector-class">.osgi</span><span class="selector-class">.internal</span><span class="selector-class">.framework</span><span class="selector-class">.EquinoxContainerAdaptor</span><span class="selector-class">.publishModuleEvent</span>(EquinoxContainerAdaptor<span class="selector-class">.java</span>:<span class="number">168</span>)</span><br><span class="line">    at org<span class="selector-class">.eclipse</span><span class="selector-class">.osgi</span><span class="selector-class">.container</span><span class="selector-class">.Module</span><span class="selector-class">.publishEvent</span>(Module<span class="selector-class">.java</span>:<span class="number">476</span>)</span><br><span class="line">    at org<span class="selector-class">.eclipse</span><span class="selector-class">.osgi</span><span class="selector-class">.container</span><span class="selector-class">.Module</span><span class="selector-class">.start</span>(Module<span class="selector-class">.java</span>:<span class="number">467</span>)</span><br><span class="line">    at org<span class="selector-class">.eclipse</span><span class="selector-class">.osgi</span><span class="selector-class">.internal</span><span class="selector-class">.framework</span><span class="selector-class">.EquinoxBundle</span><span class="selector-class">.start</span>(EquinoxBundle<span class="selector-class">.java</span>:<span class="number">383</span>)</span><br><span class="line">    at org<span class="selector-class">.eclipse</span><span class="selector-class">.osgi</span><span class="selector-class">.internal</span><span class="selector-class">.framework</span><span class="selector-class">.EquinoxBundle</span><span class="selector-class">.start</span>(EquinoxBundle<span class="selector-class">.java</span>:<span class="number">402</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.karaf</span><span class="selector-class">.features</span><span class="selector-class">.internal</span><span class="selector-class">.service</span><span class="selector-class">.BundleInstallSupportImpl</span><span class="selector-class">.startBundle</span>(BundleInstallSupportImpl<span class="selector-class">.java</span>:<span class="number">161</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.karaf</span><span class="selector-class">.features</span><span class="selector-class">.internal</span><span class="selector-class">.service</span><span class="selector-class">.FeaturesServiceImpl</span><span class="selector-class">.startBundle</span>(FeaturesServiceImpl<span class="selector-class">.java</span>:<span class="number">1116</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.karaf</span><span class="selector-class">.features</span><span class="selector-class">.internal</span><span class="selector-class">.service</span><span class="selector-class">.Deployer</span><span class="selector-class">.deploy</span>(Deployer<span class="selector-class">.java</span>:<span class="number">997</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.karaf</span><span class="selector-class">.features</span><span class="selector-class">.internal</span><span class="selector-class">.service</span><span class="selector-class">.FeaturesServiceImpl</span><span class="selector-class">.doProvision</span>(FeaturesServiceImpl<span class="selector-class">.java</span>:<span class="number">1025</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.karaf</span><span class="selector-class">.features</span><span class="selector-class">.internal</span><span class="selector-class">.service</span><span class="selector-class">.FeaturesServiceImpl</span>.lambda<span class="variable">$doProvisionInThread</span>$<span class="number">13</span>(FeaturesServiceImpl<span class="selector-class">.java</span>:<span class="number">964</span>)</span><br><span class="line">    at java.base/java<span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.FutureTask</span><span class="selector-class">.run</span>(FutureTask<span class="selector-class">.java</span>:<span class="number">264</span>)</span><br><span class="line">    at java.base/java<span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.ThreadPoolExecutor</span><span class="selector-class">.runWorker</span>(ThreadPoolExecutor<span class="selector-class">.java</span>:<span class="number">1128</span>)</span><br><span class="line">    at java.base/java<span class="selector-class">.util</span><span class="selector-class">.concurrent</span>.ThreadPoolExecutor<span class="variable">$Worker</span><span class="selector-class">.run</span>(ThreadPoolExecutor<span class="selector-class">.java</span>:<span class="number">628</span>)</span><br><span class="line">    at java.base/java<span class="selector-class">.lang</span><span class="selector-class">.Thread</span><span class="selector-class">.run</span>(Thread<span class="selector-class">.java</span>:<span class="number">834</span>)</span><br></pre></td></tr></table></figure> 我自己编写的 SDN app 并没有顺利启动，说是 Unresolved ref/idref to component: delaycollectorConfig, 就是我写的 application 的配置类并没有被找到。从 Exception trace 来看，并没有提示是哪个class/method出的问题(不过从异常 org.osgi.service.blueprint.container.ComponentDefinitionException 来看，问题应该出在blueprint文件中)。我只能通过 grep + 关键词查找了，定位到了问题：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">blueprint</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;</span> <span class="attr">xmlns:odl</span>=<span class="string">&quot;http://opendaylight.org/xmlns/blueprint/v1.0.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">reference</span> <span class="attr">id</span>=<span class="string">&quot;dataBroker&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">interface</span>=<span class="string">&quot;org.opendaylight.controller.md.sal.binding.api.DataBroker&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">odl:type</span>=<span class="string">&quot;default&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">odl:clustered-app-config</span> <span class="attr">id</span>=<span class="string">&quot;pathCheckerConfig&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">binding-class</span>=<span class="string">&quot;org.opendaylight.yang.gen.v1.urn.opendaylight.sfc.sfp.checker.config.rev190701.SfpCheckerConfig&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">odl:clustered-app-config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">reference</span> <span class="attr">id</span>=<span class="string">&quot;notificationProviderService&quot;</span> <span class="attr">interface</span>=<span class="string">&quot;org.opendaylight.controller.sal.binding.api.NotificationProviderService&quot;</span>/&gt;</span>  </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">odl:rpc-service</span> <span class="attr">id</span>=<span class="string">&quot;mypacketHandlerService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">interface</span>=<span class="string">&quot;org.opendaylight.yang.gen.v1.urn.opendaylight.packet.service.rev130709.PacketProcessingService&quot;</span> /&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;<span class="name">reference</span> <span class="attr">id</span>=<span class="string">&quot;rpcRegistry&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">interface</span>=<span class="string">&quot;org.opendaylight.controller.sal.binding.api.RpcProviderRegistry&quot;</span> /&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;provider&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;org.opendaylight.sfc.pathchecker.SfpCheckerProvider&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">argument</span> <span class="attr">ref</span>=<span class="string">&quot;dataBroker&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">argument</span> <span class="attr">ref</span>=<span class="string">&quot;delaycollectorConfig&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">argument</span> <span class="attr">ref</span>=<span class="string">&quot;notificationProviderService&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">argument</span> <span class="attr">ref</span>=<span class="string">&quot;mypacketHandlerService&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">argument</span> <span class="attr">ref</span>=<span class="string">&quot;rpcRegistry&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">blueprint</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>原来是我实例化 <code>bean id=&quot;rpcRegistry&quot;</code>, 在argument处给了错误的的<code>ref</code>: 实际上应该是<code>pathCheckerConfig</code>而不是<code>delaycollectorConfig</code>. 因为这个错误导致的异常，最后连run-demo的ping包也没有发出去。</p>
<h1 id="section-6"></h1>
<p>在编译sfc-sfp-checker的时候，遇到如下错误： <figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time:  <span class="number">9.559</span> s</span><br><span class="line">[INFO] Finished at: <span class="number">2019</span>-<span class="number">07</span>-<span class="number">02</span>T12:<span class="number">47</span>:<span class="number">43</span>+<span class="number">02</span>:<span class="number">00</span></span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:<span class="number">3.8</span>.<span class="number">0</span>:<span class="keyword">compile</span> (<span class="keyword">default</span>-<span class="keyword">compile</span>) on <span class="keyword">project</span> sfc-sfp-checker: Compilation failure: Compilation failure:</span><br><span class="line">[ERROR] <span class="regexp">/home/</span>qsong<span class="regexp">/Documents/</span>sfc-patch<span class="regexp">/sfc-sfp-checker/</span>src<span class="regexp">/main/</span>java<span class="regexp">/org/</span>opendaylight<span class="regexp">/sfc/</span>pathchecker/SfpCheckerPacketSenderTask.java:[<span class="number">13</span>,<span class="number">49</span>] <span class="keyword">package</span> org.opendaylight.l2switch.arphandler.core does not exist</span><br><span class="line">[ERROR] <span class="regexp">/home/</span>qsong<span class="regexp">/Documents/</span>sfc-patch<span class="regexp">/sfc-sfp-checker/</span>src<span class="regexp">/main/</span>java<span class="regexp">/org/</span>opendaylight<span class="regexp">/sfc/</span>pathchecker/SfpCheckerPacketSenderTask.java:[<span class="number">14</span>,<span class="number">54</span>] <span class="keyword">package</span> org.opendaylight.l2switch.arphandler.inventory does not exist</span><br><span class="line">[ERROR] <span class="regexp">/home/</span>qsong<span class="regexp">/Documents/</span>sfc-patch<span class="regexp">/sfc-sfp-checker/</span>src<span class="regexp">/main/</span>java<span class="regexp">/org/</span>opendaylight<span class="regexp">/sfc/</span>pathchecker/SfpCheckerPacketSenderTask.java:[<span class="number">16</span>,<span class="number">75</span>] <span class="keyword">package</span> org.opendaylight.yang.gen.v1.urn.opendaylight.packet.ipv4.rev140528 does not exist</span><br><span class="line">[ERROR] <span class="regexp">/home/</span>qsong<span class="regexp">/Documents/</span>sfc-patch<span class="regexp">/sfc-sfp-checker/</span>src<span class="regexp">/main/</span>java<span class="regexp">/org/</span>opendaylight<span class="regexp">/sfc/</span>pathchecker/SfpCheckerPacketSenderTask.java:[<span class="number">21</span>,<span class="number">43</span>] <span class="keyword">package</span> org.opendaylight.controller.liblldp does not exist</span><br><span class="line">[ERROR] <span class="regexp">/home/</span>qsong<span class="regexp">/Documents/</span>sfc-patch<span class="regexp">/sfc-sfp-checker/</span>src<span class="regexp">/main/</span>java<span class="regexp">/org/</span>opendaylight<span class="regexp">/sfc/</span>pathchecker/SfpCheckerPacketSenderTask.java:[<span class="number">22</span>,<span class="number">43</span>] <span class="keyword">package</span> org.opendaylight.controller.liblldp does not exist</span><br><span class="line">[ERROR] <span class="regexp">/home/</span>qsong<span class="regexp">/Documents/</span>sfc-patch<span class="regexp">/sfc-sfp-checker/</span>src<span class="regexp">/main/</span>java<span class="regexp">/org/</span>opendaylight<span class="regexp">/sfc/</span>pathchecker/SfpCheckerPacketSenderTask.java:[<span class="number">23</span>,<span class="number">43</span>] <span class="keyword">package</span> org.opendaylight.controller.liblldp does not exist</span><br><span class="line">[ERROR] <span class="regexp">/home/</span>qsong<span class="regexp">/Documents/</span>sfc-patch<span class="regexp">/sfc-sfp-checker/</span>src<span class="regexp">/main/</span>java<span class="regexp">/org/</span>opendaylight<span class="regexp">/sfc/</span>pathchecker/SfpCheckerPacketSenderTask.java:[<span class="number">24</span>,<span class="number">43</span>] <span class="keyword">package</span> org.opendaylight.controller.liblldp does not exist</span><br><span class="line">[ERROR] <span class="regexp">/home/</span>qsong<span class="regexp">/Documents/</span>sfc-patch<span class="regexp">/sfc-sfp-checker/</span>src<span class="regexp">/main/</span>java<span class="regexp">/org/</span>opendaylight<span class="regexp">/sfc/</span>pathchecker/SfpCheckerPacketSenderTask.java:[<span class="number">25</span>,<span class="number">43</span>] <span class="keyword">package</span> org.opendaylight.controller.liblldp does not exist</span><br></pre></td></tr></table></figure> 原因肯定是依赖管理没有弄好，添加<code>l2switch.arphandler</code>以及<code>liblldp</code></p>
<h1 id="新问题">新问题</h1>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-07</span><span class="number">-03</span>T01:<span class="number">08</span>:<span class="number">34</span>,<span class="number">528</span> | ERROR | activator<span class="number">-1</span>-thread<span class="number">-2</span> | BootFeaturesInstaller            | org.apache.karaf.features.core | installBootFeatures(:<span class="number">113</span>): Error installing boot features</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable <span class="keyword">to</span> resolve root: missing requirement [root] osgi.<span class="keyword">identity</span>; osgi.<span class="keyword">identity</span>=odl-sfc-sfp-checker; <span class="keyword">type</span>=karaf.feature; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; <span class="keyword">filter</span>:=&quot;(&amp;(osgi.identity=odl-sfc-sfp-checker)(type=karaf.feature)(version&gt;=0.10.0.SNAPSHOT)(version&lt;=0.10.0.SNAPSHOT))&quot; [caused <span class="keyword">by</span>: Unable <span class="keyword">to</span> resolve odl-sfc-sfp-checker/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>: missing requirement [odl-sfc-sfp-checker/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>] osgi.<span class="keyword">identity</span>; osgi.<span class="keyword">identity</span>=org.opendaylight.controller.liblldp; <span class="keyword">type</span>=osgi.bundle; version=&quot;[0.14.4,0.14.4]&quot;; resolution:=mandatory [caused <span class="keyword">by</span>: Unable <span class="keyword">to</span> resolve org.opendaylight.controller.liblldp/<span class="number">0.14</span><span class="number">.4</span>: missing requirement [org.opendaylight.controller.liblldp/<span class="number">0.14</span><span class="number">.4</span>] osgi.wiring.package; <span class="keyword">filter</span>:=&quot;(&amp;(osgi.wiring.package=com.google.common.collect)(version&gt;=23.6.0)(!(version&gt;=24.0.0)))&quot;]]</span><br><span class="line">        at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:<span class="number">1343</span>) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.doResolve(ResolverImpl.java:<span class="number">392</span>) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:<span class="number">378</span>) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:<span class="number">332</span>) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.region.SubsystemResolver.resolve(SubsystemResolver.java:<span class="number">257</span>) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.Deployer.deploy(Deployer.java:<span class="number">388</span>) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.FeaturesServiceImpl.doProvision(FeaturesServiceImpl.java:<span class="number">1025</span>) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.FeaturesServiceImpl.lambda$doProvisionInThread$<span class="ruby"><span class="number">13</span>(FeaturesServiceImpl.<span class="symbol">java:</span><span class="number">964</span>) ~[<span class="string">?:</span><span class="string">?]</span></span></span><br><span class="line"><span class="ruby">        at java.util.concurrent.FutureTask.run(FutureTask.<span class="symbol">java:</span><span class="number">264</span>) [<span class="string">?:</span><span class="string">?]</span></span></span><br><span class="line"><span class="ruby">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.<span class="symbol">java:</span><span class="number">1128</span>) [<span class="string">?:</span><span class="string">?]</span></span></span><br><span class="line"><span class="ruby">        at java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.run(ThreadPoolExecutor.<span class="symbol">java:</span><span class="number">628</span>) [<span class="string">?:</span><span class="string">?]</span></span></span><br></pre></td></tr></table></figure>
<p>因为没有在<code>features/odl-sfc-sfp-checker</code>中的<code>pom.xml</code>中依赖声明没有关于<code>org.opendaylight.controller.liblldp</code>的缘故</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vagrant@odl:~$ tail -f sfc/karaf/target/assembly/data/<span class="built_in">log</span>/karaf.<span class="built_in">log</span></span><br><span class="line">    <span class="keyword">at</span> java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class="number">1128</span>) [?:?]</span><br><span class="line">    <span class="keyword">at</span> java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class="number">628</span>) [?:?]</span><br><span class="line">    <span class="keyword">at</span> java.lang.Thread.run(Thread.java:<span class="number">834</span>) [?:?]</span><br><span class="line">Caused <span class="keyword">by</span>: org.apache.felix.resolver.reason.ReasonException: Unable <span class="built_in">to</span> <span class="built_in">resolve</span> odl-sfc-sfp-checker/<span class="number">0.10</span><span class="number">.0</span>.SNAPSHOT: missing requirement [odl-sfc-sfp-checker/<span class="number">0.10</span><span class="number">.0</span>.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.controller.sal-common-api; type=osgi.bundle; <span class="built_in">version</span>=<span class="string">&quot;[1.7.4,1.7.4]&quot;</span>; resolution:=mandatory [caused <span class="keyword">by</span>: Unable <span class="built_in">to</span> <span class="built_in">resolve</span> org.opendaylight.controller.sal-common-api/<span class="number">1.7</span><span class="number">.4</span>: missing requirement [org.opendaylight.controller.sal-common-api/<span class="number">1.7</span><span class="number">.4</span>] osgi.wiring.package; <span class="built_in">filter</span>:=<span class="string">&quot;(&amp;(osgi.wiring.package=com.google.common.base)(version&gt;=23.6.0)(!(version&gt;=24.0.0)))&quot;</span>]</span><br><span class="line">    <span class="keyword">at</span> org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:<span class="number">1343</span>) ~[?:?]</span><br><span class="line">    ... <span class="number">12</span> more</span><br><span class="line">Caused <span class="keyword">by</span>: org.apache.felix.resolver.reason.ReasonException: Unable <span class="built_in">to</span> <span class="built_in">resolve</span> org.opendaylight.controller.sal-common-api/<span class="number">1.7</span><span class="number">.4</span>: missing requirement [org.opendaylight.controller.sal-common-api/<span class="number">1.7</span><span class="number">.4</span>] osgi.wiring.package; <span class="built_in">filter</span>:=<span class="string">&quot;(&amp;(osgi.wiring.package=com.google.common.base)(version&gt;=23.6.0)(!(version&gt;=24.0.0)))&quot;</span></span><br><span class="line">    <span class="keyword">at</span> org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:<span class="number">1343</span>) ~[?:?]</span><br><span class="line">    <span class="keyword">at</span> org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:<span class="number">1343</span>) ~[?:?]</span><br><span class="line">    ... <span class="number">12</span> more</span><br></pre></td></tr></table></figure>
<p>我一开始以为是 <code>org.opendaylight.controller.sal-common-api</code> 这个包找不到 但是即使在pom.xml中声明了依赖，依然还是报同样的错误，这个感觉有点儿似曾相识。从错误日志来看，<code>com.google.common.base</code> 像是被加载了多次。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">2019-07-03T10:48:28,376 | <span class="builtin-name">ERROR</span> | activator-1-thread-2 | BootFeaturesInstaller            | org.apache.karaf.features.core | installBootFeatures(:113): <span class="builtin-name">Error</span> installing boot features</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable <span class="keyword">to</span> resolve root: missing requirement [root] osgi.identity; osgi.<span class="attribute">identity</span>=odl-sfc-sfp-checker; <span class="attribute">type</span>=karaf.feature; <span class="attribute">version</span>=<span class="string">&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;</span>; filter:=<span class="string">&quot;(&amp;(osgi.identity=odl-sfc-sfp-checker)(type=karaf.feature)(version&gt;=0.10.0.SNAPSHOT)(version&lt;=0.10.0.SNAPSHOT))&quot;</span> [caused by: Unable <span class="keyword">to</span> resolve odl-sfc-sfp-checker/0.10.0.SNAPSHOT: missing requirement [odl-sfc-sfp-checker/0.10.0.SNAPSHOT] osgi.identity; osgi.<span class="attribute">identity</span>=org.opendaylight.controller.model.topology; <span class="attribute">type</span>=osgi.bundle; <span class="attribute">version</span>=<span class="string">&quot;[1.7.4,1.7.4]&quot;</span>; resolution:=mandatory [caused by: Unable <span class="keyword">to</span> resolve org.opendaylight.controller.model.topology/1.7.4: missing requirement [org.opendaylight.controller.model.topology/1.7.4] osgi.wiring.package; filter:=<span class="string">&quot;(&amp;(osgi.wiring.package=com.google.common.collect)(version&gt;=23.6.0)(!(version&gt;=24.0.0)))&quot;</span>]]</span><br><span class="line">        at org.apache.felix.resolver.Candidates<span class="variable">$MissingRequirementError</span>.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.doResolve(ResolverImpl.java:392) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:378) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:332) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.region.SubsystemResolver.resolve(SubsystemResolver.java:257) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.Deployer.deploy(Deployer.java:388) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.FeaturesServiceImpl.doProvision(FeaturesServiceImpl.java:1025) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.FeaturesServiceImpl.lambda<span class="variable">$doProvisionInThread</span><span class="variable">$13</span>(FeaturesServiceImpl.java:964) ~[?:?]</span><br><span class="line">        at java.util.concurrent.FutureTask.<span class="builtin-name">run</span>(FutureTask.java:264) [?:?]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.<span class="builtin-name">run</span>(ThreadPoolExecutor.java:628) [?:?]</span><br><span class="line">        at java.lang.Thread.<span class="builtin-name">run</span>(Thread.java:834) [?:?]</span><br><span class="line">Caused by: org.apache.felix.resolver.reason.ReasonException: Unable <span class="keyword">to</span> resolve odl-sfc-sfp-checker/0.10.0.SNAPSHOT: missing requirement [odl-sfc-sfp-checker/0.10.0.SNAPSHOT] osgi.identity; osgi.<span class="attribute">identity</span>=org.opendaylight.controller.model.topology; <span class="attribute">type</span>=osgi.bundle; <span class="attribute">version</span>=<span class="string">&quot;[1.7.4,1.7.4]&quot;</span>; resolution:=mandatory [caused by: Unable <span class="keyword">to</span> resolve org.opendaylight.controller.model.topology/1.7.4: missing requirement [org.opendaylight.controller.model.topology/1.7.4] osgi.wiring.package; filter:=<span class="string">&quot;(&amp;(osgi.wiring.package=com.google.common.collect)(version&gt;=23.6.0)(!(version&gt;=24.0.0)))&quot;</span>]</span><br><span class="line">        at org.apache.felix.resolver.Candidates<span class="variable">$MissingRequirementError</span>.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">        <span class="built_in">..</span>. 12 more</span><br></pre></td></tr></table></figure>
<p>在pom.xml中删除了一些依赖声明， <figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.<span class="regexp">/features/</span>odl-sfc-statistics<span class="regexp">/target/</span>classes<span class="regexp">/META-INF/m</span>aven<span class="regexp">/dependencies.properties:org.opendaylight.controller/</span>odl-controller-model-topology/version = <span class="number">1.10</span>.<span class="number">0</span>-SNAPSHOT</span><br><span class="line">.<span class="regexp">/features/</span>odl-sfc-statistics<span class="regexp">/target/</span>classes<span class="regexp">/META-INF/m</span>aven<span class="regexp">/dependencies.properties:org.opendaylight.controller/</span>odl-controller-model-topology/classifier = features</span><br><span class="line">.<span class="regexp">/features/</span>odl-sfc-statistics<span class="regexp">/target/</span>classes<span class="regexp">/META-INF/m</span>aven<span class="regexp">/dependencies.properties:org.opendaylight.controller/</span>odl-controller-model-topology/type = xml</span><br><span class="line">.<span class="regexp">/features/</span>odl-sfc-statistics<span class="regexp">/target/</span>classes<span class="regexp">/META-INF/m</span>aven<span class="regexp">/dependencies.properties:org.opendaylight.controller/</span>odl-controller-model-topology/scope = <span class="keyword">compile</span></span><br><span class="line">.<span class="regexp">/features/</span>odl-sfc-statistics<span class="regexp">/target/</span>classes<span class="regexp">/META-INF/m</span>aven<span class="regexp">/dependencies.properties:org.opendaylight.controller.model/m</span>odel-topology/version = <span class="number">1.10</span>.<span class="number">0</span>-SNAPSHOT</span><br><span class="line">.<span class="regexp">/features/</span>odl-sfc-statistics<span class="regexp">/target/</span>classes<span class="regexp">/META-INF/m</span>aven<span class="regexp">/dependencies.properties:org.opendaylight.controller.model/m</span>odel-topology/type = jar</span><br><span class="line">.<span class="regexp">/features/</span>odl-sfc-statistics<span class="regexp">/target/</span>classes<span class="regexp">/META-INF/m</span>aven<span class="regexp">/dependencies.properties:org.opendaylight.controller.model/m</span>odel-topology/scope = <span class="keyword">compile</span></span><br><span class="line">.<span class="regexp">/features/</span>odl-sfc-sfp-checker<span class="regexp">/target/</span>classes<span class="regexp">/META-INF/m</span>aven<span class="regexp">/dependencies.properties:org.opendaylight.controller.model/m</span>odel-topology/version = <span class="number">1.7</span>.<span class="number">4</span></span><br><span class="line">.<span class="regexp">/features/</span>odl-sfc-sfp-checker<span class="regexp">/target/</span>classes<span class="regexp">/META-INF/m</span>aven<span class="regexp">/dependencies.properties:org.opendaylight.controller.model/m</span>odel-topology/type = jar</span><br><span class="line">.<span class="regexp">/features/</span>odl-sfc-sfp-checker<span class="regexp">/target/</span>classes<span class="regexp">/META-INF/m</span>aven<span class="regexp">/dependencies.properties:org.opendaylight.controller.model/m</span>odel-topology/scope = <span class="keyword">compile</span></span><br><span class="line">.<span class="regexp">/features/</span>odl-sfc-sfp-checker<span class="regexp">/target/</span>feature<span class="regexp">/feature.xml:        &lt;bundle&gt;mvn:org.opendaylight.controller.model/m</span>odel-topology<span class="regexp">/1.7.4&lt;/</span>bundle&gt;</span><br></pre></td></tr></table></figure> 原因应该跟以上有关 为啥sfc-sfp-checker使用的model-topology版本号是1.7.4，而其他使用的是1.10.0-SNAPSHOT.</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-07</span><span class="number">-03</span>T19:<span class="number">10</span>:<span class="number">15</span>,<span class="number">177</span> | ERROR | activator<span class="number">-1</span>-thread<span class="number">-2</span> | BootFeaturesInstaller            | org.apache.karaf.features.core | installBootFeatures(:<span class="number">113</span>): Error installing boot features</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable <span class="keyword">to</span> resolve root: missing requirement [root] osgi.<span class="keyword">identity</span>; osgi.<span class="keyword">identity</span>=odl-sfc-sfp-checker; <span class="keyword">type</span>=karaf.feature; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; <span class="keyword">filter</span>:=&quot;(&amp;(osgi.identity=odl-sfc-sfp-checker)(type=karaf.feature)(version&gt;=0.10.0.SNAPSHOT)(version&lt;=0.10.0.SNAPSHOT))&quot; [caused <span class="keyword">by</span>: Unable <span class="keyword">to</span> resolve odl-sfc-sfp-checker/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>: missing requirement [odl-sfc-sfp-checker/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>] osgi.<span class="keyword">identity</span>; osgi.<span class="keyword">identity</span>=org.opendaylight.sfc.sfp-checker; <span class="keyword">type</span>=osgi.bundle; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; resolution:=mandatory [caused <span class="keyword">by</span>: Unable <span class="keyword">to</span> resolve org.opendaylight.sfc.sfp-checker/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>: missing requirement [org.opendaylight.sfc.sfp-checker/<span class="number">0.10</span><span class="number">.0</span>.<span class="keyword">SNAPSHOT</span>] osgi.wiring.package; <span class="keyword">filter</span>:=&quot;(osgi.wiring.package=org.opendaylight.l2switch.arphandler.core)&quot;]]</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:<span class="number">1343</span>) ~[?:?]</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.doResolve(ResolverImpl.java:<span class="number">392</span>) ~[?:?]</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:<span class="number">378</span>) ~[?:?]</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:<span class="number">332</span>) ~[?:?]</span><br><span class="line">    at org.apache.karaf.features.internal.region.SubsystemResolver.resolve(SubsystemResolver.java:<span class="number">257</span>) ~[?:?]</span><br><span class="line">    at org.apache.karaf.features.internal.service.Deployer.deploy(Deployer.java:<span class="number">388</span>) ~[?:?]</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.doProvision(FeaturesServiceImpl.java:<span class="number">1025</span>) ~[?:?]</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.lambda$doProvisionInThread$<span class="ruby"><span class="number">13</span>(FeaturesServiceImpl.<span class="symbol">java:</span><span class="number">964</span>) ~[<span class="string">?:</span><span class="string">?]</span></span></span><br><span class="line"><span class="ruby">    at java.util.concurrent.FutureTask.run(FutureTask.<span class="symbol">java:</span><span class="number">264</span>) [<span class="string">?:</span><span class="string">?]</span></span></span><br><span class="line"><span class="ruby">    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.<span class="symbol">java:</span><span class="number">1128</span>) [<span class="string">?:</span><span class="string">?]</span></span></span><br><span class="line"><span class="ruby">    at java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.run(ThreadPoolExecutor.<span class="symbol">java:</span><span class="number">628</span>) [<span class="string">?:</span><span class="string">?]</span></span></span><br><span class="line"><span class="ruby">    at java.lang.Thread.run(Thread.<span class="symbol">java:</span><span class="number">834</span>) [<span class="string">?:</span><span class="string">?]</span></span></span><br><span class="line"><span class="ruby">Caused <span class="symbol">by:</span> org.apache.felix.resolver.reason.<span class="symbol">ReasonException:</span> Unable to resolve odl-sfc-sfp-checker/<span class="number">0.10</span>.<span class="number">0</span>.<span class="symbol">SNAPSHOT:</span> missing requirement [odl-sfc-sfp-checker/<span class="number">0.10</span>.<span class="number">0</span>.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.sfc.sfp-checker; type=osgi.bundle; version=<span class="string">&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;</span>; <span class="symbol">resolution:</span>=mandatory [caused <span class="symbol">by:</span> Unable to resolve org.opendaylight.sfc.sfp-checker/<span class="number">0.10</span>.<span class="number">0</span>.<span class="symbol">SNAPSHOT:</span> missing requirement [org.opendaylight.sfc.sfp-checker/<span class="number">0.10</span>.<span class="number">0</span>.SNAPSHOT] osgi.wiring.package; <span class="symbol">filter:</span>=<span class="string">&quot;(osgi.wiring.package=org.opendaylight.l2switch.arphandler.core)&quot;</span>]</span></span><br><span class="line"><span class="ruby">    at org.apache.felix.resolver.Candidates<span class="variable">$MissingRequirementError</span>.toException(Candidates.<span class="symbol">java:</span><span class="number">1343</span>) ~[<span class="string">?:</span><span class="string">?]</span></span></span><br><span class="line"><span class="ruby">    ... <span class="number">12</span> more</span></span><br><span class="line"><span class="ruby">Caused <span class="symbol">by:</span> org.apache.felix.resolver.reason.<span class="symbol">ReasonException:</span> Unable to resolve org.opendaylight.sfc.sfp-checker/<span class="number">0.10</span>.<span class="number">0</span>.<span class="symbol">SNAPSHOT:</span> missing requirement [org.opendaylight.sfc.sfp-checker/<span class="number">0.10</span>.<span class="number">0</span>.SNAPSHOT] osgi.wiring.package; <span class="symbol">filter:</span>=<span class="string">&quot;(osgi.wiring.package=org.opendaylight.l2switch.arphandler.core)&quot;</span></span></span><br><span class="line"><span class="ruby">    at org.apache.felix.resolver.Candidates<span class="variable">$MissingRequirementError</span>.toException(Candidates.<span class="symbol">java:</span><span class="number">1343</span>) ~[<span class="string">?:</span><span class="string">?]</span></span></span><br><span class="line"><span class="ruby">    at org.apache.felix.resolver.Candidates<span class="variable">$MissingRequirementError</span>.toException(Candidates.<span class="symbol">java:</span><span class="number">1343</span>) ~[<span class="string">?:</span><span class="string">?]</span></span></span><br></pre></td></tr></table></figure>
<p>为啥说找不到 <code>org.opendaylight.l2switch.arphandler.core</code>? 我查看了下MANIFEST,这个包实际上就在</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i -H <span class="string">&quot;Content-Type: application/json&quot;</span> -H <span class="string">&quot;Cache-Control: no-cache&quot;</span> --data <span class="string">&#x27;&#123; &quot;input&quot;: &#123; &#125; &#125;&#x27;</span> -X POST --user admin:admin http:<span class="regexp">//</span>localhost:<span class="number">8181</span><span class="regexp">/restconf/</span>operations/sfc-sfp-checker:send-packet</span><br></pre></td></tr></table></figure>
<p>根据 OpenflowPlugin 的<a target="_blank" rel="noopener" href="https://docs.opendaylight.org/projects/openflowplugin/en/latest/users/operation.html">文档</a>, 找到下面这条RESTFul API的调用方式，返回的结果是XML文件，所有的nodes信息就获得到了。 <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H <span class="string">&quot;Content-Type: application/xml&quot;</span> -H <span class="string">&quot;Accept: application/xml&quot;</span> -X GET --user admin:admin http:<span class="regexp">//</span>localhost:<span class="number">8181</span><span class="regexp">/restconf/</span>operational<span class="regexp">/network-topology:network-topology/</span>topology/flow:<span class="number">1</span></span><br></pre></td></tr></table></figure> 返回结果示例: <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml <span class="keyword">version</span>=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;topology xmlns=<span class="string">&quot;urn:TBD:params:xml:ns:yang:network-topology&quot;</span>&gt;</span><br><span class="line">   <span class="symbol">&lt;topology-id&gt;</span>flo<span class="variable">w:1</span>&lt;/topology-id&gt;</span><br><span class="line">   <span class="symbol">&lt;node&gt;</span></span><br><span class="line">      <span class="symbol">&lt;node-id&gt;</span>openflo<span class="variable">w:46456727321924</span>&lt;/node-id&gt;</span><br><span class="line">      <span class="symbol">&lt;termination-point&gt;</span></span><br><span class="line">         <span class="symbol">&lt;tp-id&gt;</span>openflo<span class="variable">w:46456727321924</span>:LOCAL&lt;/<span class="keyword">tp</span>-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=<span class="string">&quot;urn:opendaylight:model:topology:inventory&quot;</span> xmln<span class="variable">s:a</span>=<span class="string">&quot;urn:opendaylight:inventory&quot;</span>&gt;/<span class="variable">a:nodes</span>/<span class="variable">a:node</span>[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:46456727321924&#x27;</span>]/<span class="variable">a:node</span>-connector[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:46456727321924:LOCAL&#x27;</span>]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      <span class="symbol">&lt;termination-point&gt;</span></span><br><span class="line">         <span class="symbol">&lt;tp-id&gt;</span>openflo<span class="variable">w:46456727321924</span>:<span class="number">1</span>&lt;/<span class="keyword">tp</span>-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=<span class="string">&quot;urn:opendaylight:model:topology:inventory&quot;</span> xmln<span class="variable">s:a</span>=<span class="string">&quot;urn:opendaylight:inventory&quot;</span>&gt;/<span class="variable">a:nodes</span>/<span class="variable">a:node</span>[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:46456727321924&#x27;</span>]/<span class="variable">a:node</span>-connector[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:46456727321924:1&#x27;</span>]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      <span class="symbol">&lt;termination-point&gt;</span></span><br><span class="line">         <span class="symbol">&lt;tp-id&gt;</span>openflo<span class="variable">w:46456727321924</span>:<span class="number">3</span>&lt;/<span class="keyword">tp</span>-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=<span class="string">&quot;urn:opendaylight:model:topology:inventory&quot;</span> xmln<span class="variable">s:a</span>=<span class="string">&quot;urn:opendaylight:inventory&quot;</span>&gt;/<span class="variable">a:nodes</span>/<span class="variable">a:node</span>[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:46456727321924&#x27;</span>]/<span class="variable">a:node</span>-connector[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:46456727321924:3&#x27;</span>]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      <span class="symbol">&lt;termination-point&gt;</span></span><br><span class="line">         <span class="symbol">&lt;tp-id&gt;</span>openflo<span class="variable">w:46456727321924</span>:<span class="number">2</span>&lt;/<span class="keyword">tp</span>-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=<span class="string">&quot;urn:opendaylight:model:topology:inventory&quot;</span> xmln<span class="variable">s:a</span>=<span class="string">&quot;urn:opendaylight:inventory&quot;</span>&gt;/<span class="variable">a:nodes</span>/<span class="variable">a:node</span>[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:46456727321924&#x27;</span>]/<span class="variable">a:node</span>-connector[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:46456727321924:2&#x27;</span>]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;inventory-node-ref xmlns=<span class="string">&quot;urn:opendaylight:model:topology:inventory&quot;</span> xmln<span class="variable">s:a</span>=<span class="string">&quot;urn:opendaylight:inventory&quot;</span>&gt;/<span class="variable">a:nodes</span>/<span class="variable">a:node</span>[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:46456727321924&#x27;</span>]&lt;/inventory-node-ref&gt;</span><br><span class="line">   &lt;/node&gt;</span><br><span class="line">   <span class="symbol">&lt;node&gt;</span></span><br><span class="line">      <span class="symbol">&lt;node-id&gt;</span>openflo<span class="variable">w:156685216991309</span>&lt;/node-id&gt;</span><br><span class="line">      <span class="symbol">&lt;termination-point&gt;</span></span><br><span class="line">         <span class="symbol">&lt;tp-id&gt;</span>openflo<span class="variable">w:156685216991309</span>:<span class="number">3</span>&lt;/<span class="keyword">tp</span>-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=<span class="string">&quot;urn:opendaylight:model:topology:inventory&quot;</span> xmln<span class="variable">s:a</span>=<span class="string">&quot;urn:opendaylight:inventory&quot;</span>&gt;/<span class="variable">a:nodes</span>/<span class="variable">a:node</span>[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:156685216991309&#x27;</span>]/<span class="variable">a:node</span>-connector[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:156685216991309:3&#x27;</span>]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      <span class="symbol">&lt;termination-point&gt;</span></span><br><span class="line">         <span class="symbol">&lt;tp-id&gt;</span>openflo<span class="variable">w:156685216991309</span>:<span class="number">2</span>&lt;/<span class="keyword">tp</span>-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=<span class="string">&quot;urn:opendaylight:model:topology:inventory&quot;</span> xmln<span class="variable">s:a</span>=<span class="string">&quot;urn:opendaylight:inventory&quot;</span>&gt;/<span class="variable">a:nodes</span>/<span class="variable">a:node</span>[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:156685216991309&#x27;</span>]/<span class="variable">a:node</span>-connector[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:156685216991309:2&#x27;</span>]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      <span class="symbol">&lt;termination-point&gt;</span></span><br><span class="line">         <span class="symbol">&lt;tp-id&gt;</span>openflo<span class="variable">w:156685216991309</span>:LOCAL&lt;/<span class="keyword">tp</span>-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=<span class="string">&quot;urn:opendaylight:model:topology:inventory&quot;</span> xmln<span class="variable">s:a</span>=<span class="string">&quot;urn:opendaylight:inventory&quot;</span>&gt;/<span class="variable">a:nodes</span>/<span class="variable">a:node</span>[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:156685216991309&#x27;</span>]/<span class="variable">a:node</span>-connector[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:156685216991309:LOCAL&#x27;</span>]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      <span class="symbol">&lt;termination-point&gt;</span></span><br><span class="line">         <span class="symbol">&lt;tp-id&gt;</span>openflo<span class="variable">w:156685216991309</span>:<span class="number">1</span>&lt;/<span class="keyword">tp</span>-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=<span class="string">&quot;urn:opendaylight:model:topology:inventory&quot;</span> xmln<span class="variable">s:a</span>=<span class="string">&quot;urn:opendaylight:inventory&quot;</span>&gt;/<span class="variable">a:nodes</span>/<span class="variable">a:node</span>[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:156685216991309&#x27;</span>]/<span class="variable">a:node</span>-connector[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:156685216991309:1&#x27;</span>]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;inventory-node-ref xmlns=<span class="string">&quot;urn:opendaylight:model:topology:inventory&quot;</span> xmln<span class="variable">s:a</span>=<span class="string">&quot;urn:opendaylight:inventory&quot;</span>&gt;/<span class="variable">a:nodes</span>/<span class="variable">a:node</span>[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:156685216991309&#x27;</span>]&lt;/inventory-node-ref&gt;</span><br><span class="line">   &lt;/node&gt;</span><br><span class="line">   <span class="symbol">&lt;node&gt;</span></span><br><span class="line">      <span class="symbol">&lt;node-id&gt;</span>openflo<span class="variable">w:213647924314953</span>&lt;/node-id&gt;</span><br><span class="line">      <span class="symbol">&lt;termination-point&gt;</span></span><br><span class="line">         <span class="symbol">&lt;tp-id&gt;</span>openflo<span class="variable">w:213647924314953</span>:LOCAL&lt;/<span class="keyword">tp</span>-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=<span class="string">&quot;urn:opendaylight:model:topology:inventory&quot;</span> xmln<span class="variable">s:a</span>=<span class="string">&quot;urn:opendaylight:inventory&quot;</span>&gt;/<span class="variable">a:nodes</span>/<span class="variable">a:node</span>[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:213647924314953&#x27;</span>]/<span class="variable">a:node</span>-connector[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:213647924314953:LOCAL&#x27;</span>]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      <span class="symbol">&lt;termination-point&gt;</span></span><br><span class="line">         <span class="symbol">&lt;tp-id&gt;</span>openflo<span class="variable">w:213647924314953</span>:<span class="number">1</span>&lt;/<span class="keyword">tp</span>-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=<span class="string">&quot;urn:opendaylight:model:topology:inventory&quot;</span> xmln<span class="variable">s:a</span>=<span class="string">&quot;urn:opendaylight:inventory&quot;</span>&gt;/<span class="variable">a:nodes</span>/<span class="variable">a:node</span>[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:213647924314953&#x27;</span>]/<span class="variable">a:node</span>-connector[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:213647924314953:1&#x27;</span>]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;inventory-node-ref xmlns=<span class="string">&quot;urn:opendaylight:model:topology:inventory&quot;</span> xmln<span class="variable">s:a</span>=<span class="string">&quot;urn:opendaylight:inventory&quot;</span>&gt;/<span class="variable">a:nodes</span>/<span class="variable">a:node</span>[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:213647924314953&#x27;</span>]&lt;/inventory-node-ref&gt;</span><br><span class="line">   &lt;/node&gt;</span><br><span class="line">   <span class="symbol">&lt;node&gt;</span></span><br><span class="line">      <span class="symbol">&lt;node-id&gt;</span>openflo<span class="variable">w:77446495327310</span>&lt;/node-id&gt;</span><br><span class="line">      <span class="symbol">&lt;termination-point&gt;</span></span><br><span class="line">         <span class="symbol">&lt;tp-id&gt;</span>openflo<span class="variable">w:77446495327310</span>:<span class="number">1</span>&lt;/<span class="keyword">tp</span>-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=<span class="string">&quot;urn:opendaylight:model:topology:inventory&quot;</span> xmln<span class="variable">s:a</span>=<span class="string">&quot;urn:opendaylight:inventory&quot;</span>&gt;/<span class="variable">a:nodes</span>/<span class="variable">a:node</span>[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:77446495327310&#x27;</span>]/<span class="variable">a:node</span>-connector[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:77446495327310:1&#x27;</span>]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      <span class="symbol">&lt;termination-point&gt;</span></span><br><span class="line">         <span class="symbol">&lt;tp-id&gt;</span>openflo<span class="variable">w:77446495327310</span>:LOCAL&lt;/<span class="keyword">tp</span>-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=<span class="string">&quot;urn:opendaylight:model:topology:inventory&quot;</span> xmln<span class="variable">s:a</span>=<span class="string">&quot;urn:opendaylight:inventory&quot;</span>&gt;/<span class="variable">a:nodes</span>/<span class="variable">a:node</span>[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:77446495327310&#x27;</span>]/<span class="variable">a:node</span>-connector[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:77446495327310:LOCAL&#x27;</span>]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;inventory-node-ref xmlns=<span class="string">&quot;urn:opendaylight:model:topology:inventory&quot;</span> xmln<span class="variable">s:a</span>=<span class="string">&quot;urn:opendaylight:inventory&quot;</span>&gt;/<span class="variable">a:nodes</span>/<span class="variable">a:node</span>[<span class="variable">a:id</span>=<span class="string">&#x27;openflow:77446495327310&#x27;</span>]&lt;/inventory-node-ref&gt;</span><br><span class="line">   &lt;/node&gt;</span><br><span class="line">&lt;/topology&gt;</span><br></pre></td></tr></table></figure> 现在的问题是，如何找到ServiceNode(SFC定义)和Node(OpenFlowPlugin定义)之间的映射关系？</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取某个node的详细信息</span></span><br><span class="line">curl -H <span class="string">&quot;Content-Type: application/xml&quot;</span> -H <span class="string">&quot;Accept: application/xml&quot;</span> -X GET --user admin:admin http:<span class="regexp">//</span>localhost:<span class="number">8181</span><span class="regexp">/restconf/</span>operational<span class="regexp">/opendaylight-inventory:nodes/</span>node/openflow:<span class="number">77446495327310</span></span><br></pre></td></tr></table></figure>
<p>有时候切换另一个分支，然后重新执行./run_demo.sh的时候，在执行脚本setup_sfc.py的时候，会遇到下列错误 <figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP <span class="keyword">GET</span> http://<span class="number">192.168</span><span class="number">.1</span><span class="number">.5</span>:<span class="number">8181</span>/restconf/operational/service-<span class="keyword">function</span>-<span class="type">path</span>:service-<span class="keyword">function</span>-paths-state/service-<span class="keyword">function</span>-<span class="type">path</span>-state/SFP1</span><br><span class="line">result: <span class="number">404</span></span><br><span class="line">sfp_stae_list: &#123;&#125;</span><br><span class="line">Traceback (most recent <span class="keyword">call</span> last):</span><br><span class="line">  File &quot;/sfc/sfc-demo/sfc103/setup_sfc.py&quot;, <span class="type">line</span> <span class="number">599</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    rsp_name = get_rsp_name(&quot;SFP1&quot;, <span class="keyword">False</span>)</span><br><span class="line">  File &quot;/sfc/sfc-demo/sfc103/setup_sfc.py&quot;, <span class="type">line</span> <span class="number">571</span>, <span class="keyword">in</span> get_rsp_name</span><br><span class="line">    <span class="keyword">for</span> sfp_state <span class="keyword">in</span> sfp_state_list[&quot;service-function-path-state&quot;]:</span><br><span class="line">KeyError: <span class="string">&#x27;service-function-path-state&#x27;</span></span><br></pre></td></tr></table></figure> 这个错误意思是，SDN controller 中的 service-function-path 并没有被创立好。挣扎了许久，导致这个现象的原因是，SDN controller创建 service-function-path, 等待数据库相应的记录可查询需要一定的时间，如果等待时间不够，立即就HTTP GET的话，很容易就会遇到相关的记录查询不到的问题。这个问题在SFC涵盖的VNF数目越多越明显。 如果真的遇到这样的问题，在确定SDN controller没有BUG的情况下，不妨最后再执行一次 setup_sfc.py</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/05/17/intelliJ-idea-install-crack/" rel="prev" title="IntelliJ IDEA 下本地开发+远程同步+编译调试 工作流程">
      <i class="fa fa-chevron-left"></i> IntelliJ IDEA 下本地开发+远程同步+编译调试 工作流程
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/06/14/bash-tuto/" rel="next" title="bash_tuto">
      bash_tuto <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#odl-controller-%E7%9B%B4%E6%8E%A5%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE%E5%8C%85%E7%BB%99-ovs-%E4%BA%A4%E6%8D%A2%E6%9C%BA"><span class="nav-number">1.</span> <span class="nav-text">ODL controller 直接发送数据包给 OVS 交换机</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#odl-controller-%E7%9B%B4%E6%8E%A5%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE%E5%8C%85%E5%88%B0%E7%BD%91%E7%BB%9C%E4%B8%AD"><span class="nav-number">2.</span> <span class="nav-text">ODL controller 直接发送数据包到网络中</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%BA%E5%95%A5%E9%80%9A%E8%BF%87-maven-archetype-%E5%88%9B%E5%BB%BA%E7%9A%84project%E9%83%BD%E6%9C%89%E4%B8%AAkaraf"><span class="nav-number">3.</span> <span class="nav-text">为啥通过 maven archetype 创建的project都有个karaf</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#odl-%E5%BC%80%E5%8F%91%E9%9C%80%E8%A6%81%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-number">4.</span> <span class="nav-text">ODL 开发需要的基础知识</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#osgi"><span class="nav-number">5.</span> <span class="nav-text">OSGi</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91-odl"><span class="nav-number">6.</span> <span class="nav-text">源码编译 ODL</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#odl-%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86"><span class="nav-number">7.</span> <span class="nav-text">ODL 开发中的日志管理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#integration-%E9%A1%B9%E7%9B%AE"><span class="nav-number">8.</span> <span class="nav-text">Integration 项目</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#odl-%E5%BC%80%E5%8F%91%E4%B8%AD%E5%BF%85%E7%94%A8%E7%9A%84-karaf-%E6%8C%87%E4%BB%A4"><span class="nav-number">9.</span> <span class="nav-text">ODL 开发中必用的 Karaf 指令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#rpc-%E6%9C%BA%E5%88%B6"><span class="nav-number">10.</span> <span class="nav-text">RPC 机制</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#rpc-%E8%B0%83%E7%94%A8%E5%88%86%E7%B1%BB"><span class="nav-number">10.1.</span> <span class="nav-text">RPC 调用分类</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sfc-%E9%A1%B9%E7%9B%AE"><span class="nav-number">11.</span> <span class="nav-text">sfc 项目</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#a-required-class-was-missing...javaxxmlbindjaxbexception..."><span class="nav-number">12.</span> <span class="nav-text">A required class was missing...javax&#x2F;xml&#x2F;bind&#x2F;JAXBException...</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#karaf-%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E5%90%AF%E5%8A%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">13.</span> <span class="nav-text">karaf 在虚拟机共享文件夹中启动的问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-odl-sfc-statistics-feature-%E5%A4%B1%E8%B4%A5"><span class="nav-number">14.</span> <span class="nav-text">安装 odl-sfc-statistics feature 失败</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%A9%E5%B1%95-yang-data-model"><span class="nav-number">15.</span> <span class="nav-text">扩展 YANG data model</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8karaf-%E5%AE%89%E8%A3%85sfc-feature-%E6%8A%A5%E9%94%99"><span class="nav-number">16.</span> <span class="nav-text">启动karaf 安装sfc feature 报错！</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%A0%E9%99%A4.m2repository%E6%89%80%E6%9C%89%E5%86%85%E5%AE%B9%E4%B9%8B%E5%90%8E%E7%BC%96%E8%AF%91%E5%8F%8D%E8%80%8C%E6%97%A0%E6%B3%95%E9%80%9A%E8%BF%87%E4%BA%86"><span class="nav-number">17.</span> <span class="nav-text">删除.m2&#x2F;repository所有内容之后，编译反而无法通过了。。。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B8%85%E7%A9%BA%E4%BA%86sfckaraftargetassembly%E6%96%87%E4%BB%B6%E4%B9%8B%E5%90%8E%E5%B0%86%E6%96%B0%E7%BC%96%E8%AF%91%E5%A5%BD%E7%9A%84%E6%96%87%E4%BB%B6%E8%A7%A3%E5%8E%8B%E4%B9%8B%E5%90%8E%E7%9B%B4%E6%8E%A5%E6%94%BE%E5%9C%A8%E8%BF%99%E9%87%8C%E5%BD%93%E8%AF%95%E5%9B%BE%E5%8E%BB%E5%85%B3%E9%97%ADkaraf%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%9A%E5%87%BA%E7%8E%B0%E6%97%A0%E6%B3%95%E5%85%B3%E9%97%AD%E7%9A%84%E6%83%85%E5%86%B5-%E5%A4%B1%E8%B4%A5%E7%9A%84%E4%BF%A1%E6%81%AF%E9%9D%9E%E5%B8%B8%E7%9A%84%E5%A5%87%E6%80%AA%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%94%99%E8%AF%AF%E6%8F%90%E7%A4%BA%E7%9A%84%E5%BA%94%E8%AF%A5%E6%98%AFkaraf-console-shell-ssh%E8%BF%9B%E7%A8%8B%E6%97%A0%E6%B3%95%E8%A2%AB%E8%BF%9E%E6%8E%A5%E4%B8%8A"><span class="nav-number">18.</span> <span class="nav-text">清空了sfc&#x2F;karaf&#x2F;target&#x2F;assembly文件之后，将新编译好的文件解压之后直接放在这里，当试图去关闭karaf进程的时候，会出现无法关闭的情况 失败的信息非常的奇怪，第一个错误提示的应该是karaf console shell ssh进程无法被连接上。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%90%8C%E6%97%B6%E6%9C%89-service-function-chain-service-function-paths-rendered-service-paths-%E4%B8%89%E7%A7%8D%E6%A6%82%E5%BF%B5"><span class="nav-number">19.</span> <span class="nav-text">为什么要同时有 service-function-chain, service-function-paths, rendered-service-paths 三种概念？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#section"><span class="nav-number">20.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#section-1"><span class="nav-number">21.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#section-2"><span class="nav-number">22.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#python-process-%E4%B8%AD-%E5%A6%82%E4%BD%95%E9%87%8D%E5%90%AF-thread"><span class="nav-number">23.</span> <span class="nav-text">Python process 中 如何重启 thread?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#section-3"><span class="nav-number">24.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#section-4"><span class="nav-number">25.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#section-5"><span class="nav-number">26.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0%E5%B9%B6%E6%B2%A1%E6%9C%89%E8%A2%AB-maven-repository-%E7%9A%84jar%E6%96%87%E4%BB%B6"><span class="nav-number">27.</span> <span class="nav-text">如何添加并没有被 Maven repository 的jar文件？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%98%E6%98%AF%E6%B7%BB%E5%8A%A0%E7%AC%AC%E4%B8%89%E6%96%B9java-jar%E9%97%AE%E9%A2%98"><span class="nav-number">28.</span> <span class="nav-text">还是添加第三方java jar问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%87%BA%E7%8E%B0-packetprocessingservice-%E6%89%BE%E4%B8%8D%E5%88%B0%E7%9A%84%E6%83%85%E5%86%B5"><span class="nav-number">29.</span> <span class="nav-text">编译过程中出现 PacketProcessingService 找不到的情况</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#blueprint-%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99%E6%9C%89%E8%AF%AF"><span class="nav-number">30.</span> <span class="nav-text">Blueprint 文件编写有误</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#section-6"><span class="nav-number">31.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%96%B0%E9%97%AE%E9%A2%98"><span class="nav-number">32.</span> <span class="nav-text">新问题</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">rennsong</p>
  <div class="site-description" itemprop="description">Personal blog site, to note technique and life related articles</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">77</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rennsong</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->




  















  

  

</body>
</html>
