<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rennesong.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="http://sdnhub.org/tutorials/opendaylight/ 虽然有点老，但是这个教程也不失为一个比较好的 OpenDaylight 开发教程 我看了下 其内容还是比较系统全面的 ODL controller 直接发送数据包给 OVS 交换机 两种思路: ODL controller 直接发送数据包到网络中 ODL controller 直接发包, 其本质上并不是contro">
<meta property="og:type" content="article">
<meta property="og:title" content="opendaylight-dev">
<meta property="og:url" content="http://rennesong.com/2019/05/20/opendaylight-dev/index.html">
<meta property="og:site_name" content="Rennesong&#39;s blog">
<meta property="og:description" content="http://sdnhub.org/tutorials/opendaylight/ 虽然有点老，但是这个教程也不失为一个比较好的 OpenDaylight 开发教程 我看了下 其内容还是比较系统全面的 ODL controller 直接发送数据包给 OVS 交换机 两种思路: ODL controller 直接发送数据包到网络中 ODL controller 直接发包, 其本质上并不是contro">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-10-23T09:00:52.027Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="opendaylight-dev">
<meta name="twitter:description" content="http://sdnhub.org/tutorials/opendaylight/ 虽然有点老，但是这个教程也不失为一个比较好的 OpenDaylight 开发教程 我看了下 其内容还是比较系统全面的 ODL controller 直接发送数据包给 OVS 交换机 两种思路: ODL controller 直接发送数据包到网络中 ODL controller 直接发包, 其本质上并不是contro">

<link rel="canonical" href="http://rennesong.com/2019/05/20/opendaylight-dev/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>opendaylight-dev | Rennesong's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Rennesong's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Blog my life from now on!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/05/20/opendaylight-dev/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          opendaylight-dev
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-20 16:13:03" itemprop="dateCreated datePublished" datetime="2019-05-20T16:13:03+08:00">2019-05-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-23 17:00:52" itemprop="dateModified" datetime="2019-10-23T17:00:52+08:00">2019-10-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>http://sdnhub.org/tutorials/opendaylight/ 虽然有点老，但是这个教程也不失为一个比较好的 OpenDaylight 开发教程 我看了下 其内容还是比较系统全面的</p>
<h1 id="odl-controller-直接发送数据包给-ovs-交换机">ODL controller 直接发送数据包给 OVS 交换机</h1>
<p>两种思路:</p>
<h1 id="odl-controller-直接发送数据包到网络中">ODL controller 直接发送数据包到网络中</h1>
<p>ODL controller 直接发包, 其本质上并不是controller本身可以发送想要的数据包给某个目的地址。而是通过Openflow PacketOut message, 将要发包的指令传递给指定的发送设备，后者负责将包发出去，发送的方式多种多样，比如: 1. 可以通过PacketOut message指定要发送的信息(payload), 负责发送信息的设备(支持OpenFlow的设备，大多数情况下就是OVS交换机), 以及 ingress port。这种模式，相当于通过PacktOut信息传递给发送设备该设备认为是其指定的ingress port收到了一条信息，之后可以通过openflow rules就行一些列处理并且发送出去。 2. 可以通过PacketOut message指定要发送的信息(payload), 负责发送信息的设备(支持OpenFlow的设备，大多数情况下就是OVS交换机), 以及 egress port。这种模式就是告诉网络设备直接从某个端口发送一个包出去，而不会经过设备中已经存储的openflow rules的处理了。</p>
<h1 id="为啥通过-maven-archetype-创建的project都有个karaf">为啥通过 maven archetype 创建的project都有个karaf</h1>
<h1 id="odl-开发需要的基础知识">ODL 开发需要的基础知识</h1>
<p>ODL 依赖以下技术： * OSGI: 框架运行于ODL后台，它允许动态加载bundles和jar包，并且为了信息交换将bundle捆绑在一起。 * Karaf: 构建在OSGi框架上的应用程序容器，它简化了各方面的组包和安装应用程序操作。 * YANG: 一种数据建模语言，由RFC6020以及RFC6021定义, 通过应用,远程过程调用(PRC)以及通知消息(Notification)来操作模型配置和数据状态。</p>
<p>比较好的 ODL 开发教程，如下： https://www.sdnlab.com/community/article/odl/974 https://www.sdnlab.com/community/article/odl/978</p>
<p>很老的教程，但是可以拿来参考 http://www.muzixing.com/pages/2014/08/06/opendaylightzhong-kai-fa-mo-kuai-ping.html</p>
<p>https://www.sdnlab.com/18092.html</p>
<h1 id="osgi">OSGi</h1>
<p>仔细阅读这个资料并整理： https://www.cnblogs.com/jingmoxukong/p/4546947.html https://segmentfault.com/a/1190000007420617</p>
<p>这个教程 也是很不错：https://www.jianshu.com/p/2c0c8091e3de</p>
<p>https://www.tianmaying.com/tutorial/osgi-blueprint</p>
<h1 id="源码编译-odl">源码编译 ODL</h1>
<p>编译之后，生成的文件是会放在项目根目录之下的<code>karaf</code>文件夹之内的。</p>
<h1 id="odl-开发中的日志管理">ODL 开发中的日志管理</h1>
<p>It is not a bundle name you specify with the set <code>log level</code> command but a fully-qualified Java package or class name. You can also just edit <code>etc/org.ops4j.pax.logging.cfg</code> directly to set the log levels for packages/classes, for example: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log4j.logger.org.opendaylight.mypackage=DEBUG</span><br></pre></td></tr></table></figure></p>
<p>In code you create Logger instances per class, for example: <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.opendaylight.mypackage;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = LoggerFactory.getLogger(MyClass.class);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Log output goes to <code>data/log/karaf.log</code>.</p>
<p>也可以通过karaf console来操作: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path/to/client -u karaf -p karaf</span><br></pre></td></tr></table></figure></p>
<p>查看目前log设置 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log:list</span><br></pre></td></tr></table></figure></p>
<p>比如我们想改变某个java package log设置为DEBUG模式 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log:set DEBUG org.opendaylight.sfc.sbrest.json</span><br></pre></td></tr></table></figure></p>
<p>最后我们发现，相应地，<code>etc/org.ops4j.pax.logging.cfg</code>中的配置也发生了变化。神奇！</p>
<p>https://svn.apache.org/repos/asf/karaf/site/production/manual/latest-3.0.x/log.html</p>
<p>https://logging.apache.org/log4j/2.x/manual/layouts.html https://howtodoinjava.com/log4j2/useful-conversion-pattern-examples/</p>
<h1 id="integration-项目">Integration 项目</h1>
<p>Integration 是一个框架性的工程，所有自己开发和修改的部分（包括controller、openflowPlugin&amp;Java三个工程）编译为包后，都可以放在该工程的目录下一起执行。注意，如果是自己开发的包，则可以直接放到该目录下。但是如果是修改的原本工程，然后编译的包要替换掉上面目录中原来的包，这里有个问题是 integration 的 plugin目录下的包名和 controller， openflowplugin， openflowjava 中编译出来的包命名方式有点小差别，复制过去之前先重命名下，使之和目录下的原来包文件名一致，再复制替换。（参考自@jason-zhou童鞋的《OpenDaylight开发学习笔记基础之Controller篇》）。将各个工程的jar包copy到integration里后，运用mvn clean install 编译integration。工程所在目录：</p>
<h1 id="odl-开发中必用的-karaf-指令">ODL 开发中必用的 Karaf 指令</h1>
<ul>
<li>feature:list -i 命令可以查看已经安装的功能模块</li>
<li>feature:install <feature> 命令可以安装想要的feature。</feature></li>
<li>system:shutdown 退出ODL控制器</li>
</ul>
<p>To uninstall a feature, you must shut down OpenDaylight, delete the data directory, and start OpenDaylight up again. Uninstalling a feature using the Karaf <code>feature:uninstall</code> command is not supported and can cause unexpected and undesirable behavior.</p>
<h1 id="rpc-机制">RPC 机制</h1>
<p>在传统的开发模式中，我们通常将系统的各个服务部署在单台机器，随着服务的扩展，这种方式已经完全无法满足系统大规模的扩展需要，分布式系统由此诞生，在分布式系统中，最重要就是各个服务之间的 RPC 调用。</p>
<p>RPC 全称 Remote Procedure Call——远程过程调用，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的方式。简单一点就是：通过一定协议和方法使得调用远程计算机上的服务，就像调用本地服务一样。</p>
<h2 id="rpc-调用分类">RPC 调用分类</h2>
<p>从底层网络协议分: * 基于 HTTP 的RPC * 基于 二进制 RPC * 基于 TCP RPC 从是否跨平台可以分为: * 单语言 RPC (如RMI) * 跨平台 RPC, 如 Google protobuffer, RESTFul JSON, HTTP XML</p>
<p>从调用过程来看: * 同步通信 RPC: 指的是客户端发起调用后，必须等待调用执行完成并返回结果； * 异步通信 RPC: 指客户方调用后不关心执行结果返回，如果客户端需要结果，可用通过提供异步 callback 回调获取返回信息。大部分 RPC 框架都同时支持这两种方式的调用。</p>
<h1 id="sfc-项目">sfc 项目</h1>
<p>通过 git/gerrit 下载的代码来看，sfc 项目本身亦是由一个个Maven子项目构成的, 因为在其根目录下并没有pom.xml文件 pom.xml 主要描述了项目的maven坐标，依赖关系，开发者需要遵循的规则，缺陷管理系统，组织和licenses，以及其他所有的项目相关因素，是项目级别的配置文件 。</p>
<p>注意：setting.xml主要用于配置maven的运行环境等一系列通用的属性，是全局级别的配置文件；</p>
<h1 id="a-required-class-was-missing...javaxxmlbindjaxbexception...">A required class was missing...javax/xml/bind/JAXBException...</h1>
<p>解决方案：https://stackoverflow.com/questions/43574426/how-to-resolve-java-lang-noclassdeffounderror-javax-xml-bind-jaxbexception-in-j</p>
<h1 id="karaf-在虚拟机共享文件夹中启动的问题">karaf 在虚拟机共享文件夹中启动的问题</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vagrant@odldev:/vagrant/topology/karaf$ target/assembly/bin/karaf</span><br><span class="line">Apache Karaf starting up. Press Enter to open the shell now...</span><br><span class="line">  2% [=&gt;                                                                      ]log4j:ERROR setFile(null,true) call failed.</span><br><span class="line">java.io.FileNotFoundException: /home/qsong/Documents/odl_dev_tuto/topology/karaf/target/assembly/data/log/karaf.log (No such file or directory)</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"> 89% [================================================================&gt;       ]FATAL: PWC5963: The scratchDir you specified: /home/qsong/Documents/odl_dev_tuto/topology/karaf/target/assembly/data/pax-web-jsp/moon is unusable.</span><br><span class="line"> 90% [================================================================&gt;       ]FATAL: PWC5963: The scratchDir you specified: /home/qsong/Documents/odl_dev_tuto/topology/karaf/target/assembly/data/pax-web-jsp/oauth2 is unusable.</span><br><span class="line"> 91% [=================================================================&gt;      ]FATAL: PWC5963: The scratchDir you specified: /home/qsong/Documents/odl_dev_tuto/topology/karaf/target/assembly/data/pax-web-jsp/auth is unusable.</span><br><span class="line"> 96% [=====================================================================&gt;  ]FATAL: PWC5963: The scratchDir you specified: /home/qsong/Documents/odl_dev_tuto/topology/karaf/target/assembly/data/pax-web-jsp/restconf is unusable.</span><br><span class="line">FATAL: PWC5963: The scratchDir you specified: /home/qsong/Documents/odl_dev_tuto/topology/karaf/target/assembly/data/pax-web-jsp/apidoc is unusable.</span><br><span class="line">100% [========================================================================]</span><br></pre></td></tr></table></figure>
<p>以上信息为在vagrant启动的虚拟机中启动karaf的时候，报出的错误信息。karaf 是在 Host machine中编译通过的，<code>/home/qsong/Documents/odl_dev_tuto/</code> 在虚拟机中挂载为<code>/vagrant</code>文件夹。从上面的报错信息来看，因为是在主机中编译的，所以在启动karaf的时候会出现log日志文件找不到，某些路径找不到的问题。那么如果我们在虚拟机下直接编译，还会出现这种问题么？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-clean-plugin:3.0.0:clean (default-clean) on project topology-karaf: Failed to clean project: Failed to delete /vagrant/topology/karaf/target/assembly/data/cache/org.eclipse.osgi/bundles -&gt; [Help 1]</span><br><span class="line">[ERROR]</span><br><span class="line">[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.</span><br><span class="line">[ERROR] Re-run Maven using the -X switch to enable full debug logging.</span><br><span class="line">[ERROR]</span><br><span class="line">[ERROR] For more information about the errors and possible solutions, please read the following articles:</span><br><span class="line">[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException</span><br><span class="line">[ERROR]</span><br><span class="line">[ERROR] After correcting the problems, you can resume the build with the command</span><br><span class="line">[ERROR]   mvn &lt;goals&gt; -rf :topology-karaf</span><br></pre></td></tr></table></figure>
<p>这是因为我在另一个terminal里面还开着karaf console，所以导致 maven clean plugin 无法清扫然后编译。关闭console之后，再编译就没有这个问题了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">opendaylight-user@root&gt;bundle:list | grep topology</span><br><span class="line">109 | Active      |  80 | 2013.10.21.10_2-Carbon              | ietf-topology</span><br><span class="line">110 | Active      |  80 | 2013.10.21.10_2-Carbon              | ietf-topology-isis</span><br><span class="line">111 | Active      |  80 | 2013.10.21.10_2-Carbon              | ietf-topology-ospf</span><br><span class="line">112 | Active      |  80 | 2013.10.21.10_2-Carbon              | ietf-topology-l3-unicast-igp</span><br><span class="line">213 | Active      |  80 | 1.5.2.Carbon                        | org.opendaylight.controller.model.model-topology</span><br><span class="line">226 | GracePeriod |  80 | 0.4.2.Carbon                        | topology-lldp-discovery</span><br><span class="line">227 | GracePeriod |  80 | 0.4.2.Carbon                        | topology-manager</span><br><span class="line">229 | Active      |  80 | 0.1.0.SNAPSHOT                      | ODL :: org.opendaylight.topology :: topology-api</span><br><span class="line">230 | GracePeriod |  80 | 0.1.0.SNAPSHOT                      | ODL :: org.opendaylight.topology :: topology-impl</span><br></pre></td></tr></table></figure>
<p>我们注意到，有数个bundle处于<code>GracePeriod</code>状态。该状态的通俗解释是"time out that happens at start up stage". 我们再打开执行： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">opendaylight-user@root&gt;bundle:diag</span><br><span class="line">mdsal-eos-binding-adapter (158)</span><br><span class="line">-------------------------------</span><br><span class="line">Status: GracePeriod</span><br><span class="line">Blueprint</span><br><span class="line">6/16/19 2:27 AM</span><br><span class="line">Missing dependencies:</span><br><span class="line">(objectClass=org.opendaylight.mdsal.binding.dom.codec.api.BindingNormalizedNodeSerializer) (objectClass=org.opendaylight.mdsal.eos.dom.api.DOMEntityOwnershipService)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mdsal-singleton-dom-impl (160)</span><br><span class="line">------------------------------</span><br><span class="line">Status: GracePeriod</span><br><span class="line">Blueprint</span><br><span class="line">6/16/19 2:27 AM</span><br><span class="line">Missing dependencies:</span><br><span class="line">(objectClass=org.opendaylight.mdsal.eos.dom.api.DOMEntityOwnershipService)</span><br><span class="line">(以下省略内容若干)</span><br><span class="line"></span><br><span class="line">org.opendaylight.aaa.aaa-shiro (281)</span><br><span class="line">------------------------------------</span><br><span class="line">Status: GracePeriod</span><br><span class="line">Blueprint</span><br><span class="line">6/16/19 2:28 AM</span><br><span class="line">Missing dependencies:</span><br><span class="line">(objectClass=org.opendaylight.aaa.cert.api.ICertificateManager) (objectClass=org.opendaylight.controller.md.sal.binding.api.DataBroker)</span><br></pre></td></tr></table></figure></p>
<p>看到这些错误顿时觉得头大，毫无思路。毕竟这个命令只能告诉我们有什么错误，但并没有告诉我们进一步的错误信息。我们打开karaf日志文件看下: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">2019-06-16 02:27:27,853 | INFO  | Event Dispatcher | ServiceRecipe                    | 15 - org.apache.aries.blueprint.core - 1.6.1 | Unable to create a proxy object for the service .component-1 defined in bundle org.apache.karaf.deployer.features/3.0.8 with id. Returning the original object instead.</span><br><span class="line">org.apache.aries.proxy.UnableToProxyException: java.lang.ClassFormatError: Duplicate interface name &quot;org/apache/felix/fileinstall/ArtifactListener&quot; in class file Proxy7b9686ca_d0a4_4af2_9328_ec2785aa891b</span><br><span class="line">        at org.apache.aries.proxy.impl.interfaces.ProxyClassLoader.createProxyClass(ProxyClassLoader.java:165)</span><br><span class="line">(以下省略内容若干)</span><br><span class="line">2019-06-16 02:27:49,087 | ERROR | ult-dispatcher-3 | OneForOneStrategy                | 179 - com.typesafe.akka.slf4j - 2.4.18 | IO error: /vagrant/topology/karaf/target/assembly/journal/MANIFEST-000001: Invalid argument</span><br><span class="line">akka.actor.ActorInitializationException: akka://opendaylight-cluster-data/system/akka.persistence.journal.leveldb: exception during creation</span><br><span class="line">        at akka.actor.ActorInitializationException$.apply(Actor.scala:180)[178:com.typesafe.akka.actor:2.4.18]</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">Caused by: org.fusesource.leveldbjni.internal.NativeDB$DBException: IO error: /vagrant/topology/karaf/target/assembly/journal/MANIFEST-000001: Invalid argument</span><br></pre></td></tr></table></figure></p>
<p>日志中这么多错误，让人感觉绝望。这么多bundle没有正确启动，日志里这么多异常信息，感觉真的是无从下手。冷静下来稍微思考之后，经验告诉我，虽然爆出来这么多错误信息，但是最应该关注的其实就是第一次出现错误的地方，很有可能，之后出现的所有的错误都是因为前几错误诱发的。</p>
<p>我发现似乎在虚拟机中, <code>levelDB</code>启动有问题(异常参数)。我就通过谷歌搜索看是否有人遇到过类似问题(不一定是在OpenDaylight开发过程中遇到)。结果还真是大有所获！<code>https://groups.google.com/forum/#!topic/leveldb/MjFwXk6_RgY</code> <code>https://github.com/Level/levelup/issues/222</code>, <code>https://github.com/google/leveldb/issues/281</code></p>
<p>网友们推测，出现上述问题的根源在于Virtualbox文件系统的Bug(并不在于levelDB)。Virtualbox和主机之间创建的共享文件夹使用的<code>vboxvfs</code>文件系统。 这两种解决办法： * 在 non-shared folder 中启动karaf没有这个问题，比如我们把<code>target</code>中生成的类似于<code>karaf.tar.gz</code>的文件解压缩到另一个non-shared文件夹下 启动karaf就没有这种问题了 * 在 <code>Vagrantfile</code> 中挂载共享文件夹的时候，采用<code>nfs</code>文件系统。采用以下语句: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.vm.synced_folder &quot;/your/local/path&quot;, &quot;/home/vagrant/share&quot;, id: &quot;core&quot;, :nfs =&gt; true,  :mount_options   =&gt; [&apos;nolock,vers=3,udp&apos;]</span><br></pre></td></tr></table></figure></p>
<h1 id="安装-odl-sfc-statistics-feature-失败">安装 odl-sfc-statistics feature 失败</h1>
<p>我发现有些 sfc feature 其实是处于 installed状态的。The state of <code>installed</code> means that the bundle is installed but not yet resolved. A bundle is in the INSTALLED state when it has been installed in the Framework but is not or cannot be resolved. The state of <code>Resolved</code> means that the bundle is resolved and is able to be started. A bundle is in the <code>RESOLVED</code> state when the Framework has successfully resolved the bundle's code dependencies.</p>
<p>通过查看 <code>bundle:diag</code>，输出全是跟 Genius 有关： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">opendaylight-user@root&gt;bundle:diag</span><br><span class="line">ODL :: genius :: interfacemanager-api (246)</span><br><span class="line">-------------------------------------------</span><br><span class="line">Status: Installed</span><br><span class="line">Unsatisfied Requirements:</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.genius.infra)(&amp;(version&gt;=0.7.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.genius.interfacemanager.exceptions)&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.genius.interfacemanager.globals)&quot;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">ODL :: genius :: itm-api (248)</span><br><span class="line">------------------------------</span><br><span class="line">Status: Installed</span><br><span class="line">Unsatisfied Requirements:</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.yang.gen.v1.urn.opendaylight.genius.interfacemanager.rev160406)(&amp;(version&gt;=0.7.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.yang.gen.v1.urn.opendaylight.genius.itm.config.rev160406)&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.yang.gen.v1.urn.opendaylight.genius.itm.config.rev160406.itm.config)&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.yang.gen.v1.urn.opendaylight.genius.itm.config.rev160406.vtep.config.schemas)&quot;</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">org.opendaylight.sfc.sfc-genius-utils (368)</span><br><span class="line">-------------------------------------------</span><br><span class="line">Status: Installed</span><br><span class="line">Unsatisfied Requirements:</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.genius.mdsalutil)(&amp;(version&gt;=0.7.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.sfc.genius.util)&quot;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">org.opendaylight.sfc.sfc-openflow-renderer (370)</span><br><span class="line">------------------------------------------------</span><br><span class="line">Status: Installed</span><br><span class="line">Unsatisfied Requirements:</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.sfc.genius.util)(&amp;(version&gt;=0.10.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.sfc.genius.util.appcoexistence)(&amp;(version&gt;=0.10.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.sfc.renderers.openflow.listeners)&quot;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">org.opendaylight.sfc.sfc-scf-openflow (375)</span><br><span class="line">-------------------------------------------</span><br><span class="line">Status: Installed</span><br><span class="line">Unsatisfied Requirements:</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.sfc.genius.util)(&amp;(version&gt;=0.10.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.pack</span><br></pre></td></tr></table></figure></p>
<p>有上述错误信息可以看出，所有的错误均跟 OpenDayLight Genius 有关。继续打开错误日志，会发现如下错误： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">2019-06-16T20:30:39,353 | ERROR | Karaf ssh console user karaf | support.ShellUtil                | 129 - org.apache.karaf.shell.core - 4.2.2 | Exception caught while executing command</span><br><span class="line">org.apache.karaf.features.internal.util.MultiException: Error restarting bundles:</span><br><span class="line">        Could not resolve module: org.opendaylight.genius.mdsalutil-api [250]</span><br><span class="line">  Bundle was not resolved because of a uses contraint violation.</span><br><span class="line">  org.osgi.service.resolver.ResolutionException: Uses constraint violation. Unable to resolve resource org.opendaylight.genius.mdsalutil-api [osgi.identity; osgi.identity=&quot;org.opendaylight.genius.mdsalutil-api&quot;; type=&quot;osgi.bundle&quot;; version:Version=&quot;0.7.0.SNAPSHOT&quot;] because it is exposed to package &apos;javax.annotation&apos; from resources javax.annotation-api [osgi.identity; osgi.identity=&quot;javax.annotation-api&quot;; type=&quot;osgi.bundle&quot;; version:Version=&quot;1.2.0&quot;] and org.eclipse.osgi [osgi.identity; osgi.identity=&quot;org.eclipse.osgi&quot;; type=&quot;osgi.bundle&quot;; version:Version=&quot;3.12.100.v20180210-1608&quot;; singleton:=&quot;true&quot;] via two dependency chains.</span><br><span class="line">...</span><br><span class="line">Chain 1:</span><br><span class="line">  org.opendaylight.genius.mdsalutil-api [osgi.identity; osgi.identity=&quot;org.opendaylight.genius.mdsalutil-api&quot;; type=&quot;osgi.bundle&quot;; version:Version=&quot;0.7.0.SNAPSHOT&quot;]</span><br><span class="line">    import: (&amp;(osgi.wiring.package=javax.annotation)(&amp;(version&gt;=1.2.0)(!(version&gt;=2.0.0))))</span><br><span class="line">...</span><br><span class="line">Chain 2:</span><br><span class="line">  org.opendaylight.genius.mdsalutil-api [osgi.identity; osgi.identity=&quot;org.opendaylight.genius.mdsalutil-api&quot;;</span><br></pre></td></tr></table></figure></p>
<p>我曾经试验过，如果不安装这个feature的话， <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bundle:list</span><br><span class="line">368 ? Active   ?  80 ? 0.10.0.SNAPSHOT                        ? org.opendaylight.sfc.sfc-genius-utils</span><br><span class="line">369 ? Active   ?  80 ? 0.10.0.SNAPSHOT                        ? org.opendaylight.sfc.sfc-model</span><br><span class="line">370 ? Active   ?  80 ? 0.10.0.SNAPSHOT                        ? org.opendaylight.sfc.sfc-openflow-renderer</span><br><span class="line">371 ? Active   ?  80 ? 0.10.0.SNAPSHOT                        ? org.opendaylight.sfc.sfc-openflow-utils</span><br><span class="line">372 ? Active   ?  80 ? 0.10.0.SNAPSHOT                        ? org.opendaylight.sfc.sfc-ovs</span><br><span class="line">373 ? Active   ?  80 ? 0.10.0.SNAPSHOT                        ? org.opendaylight.sfc.sfc-provider</span><br><span class="line">374 ? Active   ?  80 ? 0.10.0.SNAPSHOT                        ? org.opendaylight.sfc.sfc-sb-rest</span><br><span class="line">375 ? Active   ?  80 ? 0.10.0.SNAPSHOT                        ? org.opendaylight.sfc.sfc-scf-openflow</span><br></pre></td></tr></table></figure></p>
<p>所有的bundle都是active状态，<code>bundle:diag</code> has no error information. We are sure that installation of <code>odl-sfc-statistics</code> lead to error, render bundle such as <code>org.opendaylight.sfc.sfc-genius-utils</code> and <code>org.opendaylight.sfc.sfc-scf-openflow</code> into state of <code>installed</code>.</p>
<p>最后终于找到原因了： &gt; The dependent features would result in bundle refresh which could lead to bundle resolution problems and it is recommended to install the features together (feature:install x y z...rather than feature:install x feaure:install y so on) in karaf 4.0 (which is being used in Oxygen,ie,0.8)</p>
<p>https://docs.opendaylight.org/en/stable-oxygen/release-notes/projects/distribution.html#known-issues https://jira.opendaylight.org/browse/OPNFLWPLUG-1029</p>
<p>此外只要重启karaf进程，之前安装的feature就不存在了。。。而且虽然我使用java11运行ODL 但对结果并没影响。</p>
<p>此时执行: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant@odl:/vagrant$ curl -i -H &quot;Content-Type: application/json&quot; -H &quot;Cache-Control: no-cache&quot; --data &apos;&#123; &quot;input&quot;: &#123; &#125; &#125;&apos; -X POST --user admin:admin http://localhost:8181/restconf/operations/sfc-statistics-operations:get-rsp-statistics</span><br></pre></td></tr></table></figure></p>
<p>得到回复： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Set-Cookie: JSESSIONID=node01t7wy9hmts7paqj22cwr5tpjq10.node0;Path=/</span><br><span class="line">Expires: Thu, 01 Jan 1970 00:00:00 GMT</span><br><span class="line">Set-Cookie: rememberMe=deleteMe; Path=/; Max-Age=0; Expires=Sun, 16-Jun-2019 13:36:49 GMT</span><br><span class="line">Content-Type: application/yang.operation+json</span><br><span class="line">Content-Length: 365</span><br><span class="line"></span><br><span class="line">&#123;&quot;output&quot;:&#123;&quot;statistics&quot;:[&#123;&quot;name&quot;:&quot;SFP1-Path-1&quot;,&quot;statistic-by-timestamp&quot;:[&#123;&quot;timestamp&quot;:1560778609224,&quot;service-statistic&quot;:&#123;&quot;packets-in&quot;:10,&quot;packets-out&quot;:10,&quot;bytes-out&quot;:1750,&quot;bytes-in&quot;:1360&#125;&#125;]&#125;,&#123;&quot;name&quot;:&quot;SFP1-Path-1-Reverse&quot;,&quot;statistic-by-timestamp&quot;:[&#123;&quot;timestamp&quot;:1560778609228,&quot;service-statistic&quot;:&#123;&quot;packets-in&quot;:8,&quot;packets-out&quot;:8,&quot;bytes-out&quot;:1673,&quot;bytes-in&quot;:1088&#125;&#125;]&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="扩展-yang-data-model">扩展 YANG data model</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">sending service function chains</span><br><span class="line">PUT http://192.168.1.5:8181/restconf/config/service-function-chain:service-function-chains/</span><br><span class="line">&#123;</span><br><span class="line">    &quot;service-function-chains&quot;: &#123;</span><br><span class="line">        &quot;service-function-chain&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;name&quot;: &quot;SFC1&quot;,</span><br><span class="line">                &quot;sfc-service-function&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;name&quot;: &quot;dpi-abstract1&quot;,</span><br><span class="line">                        &quot;type&quot;: &quot;dpi&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;name&quot;: &quot;firewall-abstract1&quot;,</span><br><span class="line">                        &quot;type&quot;: &quot;firewall&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                &quot;sig-gen-param&quot;: &quot;type a\nq 8780710799663312522437781984754049815806883199414208211028653399266475630880222957078625179422662221423155858769582317459277713367317481324925129998224791\nh 12016012264891146079388821366740534204802954401251311822919615131047207289359704531102844802183906537786776\nr 730750818665451621361119245571504901405976559617\nexp2 159\nexp1 107\nsign1 1\nsign0 1&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;&quot;errors&quot;:&#123;&quot;error&quot;:[&#123;&quot;error-type&quot;:&quot;protocol&quot;,&quot;error-tag&quot;:&quot;malformed-message&quot;,&quot;error-message&quot;:&quot;Error parsing input: Schema node with name sig-gen-param was not found under (urn:cisco:params:xml:ns:yang:sfc-sfc?revision=2014-07-01)service-function-chain.&quot;,&quot;error-info&quot;:&quot;Schema node with name sig-gen-param was not found under (urn:cisco:params:xml:ns:yang:sfc-sfc?revision=2014-07-01)service-function-chain.&quot;&#125;]&#125;&#125;</span><br><span class="line">HTTP PUT /restconf/config/service-function-chain:service-function-chains/</span><br><span class="line">result: 400</span><br></pre></td></tr></table></figure>
<p>原因是，我编译之后，很愚蠢地忘记将编译好的文件移动到$HOME/sfc/karaf/target/assembly文件夹下面了。所以在demo中执行的karaf中并没有最新的Yang model...</p>
<h1 id="启动karaf-安装sfc-feature-报错">启动karaf 安装sfc feature 报错！</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">opendaylight-user@root&gt;feature:install odl-sfc-model odl-sfc-provider-rest odl-sfc-sb-rest odl-sfc-openflow-renderer odl-sfc-scf-openflow odl-sfc-ovs odl-sfc-statistics</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve root: missing requirement [root] osgi.identity; osgi.identity=odl-sfc-ovs; type=karaf.feature; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; filter:=&quot;(&amp;(osgi.identity=odl-sfc-ovs)(type=karaf.feature)(version&gt;=0.10.0.SNAPSHOT)(version&lt;=0.10.0.SNAPSHOT))&quot; [caused by: Unable to resolve odl-sfc-ovs/0.10.0.SNAPSHOT: missing requirement [odl-sfc-ovs/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=odl-ovsdb-southbound-impl; type=karaf.feature; version=&quot;[1.9.0.SNAPSHOT,1.9.0.SNAPSHOT]&quot; [caused by: Unable to resolve odl-ovsdb-southbound-impl/1.9.0.SNAPSHOT: missing requirement [odl-ovsdb-southbound-impl/1.9.0.SNAPSHOT] osgi.identity; osgi.identity=odl-ovsdb-library; type=karaf.feature; version=&quot;[1.9.0.SNAPSHOT,1.9.0.SNAPSHOT]&quot; [caused by: Unable to resolve odl-ovsdb-library/1.9.0.SNAPSHOT: missing requirement [odl-ovsdb-library/1.9.0.SNAPSHOT] osgi.identity; osgi.identity=odl-aaa-cert; type=karaf.feature; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot; [caused by: Unable to resolve odl-aaa-cert/0.10.0.SNAPSHOT: missing requirement [odl-aaa-cert/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.aaa.cert; type=osgi.bundle; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; resolution:=mandatory [caused by: Unable to resolve org.opendaylight.aaa.cert/0.10.0.SNAPSHOT: missing requirement [org.opendaylight.aaa.cert/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.mdsal.binding.api)(version&gt;=3.0.0)(!(version&gt;=4.0.0)))&quot;]]]]]</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.doResolve(ResolverImpl.java:392)</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:378)</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:332)</span><br><span class="line">    at org.apache.karaf.features.internal.region.SubsystemResolver.resolve(SubsystemResolver.java:257)</span><br><span class="line">    at org.apache.karaf.features.internal.service.Deployer.deploy(Deployer.java:388)</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.doProvision(FeaturesServiceImpl.java:1025)</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.lambda$doProvisionInThread$13(FeaturesServiceImpl.java:964)</span><br><span class="line">    at java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">    at java.lang.Thread.run(Thread.java:748)</span><br><span class="line">Caused by: org.apache.felix.resolver.reason.ReasonException: Unable to resolve odl-sfc-ovs/0.10.0.SNAPSHOT: missing requirement [odl-sfc-ovs/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=odl-ovsdb-southbound-impl; type=karaf.feature; version=&quot;[1.9.0.SNAPSHOT,1.9.0.SNAPSHOT]&quot; [caused by: Unable to resolve odl-ovsdb-southbound-impl/1.9.0.SNAPSHOT: missing requirement [odl-ovsdb-southbound-impl/1.9.0.SNAPSHOT] osgi.identity; osgi.identity=odl-ovsdb-library; type=karaf.feature; version=&quot;[1.9.0.SNAPSHOT,1.9.0.SNAPSHOT]&quot; [caused by: Unable to resolve odl-ovsdb-library/1.9.0.SNAPSHOT: missing requirement [odl-ovsdb-library/1.9.0.SNAPSHOT] osgi.identity; osgi.identity=odl-aaa-cert; type=karaf.feature; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot; [caused by: Unable to resolve odl-aaa-cert/0.10.0.SNAPSHOT: missing requirement [odl-aaa-cert/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.aaa.cert; type=osgi.bundle; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; resolution:=mandatory [caused by: Unable to resolve org.opendaylight.aaa.cert/0.10.0.SNAPSHOT: missing requirement [org.opendaylight.aaa.cert/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.mdsal.binding.api)(version&gt;=3.0.0)(!(version&gt;=4.0.0)))&quot;]]]]</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br></pre></td></tr></table></figure>
<h1 id="删除.m2repository所有内容之后编译反而无法通过了">删除.m2/repository所有内容之后，编译反而无法通过了。。。</h1>
<p>神奇！我执行 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin master</span><br></pre></td></tr></table></figure></p>
<p>最后居然没有改变我在我本地端的改变，只获取了我没有动过的文件的update...</p>
<p>更神奇的是，我本地端还有修改还没有git add/git commit呢，结果上述命令直接把我origin弄下来的更新 merge/add/commit了！！！</p>
<p>可能是，我修改过的代码，远程端的文件压根没有改变过，所以git认为我本地的改变更新？ 没有出现，origin从方向1改变，而我朝方向2改变，这就没有构成冲突？？</p>
<p>最后顺利编译通过，没有错误，运行起来也没有任何错误，demo 也顺利执行了！神奇！！！</p>
<h1 id="清空了sfckaraftargetassembly文件之后将新编译好的文件解压之后直接放在这里当试图去关闭karaf进程的时候会出现无法关闭的情况-失败的信息非常的奇怪第一个错误提示的应该是karaf-console-shell-ssh进程无法被连接上">清空了sfc/karaf/target/assembly文件之后，将新编译好的文件解压之后直接放在这里，当试图去关闭karaf进程的时候，会出现无法关闭的情况 失败的信息非常的奇怪，第一个错误提示的应该是karaf console shell ssh进程无法被连接上。</h1>
<h1 id="为什么要同时有-service-function-chain-service-function-paths-rendered-service-paths-三种概念">为什么要同时有 service-function-chain, service-function-paths, rendered-service-paths 三种概念？</h1>
<p>这三种概念一层比一层递进 为什么会有这种设计？？</p>
<h1 id="section"></h1>
<p>org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI 实际负责具体的RSP的创建 我需要在这个类里做具体扩展</p>
<h1 id="section-1"></h1>
<p>在编译sfc项目的时候，子项目sfc-provider出了问题，改正错误之后，采用命令 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn dependency:go-offline -rf sfc-provider install -nsu -DskipTests</span><br></pre></td></tr></table></figure></p>
<p>编译安装，但是最后发现karaf启动异常，疑似出现data model缺失的情况，我怀疑可能是之前我可能执行过 <code>mvn clean</code> 之类的东西。</p>
<h1 id="section-2"></h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[INFO] --- spotbugs-maven-plugin:3.1.11:check (analyze-compile) @ sfc-provider ---</span><br><span class="line">[INFO] BugInstance size is 1</span><br><span class="line">[INFO] Error size is 0</span><br><span class="line">[INFO] Total bugs: 1</span><br><span class="line">[ERROR] Dead store to sfServicePathList in org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI.createRenderedServicePathEntry(ServiceFunctionPath, String, SfcServiceFunctionSchedulerAPI) [org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI] At SfcProviderRenderedPathAPI.java:[line 500] DLS_DEAD_LOCAL_STORE</span><br><span class="line">[INFO]</span><br></pre></td></tr></table></figure>
<p>在编译的时候，之所以会报这个错误，是因为定义与赋值之后的变量 sfServicePathList 在后续根本没有被调用过。</p>
<h1 id="python-process-中-如何重启-thread">Python process 中 如何重启 thread?</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">INFO:sfc/sfc_agent.py:Received request for SF creation: dpi-1</span><br><span class="line">INFO:sfc/sfc_agent.py:Received request from ODL to create SF. local_sf_topo content is: &#123;&apos;dpi-1&apos;: &#123;&apos;name&apos;: &apos;dpi-1&apos;, &apos;sf-data-plane-locator&apos;: [&#123;&apos;ip&apos;: &apos;192.168.1.11&apos;, &apos;port&apos;: 6633, &apos;service-function-forwarder&apos;: &apos;SFF1&apos;, &apos;name&apos;: &apos;dpi-1-dpl&apos;, &apos;transport&apos;: &apos;service-locator:vxlan-gpe&apos;&#125;], &apos;ip-mgmt-address&apos;: &apos;192.168.1.11&apos;, &apos;type&apos;: &apos;service-function-type:dpi&apos;, &apos;rest-uri&apos;: &apos;http://192.168.1.11:5000&apos;&#125;&#125;</span><br><span class="line">INFO:sfc.common.launcher:Starting Service Function: dpi-1</span><br><span class="line">ERROR:__main__:Exception on /config/service-function:service-functions/service-function/dpi-1 [PUT]</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/usr/local/lib/python3.5/dist-packages/flask/app.py&quot;, line 1817, in wsgi_app</span><br><span class="line">    response = self.full_dispatch_request()</span><br><span class="line">  File &quot;/usr/local/lib/python3.5/dist-packages/flask/app.py&quot;, line 1477, in full_dispatch_request</span><br><span class="line">    rv = self.handle_user_exception(e)</span><br><span class="line">  File &quot;/usr/local/lib/python3.5/dist-packages/flask/app.py&quot;, line 1381, in handle_user_exception</span><br><span class="line">    reraise(exc_type, exc_value, tb)</span><br><span class="line">  File &quot;/usr/local/lib/python3.5/dist-packages/flask/_compat.py&quot;, line 33, in reraise</span><br><span class="line">    raise value</span><br><span class="line">  File &quot;/usr/local/lib/python3.5/dist-packages/flask/app.py&quot;, line 1475, in full_dispatch_request</span><br><span class="line">    rv = self.dispatch_request()</span><br><span class="line">  File &quot;/usr/local/lib/python3.5/dist-packages/flask/app.py&quot;, line 1461, in dispatch_request</span><br><span class="line">    return self.view_functions[rule.endpoint](**req.view_args)</span><br><span class="line">  File &quot;sfc/sfc_agent.py&quot;, line 303, in create_sf</span><br><span class="line">    start_sf(sfname, sf_ip, sf_port, sf_type)</span><br><span class="line">  File &quot;/sfc/sfc-py/sfc/common/launcher.py&quot;, line 229, in start_sf</span><br><span class="line">    stop_service(sf_type, sf_name)</span><br><span class="line">  File &quot;/sfc/sfc-py/sfc/common/launcher.py&quot;, line 209, in stop_service</span><br><span class="line">    (service_type.upper(), service_name))</span><br><span class="line">TimeoutError: Failed to stop DPI &quot;dpi-1&quot;: service thread is still running after 10s</span><br><span class="line">INFO:werkzeug:192.168.1.5 - - [19/Jun/2019 20:26:51] &quot;PUT /config/service-function:service-functions/service-function/dpi-1 HTTP/1.1&quot; 500 -</span><br></pre></td></tr></table></figure>
<h1 id="section-3"></h1>
<p><code>sfc_agent.py</code> 启动以后，一个flask app 也随之被驱动，支持RESTFul API。比如service function 的创建，就是在收到<code>http:&lt;sf-ip-addr&gt;:6000/config/service-function:service-functions/service-function/&lt;sfname&gt;</code> 根据传递而来的JSON文件而创建(在进程中创建一个新 Thread)的。也即是，在一个service node上，<code>sfc_agent.py</code> 起到了一个前端proxy的作用，而随后创建的service funciton 其实只是一个运行在该进程中的一个 thread.</p>
<p>如果希望 service function 后续可以收到关于OMS加密的一些参数，那么需要注意: * 收到RESTFul API的时候，最好是在原有 Thread 不能停止运行的情况下，将 OMS 相关的参数传递给对应的 Thread. 实在不行 那就先kill掉，再创建一个新的 Thread。这么做的话，这个重启thread的速度需要尽量的快。比如一个 SFC 有变化，势必会诱发 OMS 参数的重新计算以及重新分配 (这样的话 一定要有DataChange event发生！相关的参数一定要写到DataStore里, 哪怕只写一个都行。。。) 如果一个SF只参与了一个SFC 且这个链条发生了变化，那么即使代表SF的thread重启了也没有关系，但是如果一个SF同时参与多个链条，那么这个时候SF需要重启可能就会对既有的SFC产生影响。。。</p>
<h1 id="section-4"></h1>
<p>SfcProviderServiceFunctionAPI 这个类中提供了方法: readServiceFunction 这个方法是向SfcDataStore中读取 ServiceFunction 对象出来的！！！而且我们看到, 在DataStore tree上，其母节点为 ServiceFunctions!!!</p>
<h1 id="section-5"></h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">2019-06-20T01:30:26,046 | ERROR | opendaylight-cluster-data-notification-dispatcher-41 | DataTreeChangeListenerActor      | org.opendaylight.controller.sal-clustering-commons | dataChanged(:83): member-1-shard-default-config: Error notifying listener org.opendaylight.sfc.provider.listeners.ServiceFunctionPathListener@48c28b2</span><br><span class="line">java.lang.NullPointerException: null</span><br><span class="line">        at org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI.createRenderedServicePathEntry(SfcProviderRenderedPathAPI.java:514) ~[379:org.opendaylight.sfc.provider:0.10.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI.createRenderedServicePathInConfig(SfcProviderRenderedPathAPI.java:143) ~[379:org.opendaylight.sfc.provider:0.10.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI.createRenderedServicePathInConfig(SfcProviderRenderedPathAPI.java:137) ~[379:org.opendaylight.sfc.provider:0.10.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.sfc.provider.listeners.ServiceFunctionPathListener.add(ServiceFunctionPathListener.java:54) ~[379:org.opendaylight.sfc.provider:0.10.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.sfc.provider.listeners.ServiceFunctionPathListener.add(ServiceFunctionPathListener.java:36) ~[379:org.opendaylight.sfc.provider:0.10.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.serviceutils.tools.mdsal.listener.DataTreeChangeListenerActions.onDataTreeChanged(DataTreeChangeListenerActions.java:67) ~[372:org.opendaylight.serviceutils.tools-api:0.4.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.serviceutils.tools.mdsal.listener.AbstractSyncDataTreeChangeListener.onDataTreeChanged(AbstractSyncDataTreeChangeListener.java:52) ~[372:org.opendaylight.serviceutils.tools-api:0.4.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.controller.md.sal.binding.impl.BindingDOMDataTreeChangeListenerAdapter.onDataTreeChanged(BindingDOMDataTreeChangeListenerAdapter.java:42) ~[225:org.opendaylight.controller.sal-binding-broker-impl:1.10.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.controller.sal.core.compat.AbstractLegacyDOMDataBrokerAdapter$ProxyListener.onDataTreeChanged(AbstractLegacyDOMDataBrokerAdapter.java:359) ~[235:org.opendaylight.controller.sal-core-compat:1.10.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.controller.cluster.datastore.DataTreeChangeListenerActor.dataChanged(DataTreeChangeListenerActor.java:81) ~[237:org.opendaylight.controller.sal-distributed-datastore:1.10.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.controller.cluster.datastore.DataTreeChangeListenerActor.handleReceive(DataTreeChangeListenerActor.java:42) ~[237:org.opendaylight.controller.sal-distributed-datastore:1.10.0.SNAPSHOT]</span><br></pre></td></tr></table></figure>
<p><code>java.lang.NullPointerException: null at org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI.createRenderedServicePathEntry(sfcProviderRenderedPathAPI.java:514)</code> 仔细观察这个信息，你会发现，这是一个java coding过程中很常见的一个错误信息。原因是想访问一个并没有被创建的对象。</p>
<h1 id="如何添加并没有被-maven-repository-的jar文件">如何添加并没有被 <code>Maven repository</code> 的jar文件？</h1>
<p>Many Java applications have dependencies that aren’t available in a public or private Maven repository. Sometimes you may have just a third party java library, packaged as a jar, that you need to put in your local repository for use in your builds. This is a very common scenario.</p>
<p>chagne to the uncompressed file of jPBC project, and type the following command respectively for <code>jpbc-api-2.0.0.jar</code> and <code>jpbc-plaf-2.0.0.jar</code>. The installation order matters, because <code>jpbc-plaf-2.0.0.jar</code> has a dependency relationship on <code>jpbc-api-2.0.0.jar</code>. I on We observe the following output and confirm that these two<br>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn install:install-file -Dfile=&lt;path-to-file&gt; -DpomFile=&lt;path-to-pomfile&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[INFO] --- maven-install-plugin:2.4:install-file (default-cli) @ jpbc ---</span><br><span class="line">[INFO] Installing /home/qsong/Documents/jpbc-2.0.0/jars/jpbc-plaf-2.0.0.jar to /home/qsong/.m2/repository/it/unisa/dia/gas/jpbc-plaf/2.0.0/jpbc-plaf-2.0.0.jar</span><br><span class="line">[INFO] Installing /home/qsong/Documents/jpbc-2.0.0/jpbc-plaf/pom.xml to /home/qsong/.m2/repository/it/unisa/dia/gas/jpbc-plaf/2.0.0/jpbc-plaf-2.0.0.pom</span><br></pre></td></tr></table></figure>
<p>还遇到了一个问题。。。解决方案： https://stackoverflow.com/questions/1355548/maven-including-jar-not-found-in-public-repository 大意就是 我们需要在依赖声明中，将某个jar文件的scope声明成system, 同时必须给出systemPath的属性，指明需要使用的jar文件的路径。 参考文献： 1. https://maven.apache.org/guides/mini/guide-3rd-party-jars-local.html 2. https://stackoverflow.com/questions/4955635/how-to-add-local-jar-files-to-a-maven-project 3. https://cleanprogrammer.net/adding-3rd-party-jar-to-maven-projects/</p>
<h1 id="还是添加第三方java-jar问题">还是添加第三方java jar问题</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[INFO] Running org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 26.15 s &lt;&lt;&lt; FAILURE! - in org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] installFeatureCatchAndLog(org.opendaylight.odlparent.featuretest.SingleFeatureTest)[repoUrl: file:/home/qsong/Documents/sfc-patch/features/odl-sfc-provider/target/feature/feature.xml, Feature: odl-sfc-provider 0.10.0.SNAPSHOT]  Time elapsed: 23.92 s  &lt;&lt;&lt; ERROR!</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve org.opendaylight.sfc.provider/0.10.0.SNAPSHOT: missing requirement [org.opendaylight.sfc.provider/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=&quot;(osgi.wiring.package=it.unisa.dia.gas.jpbc)&quot;</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br></pre></td></tr></table></figure>
<p>我最后将jpbc project编译成bundle, 并且不用scop以及systemPath之后 (Using system scope may work but it is not recommended even in the Maven specification. it is not portable.)，编译出现这个错误！ <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 30.51 s &lt;&lt;&lt; FAILURE! - in org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] installFeatureCatchAndLog(org.opendaylight.odlparent.featuretest.SingleFeatureTest)[repoUrl: file:/home/qsong/Documents/sfc-patch/features/odl-sfc-provider/target/feature/feature.xml, Feature: odl-sfc-provider 0.10.0.SNAPSHOT]  Time elapsed: 28.683 s  &lt;&lt;&lt; ERROR!</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve org.opendaylight.sfc.provider/0.10.0.SNAPSHOT: missing requirement [org.opendaylight.sfc.provider/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=it.unisa.dia.gas.jpbc)(version&gt;=2.0.0)(!(version&gt;=3.0.0)))&quot;</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br></pre></td></tr></table></figure></p>
<p>为啥会出现 <code>version&gt;=3.0.0</code>? 我怀疑原因是我在 <code>features/odl-sfc-provider</code> 这个文件下的 <code>pom.xml</code> 中指明了scope=system以及systemPath的。取消了这两项之后，虽然还是报错，内容如下: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 33.486 s &lt;&lt;&lt; FAILURE! - in org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] installFeatureCatchAndLog(org.opendaylight.odlparent.featuretest.SingleFeatureTest)[repoUrl: file:/home/qsong/Documents/sfc-patch/features/odl-sfc-provider/target/feature/feature.xml, Feature: odl-sfc-provider 0.10.0.SNAPSHOT]  Time elapsed: 26.74 s  &lt;&lt;&lt; ERROR!</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve org.opendaylight.sfc.provider/0.10.0.SNAPSHOT: missing requirement [org.opendaylight.sfc.provider/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=&quot;(osgi.wiring.package=it.unisa.dia.gas.plaf.jpbc.pairing)&quot;</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br></pre></td></tr></table></figure></p>
<p>这次找不到的是<code>it.unisa.dia.gas.plaf.jpbc.pairing</code>了 而不再是找不到 <code>it.unisa.dia.gas.plaf.jpbc</code> 了。</p>
<p>当我把 <code>features/odl-sfc-provider/pom.xml</code> 中关于 <code>sfc-jpbc</code>的依赖都删除之后，再编译错误又不一样了。。。首先，这个文件中确实不应该出现关于<code>sfc-jpbc</code>的依赖，因为正常的话，<code>sfc-jpbc</code>已经被收录进<code>sfc-provider</code>中了，而依赖 <code>sfc-provider</code> 已经在 <code>features/odl-sfc-provider/pom.xml</code> 声明过了。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">INFO] Running org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 27.418 s &lt;&lt;&lt; FAILURE! - in org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] installFeatureCatchAndLog(org.opendaylight.odlparent.featuretest.SingleFeatureTest)[repoUrl: file:/home/qsong/Documents/sfc-patch/features/odl-sfc-provider/target/feature/feature.xml, Feature: odl-sfc-provider 0.10.0.SNAPSHOT]  Time elapsed: 23.186 s  &lt;&lt;&lt; ERROR!</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve it.unisa.dia.gas.jpbc-plaf/2.0.0: missing requirement [it.unisa.dia.gas.jpbc-plaf/2.0.0] osgi.wiring.package; filter:=&quot;(osgi.wiring.package=it.unisa.dia.gas.plaf.jpbc.mm.clt13.pairing)&quot;</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INFO] Running org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 31.129 s &lt;&lt;&lt; FAILURE! - in org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] installFeatureCatchAndLog(org.opendaylight.odlparent.featuretest.SingleFeatureTest)[repoUrl: file:/home/qsong/Documents/sfc-patch/features/odl-sfc-provider/target/feature/feature.xml, Feature: odl-sfc-provider 0.10.0.SNAPSHOT]  Time elapsed: 29.362 s  &lt;&lt;&lt; ERROR!</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve it.unisa.dia.gas.jpbc-plaf/2.0.0: missing requirement [it.unisa.dia.gas.jpbc-plaf/2.0.0] osgi.wiring.package; filter:=&quot;(osgi.wiring.package=it.unisa.dia.gas.plaf.jpbc.mm.clt13.pairing)&quot;</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br></pre></td></tr></table></figure>
<h1 id="编译过程中出现-packetprocessingservice-找不到的情况">编译过程中出现 <code>PacketProcessingService</code> 找不到的情况</h1>
<ol type="1">
<li>https://yinqingwang.wordpress.com/2016/11/14/how-to-send-raw-packet-from-odls-controller-to-network-datapath/</li>
<li>https://ask.opendaylight.org/question/3872/opendaylight-plugin-send-packet-from-given-switch-and-given-port/</li>
<li>https://github.com/opendaylight/openflowplugin/blob/master/model/model-flow-service/src/main/yang/packet-processing.yang</li>
</ol>
<p>通过以上几个链接可以只知道，这个<code>PacketProcessingService</code> 接口实际上是在项目 <code>openflowplugin</code> 中的 <code>model</code> 中定义的。如果需要import这个接口，需要在我定义的项目的<code>pom.xml</code>文件中，添加如下依赖： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.opendaylight.openflowplugin.model&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;model-flow-service&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;$&#123;feature.openflowplugin.version&#125;&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="blueprint-文件编写有误">Blueprint 文件编写有误</h1>
<p>编译完毕，启动<code>karaf</code>, <code>features</code> 被安装完毕之后，执行 <code>bundle:diag</code>, 发现如下问题： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">opendaylight-user@root&gt;bundle:diag</span><br><span class="line">org.opendaylight.sfc.sfc-sfp-checker (386)</span><br><span class="line">------------------------------------------</span><br><span class="line">Status: Failure</span><br><span class="line">Declarative Services</span><br><span class="line">Blueprint</span><br><span class="line">7/2/19, 10:37 AM</span><br><span class="line">Exception:</span><br><span class="line">Unresolved ref/idref to component: delaycollectorConfig</span><br><span class="line">org.osgi.service.blueprint.container.ComponentDefinitionException: Unresolved ref/idref to component: delaycollectorConfig</span><br><span class="line">    at org.apache.aries.blueprint.container.BlueprintRepository.validate(BlueprintRepository.java:376)</span><br><span class="line">    at org.apache.aries.blueprint.container.RecipeBuilder.createRepository(RecipeBuilder.java:94)</span><br><span class="line">    at org.apache.aries.blueprint.container.BlueprintContainerImpl.getRepository(BlueprintContainerImpl.java:504)</span><br><span class="line">    at org.apache.aries.blueprint.container.BlueprintContainerImpl.doRun(BlueprintContainerImpl.java:361)</span><br><span class="line">    at org.apache.aries.blueprint.container.BlueprintContainerImpl.run(BlueprintContainerImpl.java:278)</span><br><span class="line">    at org.apache.aries.blueprint.container.BlueprintExtender.createContainer(BlueprintExtender.java:299)</span><br><span class="line">    at org.apache.aries.blueprint.container.BlueprintExtender.createContainer(BlueprintExtender.java:268)</span><br><span class="line">    at org.apache.aries.blueprint.container.BlueprintExtender.createContainer(BlueprintExtender.java:264)</span><br><span class="line">    at org.apache.aries.blueprint.container.BlueprintExtender.modifiedBundle(BlueprintExtender.java:254)</span><br><span class="line">    at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.customizerModified(BundleHookBundleTracker.java:500)</span><br><span class="line">    at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.customizerModified(BundleHookBundleTracker.java:433)</span><br><span class="line">    at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$AbstractTracked.track(BundleHookBundleTracker.java:725)</span><br><span class="line">    at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.bundleChanged(BundleHookBundleTracker.java:463)</span><br><span class="line">    at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$BundleEventHook.event(BundleHookBundleTracker.java:422)</span><br><span class="line">    at org.eclipse.osgi.internal.framework.EquinoxEventPublisher$2.call(EquinoxEventPublisher.java:239)</span><br><span class="line">    at org.eclipse.osgi.internal.serviceregistry.ServiceRegistry.notifyHookPrivileged(ServiceRegistry.java:1298)</span><br><span class="line">    at org.eclipse.osgi.internal.serviceregistry.ServiceRegistry.notifyHooksPrivileged(ServiceRegistry.java:1278)</span><br><span class="line">    at org.eclipse.osgi.internal.framework.EquinoxEventPublisher.notifyEventHooksPrivileged(EquinoxEventPublisher.java:236)</span><br><span class="line">    at org.eclipse.osgi.internal.framework.EquinoxEventPublisher.publishBundleEventPrivileged(EquinoxEventPublisher.java:194)</span><br><span class="line">    at org.eclipse.osgi.internal.framework.EquinoxEventPublisher.publishBundleEvent(EquinoxEventPublisher.java:120)</span><br><span class="line">    at org.eclipse.osgi.internal.framework.EquinoxEventPublisher.publishBundleEvent(EquinoxEventPublisher.java:112)</span><br><span class="line">    at org.eclipse.osgi.internal.framework.EquinoxContainerAdaptor.publishModuleEvent(EquinoxContainerAdaptor.java:168)</span><br><span class="line">    at org.eclipse.osgi.container.Module.publishEvent(Module.java:476)</span><br><span class="line">    at org.eclipse.osgi.container.Module.start(Module.java:467)</span><br><span class="line">    at org.eclipse.osgi.internal.framework.EquinoxBundle.start(EquinoxBundle.java:383)</span><br><span class="line">    at org.eclipse.osgi.internal.framework.EquinoxBundle.start(EquinoxBundle.java:402)</span><br><span class="line">    at org.apache.karaf.features.internal.service.BundleInstallSupportImpl.startBundle(BundleInstallSupportImpl.java:161)</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.startBundle(FeaturesServiceImpl.java:1116)</span><br><span class="line">    at org.apache.karaf.features.internal.service.Deployer.deploy(Deployer.java:997)</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.doProvision(FeaturesServiceImpl.java:1025)</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.lambda$doProvisionInThread$13(FeaturesServiceImpl.java:964)</span><br><span class="line">    at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)</span><br><span class="line">    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)</span><br><span class="line">    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)</span><br><span class="line">    at java.base/java.lang.Thread.run(Thread.java:834)</span><br></pre></td></tr></table></figure></p>
<p>我自己编写的 SDN app 并没有顺利启动，说是 Unresolved ref/idref to component: delaycollectorConfig, 就是我写的 application 的配置类并没有被找到。从 Exception trace 来看，并没有提示是哪个class/method出的问题(不过从异常 org.osgi.service.blueprint.container.ComponentDefinitionException 来看，问题应该出在blueprint文件中)。我只能通过 grep + 关键词查找了，定位到了问题：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;blueprint xmlns=&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot; xmlns:odl=&quot;http://opendaylight.org/xmlns/blueprint/v1.0.0&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;reference id=&quot;dataBroker&quot;</span><br><span class="line">    interface=&quot;org.opendaylight.controller.md.sal.binding.api.DataBroker&quot;</span><br><span class="line">    odl:type=&quot;default&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;odl:clustered-app-config id=&quot;pathCheckerConfig&quot;</span><br><span class="line">      binding-class=&quot;org.opendaylight.yang.gen.v1.urn.opendaylight.sfc.sfp.checker.config.rev190701.SfpCheckerConfig&quot;&gt;</span><br><span class="line">&lt;/odl:clustered-app-config&gt;</span><br><span class="line"></span><br><span class="line">&lt;reference id=&quot;notificationProviderService&quot; interface=&quot;org.opendaylight.controller.sal.binding.api.NotificationProviderService&quot;/&gt;  </span><br><span class="line"></span><br><span class="line">&lt;odl:rpc-service id=&quot;mypacketHandlerService&quot;</span><br><span class="line">    interface=&quot;org.opendaylight.yang.gen.v1.urn.opendaylight.packet.service.rev130709.PacketProcessingService&quot; /&gt;</span><br><span class="line">  </span><br><span class="line">&lt;reference id=&quot;rpcRegistry&quot;</span><br><span class="line">     interface=&quot;org.opendaylight.controller.sal.binding.api.RpcProviderRegistry&quot; /&gt;</span><br><span class="line">  </span><br><span class="line">&lt;bean id=&quot;provider&quot;</span><br><span class="line">    class=&quot;org.opendaylight.sfc.pathchecker.SfpCheckerProvider&quot;</span><br><span class="line">    init-method=&quot;init&quot; destroy-method=&quot;close&quot;&gt;</span><br><span class="line">    &lt;argument ref=&quot;dataBroker&quot; /&gt;</span><br><span class="line">    &lt;argument ref=&quot;delaycollectorConfig&quot; /&gt;</span><br><span class="line">    &lt;argument ref=&quot;notificationProviderService&quot; /&gt;</span><br><span class="line">    &lt;argument ref=&quot;mypacketHandlerService&quot; /&gt;</span><br><span class="line">    &lt;argument ref=&quot;rpcRegistry&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;/blueprint&gt;</span><br></pre></td></tr></table></figure>
<p>原来是我实例化 <code>bean id="rpcRegistry"</code>, 在argument处给了错误的的<code>ref</code>: 实际上应该是<code>pathCheckerConfig</code>而不是<code>delaycollectorConfig</code>. 因为这个错误导致的异常，最后连run-demo的ping包也没有发出去。</p>
<h1 id="section-6"></h1>
<p>在编译sfc-sfp-checker的时候，遇到如下错误： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time:  9.559 s</span><br><span class="line">[INFO] Finished at: 2019-07-02T12:47:43+02:00</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.8.0:compile (default-compile) on project sfc-sfp-checker: Compilation failure: Compilation failure:</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-sfp-checker/src/main/java/org/opendaylight/sfc/pathchecker/SfpCheckerPacketSenderTask.java:[13,49] package org.opendaylight.l2switch.arphandler.core does not exist</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-sfp-checker/src/main/java/org/opendaylight/sfc/pathchecker/SfpCheckerPacketSenderTask.java:[14,54] package org.opendaylight.l2switch.arphandler.inventory does not exist</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-sfp-checker/src/main/java/org/opendaylight/sfc/pathchecker/SfpCheckerPacketSenderTask.java:[16,75] package org.opendaylight.yang.gen.v1.urn.opendaylight.packet.ipv4.rev140528 does not exist</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-sfp-checker/src/main/java/org/opendaylight/sfc/pathchecker/SfpCheckerPacketSenderTask.java:[21,43] package org.opendaylight.controller.liblldp does not exist</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-sfp-checker/src/main/java/org/opendaylight/sfc/pathchecker/SfpCheckerPacketSenderTask.java:[22,43] package org.opendaylight.controller.liblldp does not exist</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-sfp-checker/src/main/java/org/opendaylight/sfc/pathchecker/SfpCheckerPacketSenderTask.java:[23,43] package org.opendaylight.controller.liblldp does not exist</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-sfp-checker/src/main/java/org/opendaylight/sfc/pathchecker/SfpCheckerPacketSenderTask.java:[24,43] package org.opendaylight.controller.liblldp does not exist</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-sfp-checker/src/main/java/org/opendaylight/sfc/pathchecker/SfpCheckerPacketSenderTask.java:[25,43] package org.opendaylight.controller.liblldp does not exist</span><br></pre></td></tr></table></figure></p>
<p>原因肯定是依赖管理没有弄好，添加<code>l2switch.arphandler</code>以及<code>liblldp</code></p>
<h1 id="新问题">新问题</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">2019-07-03T01:08:34,528 | ERROR | activator-1-thread-2 | BootFeaturesInstaller            | org.apache.karaf.features.core | installBootFeatures(:113): Error installing boot features</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve root: missing requirement [root] osgi.identity; osgi.identity=odl-sfc-sfp-checker; type=karaf.feature; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; filter:=&quot;(&amp;(osgi.identity=odl-sfc-sfp-checker)(type=karaf.feature)(version&gt;=0.10.0.SNAPSHOT)(version&lt;=0.10.0.SNAPSHOT))&quot; [caused by: Unable to resolve odl-sfc-sfp-checker/0.10.0.SNAPSHOT: missing requirement [odl-sfc-sfp-checker/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.controller.liblldp; type=osgi.bundle; version=&quot;[0.14.4,0.14.4]&quot;; resolution:=mandatory [caused by: Unable to resolve org.opendaylight.controller.liblldp/0.14.4: missing requirement [org.opendaylight.controller.liblldp/0.14.4] osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=com.google.common.collect)(version&gt;=23.6.0)(!(version&gt;=24.0.0)))&quot;]]</span><br><span class="line">        at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.doResolve(ResolverImpl.java:392) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:378) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:332) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.region.SubsystemResolver.resolve(SubsystemResolver.java:257) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.Deployer.deploy(Deployer.java:388) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.FeaturesServiceImpl.doProvision(FeaturesServiceImpl.java:1025) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.FeaturesServiceImpl.lambda$doProvisionInThread$13(FeaturesServiceImpl.java:964) ~[?:?]</span><br><span class="line">        at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]</span><br></pre></td></tr></table></figure>
<p>因为没有在<code>features/odl-sfc-sfp-checker</code>中的<code>pom.xml</code>中依赖声明没有关于<code>org.opendaylight.controller.liblldp</code>的缘故</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vagrant@odl:~$ tail -f sfc/karaf/target/assembly/data/log/karaf.log</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]</span><br><span class="line">    at java.lang.Thread.run(Thread.java:834) [?:?]</span><br><span class="line">Caused by: org.apache.felix.resolver.reason.ReasonException: Unable to resolve odl-sfc-sfp-checker/0.10.0.SNAPSHOT: missing requirement [odl-sfc-sfp-checker/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.controller.sal-common-api; type=osgi.bundle; version=&quot;[1.7.4,1.7.4]&quot;; resolution:=mandatory [caused by: Unable to resolve org.opendaylight.controller.sal-common-api/1.7.4: missing requirement [org.opendaylight.controller.sal-common-api/1.7.4] osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=com.google.common.base)(version&gt;=23.6.0)(!(version&gt;=24.0.0)))&quot;]</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">    ... 12 more</span><br><span class="line">Caused by: org.apache.felix.resolver.reason.ReasonException: Unable to resolve org.opendaylight.controller.sal-common-api/1.7.4: missing requirement [org.opendaylight.controller.sal-common-api/1.7.4] osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=com.google.common.base)(version&gt;=23.6.0)(!(version&gt;=24.0.0)))&quot;</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">    ... 12 more</span><br></pre></td></tr></table></figure>
<p>我一开始以为是 <code>org.opendaylight.controller.sal-common-api</code> 这个包找不到 但是即使在pom.xml中声明了依赖，依然还是报同样的错误，这个感觉有点儿似曾相识。从错误日志来看，<code>com.google.common.base</code> 像是被加载了多次。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">2019-07-03T10:48:28,376 | ERROR | activator-1-thread-2 | BootFeaturesInstaller            | org.apache.karaf.features.core | installBootFeatures(:113): Error installing boot features</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve root: missing requirement [root] osgi.identity; osgi.identity=odl-sfc-sfp-checker; type=karaf.feature; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; filter:=&quot;(&amp;(osgi.identity=odl-sfc-sfp-checker)(type=karaf.feature)(version&gt;=0.10.0.SNAPSHOT)(version&lt;=0.10.0.SNAPSHOT))&quot; [caused by: Unable to resolve odl-sfc-sfp-checker/0.10.0.SNAPSHOT: missing requirement [odl-sfc-sfp-checker/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.controller.model.topology; type=osgi.bundle; version=&quot;[1.7.4,1.7.4]&quot;; resolution:=mandatory [caused by: Unable to resolve org.opendaylight.controller.model.topology/1.7.4: missing requirement [org.opendaylight.controller.model.topology/1.7.4] osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=com.google.common.collect)(version&gt;=23.6.0)(!(version&gt;=24.0.0)))&quot;]]</span><br><span class="line">        at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.doResolve(ResolverImpl.java:392) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:378) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:332) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.region.SubsystemResolver.resolve(SubsystemResolver.java:257) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.Deployer.deploy(Deployer.java:388) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.FeaturesServiceImpl.doProvision(FeaturesServiceImpl.java:1025) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.FeaturesServiceImpl.lambda$doProvisionInThread$13(FeaturesServiceImpl.java:964) ~[?:?]</span><br><span class="line">        at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]</span><br><span class="line">        at java.lang.Thread.run(Thread.java:834) [?:?]</span><br><span class="line">Caused by: org.apache.felix.resolver.reason.ReasonException: Unable to resolve odl-sfc-sfp-checker/0.10.0.SNAPSHOT: missing requirement [odl-sfc-sfp-checker/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.controller.model.topology; type=osgi.bundle; version=&quot;[1.7.4,1.7.4]&quot;; resolution:=mandatory [caused by: Unable to resolve org.opendaylight.controller.model.topology/1.7.4: missing requirement [org.opendaylight.controller.model.topology/1.7.4] osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=com.google.common.collect)(version&gt;=23.6.0)(!(version&gt;=24.0.0)))&quot;]</span><br><span class="line">        at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">        ... 12 more</span><br></pre></td></tr></table></figure>
<p>在pom.xml中删除了一些依赖声明， <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">./features/odl-sfc-statistics/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller/odl-controller-model-topology/version = 1.10.0-SNAPSHOT</span><br><span class="line">./features/odl-sfc-statistics/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller/odl-controller-model-topology/classifier = features</span><br><span class="line">./features/odl-sfc-statistics/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller/odl-controller-model-topology/type = xml</span><br><span class="line">./features/odl-sfc-statistics/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller/odl-controller-model-topology/scope = compile</span><br><span class="line">./features/odl-sfc-statistics/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller.model/model-topology/version = 1.10.0-SNAPSHOT</span><br><span class="line">./features/odl-sfc-statistics/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller.model/model-topology/type = jar</span><br><span class="line">./features/odl-sfc-statistics/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller.model/model-topology/scope = compile</span><br><span class="line">./features/odl-sfc-sfp-checker/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller.model/model-topology/version = 1.7.4</span><br><span class="line">./features/odl-sfc-sfp-checker/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller.model/model-topology/type = jar</span><br><span class="line">./features/odl-sfc-sfp-checker/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller.model/model-topology/scope = compile</span><br><span class="line">./features/odl-sfc-sfp-checker/target/feature/feature.xml:        &lt;bundle&gt;mvn:org.opendaylight.controller.model/model-topology/1.7.4&lt;/bundle&gt;</span><br></pre></td></tr></table></figure></p>
<p>原因应该跟以上有关 为啥sfc-sfp-checker使用的model-topology版本号是1.7.4，而其他使用的是1.10.0-SNAPSHOT.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">2019-07-03T19:10:15,177 | ERROR | activator-1-thread-2 | BootFeaturesInstaller            | org.apache.karaf.features.core | installBootFeatures(:113): Error installing boot features</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve root: missing requirement [root] osgi.identity; osgi.identity=odl-sfc-sfp-checker; type=karaf.feature; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; filter:=&quot;(&amp;(osgi.identity=odl-sfc-sfp-checker)(type=karaf.feature)(version&gt;=0.10.0.SNAPSHOT)(version&lt;=0.10.0.SNAPSHOT))&quot; [caused by: Unable to resolve odl-sfc-sfp-checker/0.10.0.SNAPSHOT: missing requirement [odl-sfc-sfp-checker/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.sfc.sfp-checker; type=osgi.bundle; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; resolution:=mandatory [caused by: Unable to resolve org.opendaylight.sfc.sfp-checker/0.10.0.SNAPSHOT: missing requirement [org.opendaylight.sfc.sfp-checker/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.l2switch.arphandler.core)&quot;]]</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.doResolve(ResolverImpl.java:392) ~[?:?]</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:378) ~[?:?]</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:332) ~[?:?]</span><br><span class="line">    at org.apache.karaf.features.internal.region.SubsystemResolver.resolve(SubsystemResolver.java:257) ~[?:?]</span><br><span class="line">    at org.apache.karaf.features.internal.service.Deployer.deploy(Deployer.java:388) ~[?:?]</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.doProvision(FeaturesServiceImpl.java:1025) ~[?:?]</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.lambda$doProvisionInThread$13(FeaturesServiceImpl.java:964) ~[?:?]</span><br><span class="line">    at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]</span><br><span class="line">    at java.lang.Thread.run(Thread.java:834) [?:?]</span><br><span class="line">Caused by: org.apache.felix.resolver.reason.ReasonException: Unable to resolve odl-sfc-sfp-checker/0.10.0.SNAPSHOT: missing requirement [odl-sfc-sfp-checker/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.sfc.sfp-checker; type=osgi.bundle; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; resolution:=mandatory [caused by: Unable to resolve org.opendaylight.sfc.sfp-checker/0.10.0.SNAPSHOT: missing requirement [org.opendaylight.sfc.sfp-checker/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.l2switch.arphandler.core)&quot;]</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">    ... 12 more</span><br><span class="line">Caused by: org.apache.felix.resolver.reason.ReasonException: Unable to resolve org.opendaylight.sfc.sfp-checker/0.10.0.SNAPSHOT: missing requirement [org.opendaylight.sfc.sfp-checker/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.l2switch.arphandler.core)&quot;</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br></pre></td></tr></table></figure>
<p>为啥说找不到 <code>org.opendaylight.l2switch.arphandler.core</code>? 我查看了下MANIFEST,这个包实际上就在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i -H &quot;Content-Type: application/json&quot; -H &quot;Cache-Control: no-cache&quot; --data &apos;&#123; &quot;input&quot;: &#123; &#125; &#125;&apos; -X POST --user admin:admin http://localhost:8181/restconf/operations/sfc-sfp-checker:send-packet</span><br></pre></td></tr></table></figure>
<p>根据 OpenflowPlugin 的<a href="https://docs.opendaylight.org/projects/openflowplugin/en/latest/users/operation.html" target="_blank" rel="noopener">文档</a>, 找到下面这条RESTFul API的调用方式，返回的结果是XML文件，所有的nodes信息就获得到了。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &quot;Content-Type: application/xml&quot; -H &quot;Accept: application/xml&quot; -X GET --user admin:admin http://localhost:8181/restconf/operational/network-topology:network-topology/topology/flow:1</span><br></pre></td></tr></table></figure></p>
<p>返回结果示例: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;topology xmlns=&quot;urn:TBD:params:xml:ns:yang:network-topology&quot;&gt;</span><br><span class="line">   &lt;topology-id&gt;flow:1&lt;/topology-id&gt;</span><br><span class="line">   &lt;node&gt;</span><br><span class="line">      &lt;node-id&gt;openflow:46456727321924&lt;/node-id&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:46456727321924:LOCAL&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:46456727321924&apos;]/a:node-connector[a:id=&apos;openflow:46456727321924:LOCAL&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:46456727321924:1&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:46456727321924&apos;]/a:node-connector[a:id=&apos;openflow:46456727321924:1&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:46456727321924:3&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:46456727321924&apos;]/a:node-connector[a:id=&apos;openflow:46456727321924:3&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:46456727321924:2&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:46456727321924&apos;]/a:node-connector[a:id=&apos;openflow:46456727321924:2&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;inventory-node-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:46456727321924&apos;]&lt;/inventory-node-ref&gt;</span><br><span class="line">   &lt;/node&gt;</span><br><span class="line">   &lt;node&gt;</span><br><span class="line">      &lt;node-id&gt;openflow:156685216991309&lt;/node-id&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:156685216991309:3&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:156685216991309&apos;]/a:node-connector[a:id=&apos;openflow:156685216991309:3&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:156685216991309:2&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:156685216991309&apos;]/a:node-connector[a:id=&apos;openflow:156685216991309:2&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:156685216991309:LOCAL&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:156685216991309&apos;]/a:node-connector[a:id=&apos;openflow:156685216991309:LOCAL&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:156685216991309:1&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:156685216991309&apos;]/a:node-connector[a:id=&apos;openflow:156685216991309:1&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;inventory-node-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:156685216991309&apos;]&lt;/inventory-node-ref&gt;</span><br><span class="line">   &lt;/node&gt;</span><br><span class="line">   &lt;node&gt;</span><br><span class="line">      &lt;node-id&gt;openflow:213647924314953&lt;/node-id&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:213647924314953:LOCAL&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:213647924314953&apos;]/a:node-connector[a:id=&apos;openflow:213647924314953:LOCAL&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:213647924314953:1&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:213647924314953&apos;]/a:node-connector[a:id=&apos;openflow:213647924314953:1&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;inventory-node-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:213647924314953&apos;]&lt;/inventory-node-ref&gt;</span><br><span class="line">   &lt;/node&gt;</span><br><span class="line">   &lt;node&gt;</span><br><span class="line">      &lt;node-id&gt;openflow:77446495327310&lt;/node-id&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:77446495327310:1&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:77446495327310&apos;]/a:node-connector[a:id=&apos;openflow:77446495327310:1&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:77446495327310:LOCAL&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:77446495327310&apos;]/a:node-connector[a:id=&apos;openflow:77446495327310:LOCAL&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;inventory-node-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:77446495327310&apos;]&lt;/inventory-node-ref&gt;</span><br><span class="line">   &lt;/node&gt;</span><br><span class="line">&lt;/topology&gt;</span><br></pre></td></tr></table></figure></p>
<p>现在的问题是，如何找到ServiceNode(SFC定义)和Node(OpenFlowPlugin定义)之间的映射关系？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 获取某个node的详细信息</span><br><span class="line">curl -H &quot;Content-Type: application/xml&quot; -H &quot;Accept: application/xml&quot; -X GET --user admin:admin http://localhost:8181/restconf/operational/opendaylight-inventory:nodes/node/openflow:77446495327310</span><br></pre></td></tr></table></figure>
<p>有时候切换另一个分支，然后重新执行./run_demo.sh的时候，在执行脚本setup_sfc.py的时候，会遇到下列错误 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP GET http://192.168.1.5:8181/restconf/operational/service-function-path:service-function-paths-state/service-function-path-state/SFP1</span><br><span class="line">result: 404</span><br><span class="line">sfp_stae_list: &#123;&#125;</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/sfc/sfc-demo/sfc103/setup_sfc.py&quot;, line 599, in &lt;module&gt;</span><br><span class="line">    rsp_name = get_rsp_name(&quot;SFP1&quot;, False)</span><br><span class="line">  File &quot;/sfc/sfc-demo/sfc103/setup_sfc.py&quot;, line 571, in get_rsp_name</span><br><span class="line">    for sfp_state in sfp_state_list[&quot;service-function-path-state&quot;]:</span><br><span class="line">KeyError: &apos;service-function-path-state&apos;</span><br></pre></td></tr></table></figure></p>
<p>这个错误意思是，SDN controller 中的 service-function-path 并没有被创立好。挣扎了许久，导致这个现象的原因是，SDN controller创建 service-function-path, 等待数据库相应的记录可查询需要一定的时间，如果等待时间不够，立即就HTTP GET的话，很容易就会遇到相关的记录查询不到的问题。这个问题在SFC涵盖的VNF数目越多越明显。 如果真的遇到这样的问题，在确定SDN controller没有BUG的情况下，不妨最后再执行一次 setup_sfc.py</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/05/17/intelliJ-idea-install-crack/" rel="prev" title="IntelliJ IDEA 下本地开发+远程同步+编译调试 工作流程">
      <i class="fa fa-chevron-left"></i> IntelliJ IDEA 下本地开发+远程同步+编译调试 工作流程
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/06/14/bash-tuto/" rel="next" title="bash_tuto">
      bash_tuto <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#odl-controller-直接发送数据包给-ovs-交换机"><span class="nav-number">1.</span> <span class="nav-text">ODL controller 直接发送数据包给 OVS 交换机</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#odl-controller-直接发送数据包到网络中"><span class="nav-number">2.</span> <span class="nav-text">ODL controller 直接发送数据包到网络中</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#为啥通过-maven-archetype-创建的project都有个karaf"><span class="nav-number">3.</span> <span class="nav-text">为啥通过 maven archetype 创建的project都有个karaf</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#odl-开发需要的基础知识"><span class="nav-number">4.</span> <span class="nav-text">ODL 开发需要的基础知识</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#osgi"><span class="nav-number">5.</span> <span class="nav-text">OSGi</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#源码编译-odl"><span class="nav-number">6.</span> <span class="nav-text">源码编译 ODL</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#odl-开发中的日志管理"><span class="nav-number">7.</span> <span class="nav-text">ODL 开发中的日志管理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#integration-项目"><span class="nav-number">8.</span> <span class="nav-text">Integration 项目</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#odl-开发中必用的-karaf-指令"><span class="nav-number">9.</span> <span class="nav-text">ODL 开发中必用的 Karaf 指令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#rpc-机制"><span class="nav-number">10.</span> <span class="nav-text">RPC 机制</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#rpc-调用分类"><span class="nav-number">10.1.</span> <span class="nav-text">RPC 调用分类</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sfc-项目"><span class="nav-number">11.</span> <span class="nav-text">sfc 项目</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#a-required-class-was-missing...javaxxmlbindjaxbexception..."><span class="nav-number">12.</span> <span class="nav-text">A required class was missing...javax/xml/bind/JAXBException...</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#karaf-在虚拟机共享文件夹中启动的问题"><span class="nav-number">13.</span> <span class="nav-text">karaf 在虚拟机共享文件夹中启动的问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装-odl-sfc-statistics-feature-失败"><span class="nav-number">14.</span> <span class="nav-text">安装 odl-sfc-statistics feature 失败</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#扩展-yang-data-model"><span class="nav-number">15.</span> <span class="nav-text">扩展 YANG data model</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#启动karaf-安装sfc-feature-报错"><span class="nav-number">16.</span> <span class="nav-text">启动karaf 安装sfc feature 报错！</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#删除.m2repository所有内容之后编译反而无法通过了"><span class="nav-number">17.</span> <span class="nav-text">删除.m2/repository所有内容之后，编译反而无法通过了。。。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#清空了sfckaraftargetassembly文件之后将新编译好的文件解压之后直接放在这里当试图去关闭karaf进程的时候会出现无法关闭的情况-失败的信息非常的奇怪第一个错误提示的应该是karaf-console-shell-ssh进程无法被连接上"><span class="nav-number">18.</span> <span class="nav-text">清空了sfc/karaf/target/assembly文件之后，将新编译好的文件解压之后直接放在这里，当试图去关闭karaf进程的时候，会出现无法关闭的情况 失败的信息非常的奇怪，第一个错误提示的应该是karaf console shell ssh进程无法被连接上。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#为什么要同时有-service-function-chain-service-function-paths-rendered-service-paths-三种概念"><span class="nav-number">19.</span> <span class="nav-text">为什么要同时有 service-function-chain, service-function-paths, rendered-service-paths 三种概念？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#section"><span class="nav-number">20.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#section-1"><span class="nav-number">21.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#section-2"><span class="nav-number">22.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#python-process-中-如何重启-thread"><span class="nav-number">23.</span> <span class="nav-text">Python process 中 如何重启 thread?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#section-3"><span class="nav-number">24.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#section-4"><span class="nav-number">25.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#section-5"><span class="nav-number">26.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#如何添加并没有被-maven-repository-的jar文件"><span class="nav-number">27.</span> <span class="nav-text">如何添加并没有被 Maven repository 的jar文件？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#还是添加第三方java-jar问题"><span class="nav-number">28.</span> <span class="nav-text">还是添加第三方java jar问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#编译过程中出现-packetprocessingservice-找不到的情况"><span class="nav-number">29.</span> <span class="nav-text">编译过程中出现 PacketProcessingService 找不到的情况</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#blueprint-文件编写有误"><span class="nav-number">30.</span> <span class="nav-text">Blueprint 文件编写有误</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#section-6"><span class="nav-number">31.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#新问题"><span class="nav-number">32.</span> <span class="nav-text">新问题</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">rennsong</p>
  <div class="site-description" itemprop="description">Personal blog site, to note technique and life related articles</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">67</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hansomesong" title="GitHub → https://github.com/hansomesong" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rennsong</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->



  















  

  

  

</body>
</html>
