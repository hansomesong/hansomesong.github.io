<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rennesong.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Personal blog site, to note technique and life related articles">
<meta property="og:type" content="website">
<meta property="og:title" content="Rennesong&#39;s blog">
<meta property="og:url" content="http://rennesong.com/page/3/index.html">
<meta property="og:site_name" content="Rennesong&#39;s blog">
<meta property="og:description" content="Personal blog site, to note technique and life related articles">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Rennesong&#39;s blog">
<meta name="twitter:description" content="Personal blog site, to note technique and life related articles">

<link rel="canonical" href="http://rennesong.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Rennesong's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Rennesong's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Blog my life from now on!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/07/14/ssh-into-vm-on-remote-server/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/14/ssh-into-vm-on-remote-server/" class="post-title-link" itemprop="url">SSH log into a Vagrant VM on remote server via jump server</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-14 11:32:27" itemprop="dateCreated datePublished" datetime="2019-07-14T11:32:27+08:00">2019-07-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-07-19 06:33:41" itemprop="dateModified" datetime="2019-07-19T06:33:41+08:00">2019-07-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SSH/" itemprop="url" rel="index"><span itemprop="name">SSH</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>In daily work, we heavily rely on Vagrant VM to test and deploy our program. It is really straightfoward to log into a VM on our working PC (<code>vagrant ssh</code>). However, it may also be possible that we need to access into a remote VM located in a remote server. How can we handle this?</p>
<p>In this post, I will give a solution that I got during my work. Basically I have my working PC at home (Mac OSX), a public VPS instance serving as a jumper/proxy server (Ubuntu 16.04), a remote servert (Ubuntu) and a Vagrant VM instance created in my remote server. I want to do a proxyjump from the PC to the target going through the proxy. Authentication from the proxy to the target and from the PC to the proxy use pubkey authentication and each machine has its own key pair.</p>
<p>The network topology of this use case is illustrated in the following figure:</p>
<figure>
<img src="/2019/07/14/ssh-into-vm-on-remote-server/ssh-into-remote-vm.png" alt="Network topology of use case"><span class="image-caption">Network topology of use case</span><figcaption>Network topology of use case</figcaption>
</figure>
<p>In a word, we need to finally connect to the VM via two jump servers: VPS server, remote server.</p>
<p>In this <a href="/ssh-tuto.md">post</a>, we have dealed with how to connect to remote Ubuntu server via VPS instance</p>
<h1 id="preconditions">Preconditions</h1>
<ul>
<li>The working PC is running ssh-agent;</li>
<li>working PC has password-less access to ubuntu server (even via jump server);</li>
<li>ubuntu server has password-less access to Vagrant VM;</li>
<li>Working PC's ssh public key is present in ubuntu server: <code>~/.ssh/authorized_keys</code></li>
<li>Ubuntu server's ssh public key is present in <code>~/.ssh/authorized_keys</code></li>
</ul>
<h1 id="prerequisite-knowledge-netcat-command">Prerequisite knowledge <code>netcat</code> command</h1>
<p>Netcat utility can be used to created TCP tunnel (port forwarding). Here is how to establish a tunnel using netcat to a given host and port. <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netcat -L 127.0.0.1:22 -p 8080 -vvv</span><br></pre></td></tr></table></figure></p>
<p>Listen on port 8080 of the server, and when somebody tries to connect, establish a link with 127.0.0.1:22 (i.e.: SSH server). <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netcat -L google.fr:80 -p 25000 -vvv</span><br></pre></td></tr></table></figure></p>
<p>Listen on port 25000 of the server, and when somebody tries to connect, connect him to Google web server.</p>
<h1 id="proxycommand-directive">ProxyCommand directive</h1>
<p>This part is taken from this <a href="https://backreference.org/2010/02/26/jump-in-with-ssh-and-netcat/" target="_blank" rel="noopener">tutorial</a>. This post also gives a solution based on DNAT on proxy server. It is worth of carefully reading on it.</p>
<p>Essentially, a command is specified that SSH will use as a transport channel to connect to the target host. That is, instead of using TCP as usual, where I/O is performed through a network socket, it will write to and read from respectively the standard input(<code>stdin</code>) and standard output(<code>stdout</code>) of the given command. It follows that such command should eventually convert its <code>stdin</code> and <code>stdout</code> into a true network connection to some host. In other words, a command that acts like <code>cat</code> on one side but that also connects to a network socket and moves data back and forth between the two channels. As you guessed, this command is <code>netcat</code>.</p>
<p>Here's how we can use it in the <code>ProxyCommand</code>: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># ~/.ssh/config</span><br><span class="line">Host internal1</span><br><span class="line">User root</span><br><span class="line">ProxyCommand ssh user@firewall &apos;nc 192.168.0.1 22&apos;</span><br></pre></td></tr></table></figure></p>
<figure>
<img src="/2019/07/14/ssh-into-vm-on-remote-server/proxycommand-netcat-illustration.png" alt="Combination usage of ProxyCommand and netcat"><span class="image-caption">Combination usage of ProxyCommand and netcat</span><figcaption>Combination usage of ProxyCommand and netcat</figcaption>
</figure>
<p>The actual connection between sshd and netcat on the sshd side uses a UNIX socket, or a pipe in recent versions of SSH, not shown above for simplicity; the result is what you see above. And <code>stdin</code> and <code>stdout</code> just mean file descriptor <code>0</code> and <code>1</code> here. The dashed red arrow indicates the logical bidirectional channel that is established. Of course this is not enough as it's just a transport channel; the SSH negotiation should be carried on and eventually completed. By using the above command as <code>ProxyCommand</code>, ssh then uses this new channel (instead of TCP) to carry on the usual protocol negotiation, effectively talking to the SSH daemon on the internal host:</p>
<p>If you are curious and want to verify that ssh is really reading from/writing to the local <code>stdin/stdout</code>, thus effectively using the transport channel created by <code>ProxyCommand</code> (comment: <code>ProxyCommand</code> actually establish a logicl transport channel so that client and server can negociate with each other. That's why without <code>ssh-add</code> command, client will use its local keys to authenticate with server, instead of using keys in proxy server), you can modify the <code>ProxyCommand</code> directive as follows: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># ~/.ssh/config</span><br><span class="line">Host internal1</span><br><span class="line">User root</span><br><span class="line">ProxyCommand tee /tmp/loc2rem | ssh user@firewall &apos;nc 192.168.0.1 22&apos; | tee /tmp/rem2loc</span><br></pre></td></tr></table></figure></p>
<p>The first <code>tee</code> command is to capture the <code>stdin</code> of the <code>ProxyCommand</code> (ie, what goes from client to internal1), the last <code>tee</code> is to capture its <code>stdout</code> (ie, what goes from internal1 to client). Adding those extra commands does not change the semantics of the <code>ProxyCommand</code>, which overall still looks like a command that presents <code>stdin/stdout</code> on the local side, and connects to internal1 on the remote side. However, by adding those tees we are able to save the data in transit in two files, one per direction, imaginatively named loc2rem and rem2loc.</p>
<h1 id="solution">Solution</h1>
<p>Basically, there are three solutions: 1. Copy the private key initially stored in the remote Ubuntu server (using <code>vagrant ssh-config</code> to check the location) to your working host and configure it to be used. 2. <code>ssh -t ubuntu_server ssh vagrant_vm</code>. This method will create a dedicated SSH process in remote Ubuntu server that read private key inside and connect to the vagrant VM 3. <code>ProxyCommand</code> + <code>SSH agent forwardig</code> + <code>ssh-add</code>. The corresponding entry in <code>~/.ssh/config</code>: The concrete command</p>
<pre><code># Entry to connect to remote ubuntu server
Host ubuntu_server
    ...
    ... (configuration allows the connection to remote ubuntu server)
    ...
Host sfc103-vm
    User vagrant
    HostName localhost
    Port 2222
    ProxyCommand ssh -T -q -o &#39;ForwardAgent yes&#39; ubuntu_server &#39;ssh-add -t 10 ~/.ssh/mykey &amp;&amp; nc %h %p&#39;</code></pre>
<ul>
<li><code>ssh -T -q</code> indicates that it should not allocate a pseudo-TTY (-T) and be quiet (-q);</li>
<li>once on the jump server <code>ubuntu_server</code>, we add the key to the SSH keys of working PC through <code>ssh-add</code>;</li>
<li>which only works because we forwarded the SSH agent using <code>-o 'ForwardAgent yes'</code>;</li>
<li><code>ssh-add -t 10</code> indicates that I want the key to be added only for the 10 seconds needed to authenticate to the final VM;</li>
<li>and finally, <code>nc %h %p</code> initiates a netcat connection to the final VM %h at port %p. If the DNS on the <code>ubuntu_server</code> works correctly, you can even save some keystrokes by using the <code>%h</code> and <code>%p</code> variables that ssh makes available in a <code>ProxyCommand</code>. These two variables are replaced by the supplied hostname and port respectively, based on the information in the ~/.ssh/config file. In this example, %h=localhost, %p=2222). The port defaults to 22 if not provided,</li>
</ul>
<p>Actually, <code>SSH agent forwarding</code> as that's bad practice and currently insecure. Same with <code>ssh -t jump ssh server</code> as that runs another ssh process in the jump server and if attackers have access to the machine they can compromise the ssh binary and still gain access.</p>
<h1 id="the-difference-between-ssh-into-ubuntu-server-and-into-vagrant-vm">The difference between SSH into Ubuntu server and into Vagrant VM</h1>
<p>Both SSH connection into remote Ubuntu server and Vagrant VM require jump server. What are the differences? The only difference lies in the location of private key (i.g. <code>IdentityFile</code> directive in config file). To enable SSH connection to my Ubuntu server, I rely on the private key stored in standard location(<code>~/.ssh/id_rsa</code>) and copy the corresponding public key into the latter. In addition, jump server (i.e. VPS) also relies on its own private key, in standard location, to password-less connect with Ubuntu server.</p>
<p>We have to make sure that the SSH connection to Vagrant VM is password-less.</p>
<p>Directive <code>ProxyCommand</code> jsut gives a tunnel to pipe the outer ssh connection through. <code>ProxyCommand</code> will always authenticate from your local host (i.e. using your local private key). When you do ssh vagrant VM from ubuntu server, you're probably using a key on your account on ubuntu server. When you do ssh vagrant VM from your working PC, the fact that you're connecting via that <code>nc</code> command started on ubuntu server is not going to magically give you access to the keys on ubuntu server. We will need to add ubuntu's keys (private to connect to Vagrant VM) to the SSH agent of working PC (i.e. Mac OSX).</p>
<p>For instance:</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/07/13/maven-tuto/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/13/maven-tuto/" class="post-title-link" itemprop="url">maven-tuto</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-13 01:08:17" itemprop="dateCreated datePublished" datetime="2019-07-13T01:08:17+08:00">2019-07-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-07-19 19:05:59" itemprop="dateModified" datetime="2019-07-19T19:05:59+08:00">2019-07-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="maven-入门基本知识">Maven 入门基本知识</h1>
<ul>
<li>Maven是一个采用纯 Java 编写的开 源项目管理工具。所以 Maven 的运行离不开 JDK 支持, 以及相关环境变量的配置。</li>
<li>这个 Maven 的科普讲的非常之好: https://www.cnblogs.com/best/p/9676515.html</li>
<li>Maven采用了一种被称之为project object model (POM)概念来管理项目，所有的项目配置信息都被定义在一个叫做POM.xml的文件中，通过该文件，Maven可以管理项目的整个声明周期，包括编译，构建，测试，发布，报告等等。我们通常使用 maven 对 jar 包进行管理，通过使用maven，我们可以将需要的 jar 包上传到私服，其他项目成员可以下载到本地使用。</li>
<li>maven默认的本地仓库地址为</li>
<li>关于Maven仓库理解和优先级: https://swenfang.github.io/2018/06/03/Maven-Priority/</li>
</ul>
<figure>
<img src="/2019/07/13/maven-tuto/maven-project-structure.png" alt="Structure of a Maven project"><span class="image-caption">Structure of a Maven project</span><figcaption>Structure of a Maven project</figcaption>
</figure>
<p>maven 一些基本命令:</p>
<ul>
<li>mvn -v (或者mvn -version) : 检查所安装的maven版本；</li>
<li>mvn compile : 进入项目根目录下， 编译源代码，生成相关class文件（生成target文件夹）；</li>
<li>mvn test ： 运行测试代码，默认情况是把工程所有的testcase都执行一遍；</li>
<li>mvn package : 打包项目，生成项目jar包（web项目生成war包）目录（在target文件夹下）；</li>
<li>mvn clean：清理项目，删除target目录；</li>
<li>mvn install：安装jar包到本地仓库；</li>
<li>mvn archetype ： 创建Maven java项目；</li>
<li>mvn deploy : 将包拷贝到远程的repository，以共享</li>
</ul>
<p>关于 Maven 非常好的tuto, 有时间需要仔细研究： https://my.oschina.net/mzdbxqh/blog/849040</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/07/13/yang-model-tuto/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/13/yang-model-tuto/" class="post-title-link" itemprop="url">深入浅出理解 YANG 模型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-07-13 00:28:41 / 修改时间：07:03:47" itemprop="dateCreated datePublished" datetime="2019-07-13T00:28:41+08:00">2019-07-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>声明：本文主要内容借鉴以下文章: <a href="https://napalm-automation.net/yang-for-dummies/" target="_blank" rel="noopener">YANG FOR DUMMIES, By David Barroso, 08-14-2017</a> <a href="https://www.jianshu.com/p/ca7f5fe11fae" target="_blank" rel="noopener">对YANG的解读(一), By ljyfree, 02-11-2018</a></p>
<h1 id="yang-的诞生">YANG 的诞生</h1>
<p>YANG 是出于配合IETF定义的NETCONF协议的工作而诞生的。NETCONF 是一种允许网络管理员通过网络来远程管理配置网络设备的控制协议。不可避免地，NETCONF 需要对网络设备的配置数据(configuration)和运行状态(state)做操作，例如编辑配置，获取状态。因此需要一种数据建模语言(data model language)来对configuration, operational state, 甚至操作(operations)进行建模。建好的YANG data模型，最后以XML的形式进行实例化, 通过NETCONF协议在网络设备和控制器之间就行传递。打个比方，我需要向领导请假，领导说你写个请假单，包含请假人的姓名，请假的起止时间，请假事由和代理人。于是我做了一个表格，包含了上述要求，并根据实际情况填入了真实信息。那么领导的描述，就可以理解为“建模”，而我最后提交的填好内容的表格，就是将模型实例化了。</p>
<h1 id="yang-的主要概念">Yang 的主要概念</h1>
<p>这部分我们主要解释下常见的YANG相关的概念，我们不追求面面俱到，但求通过以下介绍，能让读者能读懂大部分YANG文件</p>
<h2 id="modulesubmodule">module/submodule</h2>
<p>module的header主要是一些描述信息，而body就是data model定义的地方。module可以分为submodule。模块化的好处就是方便引用。</p>
<h2 id="四种基本建模数据结构">四种基本建模数据结构</h2>
<h3 id="leaf-node">leaf node/</h3>
<p>一个leaf node包含且只包含一个value，可以是数字或是字符串，具体是什么，看关键字"type"后面跟什么。leaf node下面不能挂子节点。例如： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">    leaf host-name &#123;</span><br><span class="line">        type string;</span><br><span class="line">        description &quot;Hostname for this system&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example:</span><br><span class="line">    &lt;host-name&gt;my.example.com&lt;/host-name&gt;</span><br></pre></td></tr></table></figure></p>
<p>此处用YANG定义了一个名为host-name的leaf，它包含对自己的description，有一个string类型的值。那么当用XML实例化这个leaf的时候，就需要对host-name进行具体的赋值。换句话说，YANG是挖坑的，XML是填坑的，但是XML填坑用的材料的“形状”，要和YANG定义的一样。</p>
<h3 id="leaf-list-node">leaf-list node</h3>
<p>与上面的Leaf Nodes“一字之差”，多了一个“-list”。可以认为Leaf-List Nodes表示的是一个“数组”，“数组”中的元素的值的type必须保持一致，而且不能重复。例如： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">    leaf-list domain-search &#123;</span><br><span class="line">        type string;</span><br><span class="line">        description &quot;List of domain names to search&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example:</span><br><span class="line">    &lt;domain-search&gt;high.example.com&lt;/domain-search&gt;</span><br><span class="line">    &lt;domain-search&gt;low.example.com&lt;/domain-search&gt;</span><br><span class="line">    &lt;domain-search&gt;everywhere.example.com&lt;/domain-search&gt;</span><br></pre></td></tr></table></figure></p>
<p>和leaf node一样，它也只定义一个value，但是可以有一系列同类型的值。例子中<domain-serarch>的值有多个，但是定义和类型都是统一的。</domain-serarch></p>
<h3 id="container-node">container node</h3>
<p>“Container”可以翻译成“集装箱”。真正有价值的，是集装箱里面装的货物，而不是集装箱本身。但是如果没有集装箱，那么里面的货物就散了。Container的作用就是将数据层次化组织起来，呈现出subtree的样式。特别需要注意的是： * 一个空的集装箱也是能“卖钱”的，因为毕竟是铁皮做的，但是一个container自身是没有“value”的； * 一个集装箱容量是有限的，但是一个container可以装多少node并没有限制，而且这些node可以在leaf/list/leaf-list甚至是container(想起了俄罗斯套娃)中任意选取。</p>
<p>来看一个例子： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">    container system &#123;</span><br><span class="line">        container login &#123;</span><br><span class="line">            leaf message &#123;</span><br><span class="line">                type string;</span><br><span class="line">                description</span><br><span class="line">                    &quot;Message given at start of login session&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example:</span><br><span class="line">    &lt;system&gt;</span><br><span class="line">        &lt;login&gt;</span><br><span class="line">            &lt;message&gt;Good morning&lt;/message&gt;</span><br><span class="line">        &lt;/login&gt;</span><br><span class="line">    &lt;/system&gt;</span><br></pre></td></tr></table></figure></p>
<p>container system里面装了一个container login，然后login里面有一个leaf node，就是类型为string的<code>message</code>。</p>
<h3 id="list-nodes">list nodes</h3>
<p>一个List node可以包含多个child node，而且这些node可以在leaf/leaf-list/container中任意选取。List必须指明这些child中的一个node为key。例如: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">list user &#123;</span><br><span class="line">    key &quot;name&quot;;</span><br><span class="line">    leaf name &#123;</span><br><span class="line">        type string;</span><br><span class="line">    &#125;</span><br><span class="line">    leaf full-name &#123;</span><br><span class="line">        type string;</span><br><span class="line">    &#125;</span><br><span class="line">    leaf class &#123;</span><br><span class="line">        type string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example:</span><br><span class="line">     &lt;user&gt;</span><br><span class="line">        &lt;name&gt;glocks&lt;/name&gt;</span><br><span class="line">        &lt;full-name&gt;Goldie Locks&lt;/full-name&gt;</span><br><span class="line">        &lt;class&gt;intruder&lt;/class&gt;</span><br><span class="line">     &lt;/user&gt;</span><br><span class="line">     &lt;user&gt;</span><br><span class="line">        &lt;name&gt;snowey&lt;/name&gt;</span><br><span class="line">        &lt;full-name&gt;Snow White&lt;/full-name&gt;</span><br><span class="line">        &lt;class&gt;free-loader&lt;/class&gt;</span><br><span class="line">     &lt;/user&gt;</span><br><span class="line">     &lt;user&gt;</span><br><span class="line">        &lt;name&gt;rzell&lt;/name&gt;</span><br><span class="line">        &lt;full-name&gt;Rapun Zell&lt;/full-name&gt;</span><br><span class="line">        &lt;class&gt;tower&lt;/class&gt;</span><br><span class="line">     &lt;/user&gt;</span><br></pre></td></tr></table></figure></p>
<p>定义了一个名为“user”的list，这个list中包含三个leaf：name/full-name/class。其中name被指定为key。实例化的时候，key的值(也就是"name"的值)是必须不同的，其它的值(full-name/class)没有这个要求。随后xml实例化了三个user，都包含YANG定义的name/full-name/class，而且name都是不同的。</p>
<p>在实际工作中，我们见到的YANG文件，基本上都是以上四中基本数据结构的各种组合。</p>
<h2 id="resuable-node-groups-grouping">Resuable node groups (grouping)</h2>
<p>grouping其实不是一种数据类型，它存在的意义只是方便在“编程”的时候被引用。所以它本身是没有value的。grouping可以在本module被引用，或是被其它module引用。例如： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">     grouping target &#123;</span><br><span class="line">         leaf address &#123;</span><br><span class="line">             type inet:ip-address;</span><br><span class="line">             description &quot;Target IP address&quot;;</span><br><span class="line">         &#125;</span><br><span class="line">         leaf port &#123;</span><br><span class="line">             type inet:port-number;</span><br><span class="line">             description &quot;Target port number&quot;;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     container peer &#123;</span><br><span class="line">         container destination &#123;</span><br><span class="line">             uses target;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">-----------------------</span><br><span class="line">   NETCONF XML Example:</span><br><span class="line"></span><br><span class="line">     &lt;peer&gt;</span><br><span class="line">       &lt;destination&gt;</span><br><span class="line">         &lt;address&gt;192.0.2.1&lt;/address&gt;</span><br><span class="line">         &lt;port&gt;830&lt;/port&gt;</span><br><span class="line">       &lt;/destination&gt;</span><br><span class="line">     &lt;/peer&gt;</span><br></pre></td></tr></table></figure></p>
<p>回想一下，当一台主机对外提供服务的时候，客户端需要知道提供服务主机的的IP和端口信息。所以这边可以定义一个grouping target，在里面定义leaf address和leaf port。下面的container peer来uses(调用grouping的关键字)这个grouping。当对<peer>实例化的时候，就需要将grouping target中包含的address和port都进行赋值。这里的830端口，是在RFC6242(Using the NETCONF Protocol over Secure Shell)中定义的基于ssh的netconf服务端口。 这里的users可以理解为copy，即把grouping的整个内容都复制到了这个schema tree。grouping本身是没有绑定到任何namespace的，直到某个module uses了这个grouping，那么这个grouping就被绑定到这个module了。 grouping还有一个非常好用的特性就是refine，例如要建立连接，既需要server的IP+port，也需要client的IP+port。因为这两个的数据结构是完全一样的，所以可以复用，并用更准确的description来覆盖grouping定义时候设置的description。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">YANG Example:</span><br><span class="line"></span><br><span class="line">     container connection &#123;</span><br><span class="line">      container source &#123;</span><br><span class="line">          uses target &#123;</span><br><span class="line">              refine &quot;address&quot; &#123;</span><br><span class="line">                  description &quot;Source IP address&quot;;</span><br><span class="line">              &#125;</span><br><span class="line">              refine &quot;port&quot; &#123;</span><br><span class="line">                  description &quot;Source port number&quot;;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      container destination &#123;</span><br><span class="line">          uses target &#123;</span><br><span class="line">              refine &quot;address&quot; &#123;</span><br><span class="line">                  description &quot;Destination IP address&quot;;</span><br><span class="line">              &#125;</span><br><span class="line">              refine &quot;port&quot; &#123;</span><br><span class="line">                  description &quot;Destination port number&quot;;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></peer></p>
<h2 id="choices">Choices</h2>
<p>"choice"+"case"用来描述互斥的内容。一个choice可以包含多个case，每个case可以包含多个node。一般来说在一个choice里，一个case下面的node不应该和其他case下面的node重复。 在YANG模型和schema中可以看到choice下的所有case，而当对它实例化之后，只会出现一个case下面的nodes了。例如: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">     container food &#123;</span><br><span class="line">       choice snack &#123;</span><br><span class="line">           case sports-arena &#123;</span><br><span class="line">               leaf pretzel &#123;</span><br><span class="line">                   type empty;</span><br><span class="line">               &#125;</span><br><span class="line">               leaf beer &#123;</span><br><span class="line">                   type empty;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           case late-night &#123;</span><br><span class="line">               leaf chocolate &#123;</span><br><span class="line">                   type enumeration &#123;</span><br><span class="line">                       enum dark;</span><br><span class="line">                       enum milk;</span><br><span class="line">                       enum first-available;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example:</span><br><span class="line">    &lt;food&gt;</span><br><span class="line">        &lt;pretzel/&gt;</span><br><span class="line">        &lt;beer/&gt;</span><br><span class="line">    &lt;/food&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="configuration-以及-state-data-的区分">Configuration 以及 State Data 的区分</h2>
<p>NETCONF 需要区分 configuration data 和 operational state data 的, 在YANG建模的时候，对于state data需要加上 "config false". 例如： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">list interface &#123;</span><br><span class="line">    key &quot;name&quot;;</span><br><span class="line"></span><br><span class="line">    leaf name &#123;</span><br><span class="line">        type string;</span><br><span class="line">    &#125;</span><br><span class="line">    leaf speed &#123;</span><br><span class="line">        type enumeration &#123;</span><br><span class="line">            enum 10m;</span><br><span class="line">            enum 100m;</span><br><span class="line">            enum auto;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    leaf observed-speed &#123;</span><br><span class="line">        type uint32;</span><br><span class="line">        config false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在list interface中。speed的value type是枚举类型，就是说实例化的时候只能从这里列出的三种中选择一个。对于leaf observed-speed,因为包含"config false"，因此这个leaf记录的是state value，不可以配置。对应于netconf的操作，leaf speed可以<get-config>，而leaf observed-speed只能<get>。</get></get-config></p>
<h2 id="extending-data-models-augment">Extending Data Models (augment)</h2>
<p>YANG允许向data module插入新的节点。这是一个非常有用的特性，例如厂商想在公共yang上插入自己的特殊参数，那么augment就可以实现这个需求。"when"后面跟的是条件，即为满足这个条件，就插入新的node。例如 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">     augment /system/login/user &#123;</span><br><span class="line">         when &quot;class != &apos;wheel&apos;&quot;;</span><br><span class="line">         leaf uid &#123;</span><br><span class="line">             type uint16 &#123;</span><br><span class="line">                 range &quot;1000 .. 30000&quot;;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example 1:</span><br><span class="line">     &lt;user&gt;</span><br><span class="line">       &lt;name&gt;alicew&lt;/name&gt;</span><br><span class="line">       &lt;full-name&gt;Alice N. Wonderland&lt;/full-name&gt;</span><br><span class="line">       &lt;class&gt;drop-out&lt;/class&gt;</span><br><span class="line">       &lt;other:uid&gt;1024&lt;/other:uid&gt;</span><br><span class="line">     &lt;/user&gt;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example 2:</span><br><span class="line">     &lt;user&gt;</span><br><span class="line">       &lt;name&gt;jerryr&lt;/name&gt;</span><br><span class="line">       &lt;full-name&gt;Jerry K. Roma&lt;/full-name&gt;</span><br><span class="line">       &lt;class&gt;wheel&lt;/class&gt;</span><br><span class="line">     &lt;/user&gt;</span><br></pre></td></tr></table></figure></p>
<p>Example 1 中因为class不是"wheel"，因此插入uid; Example 2中class是"wheel"，所以不插入uid。</p>
<h2 id="rpc-definitions">RPC Definitions</h2>
<p>YANG可以用来定义netconf的rpc，包括rpc输入的参数，输出的参数，例如： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">     rpc activate-software-image &#123;</span><br><span class="line">         input &#123;</span><br><span class="line">             leaf image-name &#123;</span><br><span class="line">                 type string;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         output &#123;</span><br><span class="line">             leaf status &#123;</span><br><span class="line">                 type string;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example:</span><br><span class="line">     &lt;rpc message-id=&quot;101&quot;</span><br><span class="line">          xmlns=&quot;urn:ietf:params:xml:ns:netconf:base:1.0&quot;&gt;</span><br><span class="line">       &lt;activate-software-image xmlns=&quot;http://acme.example.com/system&quot;&gt;</span><br><span class="line">         &lt;image-name&gt;acmefw-2.3&lt;/image-name&gt;</span><br><span class="line">      &lt;/activate-software-image&gt;</span><br><span class="line">     &lt;/rpc&gt;</span><br><span class="line"></span><br><span class="line">     &lt;rpc-reply message-id=&quot;101&quot;</span><br><span class="line">                xmlns=&quot;urn:ietf:params:xml:ns:netconf:base:1.0&quot;&gt;</span><br><span class="line">       &lt;status xmlns=&quot;http://acme.example.com/system&quot;&gt;</span><br><span class="line">         The image acmefw-2.3 is being installed.</span><br><span class="line">       &lt;/status&gt;</span><br><span class="line">     &lt;/rpc-reply&gt;</span><br></pre></td></tr></table></figure></p>
<p>定义一种叫做"activate-software-image"的rpc。当Client发送rpc的时候，需要加上image-name，交换机发回rpc-reply的时候，需要加上activate的结果，本例中可以看到操作是成功了。</p>
<h2 id="notification-definitions">Notification Definitions</h2>
<p>Notification是一种通告机制，当交换机上出现特性event(事件)，交换机会主动发给已经建立netconf连接并订阅了Notification的client。YANG可以定义notification，例如` <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># YANG Example:</span><br><span class="line">    notification link-failure &#123;</span><br><span class="line">        description &quot;A link failure has been detected&quot;;</span><br><span class="line">        leaf if-name &#123;</span><br><span class="line">            type leafref &#123;</span><br><span class="line">             path &quot;/interface/name&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        leaf if-admin-status &#123;</span><br><span class="line">            type admin-status;</span><br><span class="line">        &#125;</span><br><span class="line">        leaf if-oper-status &#123;</span><br><span class="line">            type oper-status;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">-----------------------</span><br><span class="line"># NETCONF XML Example:</span><br><span class="line">     &lt;notification</span><br><span class="line">         xmlns=&quot;urn:ietf:params:netconf:capability:notification:1.0&quot;&gt;</span><br><span class="line">       &lt;eventTime&gt;2007-09-01T10:00:00Z&lt;/eventTime&gt;</span><br><span class="line">       &lt;link-failure xmlns=&quot;http://acme.example.com/system&quot;&gt;</span><br><span class="line">         &lt;if-name&gt;so-1/2/3.0&lt;/if-name&gt;</span><br><span class="line">         &lt;if-admin-status&gt;up&lt;/if-admin-status&gt;</span><br><span class="line">         &lt;if-oper-status&gt;down&lt;/if-oper-status&gt;</span><br><span class="line">       &lt;/link-failure&gt;</span><br><span class="line">     &lt;/notification&gt;</span><br></pre></td></tr></table></figure></p>
<p>这样无论是接口的admin状态(shutdown或是no shutdonw)，还是链路状态(down/up)发送改变的时候，都可以发送notification给client，并且带上了当前的状态信息。</p>
<h1 id="要点总结">要点总结</h1>
<p>节点带有"config false"标签时，他的子结构就打上了state data的标签，不可配置，能通过netconf操作获取</p>
<ul>
<li>typedef :定义衍生类型</li>
<li>grouping :可重用节点组. 一种可重用的schema nodes的集合。该集合可能在定义处的module中被使用，也可能在包含它的modules中使用，还可能在导入它的modules中被使用。grouping不会生成任何节点，可以看成一种临时树干。</li>
<li>refine :重定义, 重写特定的声明覆盖原有grouping的定义</li>
<li>choice case :申明分离不相容的节点，类似于java中的switch case</li>
<li>argument :“augment”声明定义了在数据模型树形结构中，新的节点插入的位置。“when”声明了新节点生效的条件。　　</li>
<li>rpc (Remote Procedure Call) :yang文件可以定义声明RPC的输入输出参数</li>
<li>notification :yang可以用来为netconf的notification做内容建模</li>
<li>ordered-by user :It only requires the order to be maintained if <code>ordered-by user</code> is configured in the YANG module. It will maintain YANG schema order so the objects will be returned in the correct order according to the YANG module.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/07/08/odl-l2switch-adaption/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/08/odl-l2switch-adaption/" class="post-title-link" itemprop="url">odl-l2switch-adaption</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-08 23:46:13" itemprop="dateCreated datePublished" datetime="2019-07-08T23:46:13+08:00">2019-07-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-07-12 04:26:37" itemprop="dateModified" datetime="2019-07-12T04:26:37+08:00">2019-07-12</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><code>l2switch</code> is currently not being maintained by anyone and thus did not participate in the Fluorine release cycle. It needs version bumps and code changes to conform with upstream changes in <code>yangtools</code>, <code>mdsal</code>, etc. For the compile errors above, <code>getAugmentation</code> is now <code>augmentation</code> and <code>setKey</code> is now <code>withKey</code>.</p>
<p>These upstream changes were made in Fluorine along with others. This was all documented on the ODL mailing lists and TSC JIRA items during the Fluorine release cycle. Any contributions to reboot the project and get it building again and maintain it going forward would be welcomed by the ODL community.</p>
<p>可以参考的改进</p>
<h1 id="常见的类以及所属包以及路径">常见的类以及所属包以及路径</h1>
<p>RpcResult org.opendaylight.yangtools openflow.action org.opendaylight.openflowplugin openflow.inventory =&gt; org.opendaylight.msdal org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.IpAddress =&gt; org.opendaylight.msdal openflow.inventory.rev130819.node.NodeConnector =&gt; org.opendaylight.controller.msdal opendaylight.packet.service =&gt; org.opendaylight.openflowplugin opendaylight.arp.packet.* =&gt; org.opendaylight.l2switch</p>
<h1 id="查看-odl-javadoc">查看 ODL Javadoc</h1>
<p>https://nexus.opendaylight.org/content/repositories/public/org/opendaylight/l2switch/packethandler/packethandler-model/0.7.4/ 比如bundle <code>packethandler-model</code> 的 javadoc 就可以通过这里查看</p>
<p>https://javadocs.opendaylight.org/org.opendaylight.mdsal/fluorine/ 这里也可以查，比如<code>MD-SAL</code>所有的API都在这里</p>
<h1 id="org.opendaylight.yang.gen.v1.urn.opendaylight.inventory.rev130819.node.nodeconnector">org.opendaylight.yang.gen.v1.urn.opendaylight.inventory.rev130819.node.NodeConnector</h1>
<p>getKey()变成了key() setKey()变成了withKey() getAugmentation 变成了 augmentation()</p>
<h1 id="bundle-arphandler-impl-编译失败">Bundle <code>arphandler-impl</code> 编译失败</h1>
<h2 id="错误信息">错误信息</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.7.0:compile (default-compile) on project addresstracker-impl: Compilation failure: Compilation failure:</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/addresstracker/implementation/src/main/java/org/opendaylight/l2switch/addresstracker/addressobserver/AddressObserverUsingArp.java:[60,17] no suitable constructor found for IpAddress(char[])</span><br><span class="line">[ERROR]     constructor org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.IpAddress.IpAddress(org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.Ipv4Address) is not applicable</span><br><span class="line">[ERROR]       (argument mismatch; char[] cannot be converted to org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.Ipv4Address)</span><br><span class="line">[ERROR]     constructor org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.IpAddress.IpAddress(org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.Ipv6Address) is not applicable</span><br><span class="line">[ERROR]       (argument mismatch; char[] cannot be converted to org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.Ipv6Address)</span><br><span class="line">[ERROR]     constructor org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.IpAddress.IpAddress(org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.IpAddress) is not applicable</span><br><span class="line">[ERROR]       (argument mismatch; char[] cannot be converted to org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.IpAddress)</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/addresstracker/implementation/src/main/java/org/opendaylight/l2switch/addresstracker/addressobserver/AddressObservationWriter.java:[127,21] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getAugmentation(java.lang.Class&lt;org.opendaylight.yang.gen.v1.urn.opendaylight.address.tracker.rev140617.AddressCapableNodeConnector&gt;)</span><br><span class="line">[ERROR]   location: variable nc of type org.opendaylight.yang.gen.v1.urn.opendaylight.inventory.rev130819.node.NodeConnector</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/addresstracker/implementation/src/main/java/org/opendaylight/l2switch/addresstracker/addressobserver/AddressObservationWriter.java:[138,61] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getKey()</span><br><span class="line">[ERROR]   location: interface org.opendaylight.yang.gen.v1.urn.opendaylight.address.tracker.rev140617.address.node.connector.Addresses</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/addresstracker/implementation/src/main/java/org/opendaylight/l2switch/addresstracker/addressobserver/AddressObservationWriter.java:[152,31] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getKey()</span><br><span class="line">[ERROR]   location: variable addressBuilder of type org.opendaylight.yang.gen.v1.urn.opendaylight.address.tracker.rev140617.address.node.connector.AddressesBuilder</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/addresstracker/implementation/src/main/java/org/opendaylight/l2switch/addresstracker/addressobserver/AddressObservationWriter.java:[153,31] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method setKey(org.opendaylight.yang.gen.v1.urn.opendaylight.address.tracker.rev140617.address.node.connector.AddressesKey)</span><br><span class="line">[ERROR]   location: variable addressBuilder of type org.opendaylight.yang.gen.v1.urn.opendaylight.address.tracker.rev140617.address.node.connector.AddressesBuilder</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/addresstracker/implementation/src/main/java/org/opendaylight/l2switch/addresstracker/addressobserver/AddressObserverUsingIpv4.java:[62,21] no suitable constructor found for IpAddress(char[])</span><br><span class="line">[ERROR]     constructor org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.IpAddress.IpAddress(org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.Ipv4Address) is not applicable</span><br><span class="line">[ERROR]       (argument mismatch; char[] cannot be converted to org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.Ipv4Address)</span><br><span class="line">[ERROR]     constructor org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.IpAddress.IpAddress(org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.Ipv6Address) is not applicable</span><br><span class="line">[ERROR]       (argument mismatch; char[] cannot be converted to org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.Ipv6Address)</span><br><span class="line">[ERROR]     constructor org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.IpAddress.IpAddress(org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.IpAddress) is not applicable</span><br><span class="line">[ERROR]       (argument mismatch; char[] cannot be converted to org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.IpAddress)</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/addresstracker/implementation/src/main/java/org/opendaylight/l2switch/addresstracker/addressobserver/AddressObserverUsingIpv6.java:[62,21] no suitable constructor found for IpAddress(char[])</span><br><span class="line">[ERROR]     constructor org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.IpAddress.IpAddress(org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.Ipv4Address) is not applicable</span><br><span class="line">[ERROR]       (argument mismatch; char[] cannot be converted to org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.Ipv4Address)</span><br><span class="line">[ERROR]     constructor org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.IpAddress.IpAddress(org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.Ipv6Address) is not applicable</span><br><span class="line">[ERROR]       (argument mismatch; char[] cannot be converted to org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.Ipv6Address)</span><br><span class="line">[ERROR]     constructor org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.IpAddress.IpAddress(org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.IpAddress) is not applicable</span><br><span class="line">[ERROR]       (argument mismatch; char[] cannot be converted to org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.inet.types.rev130715.IpAddress)</span><br><span class="line">[ERROR] -&gt; [Help 1]</span><br></pre></td></tr></table></figure>
<h2 id="原因-在fluorine中-org.opendaylight.msdal-中定义的-ipaddress-删去了构造体-ipaddresschar-ipaddress方法org.opendaylight.msdal-中引入了-ipaddressbuilder-该方法支持从-string直接构造ipaddress对象">原因: 在fluorine中, org.opendaylight.msdal 中定义的 IpAddress 删去了构造体 IpAddress(Char<a href="#section-1"></a> ipAddress)方法。org.opendaylight.msdal 中引入了 IpAddressBuilder 该方法支持从 String直接构造IpAddress对象</h2>
<p>http://www.gzhshoulu.wang/article/1549928 源码解读ODL的MAC地址学习(二)</p>
<p>修改完上述错误之后，还有下面的问题要解决: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.7.0:compile (default-compile) on project addresstracker-impl: Compilation failure: Compilation failure:</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/addresstracker/implementation/src/main/java/org/opendaylight/l2switch/addresstracker/addressobserver/AddressObservationWriter.java:[138,61] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getKey()</span><br><span class="line">[ERROR]   location: interface org.opendaylight.yang.gen.v1.urn.opendaylight.address.tracker.rev140617.address.node.connector.Addresses</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/addresstracker/implementation/src/main/java/org/opendaylight/l2switch/addresstracker/addressobserver/AddressObservationWriter.java:[152,31] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getKey()</span><br><span class="line">[ERROR]   location: variable addressBuilder of type org.opendaylight.yang.gen.v1.urn.opendaylight.address.tracker.rev140617.address.node.connector.AddressesBuilder</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/addresstracker/implementation/src/main/java/org/opendaylight/l2switch/addresstracker/addressobserver/AddressObservationWriter.java:[153,31] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method setKey(org.opendaylight.yang.gen.v1.urn.opendaylight.address.tracker.rev140617.address.node.connector.AddressesKey)</span><br><span class="line">[ERROR]   location: variable addressBuilder of type org.opendaylight.yang.gen.v1.urn.opendaylight.address.tracker.rev140617.address.node.connector.AddressesBuilder</span><br></pre></td></tr></table></figure></p>
<p>IntelliJ IDEA 真的是个神器。居然可以查看<code>.class</code>后缀的文件。通过查看<code>addresstracker</code>之下编译生成的<code>target/classes</code>中<code>Address.class</code>以及<code>AddressBuilder.class</code>文件 , 确认Fluorine之前版本之中的<code>getKey()</code>以及<code>setKey()</code>方法相应地被<code>key()</code>和<code>withKey()</code>替换了。</p>
<h1 id="编译-bundle-hosttracker-报错">编译 Bundle <code>hosttracker</code> 报错</h1>
<h2 id="报错信息">报错信息</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.7.0:compile (default-compile) on project hosttracker-impl: Compilation failure: Compilation failure:</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/hosttracker/implementation/src/main/java/org/opendaylight/l2switch/hosttracker/plugin/inventory/Host.java:[47,33] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getAugmentation(java.lang.Class&lt;org.opendaylight.yang.gen.v1.urn.opendaylight.host.tracker.rev140624.HostNode&gt;)</span><br><span class="line">[ERROR]   location: variable node of type org.opendaylight.yang.gen.v1.urn.tbd.params.xml.ns.yang.network.topology.rev131021.network.topology.topology.Node</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/hosttracker/implementation/src/main/java/org/opendaylight/l2switch/hosttracker/plugin/inventory/Host.java:[108,13] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method setKey(org.opendaylight.yang.gen.v1.urn.tbd.params.xml.ns.yang.network.topology.rev131021.network.topology.topology.NodeKey)</span><br><span class="line">[ERROR]   location: variable node of type org.opendaylight.yang.gen.v1.urn.tbd.params.xml.ns.yang.network.topology.rev131021.network.topology.topology.NodeBuilder</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/hosttracker/implementation/src/main/java/org/opendaylight/l2switch/hosttracker/plugin/inventory/Host.java:[229,41] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getKey()</span><br><span class="line">[ERROR]   location: variable apb of type org.opendaylight.yang.gen.v1.urn.opendaylight.host.tracker.rev140624.host.AttachmentPointsBuilder</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/hosttracker/implementation/src/main/java/org/opendaylight/l2switch/hosttracker/plugin/inventory/Host.java:[229,21] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getKey()</span><br><span class="line">[ERROR]   location: variable apbi of type org.opendaylight.yang.gen.v1.urn.opendaylight.host.tracker.rev140624.host.AttachmentPointsBuilder</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/hosttracker/implementation/src/main/java/org/opendaylight/l2switch/hosttracker/plugin/internal/ConcurrentClusterAwareHostHashMap.java:[132,86] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getKey()</span><br><span class="line">[ERROR]   location: variable hostNode of type org.opendaylight.yang.gen.v1.urn.tbd.params.xml.ns.yang.network.topology.rev131021.network.topology.topology.Node</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/hosttracker/implementation/src/main/java/org/opendaylight/l2switch/hosttracker/plugin/internal/ConcurrentClusterAwareHostHashMap.java:[150,90] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getKey()</span><br><span class="line">[ERROR]   location: variable hostNode of type org.opendaylight.yang.gen.v1.urn.tbd.params.xml.ns.yang.network.topology.rev131021.network.topology.topology.Node</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/hosttracker/implementation/src/main/java/org/opendaylight/l2switch/hosttracker/plugin/internal/ConcurrentClusterAwareHostHashMap.java:[170,86] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getKey()</span><br><span class="line">[ERROR]   location: variable hostNode of type org.opendaylight.yang.gen.v1.urn.tbd.params.xml.ns.yang.network.topology.rev131021.network.topology.topology.Node</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/hosttracker/implementation/src/main/java/org/opendaylight/l2switch/hosttracker/plugin/internal/ConcurrentClusterAwareHostHashMap.java:[189,83] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getKey()</span><br><span class="line">[ERROR]   location: variable hostNode of type org.opendaylight.yang.gen.v1.urn.tbd.params.xml.ns.yang.network.topology.rev131021.network.topology.topology.Node</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/hosttracker/implementation/src/main/java/org/opendaylight/l2switch/hosttracker/plugin/internal/HostTrackerImpl.java:[200,37] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getAugmentation(java.lang.Class&lt;org.opendaylight.yang.gen.v1.urn.opendaylight.host.tracker.rev140624.HostNode&gt;)</span><br><span class="line">[ERROR]   location: variable node of type org.opendaylight.yang.gen.v1.urn.tbd.params.xml.ns.yang.network.topology.rev131021.network.topology.topology.Node</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/hosttracker/implementation/src/main/java/org/opendaylight/l2switch/hosttracker/plugin/internal/HostTrackerImpl.java:[286,43] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getKey()</span><br><span class="line">[ERROR]   location: variable nodeConnector of type org.opendaylight.yang.gen.v1.urn.opendaylight.inventory.rev130819.node.NodeConnector</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/hosttracker/implementation/src/main/java/org/opendaylight/l2switch/hosttracker/plugin/internal/HostTrackerImpl.java:[356,79] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getKey()</span><br><span class="line">[ERROR]   location: variable l of type org.opendaylight.yang.gen.v1.urn.tbd.params.xml.ns.yang.network.topology.rev131021.network.topology.topology.Link</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/hosttracker/implementation/src/main/java/org/opendaylight/l2switch/hosttracker/plugin/internal/HostTrackerImpl.java:[363,79] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getKey()</span><br><span class="line">[ERROR]   location: variable l of type org.opendaylight.yang.gen.v1.urn.tbd.params.xml.ns.yang.network.topology.rev131021.network.topology.topology.Link</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/hosttracker/implementation/src/main/java/org/opendaylight/l2switch/hosttracker/plugin/internal/HostTrackerImpl.java:[383,48] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getAugmentation(java.lang.Class&lt;org.opendaylight.yang.gen.v1.urn.opendaylight.host.tracker.rev140624.HostNode&gt;)</span><br><span class="line">[ERROR]   location: interface org.opendaylight.yang.gen.v1.urn.tbd.params.xml.ns.yang.network.topology.rev131021.network.topology.topology.Node</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/hosttracker/implementation/src/main/java/org/opendaylight/l2switch/hosttracker/plugin/internal/SimpleAddressObserver.java:[190,14] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method setKey(org.opendaylight.yang.gen.v1.urn.opendaylight.address.tracker.rev140617.address.node.connector.AddressesKey)</span><br><span class="line">[ERROR]   location: variable addrs of type org.opendaylight.yang.gen.v1.urn.opendaylight.address.tracker.rev140617.address.node.connector.AddressesBuilder</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/hosttracker/implementation/src/main/java/org/opendaylight/l2switch/hosttracker/plugin/util/Utilities.java:[44,15] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method setKey(org.opendaylight.yang.gen.v1.urn.tbd.params.xml.ns.yang.network.topology.rev131021.network.topology.topology.LinkKey)</span><br><span class="line">[ERROR]   location: variable srcdst of type org.opendaylight.yang.gen.v1.urn.tbd.params.xml.ns.yang.network.topology.rev131021.network.topology.topology.LinkBuilder</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/hosttracker/implementation/src/main/java/org/opendaylight/l2switch/hosttracker/plugin/util/Utilities.java:[52,15] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method setKey(org.opendaylight.yang.gen.v1.urn.tbd.params.xml.ns.yang.network.topology.rev131021.network.topology.topology.LinkKey)</span><br><span class="line">[ERROR]   location: variable dstsrc of type org.opendaylight.yang.gen.v1.urn.tbd.params.xml.ns.yang.network.topology.rev131021.network.topology.topology.LinkBuilder</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/hosttracker/implementation/src/main/java/org/opendaylight/l2switch/hosttracker/plugin/util/Utilities.java:[80,17] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method setKey(org.opendaylight.yang.gen.v1.urn.opendaylight.host.tracker.rev140624.host.AttachmentPointsKey)</span><br><span class="line">[ERROR]   location: class org.opendaylight.yang.gen.v1.urn.opendaylight.host.tracker.rev140624.host.AttachmentPointsBuilder</span><br></pre></td></tr></table></figure>
<p><code>org.opendaylight.yang.gen.v1.urn.tbd.params.xml.ns.yang.network.topology.rev131021.network.topology.topology</code> 属于 <code>org.opendaylight.mdsal</code>.</p>
<h1 id="l2switch-main-编译错误">l2switch-main 编译错误</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.7.0:compile (default-compile) on project main-impl: Compilation failure: Compilation failure:</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/l2switch-main/src/main/java/org/opendaylight/l2switch/inventory/InventoryReader.java:[73,69] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getAugmentation(java.lang.Class&lt;org.opendaylight.yang.gen.v1.urn.opendaylight.l2switch.loopremover.rev140714.StpStatusAwareNodeConnector&gt;)</span><br><span class="line">[ERROR]   location: variable nc of type org.opendaylight.yang.gen.v1.urn.opendaylight.inventory.rev130819.node.NodeConnector</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/l2switch-main/src/main/java/org/opendaylight/l2switch/inventory/InventoryReader.java:[77,88] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getKey()</span><br><span class="line">[ERROR]   location: variable nc of type org.opendaylight.yang.gen.v1.urn.opendaylight.inventory.rev130819.node.NodeConnector</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/l2switch-main/src/main/java/org/opendaylight/l2switch/inventory/InventoryReader.java:[78,58] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getAugmentation(java.lang.Class&lt;org.opendaylight.yang.gen.v1.urn.opendaylight.address.tracker.rev140617.AddressCapableNodeConnector&gt;)</span><br><span class="line">[ERROR]   location: variable nc of type org.opendaylight.yang.gen.v1.urn.opendaylight.inventory.rev130819.node.NodeConnector</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/l2switch-main/src/main/java/org/opendaylight/l2switch/inventory/InventoryReader.java:[85,84] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getKey()</span><br><span class="line">[ERROR]   location: variable nc of type org.opendaylight.yang.gen.v1.urn.opendaylight.inventory.rev130819.node.NodeConnector</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/l2switch-main/src/main/java/org/opendaylight/l2switch/inventory/InventoryReader.java:[87,102] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   method getKey()</span><br><span class="line">[ERROR]   location: variable nc of type org.opendaylight.yang.gen.v1.urn.opendaylight.inventory.rev130819.node.NodeConnector</span><br></pre></td></tr></table></figure>
<h1 id="feature-odl-l2switch-packethandler-编译报错">feature odl-l2switch-packethandler 编译报错</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[ERROR] Failed to execute goal on project odl-l2switch-packethandler: Could not resolve dependencies for project org.opendaylight.l2switch:odl-l2switch-packethandler:feature:0.8.0-SNAPSHOT: Could not find artifact org.opendaylight.openflowplugin:odl-openflowplugin-southbound:xml:features:0.7.0-SNAPSHOT in opendaylight-snapshot (https://nexus.opendaylight.org/content/repositories/opendaylight.snapshot/) -&gt; [Help 1]</span><br><span class="line">[ERROR]</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">依赖问题，因为从fluorine起，maven采用的repository是`https://nexus.opendaylight.org/content/repositories/public/`, snapshot采用的是`https://nexus.opendaylight.org/content/repositories/opendaylight.snapshot/` 而`opendaylight.snapshot`删掉了好多东西</span><br><span class="line"></span><br><span class="line">修改`odl-l2switch-packethandler/pom.xml`中的依赖关系如下:</span><br></pre></td></tr></table></figure>
<p><dependency> <groupid>org.opendaylight.openflowplugin</groupid> <artifactid>odl-openflowplugin-southbound</artifactid> <version>0.7.0</version> <type>xml</type> <classifier>features</classifier> </dependency> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># feature odl-l2switch-loopremover 编译报错</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[ERROR] Failed to execute goal on project odl-l2switch-loopremover: Could not resolve dependencies for project org.opendaylight.l2switch:odl-l2switch-loopremover:feature:0.8.0-SNAPSHOT: Could not find artifact org.opendaylight.openflowplugin:odl-openflowplugin-flow-services:xml:features:0.7.0-SNAPSHOT in opendaylight-snapshot (https://nexus.opendaylight.org/content/repositories/opendaylight.snapshot/) -&gt; [Help 1]</span><br><span class="line">[ERROR]</span><br></pre></td></tr></table></figure>
<p>编译好的的<code>l2switch</code>(0.7.4)依赖<code>odl-openflowplugin-flow-services</code>的版本是0.6.4 鉴于其他SFC项目都采用了0.9.0-SNAPSHOT的<code>odl-openflowplugin-flow-services</code>。所以这里修改如下: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.opendaylight.openflowplugin&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;odl-openflowplugin-flow-services&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.9.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;type&gt;xml&lt;/type&gt;</span><br><span class="line">    &lt;classifier&gt;features&lt;/classifier&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="feature-odl-l2switch-switch-rest-编译失败">feature odl-l2switch-switch-rest 编译失败</h1>
<p>因为项目的<code>pom.xml</code>依赖的是: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.opendaylight.netconf&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;odl-restconf&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;1.8.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;type&gt;xml&lt;/type&gt;</span><br><span class="line">&lt;classifier&gt;features&lt;/classifier&gt;</span><br></pre></td></tr></table></figure></p>
<p>以SFC项目为例，odl-sfc-provider-rest 依赖的<code>odl-restconf</code>工件版本已经是1.10.0-SNAPSHOT. 应该与SFC统一。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.opendaylight.netconf&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;odl-restconf&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;1.10.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;type&gt;xml&lt;/type&gt;</span><br><span class="line">&lt;classifier&gt;features&lt;/classifier&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="feature-odl-l2switch-ui-编译报错">feature odl-l2switch-ui 编译报错</h1>
<p>在<code>features/pom.xml</code>注释掉/删掉关于 <code>odl-l2switch-switch-ui</code> 的模块</p>
<h1 id="feature-l2switch-编译报错">feature-l2switch 编译报错</h1>
<p>该项目下的pom.xml中注销掉关于<code>odl-l2switch-switch-ui</code>的依赖</p>
<h1 id="distribution-karaf-编译报错">distribution-karaf 编译报错</h1>
<p>有几个现象值得注意下： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[INFO] ------------&lt; org.opendaylight.l2switch:distribution-karaf &gt;------------</span><br><span class="line">[INFO] Building distribution-karaf 0.8.0-SNAPSHOT                         [2/5]</span><br><span class="line">[INFO] --------------------------------[ pom ]---------------------------------</span><br><span class="line">Downloading from opendaylight-mirror: https://nexus.opendaylight.org/content/repositories/public/org/opendaylight/odlparent/karaf-plugin/3.1.0/karaf-plugin-3.1.0.pom</span><br><span class="line">Downloaded from opendaylight-mirror: https://nexus.opendaylight.org/content/repositories/public/org/opendaylight/odlparent/karaf-plugin/3.1.0/karaf-plugin-3.1.0.pom (5.6 kB at 9.9 kB/s)</span><br><span class="line">Downloading from opendaylight-mirror: https://nexus.opendaylight.org/content/repositories/public/org/opendaylight/odlparent/karaf-plugin/3.1.0/karaf-plugin-3.1.0.jar</span><br><span class="line">Downloaded from opendaylight-mirror: https://nexus.opendaylight.org/content/repositories/public/org/opendaylight/odlparent/karaf-plugin/3.1.0/karaf-plugin-3.1.0.jar (32 kB at 96 kB/s)</span><br><span class="line">Downloading from opendaylight-mirror: https://nexus.opendaylight.org/content/repositories/public/org/apache/karaf/features/framework/4.1.5/framework-4.1.5.pom</span><br><span class="line">Downloaded from opendaylight-mirror: https://nexus.opendaylight.org/content/repositories/public/org/apache/karaf/features/framework/4.1.5/framework-4.1.5.pom (12 kB at 53 kB/s)</span><br><span class="line">Downloading from opendaylight-mirror: https://nexus.opendaylight.org/content/repositories/public/org/apache/karaf/features/base/4.1.5/base-4.1.5.pom</span><br><span class="line">Downloaded from opendaylight-mirror: https://nexus.opendaylight.org/content/repositories/public/org/apache/karaf/features/base/4.1.5/base-4.1.5.pom (9.1 kB at 37 kB/s)</span><br><span class="line">Downloading from opendaylight-mirror: https://nexus.opendaylight.org/content/repositories/public/org/apache/karaf/org.ap</span><br></pre></td></tr></table></figure></p>
<p>针对这一点有两处需要改动： 1. features/featues-l2switch 貌似下载的是<code>karaf 3.1.1</code>, 而SFC依赖的是(定义在<code>features/features-l2switch/pom.xml</code>中): <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.opendaylight.odlparent&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;feature-repo-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.0.0&lt;/version&gt;</span><br><span class="line">    &lt;relativePath/&gt;</span><br><span class="line">&lt;/parent&gt;</span><br></pre></td></tr></table></figure></p>
<p>修改<code>features/features-l2switch</code>使二者统一</p>
<ol start="2" type="1">
<li>artifacts/pom.xml 修改后的内容: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.opendaylight.odlparent&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;odlparent-lite&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.0.0&lt;/version&gt;</span><br><span class="line">    &lt;relativePath/&gt;</span><br><span class="line">&lt;/parent&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>为何sfc项目保持一致。&lt;openflow.plugin.version&gt;0.9.0-SNAPSHOT&lt;/openflow.plugin.version&gt; 统一改为0.9.0-SNAPSHOT 之前是多少？</p>
<p>parent 文件夹中pom.xml中<parent>亦是改成4.0.2(之前为0.13.0)</parent></p>
<p>第二，报错依然跟<code>odl-l2switch-switch-ui/</code>有关 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[ERROR] Failed to execute goal org.apache.karaf.tooling:karaf-maven-plugin:4.1.5:assembly (process-resources) on project distribution-karaf: Unable to build assembly: Could not find matching feature for odl-l2switch-switch-ui/0.0.0 -&gt; [Help 1]</span><br><span class="line">[ERROR]</span><br></pre></td></tr></table></figure></p>
<p>这是因为在文件<code>/distribution/karaf/pom.xml</code> 中，有这么个配置，而这么个配置是编译中产生的:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--properties&gt;</span><br><span class="line">  &lt;karaf.localFeature&gt;odl-l2switch-switch-ui&lt;/karaf.localFeature&gt;</span><br><span class="line">&lt;/properties--&gt;</span><br></pre></td></tr></table></figure>
<p>删掉这个配置！ 同时parent的版本号要改成5.0.0</p>
<h1 id="section"></h1>
<p>[INFO] ------------------------------------------------------------------------ [ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.7.0:compile (default-compile) on project packethandler-model: Compilation failure [ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/packethandler/model/target/generated-sources/mdsal-binding/org/opendaylight/yang/gen/v1/urn/opendaylight/packet/basepacket/rev140528/raw/packet/fields/MatchBuilder.java:[293,26] org.opendaylight.yang.gen.v1.urn.opendaylight.packet.basepacket.rev140528.raw.packet.fields.MatchBuilder.MatchImpl is not abstract and does not override abstract method implementedInterface() in org.opendaylight.yang.gen.v1.urn.opendaylight.model.match.types.rev131026.Match</p>
<p>这个错误是由于依赖从&lt;openflow.plugin.version&gt;0.9.0-SNAPSHOT&lt;/openflow.plugin.version&gt; 改为0.9.0-SNAPSHOT引起的，当其为0.7.0的时候，并没有这个问题！ <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 获取另外分支上的更新到 src/js 文件/文件夹下</span><br><span class="line">git checkout feature-branch -- src/js/</span><br><span class="line"># 比较两个分支上跟新的不同</span><br><span class="line">git diff branchA branchB -- file.cs</span><br></pre></td></tr></table></figure></p>
<h1 id="section-1"></h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[INFO] --- maven-surefire-plugin:2.18.1:test (default) @ odl-l2switch-packethandler ---</span><br><span class="line">[INFO] Surefire report directory: /home/qsong/Documents/sfc-patch/sfc-l2switch/features/odl-l2switch-packethandler/target/surefire-reports</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------</span><br><span class="line"> T E S T S</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">Running org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 18.655 sec &lt;&lt;&lt; FAILURE! - in org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">installFeatureCatchAndLog(org.opendaylight.odlparent.featuretest.SingleFeatureTest)[repoUrl: file:/home/qsong/Documents/sfc-patch/sfc-l2switch/features/odl-l2switch-packethandler/target/feature/feature.xml, Feature: odl-l2switch-packethandler 0.8.0.SNAPSHOT]  Time elapsed: 17.925 sec  &lt;&lt;&lt; ERROR!</span><br><span class="line">org.osgi.service.resolver.ResolutionException: Unable to resolve root: missing requirement [root] osgi.identity; osgi.identity=odl-l2switch-packethandler; type=karaf.feature; version=&quot;[0.8.0.SNAPSHOT,0.8.0.SNAPSHOT]&quot;; filter:=&quot;(&amp;(osgi.identity=odl-l2switch-packethandler)(type=karaf.feature)(version&gt;=0.8.0.SNAPSHOT)(version&lt;=0.8.0.SNAPSHOT))&quot; [caused by: Unable to resolve odl-l2switch-packethandler/0.8.0.SNAPSHOT: missing requirement [odl-l2switch-packethandler/0.8.0.SNAPSHOT] osgi.identity; osgi.identity=odl-openflowplugin-southbound; type=karaf.feature; version=&quot;[0.7.0,0.7.0]&quot; [caused by: Unable to resolve odl-openflowplugin-southbound/0.7.0: missing requirement [odl-openflowplugin-southbound/0.7.0] osgi.identity; osgi.identity=odl-serviceutils-tools; type=karaf.feature; version=&quot;[0.2.0,0.2.0]&quot; [caused by: Unable to resolve odl-serviceutils-tools/0.2.0: missing requirement [odl-serviceutils-tools/0.2.0] osgi.identity; osgi.identity=odl-infrautils-metrics; type=karaf.feature; version=&quot;[1.4.0,1.4.0]&quot; [caused by: Unable to resolve odl-infrautils-metrics/1.4.0: missing requirement [odl-infrautils-metrics/1.4.0] osgi.identity; osgi.identity=io.dropwizard.metrics.jvm; type=osgi.bundle; version=&quot;[4.0.2,4.0.2]&quot;; resolution:=mandatory [caused by: Unable to resolve io.dropwizard.metrics.jvm/4.0.2: missing requirement [io.dropwizard.metrics.jvm/4.0.2] osgi.wiring.package; filter:=&quot;(osgi.wiring.package=com.sun.management)&quot;]]]]]</span><br><span class="line">    at org.apache.felix.resolver.ResolutionError.toException(ResolutionError.java:42)</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.doResolve(ResolverImpl.java:391)</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:377)</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:349)</span><br><span class="line">    at org.apache.karaf.features.internal.region.SubsystemResolver.resolve(SubsystemResolver.java:218)</span><br><span class="line">    at org.apache.karaf.features.internal.service.Deployer.deploy(Deployer.java:291)</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.doProvision(FeaturesServiceImpl.java:1248)</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.lambda$doProvisionInThread$1(FeaturesServiceImpl.java:1147)</span><br><span class="line">    at java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">    at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Results :</span><br><span class="line"></span><br><span class="line">Tests in error:</span><br><span class="line">  Unable to resolve root: missing requirement [root] osgi.identity; osgi.identity=odl-l2switch-packethandler; type=karaf.feature; version=&quot;[0.8.0.SNAPSHOT,0.8.0.SNAPSHOT]&quot;; filter:=&quot;(&amp;(osgi.identity=odl-l2switch-packethandler)(type=karaf.feature)(version&gt;=0.8.0.SNAPSHOT)(version&lt;=0.8.0.SNAPSHOT))&quot; [caused by: Unable to resolve odl-l2switch-packethandler/0.8.0.SNAPSHOT: missing requirement [odl-l2switch-packethandler/0.8.0.SNAPSHOT] osgi.identity; osgi.identity=odl-openflowplugin-southbound; type=karaf.feature; version=&quot;[0.7.0,0.7.0]&quot; [caused by: Unable to resolve odl-openflowplugin-southbound/0.7.0: missing requirement [odl-openflowplugin-southbound/0.7.0] osgi.identity; osgi.identity=odl-serviceutils-tools; type=karaf.feature; version=&quot;[0.2.0,0.2.0]&quot; [caused by: Unable to resolve odl-serviceutils-tools/0.2.0: missing requirement [odl-serviceutils-tools/0.2.0] osgi.identity; osgi.identity=odl-infrautils-metrics; type=karaf.feature; version=&quot;[1.4.0,1.4.0]&quot; [caused by: Unable to resolve odl-infrautils-metrics/1.4.0: missing requirement [odl-infrautils-metrics/1.4.0] osgi.identity; osgi.identity=io.dropwizard.metrics.jvm; type=osgi.bundle; version=&quot;[4.0.2,4.0.2]&quot;; resolution:=mandatory [caused by: Unable to resolve io.dropwizard.metrics.jvm/4.0.2: missing requirement [io.dropwizard.metrics.jvm/4.0.2] osgi.wiring.package; filter:=&quot;(osgi.wiring.package=com.sun.management)&quot;]]]]]</span><br><span class="line"></span><br><span class="line">Tests run: 1, Failures: 0, Errors: 1, Skipped: 0</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.7.0:compile (default-compile) on project packethandler-model: Compilation failure: Compilation failure:</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-l2switch/packethandler/model/src/main/yang-gen-sal/org/opendaylight/yang/gen/v1/urn/opendaylight/packet/ethernet/rev140528/VlanId.java:[10,47] cannot find symbol</span><br><span class="line">[ERROR]   symbol:   class TypeObject</span><br><span class="line">[ERROR]   location: package org.opendaylight.yangtools.yang.binding</span><br></pre></td></tr></table></figure>
<p>好端端的为啥 <code>org.opendaylight.yangtools.yang.binding.TypeObject</code> 就找不到了？ 这个包定义在 <code>org.opendaylight.mdsal</code>之中</p>
<p><code>https://github.com/opendaylight/mdsal/tree/stable/fluorine/binding/yang-binding/src/main/java/org/opendaylight/yangtools/yang/binding</code> 显示 这个<code>TypeObject</code>类没有了</p>
<p><a href="https://javadocs.opendaylight.org/org.opendaylight.mdsal/master/" target="_blank" rel="noopener">ODL MDSAL Javadoc</a> 显示: <code>TypeObject</code>这个类似乎是master分支才引进的，之前(包括Fluorine版本)从来没有存在过！L2switch代码我下载的也是master分支的，并且其中代码实现了接口类<code>TypeObject</code>.</p>
<p>问题: 为什么在<code>l2switch-parent/pom.xml</code>中，之前使用老版本的mdsal反倒没有这种问题呢？ 我发现<code>~/.m2/repository/org/opendaylight/mdsal/yang-binding/2.0.2/yang-binding-2.0.2.jar</code>中倒是发现了<code>TypeObject这个类</code></p>
<p>IntelliJ IDEA 真是写代码神器，有这个工具的帮助，感觉效率成倍提高！我的目标是让l2switch跟sfc代码兼容，让他们有相同的依赖，没有依赖冲突。现在的策略是一个一个模块来编译</p>
<p>在做static code analysis 的时候，将<code>javax.annotation.Nonnull</code>统一替换为<code>org.eclipse.jdt.annotation.NonNull</code></p>
<p>loopremover/NetworkGraphImpl 下有几个特殊字符，不知道IDE 自动替换的是否正确啊</p>
<p>原来一直odl-l2switch-switch-rest中依赖的 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.opendaylight.netconf&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;odl-restconf&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;1.8.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;type&gt;xml&lt;/type&gt;</span><br><span class="line">&lt;classifier&gt;features&lt;/classifier&gt;</span><br></pre></td></tr></table></figure></p>
<p>在编译成distribution-karaf的时候，依赖一些老的东西, 采用<version>1.10.0-SNAPSHOT</version></p>
<h1 id="后来在编译feature-odl-l2switch-loopremover-的时候又是因为在dependency里面显式地依赖了org.opendaylight.openflowplugin-的-odl-openflowplugin-flow-services-0.7.0版本-而不是0.9.0-snapshot-最后又出现了需要-com.google.common.base-version-27.1.0-提供的是-28.0.0">后来在编译feature odl-l2switch-loopremover 的时候，又是因为在dependency里面显式地依赖了org.opendaylight.openflowplugin 的 odl-openflowplugin-flow-services (0.7.0版本) 而不是0.9.0-SNAPSHOT 最后又出现了需要 com.google.common.base version = 27.1.0 提供的是 28.0.0</h1>
<h1 id="这个问题终于找到了原因了">这个问题终于找到了原因了</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[INFO] Running org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 27.367 s &lt;&lt;&lt; FAILURE! - in org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] installFeatureCatchAndLog(org.opendaylight.odlparent.featuretest.SingleFeatureTest)[repoUrl: file:/Users/qsong/Documents/Post-doc-doc/sfc-patch/features/odl-sfc-sfp-checker/target/feature/feature.xml, Feature: odl-sfc-sfp-checker 0.10.0.SNAPSHOT]  Time elapsed: 24.488 s  &lt;&lt;&lt; ERROR!</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve org.opendaylight.sfc.sfp-checker/0.10.0.SNAPSHOT: missing requirement [org.opendaylight.sfc.sfp-checker/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.l2switch.arphandler.core)&quot;</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.doResolve(ResolverImpl.java:392)</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:378)</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:332)</span><br><span class="line">    at org.apache.karaf.features.internal.region.SubsystemResolver.resolve(SubsystemResolver.java:257)</span><br><span class="line">    at org.apache.karaf.features.internal.service.Deployer.deploy(Deployer.java:388)</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.doProvision(FeaturesServiceImpl.java:1025)</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.lambda$doProvisionInThread$13(FeaturesServiceImpl.java:964)</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl$$Lambda$75.00000000E79B4420.call(Unknown Source)</span><br><span class="line">    at java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">    at java.lang.Thread.run(Thread.java:819)</span><br></pre></td></tr></table></figure>
<p>根本原因是 arphandler-impl 这个bundle并没有export-package其中的core包，但问题是：为啥这个sfc-sfp-checker这个模块依赖arphandler-impl的时候 却没有任何问题呢？？？</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/06/21/java-tuto/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/06/21/java-tuto/" class="post-title-link" itemprop="url">Maven Java 经验积累</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-06-21 13:52:09" itemprop="dateCreated datePublished" datetime="2019-06-21T13:52:09+08:00">2019-06-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-07-13 07:09:45" itemprop="dateModified" datetime="2019-07-13T07:09:45+08:00">2019-07-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="开发虚拟环境构建">开发虚拟环境构建</h1>
<h2 id="java8-安装问题">java8 安装问题</h2>
<p>https://www.javahelps.com/2015/03/install-oracle-jdk-in-ubuntu.html Oracle 现在不允许其他源提供下载，但是我们依然可以通过登录 Oracle 官网来下载 tar.gz 文件。</p>
<p>如果不是用java8安装的话，会导致编译错误！因为</p>
<p>https://www.geofis.org/en/install/install-on-linux/install-openjdk-8-on-ubuntu-trusty/</p>
<p>安装OpenJDK也是可以的</p>
<h1 id="java-8-在-macosx-中的安装">Java 8 在 MacOSX 中的安装</h1>
<p>https://github.com/AdoptOpenJDK/homebrew-openjdk https://royvanrijn.com/blog/2018/05/openj9-jvm-shootout/ java虚拟机的一些介绍</p>
<h2 id="java-开发环境管理">Java 开发环境管理</h2>
<p>https://blog.csdn.net/theonegis/article/details/79874684 https://github.com/jenv/jenv/issues/44 jenv无法设置JAVA_HOME的问题</p>
<h1 id="java-io">Java I/O</h1>
<p>首先来清楚几个I/O相关的概念: * Data in files on your system is called <code>persistent data</code> because it persists after the program runs; * Files are created through <code>streams</code> in Java code; * A <code>stream</code> is a linear, sequential <code>flow of bytes</code> of input/output data; * <code>Streams</code> are written to the file system to create files; * <code>Streams</code> can be either byte based or character based; * <code>Streams</code> can also be transferred over the Internet; * Three streams are created for us automatically: - <code>System.out*</code> :standard output stream - <code>System.in*</code> :standard input stream - <code>System.err*</code> :standard error</p>
<h1 id="java-callable-and-future">Java Callable and Future</h1>
<p>产生的背景: 一直以来，java 中创建线程的2种方式，一种是直接继承 Thread，另外一种就是实现 Runnable 接口。这2种方式都有一个缺陷就是：在执行完任务之后无法获取执行结果。 如果需要获取执行结果，就必须通过共享变量或者使用线程通信的方式来达到效果，这样使用起来就比较麻烦。</p>
<p>Callable 以及 Future 就是自从Java 1.5引入的，用来解决这种问题的接口。简单说，所以说Callable用于产生结果，Future用于获取结果。Callable接口使用泛型去定义它的返回类型。Executors 类提供了一些有用的方法在线程池中执行 Callable 内的任务。由于 Callable 任务是并行的（并行就是整体看上去是并行的，其实在某个时间点只有一个线程在执行），我们必须等待它返回的结果。 <code>java.util.concurrent.Future</code> 对象为我们解决了这个问题。在线程池提交 <code>Callable</code> 任务后返回了一个 <code>Future</code> 对象，使用它可以知道 <code>Callable</code> 任务的状态和得到 <code>Callable</code>返回的执行结果。<code>Future</code> 提供了 get() 方法让我们可以等待 <code>Callable</code>结束并获取它的执行结果。</p>
<p>参考文献: 1. https://www.imooc.com/article/14383</p>
<h1 id="java-开发中的一些概念">Java 开发中的一些概念</h1>
<ul>
<li>artifact: 我认为可以理解为component 组成java程序的组成部分，是一种比较宽泛通用的说法</li>
<li>bundle: OSGi 程序的组成部分 (是<code>artifact</code>的一种), 由 Apache Felix 插件 <code>maven-bundle-plugin</code> 生成。The plugin treats all the classes available to your module (the module's own classes, classes provided by dependencies, other classes on the classpath) as one giant set, then lets you select a subset of those classes to bundle into a jar. It also creates the necessary manifest information to make the artifact an OSGi bundle.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/06/14/bash-tuto/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/06/14/bash-tuto/" class="post-title-link" itemprop="url">bash_tuto</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-06-14 15:04:08" itemprop="dateCreated datePublished" datetime="2019-06-14T15:04:08+08:00">2019-06-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-25 18:02:57" itemprop="dateModified" datetime="2020-04-25T18:02:57+08:00">2020-04-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>https://linuxconfig.org/how-to-use-arrays-in-bash-script How to define array in</p>
<p>vim tuto</p>
<h1 id="vim-下光标跳转">VIM 下光标跳转</h1>
<h2 id="种移动方式normal-mode">8种移动方式(normal mode)</h2>
<ul>
<li>h,j,k,l =&gt; 左，下，上，右</li>
<li>w, b =&gt; 当前行往右/往左移动一个词</li>
<li>gg, shitf+G =&gt; 跳转至文档开头/末尾</li>
<li>10G(10+shift+g) =&gt; 跳转到文档第10行</li>
<li>^ (shift+6), $(shift+4) =&gt; 跳转到当前行首，行末</li>
<li>f{n} =&gt; 光标跳转至本行第一次出现字符{n}的地方</li>
<li>ctrl +o =&gt; 跳转至上一次跳转光标所在的位置 (挺实用的技巧)</li>
</ul>
<h2 id="种移动方式command-mode">1种移动方式(command mode)</h2>
<ul>
<li>:4 =&gt; 跳转到第四行</li>
</ul>
<h1 id="vim-删除文本">VIM 删除文本</h1>
<h2 id="normal-mode">normal mode</h2>
<ul>
<li>x, X =&gt; 删除当前光标所在的字符，删除当前光标所在之前一个字符</li>
<li>dd =&gt; 删除当前所在的行</li>
<li>dG =&gt; 删除至文档末尾</li>
<li>dw =&gt; 删除一个单词</li>
<li>d^(d+shift+6) =&gt; 从当前光标所在的位置删除至行首</li>
<li>d$(d+shift+4) =&gt; 从当前光标所在的位置删除至行尾 利用vim重复命令特性</li>
<li>d5w =&gt; 删除当前光标之后的5个单词</li>
<li>3dd =&gt; 删除当前行以及之后的两行(一共3行)</li>
</ul>
<h1 id="vim-复制粘贴文本">VIM 复制粘贴文本</h1>
<p>y yanking 在VIM发明的年代，c键已经被用作其他命令了，作者们只好用y表示复制了。 * yy =&gt; 复制当前行 * yw =&gt; 复制当前的word * y$ =&gt; 复制从当前光标处到行末的字符 * y^ =&gt; 复制从当前光标处到行首的字符 * p =&gt; 粘贴(没有那么多花样)</p>
<h1 id="vim-退出">VIM 退出</h1>
<h2 id="normal-mode-1">normal mode</h2>
<ul>
<li>shift + zz ## command mode</li>
<li>:x</li>
<li>:wq</li>
<li>:q!</li>
<li>:w NEW_FILE_NAME 将当前文件另存为 NEW_FILE_NAME</li>
</ul>
<h1 id="vim-撤销上一次操作-撤销上一次的撤销">VIM 撤销上一次操作 撤销上一次的撤销</h1>
<ul>
<li>u{N}， ctrl+r =&gt; 撤销N次操作，反撤销 (不是ctrl+u还猛一下让人不习惯的)</li>
</ul>
<h1 id="vim-替换操作">VIM 替换操作</h1>
<ul>
<li>r{字符} =&gt; 将当前光标所在的字符替换为{字符}代表的字符，如ra, 将当前光标所在的字符替换为a</li>
<li>R =&gt; 连续替换，直到按住ESC退出替换</li>
<li>~ =&gt; 当前字符大小写反转</li>
</ul>
<h1 id="vim-缩进以及对齐">VIM 缩进以及对齐</h1>
<ul>
<li><blockquote>
<blockquote>
<p>向右缩进shiftwidth个空格</p>
</blockquote>
</blockquote></li>
<li>&lt;&lt; 向左缩进shiftwidth个空格</li>
<li>:set shiftwidth=4 设置shiftwidth代表的空格数</li>
</ul>
<p>VIM 高级功能</p>
<p>https://github.com/goreliu/zshguide 很好的zsh script教程</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/05/20/opendaylight-dev/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/20/opendaylight-dev/" class="post-title-link" itemprop="url">opendaylight-dev</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-20 16:13:03" itemprop="dateCreated datePublished" datetime="2019-05-20T16:13:03+08:00">2019-05-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-23 17:00:52" itemprop="dateModified" datetime="2019-10-23T17:00:52+08:00">2019-10-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>http://sdnhub.org/tutorials/opendaylight/ 虽然有点老，但是这个教程也不失为一个比较好的 OpenDaylight 开发教程 我看了下 其内容还是比较系统全面的</p>
<h1 id="odl-controller-直接发送数据包给-ovs-交换机">ODL controller 直接发送数据包给 OVS 交换机</h1>
<p>两种思路:</p>
<h1 id="odl-controller-直接发送数据包到网络中">ODL controller 直接发送数据包到网络中</h1>
<p>ODL controller 直接发包, 其本质上并不是controller本身可以发送想要的数据包给某个目的地址。而是通过Openflow PacketOut message, 将要发包的指令传递给指定的发送设备，后者负责将包发出去，发送的方式多种多样，比如: 1. 可以通过PacketOut message指定要发送的信息(payload), 负责发送信息的设备(支持OpenFlow的设备，大多数情况下就是OVS交换机), 以及 ingress port。这种模式，相当于通过PacktOut信息传递给发送设备该设备认为是其指定的ingress port收到了一条信息，之后可以通过openflow rules就行一些列处理并且发送出去。 2. 可以通过PacketOut message指定要发送的信息(payload), 负责发送信息的设备(支持OpenFlow的设备，大多数情况下就是OVS交换机), 以及 egress port。这种模式就是告诉网络设备直接从某个端口发送一个包出去，而不会经过设备中已经存储的openflow rules的处理了。</p>
<h1 id="为啥通过-maven-archetype-创建的project都有个karaf">为啥通过 maven archetype 创建的project都有个karaf</h1>
<h1 id="odl-开发需要的基础知识">ODL 开发需要的基础知识</h1>
<p>ODL 依赖以下技术： * OSGI: 框架运行于ODL后台，它允许动态加载bundles和jar包，并且为了信息交换将bundle捆绑在一起。 * Karaf: 构建在OSGi框架上的应用程序容器，它简化了各方面的组包和安装应用程序操作。 * YANG: 一种数据建模语言，由RFC6020以及RFC6021定义, 通过应用,远程过程调用(PRC)以及通知消息(Notification)来操作模型配置和数据状态。</p>
<p>比较好的 ODL 开发教程，如下： https://www.sdnlab.com/community/article/odl/974 https://www.sdnlab.com/community/article/odl/978</p>
<p>很老的教程，但是可以拿来参考 http://www.muzixing.com/pages/2014/08/06/opendaylightzhong-kai-fa-mo-kuai-ping.html</p>
<p>https://www.sdnlab.com/18092.html</p>
<h1 id="osgi">OSGi</h1>
<p>仔细阅读这个资料并整理： https://www.cnblogs.com/jingmoxukong/p/4546947.html https://segmentfault.com/a/1190000007420617</p>
<p>这个教程 也是很不错：https://www.jianshu.com/p/2c0c8091e3de</p>
<p>https://www.tianmaying.com/tutorial/osgi-blueprint</p>
<h1 id="源码编译-odl">源码编译 ODL</h1>
<p>编译之后，生成的文件是会放在项目根目录之下的<code>karaf</code>文件夹之内的。</p>
<h1 id="odl-开发中的日志管理">ODL 开发中的日志管理</h1>
<p>It is not a bundle name you specify with the set <code>log level</code> command but a fully-qualified Java package or class name. You can also just edit <code>etc/org.ops4j.pax.logging.cfg</code> directly to set the log levels for packages/classes, for example: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log4j.logger.org.opendaylight.mypackage=DEBUG</span><br></pre></td></tr></table></figure></p>
<p>In code you create Logger instances per class, for example: <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.opendaylight.mypackage;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = LoggerFactory.getLogger(MyClass.class);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Log output goes to <code>data/log/karaf.log</code>.</p>
<p>也可以通过karaf console来操作: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path/to/client -u karaf -p karaf</span><br></pre></td></tr></table></figure></p>
<p>查看目前log设置 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log:list</span><br></pre></td></tr></table></figure></p>
<p>比如我们想改变某个java package log设置为DEBUG模式 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log:set DEBUG org.opendaylight.sfc.sbrest.json</span><br></pre></td></tr></table></figure></p>
<p>最后我们发现，相应地，<code>etc/org.ops4j.pax.logging.cfg</code>中的配置也发生了变化。神奇！</p>
<p>https://svn.apache.org/repos/asf/karaf/site/production/manual/latest-3.0.x/log.html</p>
<p>https://logging.apache.org/log4j/2.x/manual/layouts.html https://howtodoinjava.com/log4j2/useful-conversion-pattern-examples/</p>
<h1 id="integration-项目">Integration 项目</h1>
<p>Integration 是一个框架性的工程，所有自己开发和修改的部分（包括controller、openflowPlugin&amp;Java三个工程）编译为包后，都可以放在该工程的目录下一起执行。注意，如果是自己开发的包，则可以直接放到该目录下。但是如果是修改的原本工程，然后编译的包要替换掉上面目录中原来的包，这里有个问题是 integration 的 plugin目录下的包名和 controller， openflowplugin， openflowjava 中编译出来的包命名方式有点小差别，复制过去之前先重命名下，使之和目录下的原来包文件名一致，再复制替换。（参考自@jason-zhou童鞋的《OpenDaylight开发学习笔记基础之Controller篇》）。将各个工程的jar包copy到integration里后，运用mvn clean install 编译integration。工程所在目录：</p>
<h1 id="odl-开发中必用的-karaf-指令">ODL 开发中必用的 Karaf 指令</h1>
<ul>
<li>feature:list -i 命令可以查看已经安装的功能模块</li>
<li>feature:install <feature> 命令可以安装想要的feature。</feature></li>
<li>system:shutdown 退出ODL控制器</li>
</ul>
<p>To uninstall a feature, you must shut down OpenDaylight, delete the data directory, and start OpenDaylight up again. Uninstalling a feature using the Karaf <code>feature:uninstall</code> command is not supported and can cause unexpected and undesirable behavior.</p>
<h1 id="rpc-机制">RPC 机制</h1>
<p>在传统的开发模式中，我们通常将系统的各个服务部署在单台机器，随着服务的扩展，这种方式已经完全无法满足系统大规模的扩展需要，分布式系统由此诞生，在分布式系统中，最重要就是各个服务之间的 RPC 调用。</p>
<p>RPC 全称 Remote Procedure Call——远程过程调用，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的方式。简单一点就是：通过一定协议和方法使得调用远程计算机上的服务，就像调用本地服务一样。</p>
<h2 id="rpc-调用分类">RPC 调用分类</h2>
<p>从底层网络协议分: * 基于 HTTP 的RPC * 基于 二进制 RPC * 基于 TCP RPC 从是否跨平台可以分为: * 单语言 RPC (如RMI) * 跨平台 RPC, 如 Google protobuffer, RESTFul JSON, HTTP XML</p>
<p>从调用过程来看: * 同步通信 RPC: 指的是客户端发起调用后，必须等待调用执行完成并返回结果； * 异步通信 RPC: 指客户方调用后不关心执行结果返回，如果客户端需要结果，可用通过提供异步 callback 回调获取返回信息。大部分 RPC 框架都同时支持这两种方式的调用。</p>
<h1 id="sfc-项目">sfc 项目</h1>
<p>通过 git/gerrit 下载的代码来看，sfc 项目本身亦是由一个个Maven子项目构成的, 因为在其根目录下并没有pom.xml文件 pom.xml 主要描述了项目的maven坐标，依赖关系，开发者需要遵循的规则，缺陷管理系统，组织和licenses，以及其他所有的项目相关因素，是项目级别的配置文件 。</p>
<p>注意：setting.xml主要用于配置maven的运行环境等一系列通用的属性，是全局级别的配置文件；</p>
<h1 id="a-required-class-was-missing...javaxxmlbindjaxbexception...">A required class was missing...javax/xml/bind/JAXBException...</h1>
<p>解决方案：https://stackoverflow.com/questions/43574426/how-to-resolve-java-lang-noclassdeffounderror-javax-xml-bind-jaxbexception-in-j</p>
<h1 id="karaf-在虚拟机共享文件夹中启动的问题">karaf 在虚拟机共享文件夹中启动的问题</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vagrant@odldev:/vagrant/topology/karaf$ target/assembly/bin/karaf</span><br><span class="line">Apache Karaf starting up. Press Enter to open the shell now...</span><br><span class="line">  2% [=&gt;                                                                      ]log4j:ERROR setFile(null,true) call failed.</span><br><span class="line">java.io.FileNotFoundException: /home/qsong/Documents/odl_dev_tuto/topology/karaf/target/assembly/data/log/karaf.log (No such file or directory)</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"> 89% [================================================================&gt;       ]FATAL: PWC5963: The scratchDir you specified: /home/qsong/Documents/odl_dev_tuto/topology/karaf/target/assembly/data/pax-web-jsp/moon is unusable.</span><br><span class="line"> 90% [================================================================&gt;       ]FATAL: PWC5963: The scratchDir you specified: /home/qsong/Documents/odl_dev_tuto/topology/karaf/target/assembly/data/pax-web-jsp/oauth2 is unusable.</span><br><span class="line"> 91% [=================================================================&gt;      ]FATAL: PWC5963: The scratchDir you specified: /home/qsong/Documents/odl_dev_tuto/topology/karaf/target/assembly/data/pax-web-jsp/auth is unusable.</span><br><span class="line"> 96% [=====================================================================&gt;  ]FATAL: PWC5963: The scratchDir you specified: /home/qsong/Documents/odl_dev_tuto/topology/karaf/target/assembly/data/pax-web-jsp/restconf is unusable.</span><br><span class="line">FATAL: PWC5963: The scratchDir you specified: /home/qsong/Documents/odl_dev_tuto/topology/karaf/target/assembly/data/pax-web-jsp/apidoc is unusable.</span><br><span class="line">100% [========================================================================]</span><br></pre></td></tr></table></figure>
<p>以上信息为在vagrant启动的虚拟机中启动karaf的时候，报出的错误信息。karaf 是在 Host machine中编译通过的，<code>/home/qsong/Documents/odl_dev_tuto/</code> 在虚拟机中挂载为<code>/vagrant</code>文件夹。从上面的报错信息来看，因为是在主机中编译的，所以在启动karaf的时候会出现log日志文件找不到，某些路径找不到的问题。那么如果我们在虚拟机下直接编译，还会出现这种问题么？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-clean-plugin:3.0.0:clean (default-clean) on project topology-karaf: Failed to clean project: Failed to delete /vagrant/topology/karaf/target/assembly/data/cache/org.eclipse.osgi/bundles -&gt; [Help 1]</span><br><span class="line">[ERROR]</span><br><span class="line">[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.</span><br><span class="line">[ERROR] Re-run Maven using the -X switch to enable full debug logging.</span><br><span class="line">[ERROR]</span><br><span class="line">[ERROR] For more information about the errors and possible solutions, please read the following articles:</span><br><span class="line">[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException</span><br><span class="line">[ERROR]</span><br><span class="line">[ERROR] After correcting the problems, you can resume the build with the command</span><br><span class="line">[ERROR]   mvn &lt;goals&gt; -rf :topology-karaf</span><br></pre></td></tr></table></figure>
<p>这是因为我在另一个terminal里面还开着karaf console，所以导致 maven clean plugin 无法清扫然后编译。关闭console之后，再编译就没有这个问题了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">opendaylight-user@root&gt;bundle:list | grep topology</span><br><span class="line">109 | Active      |  80 | 2013.10.21.10_2-Carbon              | ietf-topology</span><br><span class="line">110 | Active      |  80 | 2013.10.21.10_2-Carbon              | ietf-topology-isis</span><br><span class="line">111 | Active      |  80 | 2013.10.21.10_2-Carbon              | ietf-topology-ospf</span><br><span class="line">112 | Active      |  80 | 2013.10.21.10_2-Carbon              | ietf-topology-l3-unicast-igp</span><br><span class="line">213 | Active      |  80 | 1.5.2.Carbon                        | org.opendaylight.controller.model.model-topology</span><br><span class="line">226 | GracePeriod |  80 | 0.4.2.Carbon                        | topology-lldp-discovery</span><br><span class="line">227 | GracePeriod |  80 | 0.4.2.Carbon                        | topology-manager</span><br><span class="line">229 | Active      |  80 | 0.1.0.SNAPSHOT                      | ODL :: org.opendaylight.topology :: topology-api</span><br><span class="line">230 | GracePeriod |  80 | 0.1.0.SNAPSHOT                      | ODL :: org.opendaylight.topology :: topology-impl</span><br></pre></td></tr></table></figure>
<p>我们注意到，有数个bundle处于<code>GracePeriod</code>状态。该状态的通俗解释是"time out that happens at start up stage". 我们再打开执行： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">opendaylight-user@root&gt;bundle:diag</span><br><span class="line">mdsal-eos-binding-adapter (158)</span><br><span class="line">-------------------------------</span><br><span class="line">Status: GracePeriod</span><br><span class="line">Blueprint</span><br><span class="line">6/16/19 2:27 AM</span><br><span class="line">Missing dependencies:</span><br><span class="line">(objectClass=org.opendaylight.mdsal.binding.dom.codec.api.BindingNormalizedNodeSerializer) (objectClass=org.opendaylight.mdsal.eos.dom.api.DOMEntityOwnershipService)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mdsal-singleton-dom-impl (160)</span><br><span class="line">------------------------------</span><br><span class="line">Status: GracePeriod</span><br><span class="line">Blueprint</span><br><span class="line">6/16/19 2:27 AM</span><br><span class="line">Missing dependencies:</span><br><span class="line">(objectClass=org.opendaylight.mdsal.eos.dom.api.DOMEntityOwnershipService)</span><br><span class="line">(以下省略内容若干)</span><br><span class="line"></span><br><span class="line">org.opendaylight.aaa.aaa-shiro (281)</span><br><span class="line">------------------------------------</span><br><span class="line">Status: GracePeriod</span><br><span class="line">Blueprint</span><br><span class="line">6/16/19 2:28 AM</span><br><span class="line">Missing dependencies:</span><br><span class="line">(objectClass=org.opendaylight.aaa.cert.api.ICertificateManager) (objectClass=org.opendaylight.controller.md.sal.binding.api.DataBroker)</span><br></pre></td></tr></table></figure></p>
<p>看到这些错误顿时觉得头大，毫无思路。毕竟这个命令只能告诉我们有什么错误，但并没有告诉我们进一步的错误信息。我们打开karaf日志文件看下: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">2019-06-16 02:27:27,853 | INFO  | Event Dispatcher | ServiceRecipe                    | 15 - org.apache.aries.blueprint.core - 1.6.1 | Unable to create a proxy object for the service .component-1 defined in bundle org.apache.karaf.deployer.features/3.0.8 with id. Returning the original object instead.</span><br><span class="line">org.apache.aries.proxy.UnableToProxyException: java.lang.ClassFormatError: Duplicate interface name &quot;org/apache/felix/fileinstall/ArtifactListener&quot; in class file Proxy7b9686ca_d0a4_4af2_9328_ec2785aa891b</span><br><span class="line">        at org.apache.aries.proxy.impl.interfaces.ProxyClassLoader.createProxyClass(ProxyClassLoader.java:165)</span><br><span class="line">(以下省略内容若干)</span><br><span class="line">2019-06-16 02:27:49,087 | ERROR | ult-dispatcher-3 | OneForOneStrategy                | 179 - com.typesafe.akka.slf4j - 2.4.18 | IO error: /vagrant/topology/karaf/target/assembly/journal/MANIFEST-000001: Invalid argument</span><br><span class="line">akka.actor.ActorInitializationException: akka://opendaylight-cluster-data/system/akka.persistence.journal.leveldb: exception during creation</span><br><span class="line">        at akka.actor.ActorInitializationException$.apply(Actor.scala:180)[178:com.typesafe.akka.actor:2.4.18]</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">Caused by: org.fusesource.leveldbjni.internal.NativeDB$DBException: IO error: /vagrant/topology/karaf/target/assembly/journal/MANIFEST-000001: Invalid argument</span><br></pre></td></tr></table></figure></p>
<p>日志中这么多错误，让人感觉绝望。这么多bundle没有正确启动，日志里这么多异常信息，感觉真的是无从下手。冷静下来稍微思考之后，经验告诉我，虽然爆出来这么多错误信息，但是最应该关注的其实就是第一次出现错误的地方，很有可能，之后出现的所有的错误都是因为前几错误诱发的。</p>
<p>我发现似乎在虚拟机中, <code>levelDB</code>启动有问题(异常参数)。我就通过谷歌搜索看是否有人遇到过类似问题(不一定是在OpenDaylight开发过程中遇到)。结果还真是大有所获！<code>https://groups.google.com/forum/#!topic/leveldb/MjFwXk6_RgY</code> <code>https://github.com/Level/levelup/issues/222</code>, <code>https://github.com/google/leveldb/issues/281</code></p>
<p>网友们推测，出现上述问题的根源在于Virtualbox文件系统的Bug(并不在于levelDB)。Virtualbox和主机之间创建的共享文件夹使用的<code>vboxvfs</code>文件系统。 这两种解决办法： * 在 non-shared folder 中启动karaf没有这个问题，比如我们把<code>target</code>中生成的类似于<code>karaf.tar.gz</code>的文件解压缩到另一个non-shared文件夹下 启动karaf就没有这种问题了 * 在 <code>Vagrantfile</code> 中挂载共享文件夹的时候，采用<code>nfs</code>文件系统。采用以下语句: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.vm.synced_folder &quot;/your/local/path&quot;, &quot;/home/vagrant/share&quot;, id: &quot;core&quot;, :nfs =&gt; true,  :mount_options   =&gt; [&apos;nolock,vers=3,udp&apos;]</span><br></pre></td></tr></table></figure></p>
<h1 id="安装-odl-sfc-statistics-feature-失败">安装 odl-sfc-statistics feature 失败</h1>
<p>我发现有些 sfc feature 其实是处于 installed状态的。The state of <code>installed</code> means that the bundle is installed but not yet resolved. A bundle is in the INSTALLED state when it has been installed in the Framework but is not or cannot be resolved. The state of <code>Resolved</code> means that the bundle is resolved and is able to be started. A bundle is in the <code>RESOLVED</code> state when the Framework has successfully resolved the bundle's code dependencies.</p>
<p>通过查看 <code>bundle:diag</code>，输出全是跟 Genius 有关： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">opendaylight-user@root&gt;bundle:diag</span><br><span class="line">ODL :: genius :: interfacemanager-api (246)</span><br><span class="line">-------------------------------------------</span><br><span class="line">Status: Installed</span><br><span class="line">Unsatisfied Requirements:</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.genius.infra)(&amp;(version&gt;=0.7.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.genius.interfacemanager.exceptions)&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.genius.interfacemanager.globals)&quot;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">ODL :: genius :: itm-api (248)</span><br><span class="line">------------------------------</span><br><span class="line">Status: Installed</span><br><span class="line">Unsatisfied Requirements:</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.yang.gen.v1.urn.opendaylight.genius.interfacemanager.rev160406)(&amp;(version&gt;=0.7.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.yang.gen.v1.urn.opendaylight.genius.itm.config.rev160406)&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.yang.gen.v1.urn.opendaylight.genius.itm.config.rev160406.itm.config)&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.yang.gen.v1.urn.opendaylight.genius.itm.config.rev160406.vtep.config.schemas)&quot;</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">org.opendaylight.sfc.sfc-genius-utils (368)</span><br><span class="line">-------------------------------------------</span><br><span class="line">Status: Installed</span><br><span class="line">Unsatisfied Requirements:</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.genius.mdsalutil)(&amp;(version&gt;=0.7.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.sfc.genius.util)&quot;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">org.opendaylight.sfc.sfc-openflow-renderer (370)</span><br><span class="line">------------------------------------------------</span><br><span class="line">Status: Installed</span><br><span class="line">Unsatisfied Requirements:</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.sfc.genius.util)(&amp;(version&gt;=0.10.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.sfc.genius.util.appcoexistence)(&amp;(version&gt;=0.10.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.sfc.renderers.openflow.listeners)&quot;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">org.opendaylight.sfc.sfc-scf-openflow (375)</span><br><span class="line">-------------------------------------------</span><br><span class="line">Status: Installed</span><br><span class="line">Unsatisfied Requirements:</span><br><span class="line">osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.sfc.genius.util)(&amp;(version&gt;=0.10.0)(!(version&gt;=1.0.0))))&quot;</span><br><span class="line">osgi.wiring.pack</span><br></pre></td></tr></table></figure></p>
<p>有上述错误信息可以看出，所有的错误均跟 OpenDayLight Genius 有关。继续打开错误日志，会发现如下错误： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">2019-06-16T20:30:39,353 | ERROR | Karaf ssh console user karaf | support.ShellUtil                | 129 - org.apache.karaf.shell.core - 4.2.2 | Exception caught while executing command</span><br><span class="line">org.apache.karaf.features.internal.util.MultiException: Error restarting bundles:</span><br><span class="line">        Could not resolve module: org.opendaylight.genius.mdsalutil-api [250]</span><br><span class="line">  Bundle was not resolved because of a uses contraint violation.</span><br><span class="line">  org.osgi.service.resolver.ResolutionException: Uses constraint violation. Unable to resolve resource org.opendaylight.genius.mdsalutil-api [osgi.identity; osgi.identity=&quot;org.opendaylight.genius.mdsalutil-api&quot;; type=&quot;osgi.bundle&quot;; version:Version=&quot;0.7.0.SNAPSHOT&quot;] because it is exposed to package &apos;javax.annotation&apos; from resources javax.annotation-api [osgi.identity; osgi.identity=&quot;javax.annotation-api&quot;; type=&quot;osgi.bundle&quot;; version:Version=&quot;1.2.0&quot;] and org.eclipse.osgi [osgi.identity; osgi.identity=&quot;org.eclipse.osgi&quot;; type=&quot;osgi.bundle&quot;; version:Version=&quot;3.12.100.v20180210-1608&quot;; singleton:=&quot;true&quot;] via two dependency chains.</span><br><span class="line">...</span><br><span class="line">Chain 1:</span><br><span class="line">  org.opendaylight.genius.mdsalutil-api [osgi.identity; osgi.identity=&quot;org.opendaylight.genius.mdsalutil-api&quot;; type=&quot;osgi.bundle&quot;; version:Version=&quot;0.7.0.SNAPSHOT&quot;]</span><br><span class="line">    import: (&amp;(osgi.wiring.package=javax.annotation)(&amp;(version&gt;=1.2.0)(!(version&gt;=2.0.0))))</span><br><span class="line">...</span><br><span class="line">Chain 2:</span><br><span class="line">  org.opendaylight.genius.mdsalutil-api [osgi.identity; osgi.identity=&quot;org.opendaylight.genius.mdsalutil-api&quot;;</span><br></pre></td></tr></table></figure></p>
<p>我曾经试验过，如果不安装这个feature的话， <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bundle:list</span><br><span class="line">368 ? Active   ?  80 ? 0.10.0.SNAPSHOT                        ? org.opendaylight.sfc.sfc-genius-utils</span><br><span class="line">369 ? Active   ?  80 ? 0.10.0.SNAPSHOT                        ? org.opendaylight.sfc.sfc-model</span><br><span class="line">370 ? Active   ?  80 ? 0.10.0.SNAPSHOT                        ? org.opendaylight.sfc.sfc-openflow-renderer</span><br><span class="line">371 ? Active   ?  80 ? 0.10.0.SNAPSHOT                        ? org.opendaylight.sfc.sfc-openflow-utils</span><br><span class="line">372 ? Active   ?  80 ? 0.10.0.SNAPSHOT                        ? org.opendaylight.sfc.sfc-ovs</span><br><span class="line">373 ? Active   ?  80 ? 0.10.0.SNAPSHOT                        ? org.opendaylight.sfc.sfc-provider</span><br><span class="line">374 ? Active   ?  80 ? 0.10.0.SNAPSHOT                        ? org.opendaylight.sfc.sfc-sb-rest</span><br><span class="line">375 ? Active   ?  80 ? 0.10.0.SNAPSHOT                        ? org.opendaylight.sfc.sfc-scf-openflow</span><br></pre></td></tr></table></figure></p>
<p>所有的bundle都是active状态，<code>bundle:diag</code> has no error information. We are sure that installation of <code>odl-sfc-statistics</code> lead to error, render bundle such as <code>org.opendaylight.sfc.sfc-genius-utils</code> and <code>org.opendaylight.sfc.sfc-scf-openflow</code> into state of <code>installed</code>.</p>
<p>最后终于找到原因了： &gt; The dependent features would result in bundle refresh which could lead to bundle resolution problems and it is recommended to install the features together (feature:install x y z...rather than feature:install x feaure:install y so on) in karaf 4.0 (which is being used in Oxygen,ie,0.8)</p>
<p>https://docs.opendaylight.org/en/stable-oxygen/release-notes/projects/distribution.html#known-issues https://jira.opendaylight.org/browse/OPNFLWPLUG-1029</p>
<p>此外只要重启karaf进程，之前安装的feature就不存在了。。。而且虽然我使用java11运行ODL 但对结果并没影响。</p>
<p>此时执行: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant@odl:/vagrant$ curl -i -H &quot;Content-Type: application/json&quot; -H &quot;Cache-Control: no-cache&quot; --data &apos;&#123; &quot;input&quot;: &#123; &#125; &#125;&apos; -X POST --user admin:admin http://localhost:8181/restconf/operations/sfc-statistics-operations:get-rsp-statistics</span><br></pre></td></tr></table></figure></p>
<p>得到回复： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Set-Cookie: JSESSIONID=node01t7wy9hmts7paqj22cwr5tpjq10.node0;Path=/</span><br><span class="line">Expires: Thu, 01 Jan 1970 00:00:00 GMT</span><br><span class="line">Set-Cookie: rememberMe=deleteMe; Path=/; Max-Age=0; Expires=Sun, 16-Jun-2019 13:36:49 GMT</span><br><span class="line">Content-Type: application/yang.operation+json</span><br><span class="line">Content-Length: 365</span><br><span class="line"></span><br><span class="line">&#123;&quot;output&quot;:&#123;&quot;statistics&quot;:[&#123;&quot;name&quot;:&quot;SFP1-Path-1&quot;,&quot;statistic-by-timestamp&quot;:[&#123;&quot;timestamp&quot;:1560778609224,&quot;service-statistic&quot;:&#123;&quot;packets-in&quot;:10,&quot;packets-out&quot;:10,&quot;bytes-out&quot;:1750,&quot;bytes-in&quot;:1360&#125;&#125;]&#125;,&#123;&quot;name&quot;:&quot;SFP1-Path-1-Reverse&quot;,&quot;statistic-by-timestamp&quot;:[&#123;&quot;timestamp&quot;:1560778609228,&quot;service-statistic&quot;:&#123;&quot;packets-in&quot;:8,&quot;packets-out&quot;:8,&quot;bytes-out&quot;:1673,&quot;bytes-in&quot;:1088&#125;&#125;]&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="扩展-yang-data-model">扩展 YANG data model</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">sending service function chains</span><br><span class="line">PUT http://192.168.1.5:8181/restconf/config/service-function-chain:service-function-chains/</span><br><span class="line">&#123;</span><br><span class="line">    &quot;service-function-chains&quot;: &#123;</span><br><span class="line">        &quot;service-function-chain&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;name&quot;: &quot;SFC1&quot;,</span><br><span class="line">                &quot;sfc-service-function&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;name&quot;: &quot;dpi-abstract1&quot;,</span><br><span class="line">                        &quot;type&quot;: &quot;dpi&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;name&quot;: &quot;firewall-abstract1&quot;,</span><br><span class="line">                        &quot;type&quot;: &quot;firewall&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                &quot;sig-gen-param&quot;: &quot;type a\nq 8780710799663312522437781984754049815806883199414208211028653399266475630880222957078625179422662221423155858769582317459277713367317481324925129998224791\nh 12016012264891146079388821366740534204802954401251311822919615131047207289359704531102844802183906537786776\nr 730750818665451621361119245571504901405976559617\nexp2 159\nexp1 107\nsign1 1\nsign0 1&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;&quot;errors&quot;:&#123;&quot;error&quot;:[&#123;&quot;error-type&quot;:&quot;protocol&quot;,&quot;error-tag&quot;:&quot;malformed-message&quot;,&quot;error-message&quot;:&quot;Error parsing input: Schema node with name sig-gen-param was not found under (urn:cisco:params:xml:ns:yang:sfc-sfc?revision=2014-07-01)service-function-chain.&quot;,&quot;error-info&quot;:&quot;Schema node with name sig-gen-param was not found under (urn:cisco:params:xml:ns:yang:sfc-sfc?revision=2014-07-01)service-function-chain.&quot;&#125;]&#125;&#125;</span><br><span class="line">HTTP PUT /restconf/config/service-function-chain:service-function-chains/</span><br><span class="line">result: 400</span><br></pre></td></tr></table></figure>
<p>原因是，我编译之后，很愚蠢地忘记将编译好的文件移动到$HOME/sfc/karaf/target/assembly文件夹下面了。所以在demo中执行的karaf中并没有最新的Yang model...</p>
<h1 id="启动karaf-安装sfc-feature-报错">启动karaf 安装sfc feature 报错！</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">opendaylight-user@root&gt;feature:install odl-sfc-model odl-sfc-provider-rest odl-sfc-sb-rest odl-sfc-openflow-renderer odl-sfc-scf-openflow odl-sfc-ovs odl-sfc-statistics</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve root: missing requirement [root] osgi.identity; osgi.identity=odl-sfc-ovs; type=karaf.feature; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; filter:=&quot;(&amp;(osgi.identity=odl-sfc-ovs)(type=karaf.feature)(version&gt;=0.10.0.SNAPSHOT)(version&lt;=0.10.0.SNAPSHOT))&quot; [caused by: Unable to resolve odl-sfc-ovs/0.10.0.SNAPSHOT: missing requirement [odl-sfc-ovs/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=odl-ovsdb-southbound-impl; type=karaf.feature; version=&quot;[1.9.0.SNAPSHOT,1.9.0.SNAPSHOT]&quot; [caused by: Unable to resolve odl-ovsdb-southbound-impl/1.9.0.SNAPSHOT: missing requirement [odl-ovsdb-southbound-impl/1.9.0.SNAPSHOT] osgi.identity; osgi.identity=odl-ovsdb-library; type=karaf.feature; version=&quot;[1.9.0.SNAPSHOT,1.9.0.SNAPSHOT]&quot; [caused by: Unable to resolve odl-ovsdb-library/1.9.0.SNAPSHOT: missing requirement [odl-ovsdb-library/1.9.0.SNAPSHOT] osgi.identity; osgi.identity=odl-aaa-cert; type=karaf.feature; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot; [caused by: Unable to resolve odl-aaa-cert/0.10.0.SNAPSHOT: missing requirement [odl-aaa-cert/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.aaa.cert; type=osgi.bundle; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; resolution:=mandatory [caused by: Unable to resolve org.opendaylight.aaa.cert/0.10.0.SNAPSHOT: missing requirement [org.opendaylight.aaa.cert/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.mdsal.binding.api)(version&gt;=3.0.0)(!(version&gt;=4.0.0)))&quot;]]]]]</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.doResolve(ResolverImpl.java:392)</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:378)</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:332)</span><br><span class="line">    at org.apache.karaf.features.internal.region.SubsystemResolver.resolve(SubsystemResolver.java:257)</span><br><span class="line">    at org.apache.karaf.features.internal.service.Deployer.deploy(Deployer.java:388)</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.doProvision(FeaturesServiceImpl.java:1025)</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.lambda$doProvisionInThread$13(FeaturesServiceImpl.java:964)</span><br><span class="line">    at java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">    at java.lang.Thread.run(Thread.java:748)</span><br><span class="line">Caused by: org.apache.felix.resolver.reason.ReasonException: Unable to resolve odl-sfc-ovs/0.10.0.SNAPSHOT: missing requirement [odl-sfc-ovs/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=odl-ovsdb-southbound-impl; type=karaf.feature; version=&quot;[1.9.0.SNAPSHOT,1.9.0.SNAPSHOT]&quot; [caused by: Unable to resolve odl-ovsdb-southbound-impl/1.9.0.SNAPSHOT: missing requirement [odl-ovsdb-southbound-impl/1.9.0.SNAPSHOT] osgi.identity; osgi.identity=odl-ovsdb-library; type=karaf.feature; version=&quot;[1.9.0.SNAPSHOT,1.9.0.SNAPSHOT]&quot; [caused by: Unable to resolve odl-ovsdb-library/1.9.0.SNAPSHOT: missing requirement [odl-ovsdb-library/1.9.0.SNAPSHOT] osgi.identity; osgi.identity=odl-aaa-cert; type=karaf.feature; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot; [caused by: Unable to resolve odl-aaa-cert/0.10.0.SNAPSHOT: missing requirement [odl-aaa-cert/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.aaa.cert; type=osgi.bundle; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; resolution:=mandatory [caused by: Unable to resolve org.opendaylight.aaa.cert/0.10.0.SNAPSHOT: missing requirement [org.opendaylight.aaa.cert/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=org.opendaylight.mdsal.binding.api)(version&gt;=3.0.0)(!(version&gt;=4.0.0)))&quot;]]]]</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br></pre></td></tr></table></figure>
<h1 id="删除.m2repository所有内容之后编译反而无法通过了">删除.m2/repository所有内容之后，编译反而无法通过了。。。</h1>
<p>神奇！我执行 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin master</span><br></pre></td></tr></table></figure></p>
<p>最后居然没有改变我在我本地端的改变，只获取了我没有动过的文件的update...</p>
<p>更神奇的是，我本地端还有修改还没有git add/git commit呢，结果上述命令直接把我origin弄下来的更新 merge/add/commit了！！！</p>
<p>可能是，我修改过的代码，远程端的文件压根没有改变过，所以git认为我本地的改变更新？ 没有出现，origin从方向1改变，而我朝方向2改变，这就没有构成冲突？？</p>
<p>最后顺利编译通过，没有错误，运行起来也没有任何错误，demo 也顺利执行了！神奇！！！</p>
<h1 id="清空了sfckaraftargetassembly文件之后将新编译好的文件解压之后直接放在这里当试图去关闭karaf进程的时候会出现无法关闭的情况-失败的信息非常的奇怪第一个错误提示的应该是karaf-console-shell-ssh进程无法被连接上">清空了sfc/karaf/target/assembly文件之后，将新编译好的文件解压之后直接放在这里，当试图去关闭karaf进程的时候，会出现无法关闭的情况 失败的信息非常的奇怪，第一个错误提示的应该是karaf console shell ssh进程无法被连接上。</h1>
<h1 id="为什么要同时有-service-function-chain-service-function-paths-rendered-service-paths-三种概念">为什么要同时有 service-function-chain, service-function-paths, rendered-service-paths 三种概念？</h1>
<p>这三种概念一层比一层递进 为什么会有这种设计？？</p>
<h1 id="section"></h1>
<p>org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI 实际负责具体的RSP的创建 我需要在这个类里做具体扩展</p>
<h1 id="section-1"></h1>
<p>在编译sfc项目的时候，子项目sfc-provider出了问题，改正错误之后，采用命令 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn dependency:go-offline -rf sfc-provider install -nsu -DskipTests</span><br></pre></td></tr></table></figure></p>
<p>编译安装，但是最后发现karaf启动异常，疑似出现data model缺失的情况，我怀疑可能是之前我可能执行过 <code>mvn clean</code> 之类的东西。</p>
<h1 id="section-2"></h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[INFO] --- spotbugs-maven-plugin:3.1.11:check (analyze-compile) @ sfc-provider ---</span><br><span class="line">[INFO] BugInstance size is 1</span><br><span class="line">[INFO] Error size is 0</span><br><span class="line">[INFO] Total bugs: 1</span><br><span class="line">[ERROR] Dead store to sfServicePathList in org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI.createRenderedServicePathEntry(ServiceFunctionPath, String, SfcServiceFunctionSchedulerAPI) [org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI] At SfcProviderRenderedPathAPI.java:[line 500] DLS_DEAD_LOCAL_STORE</span><br><span class="line">[INFO]</span><br></pre></td></tr></table></figure>
<p>在编译的时候，之所以会报这个错误，是因为定义与赋值之后的变量 sfServicePathList 在后续根本没有被调用过。</p>
<h1 id="python-process-中-如何重启-thread">Python process 中 如何重启 thread?</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">INFO:sfc/sfc_agent.py:Received request for SF creation: dpi-1</span><br><span class="line">INFO:sfc/sfc_agent.py:Received request from ODL to create SF. local_sf_topo content is: &#123;&apos;dpi-1&apos;: &#123;&apos;name&apos;: &apos;dpi-1&apos;, &apos;sf-data-plane-locator&apos;: [&#123;&apos;ip&apos;: &apos;192.168.1.11&apos;, &apos;port&apos;: 6633, &apos;service-function-forwarder&apos;: &apos;SFF1&apos;, &apos;name&apos;: &apos;dpi-1-dpl&apos;, &apos;transport&apos;: &apos;service-locator:vxlan-gpe&apos;&#125;], &apos;ip-mgmt-address&apos;: &apos;192.168.1.11&apos;, &apos;type&apos;: &apos;service-function-type:dpi&apos;, &apos;rest-uri&apos;: &apos;http://192.168.1.11:5000&apos;&#125;&#125;</span><br><span class="line">INFO:sfc.common.launcher:Starting Service Function: dpi-1</span><br><span class="line">ERROR:__main__:Exception on /config/service-function:service-functions/service-function/dpi-1 [PUT]</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/usr/local/lib/python3.5/dist-packages/flask/app.py&quot;, line 1817, in wsgi_app</span><br><span class="line">    response = self.full_dispatch_request()</span><br><span class="line">  File &quot;/usr/local/lib/python3.5/dist-packages/flask/app.py&quot;, line 1477, in full_dispatch_request</span><br><span class="line">    rv = self.handle_user_exception(e)</span><br><span class="line">  File &quot;/usr/local/lib/python3.5/dist-packages/flask/app.py&quot;, line 1381, in handle_user_exception</span><br><span class="line">    reraise(exc_type, exc_value, tb)</span><br><span class="line">  File &quot;/usr/local/lib/python3.5/dist-packages/flask/_compat.py&quot;, line 33, in reraise</span><br><span class="line">    raise value</span><br><span class="line">  File &quot;/usr/local/lib/python3.5/dist-packages/flask/app.py&quot;, line 1475, in full_dispatch_request</span><br><span class="line">    rv = self.dispatch_request()</span><br><span class="line">  File &quot;/usr/local/lib/python3.5/dist-packages/flask/app.py&quot;, line 1461, in dispatch_request</span><br><span class="line">    return self.view_functions[rule.endpoint](**req.view_args)</span><br><span class="line">  File &quot;sfc/sfc_agent.py&quot;, line 303, in create_sf</span><br><span class="line">    start_sf(sfname, sf_ip, sf_port, sf_type)</span><br><span class="line">  File &quot;/sfc/sfc-py/sfc/common/launcher.py&quot;, line 229, in start_sf</span><br><span class="line">    stop_service(sf_type, sf_name)</span><br><span class="line">  File &quot;/sfc/sfc-py/sfc/common/launcher.py&quot;, line 209, in stop_service</span><br><span class="line">    (service_type.upper(), service_name))</span><br><span class="line">TimeoutError: Failed to stop DPI &quot;dpi-1&quot;: service thread is still running after 10s</span><br><span class="line">INFO:werkzeug:192.168.1.5 - - [19/Jun/2019 20:26:51] &quot;PUT /config/service-function:service-functions/service-function/dpi-1 HTTP/1.1&quot; 500 -</span><br></pre></td></tr></table></figure>
<h1 id="section-3"></h1>
<p><code>sfc_agent.py</code> 启动以后，一个flask app 也随之被驱动，支持RESTFul API。比如service function 的创建，就是在收到<code>http:&lt;sf-ip-addr&gt;:6000/config/service-function:service-functions/service-function/&lt;sfname&gt;</code> 根据传递而来的JSON文件而创建(在进程中创建一个新 Thread)的。也即是，在一个service node上，<code>sfc_agent.py</code> 起到了一个前端proxy的作用，而随后创建的service funciton 其实只是一个运行在该进程中的一个 thread.</p>
<p>如果希望 service function 后续可以收到关于OMS加密的一些参数，那么需要注意: * 收到RESTFul API的时候，最好是在原有 Thread 不能停止运行的情况下，将 OMS 相关的参数传递给对应的 Thread. 实在不行 那就先kill掉，再创建一个新的 Thread。这么做的话，这个重启thread的速度需要尽量的快。比如一个 SFC 有变化，势必会诱发 OMS 参数的重新计算以及重新分配 (这样的话 一定要有DataChange event发生！相关的参数一定要写到DataStore里, 哪怕只写一个都行。。。) 如果一个SF只参与了一个SFC 且这个链条发生了变化，那么即使代表SF的thread重启了也没有关系，但是如果一个SF同时参与多个链条，那么这个时候SF需要重启可能就会对既有的SFC产生影响。。。</p>
<h1 id="section-4"></h1>
<p>SfcProviderServiceFunctionAPI 这个类中提供了方法: readServiceFunction 这个方法是向SfcDataStore中读取 ServiceFunction 对象出来的！！！而且我们看到, 在DataStore tree上，其母节点为 ServiceFunctions!!!</p>
<h1 id="section-5"></h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">2019-06-20T01:30:26,046 | ERROR | opendaylight-cluster-data-notification-dispatcher-41 | DataTreeChangeListenerActor      | org.opendaylight.controller.sal-clustering-commons | dataChanged(:83): member-1-shard-default-config: Error notifying listener org.opendaylight.sfc.provider.listeners.ServiceFunctionPathListener@48c28b2</span><br><span class="line">java.lang.NullPointerException: null</span><br><span class="line">        at org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI.createRenderedServicePathEntry(SfcProviderRenderedPathAPI.java:514) ~[379:org.opendaylight.sfc.provider:0.10.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI.createRenderedServicePathInConfig(SfcProviderRenderedPathAPI.java:143) ~[379:org.opendaylight.sfc.provider:0.10.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI.createRenderedServicePathInConfig(SfcProviderRenderedPathAPI.java:137) ~[379:org.opendaylight.sfc.provider:0.10.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.sfc.provider.listeners.ServiceFunctionPathListener.add(ServiceFunctionPathListener.java:54) ~[379:org.opendaylight.sfc.provider:0.10.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.sfc.provider.listeners.ServiceFunctionPathListener.add(ServiceFunctionPathListener.java:36) ~[379:org.opendaylight.sfc.provider:0.10.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.serviceutils.tools.mdsal.listener.DataTreeChangeListenerActions.onDataTreeChanged(DataTreeChangeListenerActions.java:67) ~[372:org.opendaylight.serviceutils.tools-api:0.4.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.serviceutils.tools.mdsal.listener.AbstractSyncDataTreeChangeListener.onDataTreeChanged(AbstractSyncDataTreeChangeListener.java:52) ~[372:org.opendaylight.serviceutils.tools-api:0.4.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.controller.md.sal.binding.impl.BindingDOMDataTreeChangeListenerAdapter.onDataTreeChanged(BindingDOMDataTreeChangeListenerAdapter.java:42) ~[225:org.opendaylight.controller.sal-binding-broker-impl:1.10.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.controller.sal.core.compat.AbstractLegacyDOMDataBrokerAdapter$ProxyListener.onDataTreeChanged(AbstractLegacyDOMDataBrokerAdapter.java:359) ~[235:org.opendaylight.controller.sal-core-compat:1.10.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.controller.cluster.datastore.DataTreeChangeListenerActor.dataChanged(DataTreeChangeListenerActor.java:81) ~[237:org.opendaylight.controller.sal-distributed-datastore:1.10.0.SNAPSHOT]</span><br><span class="line">        at org.opendaylight.controller.cluster.datastore.DataTreeChangeListenerActor.handleReceive(DataTreeChangeListenerActor.java:42) ~[237:org.opendaylight.controller.sal-distributed-datastore:1.10.0.SNAPSHOT]</span><br></pre></td></tr></table></figure>
<p><code>java.lang.NullPointerException: null at org.opendaylight.sfc.provider.api.SfcProviderRenderedPathAPI.createRenderedServicePathEntry(sfcProviderRenderedPathAPI.java:514)</code> 仔细观察这个信息，你会发现，这是一个java coding过程中很常见的一个错误信息。原因是想访问一个并没有被创建的对象。</p>
<h1 id="如何添加并没有被-maven-repository-的jar文件">如何添加并没有被 <code>Maven repository</code> 的jar文件？</h1>
<p>Many Java applications have dependencies that aren’t available in a public or private Maven repository. Sometimes you may have just a third party java library, packaged as a jar, that you need to put in your local repository for use in your builds. This is a very common scenario.</p>
<p>chagne to the uncompressed file of jPBC project, and type the following command respectively for <code>jpbc-api-2.0.0.jar</code> and <code>jpbc-plaf-2.0.0.jar</code>. The installation order matters, because <code>jpbc-plaf-2.0.0.jar</code> has a dependency relationship on <code>jpbc-api-2.0.0.jar</code>. I on We observe the following output and confirm that these two<br>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn install:install-file -Dfile=&lt;path-to-file&gt; -DpomFile=&lt;path-to-pomfile&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[INFO] --- maven-install-plugin:2.4:install-file (default-cli) @ jpbc ---</span><br><span class="line">[INFO] Installing /home/qsong/Documents/jpbc-2.0.0/jars/jpbc-plaf-2.0.0.jar to /home/qsong/.m2/repository/it/unisa/dia/gas/jpbc-plaf/2.0.0/jpbc-plaf-2.0.0.jar</span><br><span class="line">[INFO] Installing /home/qsong/Documents/jpbc-2.0.0/jpbc-plaf/pom.xml to /home/qsong/.m2/repository/it/unisa/dia/gas/jpbc-plaf/2.0.0/jpbc-plaf-2.0.0.pom</span><br></pre></td></tr></table></figure>
<p>还遇到了一个问题。。。解决方案： https://stackoverflow.com/questions/1355548/maven-including-jar-not-found-in-public-repository 大意就是 我们需要在依赖声明中，将某个jar文件的scope声明成system, 同时必须给出systemPath的属性，指明需要使用的jar文件的路径。 参考文献： 1. https://maven.apache.org/guides/mini/guide-3rd-party-jars-local.html 2. https://stackoverflow.com/questions/4955635/how-to-add-local-jar-files-to-a-maven-project 3. https://cleanprogrammer.net/adding-3rd-party-jar-to-maven-projects/</p>
<h1 id="还是添加第三方java-jar问题">还是添加第三方java jar问题</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[INFO] Running org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 26.15 s &lt;&lt;&lt; FAILURE! - in org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] installFeatureCatchAndLog(org.opendaylight.odlparent.featuretest.SingleFeatureTest)[repoUrl: file:/home/qsong/Documents/sfc-patch/features/odl-sfc-provider/target/feature/feature.xml, Feature: odl-sfc-provider 0.10.0.SNAPSHOT]  Time elapsed: 23.92 s  &lt;&lt;&lt; ERROR!</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve org.opendaylight.sfc.provider/0.10.0.SNAPSHOT: missing requirement [org.opendaylight.sfc.provider/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=&quot;(osgi.wiring.package=it.unisa.dia.gas.jpbc)&quot;</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br></pre></td></tr></table></figure>
<p>我最后将jpbc project编译成bundle, 并且不用scop以及systemPath之后 (Using system scope may work but it is not recommended even in the Maven specification. it is not portable.)，编译出现这个错误！ <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 30.51 s &lt;&lt;&lt; FAILURE! - in org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] installFeatureCatchAndLog(org.opendaylight.odlparent.featuretest.SingleFeatureTest)[repoUrl: file:/home/qsong/Documents/sfc-patch/features/odl-sfc-provider/target/feature/feature.xml, Feature: odl-sfc-provider 0.10.0.SNAPSHOT]  Time elapsed: 28.683 s  &lt;&lt;&lt; ERROR!</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve org.opendaylight.sfc.provider/0.10.0.SNAPSHOT: missing requirement [org.opendaylight.sfc.provider/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=it.unisa.dia.gas.jpbc)(version&gt;=2.0.0)(!(version&gt;=3.0.0)))&quot;</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br></pre></td></tr></table></figure></p>
<p>为啥会出现 <code>version&gt;=3.0.0</code>? 我怀疑原因是我在 <code>features/odl-sfc-provider</code> 这个文件下的 <code>pom.xml</code> 中指明了scope=system以及systemPath的。取消了这两项之后，虽然还是报错，内容如下: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 33.486 s &lt;&lt;&lt; FAILURE! - in org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] installFeatureCatchAndLog(org.opendaylight.odlparent.featuretest.SingleFeatureTest)[repoUrl: file:/home/qsong/Documents/sfc-patch/features/odl-sfc-provider/target/feature/feature.xml, Feature: odl-sfc-provider 0.10.0.SNAPSHOT]  Time elapsed: 26.74 s  &lt;&lt;&lt; ERROR!</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve org.opendaylight.sfc.provider/0.10.0.SNAPSHOT: missing requirement [org.opendaylight.sfc.provider/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=&quot;(osgi.wiring.package=it.unisa.dia.gas.plaf.jpbc.pairing)&quot;</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br></pre></td></tr></table></figure></p>
<p>这次找不到的是<code>it.unisa.dia.gas.plaf.jpbc.pairing</code>了 而不再是找不到 <code>it.unisa.dia.gas.plaf.jpbc</code> 了。</p>
<p>当我把 <code>features/odl-sfc-provider/pom.xml</code> 中关于 <code>sfc-jpbc</code>的依赖都删除之后，再编译错误又不一样了。。。首先，这个文件中确实不应该出现关于<code>sfc-jpbc</code>的依赖，因为正常的话，<code>sfc-jpbc</code>已经被收录进<code>sfc-provider</code>中了，而依赖 <code>sfc-provider</code> 已经在 <code>features/odl-sfc-provider/pom.xml</code> 声明过了。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">INFO] Running org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 27.418 s &lt;&lt;&lt; FAILURE! - in org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] installFeatureCatchAndLog(org.opendaylight.odlparent.featuretest.SingleFeatureTest)[repoUrl: file:/home/qsong/Documents/sfc-patch/features/odl-sfc-provider/target/feature/feature.xml, Feature: odl-sfc-provider 0.10.0.SNAPSHOT]  Time elapsed: 23.186 s  &lt;&lt;&lt; ERROR!</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve it.unisa.dia.gas.jpbc-plaf/2.0.0: missing requirement [it.unisa.dia.gas.jpbc-plaf/2.0.0] osgi.wiring.package; filter:=&quot;(osgi.wiring.package=it.unisa.dia.gas.plaf.jpbc.mm.clt13.pairing)&quot;</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INFO] Running org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 31.129 s &lt;&lt;&lt; FAILURE! - in org.opendaylight.odlparent.featuretest.SingleFeatureTest</span><br><span class="line">[ERROR] installFeatureCatchAndLog(org.opendaylight.odlparent.featuretest.SingleFeatureTest)[repoUrl: file:/home/qsong/Documents/sfc-patch/features/odl-sfc-provider/target/feature/feature.xml, Feature: odl-sfc-provider 0.10.0.SNAPSHOT]  Time elapsed: 29.362 s  &lt;&lt;&lt; ERROR!</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve it.unisa.dia.gas.jpbc-plaf/2.0.0: missing requirement [it.unisa.dia.gas.jpbc-plaf/2.0.0] osgi.wiring.package; filter:=&quot;(osgi.wiring.package=it.unisa.dia.gas.plaf.jpbc.mm.clt13.pairing)&quot;</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343)</span><br></pre></td></tr></table></figure>
<h1 id="编译过程中出现-packetprocessingservice-找不到的情况">编译过程中出现 <code>PacketProcessingService</code> 找不到的情况</h1>
<ol type="1">
<li>https://yinqingwang.wordpress.com/2016/11/14/how-to-send-raw-packet-from-odls-controller-to-network-datapath/</li>
<li>https://ask.opendaylight.org/question/3872/opendaylight-plugin-send-packet-from-given-switch-and-given-port/</li>
<li>https://github.com/opendaylight/openflowplugin/blob/master/model/model-flow-service/src/main/yang/packet-processing.yang</li>
</ol>
<p>通过以上几个链接可以只知道，这个<code>PacketProcessingService</code> 接口实际上是在项目 <code>openflowplugin</code> 中的 <code>model</code> 中定义的。如果需要import这个接口，需要在我定义的项目的<code>pom.xml</code>文件中，添加如下依赖： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.opendaylight.openflowplugin.model&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;model-flow-service&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;$&#123;feature.openflowplugin.version&#125;&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="blueprint-文件编写有误">Blueprint 文件编写有误</h1>
<p>编译完毕，启动<code>karaf</code>, <code>features</code> 被安装完毕之后，执行 <code>bundle:diag</code>, 发现如下问题： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">opendaylight-user@root&gt;bundle:diag</span><br><span class="line">org.opendaylight.sfc.sfc-sfp-checker (386)</span><br><span class="line">------------------------------------------</span><br><span class="line">Status: Failure</span><br><span class="line">Declarative Services</span><br><span class="line">Blueprint</span><br><span class="line">7/2/19, 10:37 AM</span><br><span class="line">Exception:</span><br><span class="line">Unresolved ref/idref to component: delaycollectorConfig</span><br><span class="line">org.osgi.service.blueprint.container.ComponentDefinitionException: Unresolved ref/idref to component: delaycollectorConfig</span><br><span class="line">    at org.apache.aries.blueprint.container.BlueprintRepository.validate(BlueprintRepository.java:376)</span><br><span class="line">    at org.apache.aries.blueprint.container.RecipeBuilder.createRepository(RecipeBuilder.java:94)</span><br><span class="line">    at org.apache.aries.blueprint.container.BlueprintContainerImpl.getRepository(BlueprintContainerImpl.java:504)</span><br><span class="line">    at org.apache.aries.blueprint.container.BlueprintContainerImpl.doRun(BlueprintContainerImpl.java:361)</span><br><span class="line">    at org.apache.aries.blueprint.container.BlueprintContainerImpl.run(BlueprintContainerImpl.java:278)</span><br><span class="line">    at org.apache.aries.blueprint.container.BlueprintExtender.createContainer(BlueprintExtender.java:299)</span><br><span class="line">    at org.apache.aries.blueprint.container.BlueprintExtender.createContainer(BlueprintExtender.java:268)</span><br><span class="line">    at org.apache.aries.blueprint.container.BlueprintExtender.createContainer(BlueprintExtender.java:264)</span><br><span class="line">    at org.apache.aries.blueprint.container.BlueprintExtender.modifiedBundle(BlueprintExtender.java:254)</span><br><span class="line">    at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.customizerModified(BundleHookBundleTracker.java:500)</span><br><span class="line">    at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.customizerModified(BundleHookBundleTracker.java:433)</span><br><span class="line">    at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$AbstractTracked.track(BundleHookBundleTracker.java:725)</span><br><span class="line">    at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.bundleChanged(BundleHookBundleTracker.java:463)</span><br><span class="line">    at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$BundleEventHook.event(BundleHookBundleTracker.java:422)</span><br><span class="line">    at org.eclipse.osgi.internal.framework.EquinoxEventPublisher$2.call(EquinoxEventPublisher.java:239)</span><br><span class="line">    at org.eclipse.osgi.internal.serviceregistry.ServiceRegistry.notifyHookPrivileged(ServiceRegistry.java:1298)</span><br><span class="line">    at org.eclipse.osgi.internal.serviceregistry.ServiceRegistry.notifyHooksPrivileged(ServiceRegistry.java:1278)</span><br><span class="line">    at org.eclipse.osgi.internal.framework.EquinoxEventPublisher.notifyEventHooksPrivileged(EquinoxEventPublisher.java:236)</span><br><span class="line">    at org.eclipse.osgi.internal.framework.EquinoxEventPublisher.publishBundleEventPrivileged(EquinoxEventPublisher.java:194)</span><br><span class="line">    at org.eclipse.osgi.internal.framework.EquinoxEventPublisher.publishBundleEvent(EquinoxEventPublisher.java:120)</span><br><span class="line">    at org.eclipse.osgi.internal.framework.EquinoxEventPublisher.publishBundleEvent(EquinoxEventPublisher.java:112)</span><br><span class="line">    at org.eclipse.osgi.internal.framework.EquinoxContainerAdaptor.publishModuleEvent(EquinoxContainerAdaptor.java:168)</span><br><span class="line">    at org.eclipse.osgi.container.Module.publishEvent(Module.java:476)</span><br><span class="line">    at org.eclipse.osgi.container.Module.start(Module.java:467)</span><br><span class="line">    at org.eclipse.osgi.internal.framework.EquinoxBundle.start(EquinoxBundle.java:383)</span><br><span class="line">    at org.eclipse.osgi.internal.framework.EquinoxBundle.start(EquinoxBundle.java:402)</span><br><span class="line">    at org.apache.karaf.features.internal.service.BundleInstallSupportImpl.startBundle(BundleInstallSupportImpl.java:161)</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.startBundle(FeaturesServiceImpl.java:1116)</span><br><span class="line">    at org.apache.karaf.features.internal.service.Deployer.deploy(Deployer.java:997)</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.doProvision(FeaturesServiceImpl.java:1025)</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.lambda$doProvisionInThread$13(FeaturesServiceImpl.java:964)</span><br><span class="line">    at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)</span><br><span class="line">    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)</span><br><span class="line">    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)</span><br><span class="line">    at java.base/java.lang.Thread.run(Thread.java:834)</span><br></pre></td></tr></table></figure></p>
<p>我自己编写的 SDN app 并没有顺利启动，说是 Unresolved ref/idref to component: delaycollectorConfig, 就是我写的 application 的配置类并没有被找到。从 Exception trace 来看，并没有提示是哪个class/method出的问题(不过从异常 org.osgi.service.blueprint.container.ComponentDefinitionException 来看，问题应该出在blueprint文件中)。我只能通过 grep + 关键词查找了，定位到了问题：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;blueprint xmlns=&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot; xmlns:odl=&quot;http://opendaylight.org/xmlns/blueprint/v1.0.0&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;reference id=&quot;dataBroker&quot;</span><br><span class="line">    interface=&quot;org.opendaylight.controller.md.sal.binding.api.DataBroker&quot;</span><br><span class="line">    odl:type=&quot;default&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;odl:clustered-app-config id=&quot;pathCheckerConfig&quot;</span><br><span class="line">      binding-class=&quot;org.opendaylight.yang.gen.v1.urn.opendaylight.sfc.sfp.checker.config.rev190701.SfpCheckerConfig&quot;&gt;</span><br><span class="line">&lt;/odl:clustered-app-config&gt;</span><br><span class="line"></span><br><span class="line">&lt;reference id=&quot;notificationProviderService&quot; interface=&quot;org.opendaylight.controller.sal.binding.api.NotificationProviderService&quot;/&gt;  </span><br><span class="line"></span><br><span class="line">&lt;odl:rpc-service id=&quot;mypacketHandlerService&quot;</span><br><span class="line">    interface=&quot;org.opendaylight.yang.gen.v1.urn.opendaylight.packet.service.rev130709.PacketProcessingService&quot; /&gt;</span><br><span class="line">  </span><br><span class="line">&lt;reference id=&quot;rpcRegistry&quot;</span><br><span class="line">     interface=&quot;org.opendaylight.controller.sal.binding.api.RpcProviderRegistry&quot; /&gt;</span><br><span class="line">  </span><br><span class="line">&lt;bean id=&quot;provider&quot;</span><br><span class="line">    class=&quot;org.opendaylight.sfc.pathchecker.SfpCheckerProvider&quot;</span><br><span class="line">    init-method=&quot;init&quot; destroy-method=&quot;close&quot;&gt;</span><br><span class="line">    &lt;argument ref=&quot;dataBroker&quot; /&gt;</span><br><span class="line">    &lt;argument ref=&quot;delaycollectorConfig&quot; /&gt;</span><br><span class="line">    &lt;argument ref=&quot;notificationProviderService&quot; /&gt;</span><br><span class="line">    &lt;argument ref=&quot;mypacketHandlerService&quot; /&gt;</span><br><span class="line">    &lt;argument ref=&quot;rpcRegistry&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;/blueprint&gt;</span><br></pre></td></tr></table></figure>
<p>原来是我实例化 <code>bean id="rpcRegistry"</code>, 在argument处给了错误的的<code>ref</code>: 实际上应该是<code>pathCheckerConfig</code>而不是<code>delaycollectorConfig</code>. 因为这个错误导致的异常，最后连run-demo的ping包也没有发出去。</p>
<h1 id="section-6"></h1>
<p>在编译sfc-sfp-checker的时候，遇到如下错误： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time:  9.559 s</span><br><span class="line">[INFO] Finished at: 2019-07-02T12:47:43+02:00</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.8.0:compile (default-compile) on project sfc-sfp-checker: Compilation failure: Compilation failure:</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-sfp-checker/src/main/java/org/opendaylight/sfc/pathchecker/SfpCheckerPacketSenderTask.java:[13,49] package org.opendaylight.l2switch.arphandler.core does not exist</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-sfp-checker/src/main/java/org/opendaylight/sfc/pathchecker/SfpCheckerPacketSenderTask.java:[14,54] package org.opendaylight.l2switch.arphandler.inventory does not exist</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-sfp-checker/src/main/java/org/opendaylight/sfc/pathchecker/SfpCheckerPacketSenderTask.java:[16,75] package org.opendaylight.yang.gen.v1.urn.opendaylight.packet.ipv4.rev140528 does not exist</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-sfp-checker/src/main/java/org/opendaylight/sfc/pathchecker/SfpCheckerPacketSenderTask.java:[21,43] package org.opendaylight.controller.liblldp does not exist</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-sfp-checker/src/main/java/org/opendaylight/sfc/pathchecker/SfpCheckerPacketSenderTask.java:[22,43] package org.opendaylight.controller.liblldp does not exist</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-sfp-checker/src/main/java/org/opendaylight/sfc/pathchecker/SfpCheckerPacketSenderTask.java:[23,43] package org.opendaylight.controller.liblldp does not exist</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-sfp-checker/src/main/java/org/opendaylight/sfc/pathchecker/SfpCheckerPacketSenderTask.java:[24,43] package org.opendaylight.controller.liblldp does not exist</span><br><span class="line">[ERROR] /home/qsong/Documents/sfc-patch/sfc-sfp-checker/src/main/java/org/opendaylight/sfc/pathchecker/SfpCheckerPacketSenderTask.java:[25,43] package org.opendaylight.controller.liblldp does not exist</span><br></pre></td></tr></table></figure></p>
<p>原因肯定是依赖管理没有弄好，添加<code>l2switch.arphandler</code>以及<code>liblldp</code></p>
<h1 id="新问题">新问题</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">2019-07-03T01:08:34,528 | ERROR | activator-1-thread-2 | BootFeaturesInstaller            | org.apache.karaf.features.core | installBootFeatures(:113): Error installing boot features</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve root: missing requirement [root] osgi.identity; osgi.identity=odl-sfc-sfp-checker; type=karaf.feature; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; filter:=&quot;(&amp;(osgi.identity=odl-sfc-sfp-checker)(type=karaf.feature)(version&gt;=0.10.0.SNAPSHOT)(version&lt;=0.10.0.SNAPSHOT))&quot; [caused by: Unable to resolve odl-sfc-sfp-checker/0.10.0.SNAPSHOT: missing requirement [odl-sfc-sfp-checker/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.controller.liblldp; type=osgi.bundle; version=&quot;[0.14.4,0.14.4]&quot;; resolution:=mandatory [caused by: Unable to resolve org.opendaylight.controller.liblldp/0.14.4: missing requirement [org.opendaylight.controller.liblldp/0.14.4] osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=com.google.common.collect)(version&gt;=23.6.0)(!(version&gt;=24.0.0)))&quot;]]</span><br><span class="line">        at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.doResolve(ResolverImpl.java:392) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:378) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:332) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.region.SubsystemResolver.resolve(SubsystemResolver.java:257) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.Deployer.deploy(Deployer.java:388) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.FeaturesServiceImpl.doProvision(FeaturesServiceImpl.java:1025) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.FeaturesServiceImpl.lambda$doProvisionInThread$13(FeaturesServiceImpl.java:964) ~[?:?]</span><br><span class="line">        at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]</span><br></pre></td></tr></table></figure>
<p>因为没有在<code>features/odl-sfc-sfp-checker</code>中的<code>pom.xml</code>中依赖声明没有关于<code>org.opendaylight.controller.liblldp</code>的缘故</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vagrant@odl:~$ tail -f sfc/karaf/target/assembly/data/log/karaf.log</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]</span><br><span class="line">    at java.lang.Thread.run(Thread.java:834) [?:?]</span><br><span class="line">Caused by: org.apache.felix.resolver.reason.ReasonException: Unable to resolve odl-sfc-sfp-checker/0.10.0.SNAPSHOT: missing requirement [odl-sfc-sfp-checker/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.controller.sal-common-api; type=osgi.bundle; version=&quot;[1.7.4,1.7.4]&quot;; resolution:=mandatory [caused by: Unable to resolve org.opendaylight.controller.sal-common-api/1.7.4: missing requirement [org.opendaylight.controller.sal-common-api/1.7.4] osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=com.google.common.base)(version&gt;=23.6.0)(!(version&gt;=24.0.0)))&quot;]</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">    ... 12 more</span><br><span class="line">Caused by: org.apache.felix.resolver.reason.ReasonException: Unable to resolve org.opendaylight.controller.sal-common-api/1.7.4: missing requirement [org.opendaylight.controller.sal-common-api/1.7.4] osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=com.google.common.base)(version&gt;=23.6.0)(!(version&gt;=24.0.0)))&quot;</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">    ... 12 more</span><br></pre></td></tr></table></figure>
<p>我一开始以为是 <code>org.opendaylight.controller.sal-common-api</code> 这个包找不到 但是即使在pom.xml中声明了依赖，依然还是报同样的错误，这个感觉有点儿似曾相识。从错误日志来看，<code>com.google.common.base</code> 像是被加载了多次。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">2019-07-03T10:48:28,376 | ERROR | activator-1-thread-2 | BootFeaturesInstaller            | org.apache.karaf.features.core | installBootFeatures(:113): Error installing boot features</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve root: missing requirement [root] osgi.identity; osgi.identity=odl-sfc-sfp-checker; type=karaf.feature; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; filter:=&quot;(&amp;(osgi.identity=odl-sfc-sfp-checker)(type=karaf.feature)(version&gt;=0.10.0.SNAPSHOT)(version&lt;=0.10.0.SNAPSHOT))&quot; [caused by: Unable to resolve odl-sfc-sfp-checker/0.10.0.SNAPSHOT: missing requirement [odl-sfc-sfp-checker/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.controller.model.topology; type=osgi.bundle; version=&quot;[1.7.4,1.7.4]&quot;; resolution:=mandatory [caused by: Unable to resolve org.opendaylight.controller.model.topology/1.7.4: missing requirement [org.opendaylight.controller.model.topology/1.7.4] osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=com.google.common.collect)(version&gt;=23.6.0)(!(version&gt;=24.0.0)))&quot;]]</span><br><span class="line">        at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.doResolve(ResolverImpl.java:392) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:378) ~[?:?]</span><br><span class="line">        at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:332) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.region.SubsystemResolver.resolve(SubsystemResolver.java:257) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.Deployer.deploy(Deployer.java:388) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.FeaturesServiceImpl.doProvision(FeaturesServiceImpl.java:1025) ~[?:?]</span><br><span class="line">        at org.apache.karaf.features.internal.service.FeaturesServiceImpl.lambda$doProvisionInThread$13(FeaturesServiceImpl.java:964) ~[?:?]</span><br><span class="line">        at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]</span><br><span class="line">        at java.lang.Thread.run(Thread.java:834) [?:?]</span><br><span class="line">Caused by: org.apache.felix.resolver.reason.ReasonException: Unable to resolve odl-sfc-sfp-checker/0.10.0.SNAPSHOT: missing requirement [odl-sfc-sfp-checker/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.controller.model.topology; type=osgi.bundle; version=&quot;[1.7.4,1.7.4]&quot;; resolution:=mandatory [caused by: Unable to resolve org.opendaylight.controller.model.topology/1.7.4: missing requirement [org.opendaylight.controller.model.topology/1.7.4] osgi.wiring.package; filter:=&quot;(&amp;(osgi.wiring.package=com.google.common.collect)(version&gt;=23.6.0)(!(version&gt;=24.0.0)))&quot;]</span><br><span class="line">        at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">        ... 12 more</span><br></pre></td></tr></table></figure>
<p>在pom.xml中删除了一些依赖声明， <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">./features/odl-sfc-statistics/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller/odl-controller-model-topology/version = 1.10.0-SNAPSHOT</span><br><span class="line">./features/odl-sfc-statistics/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller/odl-controller-model-topology/classifier = features</span><br><span class="line">./features/odl-sfc-statistics/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller/odl-controller-model-topology/type = xml</span><br><span class="line">./features/odl-sfc-statistics/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller/odl-controller-model-topology/scope = compile</span><br><span class="line">./features/odl-sfc-statistics/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller.model/model-topology/version = 1.10.0-SNAPSHOT</span><br><span class="line">./features/odl-sfc-statistics/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller.model/model-topology/type = jar</span><br><span class="line">./features/odl-sfc-statistics/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller.model/model-topology/scope = compile</span><br><span class="line">./features/odl-sfc-sfp-checker/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller.model/model-topology/version = 1.7.4</span><br><span class="line">./features/odl-sfc-sfp-checker/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller.model/model-topology/type = jar</span><br><span class="line">./features/odl-sfc-sfp-checker/target/classes/META-INF/maven/dependencies.properties:org.opendaylight.controller.model/model-topology/scope = compile</span><br><span class="line">./features/odl-sfc-sfp-checker/target/feature/feature.xml:        &lt;bundle&gt;mvn:org.opendaylight.controller.model/model-topology/1.7.4&lt;/bundle&gt;</span><br></pre></td></tr></table></figure></p>
<p>原因应该跟以上有关 为啥sfc-sfp-checker使用的model-topology版本号是1.7.4，而其他使用的是1.10.0-SNAPSHOT.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">2019-07-03T19:10:15,177 | ERROR | activator-1-thread-2 | BootFeaturesInstaller            | org.apache.karaf.features.core | installBootFeatures(:113): Error installing boot features</span><br><span class="line">org.apache.felix.resolver.reason.ReasonException: Unable to resolve root: missing requirement [root] osgi.identity; osgi.identity=odl-sfc-sfp-checker; type=karaf.feature; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; filter:=&quot;(&amp;(osgi.identity=odl-sfc-sfp-checker)(type=karaf.feature)(version&gt;=0.10.0.SNAPSHOT)(version&lt;=0.10.0.SNAPSHOT))&quot; [caused by: Unable to resolve odl-sfc-sfp-checker/0.10.0.SNAPSHOT: missing requirement [odl-sfc-sfp-checker/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.sfc.sfp-checker; type=osgi.bundle; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; resolution:=mandatory [caused by: Unable to resolve org.opendaylight.sfc.sfp-checker/0.10.0.SNAPSHOT: missing requirement [org.opendaylight.sfc.sfp-checker/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.l2switch.arphandler.core)&quot;]]</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.doResolve(ResolverImpl.java:392) ~[?:?]</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:378) ~[?:?]</span><br><span class="line">    at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:332) ~[?:?]</span><br><span class="line">    at org.apache.karaf.features.internal.region.SubsystemResolver.resolve(SubsystemResolver.java:257) ~[?:?]</span><br><span class="line">    at org.apache.karaf.features.internal.service.Deployer.deploy(Deployer.java:388) ~[?:?]</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.doProvision(FeaturesServiceImpl.java:1025) ~[?:?]</span><br><span class="line">    at org.apache.karaf.features.internal.service.FeaturesServiceImpl.lambda$doProvisionInThread$13(FeaturesServiceImpl.java:964) ~[?:?]</span><br><span class="line">    at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]</span><br><span class="line">    at java.lang.Thread.run(Thread.java:834) [?:?]</span><br><span class="line">Caused by: org.apache.felix.resolver.reason.ReasonException: Unable to resolve odl-sfc-sfp-checker/0.10.0.SNAPSHOT: missing requirement [odl-sfc-sfp-checker/0.10.0.SNAPSHOT] osgi.identity; osgi.identity=org.opendaylight.sfc.sfp-checker; type=osgi.bundle; version=&quot;[0.10.0.SNAPSHOT,0.10.0.SNAPSHOT]&quot;; resolution:=mandatory [caused by: Unable to resolve org.opendaylight.sfc.sfp-checker/0.10.0.SNAPSHOT: missing requirement [org.opendaylight.sfc.sfp-checker/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.l2switch.arphandler.core)&quot;]</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">    ... 12 more</span><br><span class="line">Caused by: org.apache.felix.resolver.reason.ReasonException: Unable to resolve org.opendaylight.sfc.sfp-checker/0.10.0.SNAPSHOT: missing requirement [org.opendaylight.sfc.sfp-checker/0.10.0.SNAPSHOT] osgi.wiring.package; filter:=&quot;(osgi.wiring.package=org.opendaylight.l2switch.arphandler.core)&quot;</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br><span class="line">    at org.apache.felix.resolver.Candidates$MissingRequirementError.toException(Candidates.java:1343) ~[?:?]</span><br></pre></td></tr></table></figure>
<p>为啥说找不到 <code>org.opendaylight.l2switch.arphandler.core</code>? 我查看了下MANIFEST,这个包实际上就在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i -H &quot;Content-Type: application/json&quot; -H &quot;Cache-Control: no-cache&quot; --data &apos;&#123; &quot;input&quot;: &#123; &#125; &#125;&apos; -X POST --user admin:admin http://localhost:8181/restconf/operations/sfc-sfp-checker:send-packet</span><br></pre></td></tr></table></figure>
<p>根据 OpenflowPlugin 的<a href="https://docs.opendaylight.org/projects/openflowplugin/en/latest/users/operation.html" target="_blank" rel="noopener">文档</a>, 找到下面这条RESTFul API的调用方式，返回的结果是XML文件，所有的nodes信息就获得到了。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &quot;Content-Type: application/xml&quot; -H &quot;Accept: application/xml&quot; -X GET --user admin:admin http://localhost:8181/restconf/operational/network-topology:network-topology/topology/flow:1</span><br></pre></td></tr></table></figure></p>
<p>返回结果示例: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;topology xmlns=&quot;urn:TBD:params:xml:ns:yang:network-topology&quot;&gt;</span><br><span class="line">   &lt;topology-id&gt;flow:1&lt;/topology-id&gt;</span><br><span class="line">   &lt;node&gt;</span><br><span class="line">      &lt;node-id&gt;openflow:46456727321924&lt;/node-id&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:46456727321924:LOCAL&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:46456727321924&apos;]/a:node-connector[a:id=&apos;openflow:46456727321924:LOCAL&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:46456727321924:1&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:46456727321924&apos;]/a:node-connector[a:id=&apos;openflow:46456727321924:1&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:46456727321924:3&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:46456727321924&apos;]/a:node-connector[a:id=&apos;openflow:46456727321924:3&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:46456727321924:2&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:46456727321924&apos;]/a:node-connector[a:id=&apos;openflow:46456727321924:2&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;inventory-node-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:46456727321924&apos;]&lt;/inventory-node-ref&gt;</span><br><span class="line">   &lt;/node&gt;</span><br><span class="line">   &lt;node&gt;</span><br><span class="line">      &lt;node-id&gt;openflow:156685216991309&lt;/node-id&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:156685216991309:3&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:156685216991309&apos;]/a:node-connector[a:id=&apos;openflow:156685216991309:3&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:156685216991309:2&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:156685216991309&apos;]/a:node-connector[a:id=&apos;openflow:156685216991309:2&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:156685216991309:LOCAL&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:156685216991309&apos;]/a:node-connector[a:id=&apos;openflow:156685216991309:LOCAL&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:156685216991309:1&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:156685216991309&apos;]/a:node-connector[a:id=&apos;openflow:156685216991309:1&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;inventory-node-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:156685216991309&apos;]&lt;/inventory-node-ref&gt;</span><br><span class="line">   &lt;/node&gt;</span><br><span class="line">   &lt;node&gt;</span><br><span class="line">      &lt;node-id&gt;openflow:213647924314953&lt;/node-id&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:213647924314953:LOCAL&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:213647924314953&apos;]/a:node-connector[a:id=&apos;openflow:213647924314953:LOCAL&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:213647924314953:1&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:213647924314953&apos;]/a:node-connector[a:id=&apos;openflow:213647924314953:1&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;inventory-node-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:213647924314953&apos;]&lt;/inventory-node-ref&gt;</span><br><span class="line">   &lt;/node&gt;</span><br><span class="line">   &lt;node&gt;</span><br><span class="line">      &lt;node-id&gt;openflow:77446495327310&lt;/node-id&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:77446495327310:1&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:77446495327310&apos;]/a:node-connector[a:id=&apos;openflow:77446495327310:1&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;termination-point&gt;</span><br><span class="line">         &lt;tp-id&gt;openflow:77446495327310:LOCAL&lt;/tp-id&gt;</span><br><span class="line">         &lt;inventory-node-connector-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:77446495327310&apos;]/a:node-connector[a:id=&apos;openflow:77446495327310:LOCAL&apos;]&lt;/inventory-node-connector-ref&gt;</span><br><span class="line">      &lt;/termination-point&gt;</span><br><span class="line">      &lt;inventory-node-ref xmlns=&quot;urn:opendaylight:model:topology:inventory&quot; xmlns:a=&quot;urn:opendaylight:inventory&quot;&gt;/a:nodes/a:node[a:id=&apos;openflow:77446495327310&apos;]&lt;/inventory-node-ref&gt;</span><br><span class="line">   &lt;/node&gt;</span><br><span class="line">&lt;/topology&gt;</span><br></pre></td></tr></table></figure></p>
<p>现在的问题是，如何找到ServiceNode(SFC定义)和Node(OpenFlowPlugin定义)之间的映射关系？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 获取某个node的详细信息</span><br><span class="line">curl -H &quot;Content-Type: application/xml&quot; -H &quot;Accept: application/xml&quot; -X GET --user admin:admin http://localhost:8181/restconf/operational/opendaylight-inventory:nodes/node/openflow:77446495327310</span><br></pre></td></tr></table></figure>
<p>有时候切换另一个分支，然后重新执行./run_demo.sh的时候，在执行脚本setup_sfc.py的时候，会遇到下列错误 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP GET http://192.168.1.5:8181/restconf/operational/service-function-path:service-function-paths-state/service-function-path-state/SFP1</span><br><span class="line">result: 404</span><br><span class="line">sfp_stae_list: &#123;&#125;</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/sfc/sfc-demo/sfc103/setup_sfc.py&quot;, line 599, in &lt;module&gt;</span><br><span class="line">    rsp_name = get_rsp_name(&quot;SFP1&quot;, False)</span><br><span class="line">  File &quot;/sfc/sfc-demo/sfc103/setup_sfc.py&quot;, line 571, in get_rsp_name</span><br><span class="line">    for sfp_state in sfp_state_list[&quot;service-function-path-state&quot;]:</span><br><span class="line">KeyError: &apos;service-function-path-state&apos;</span><br></pre></td></tr></table></figure></p>
<p>这个错误意思是，SDN controller 中的 service-function-path 并没有被创立好。挣扎了许久，导致这个现象的原因是，SDN controller创建 service-function-path, 等待数据库相应的记录可查询需要一定的时间，如果等待时间不够，立即就HTTP GET的话，很容易就会遇到相关的记录查询不到的问题。这个问题在SFC涵盖的VNF数目越多越明显。 如果真的遇到这样的问题，在确定SDN controller没有BUG的情况下，不妨最后再执行一次 setup_sfc.py</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/05/17/intelliJ-idea-install-crack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/17/intelliJ-idea-install-crack/" class="post-title-link" itemprop="url">IntelliJ IDEA 下本地开发+远程同步+编译调试 工作流程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-17 15:39:40" itemprop="dateCreated datePublished" datetime="2019-05-17T15:39:40+08:00">2019-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-07-19 19:06:00" itemprop="dateModified" datetime="2019-07-19T19:06:00+08:00">2019-07-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>因为科研的需要，进行 OpenDaylight 开发，但是自己的 Macbook pro 性能有限，并且不在办公室的时候网络连接性能不太好，所以传统方案，直接在Mac上编辑编译运行，这么一个路子对我来说并不适用。我有一台放置在办公室的运行 Ubuntu 16.04 的笔记本电脑 (16G内存，性能上相对来说强悍的多)，我也可以通过 SSH 远程访问这台笔记本电脑。所以，针对我的工程需求，我觉得最优的方案应该是： 1. 本地 Macbook pro上编辑开发 2. 通过 Rsyn 工具远程同步到到我的 Ubuntun server上，并且编译, 取回编译结果 3. 在远程 Ubuntu server 上运行我的实验程序, 并且取回实验结果 其中 2,3步骤最好可以通过 IDEA 的脚本来执行</p>
<h1 id="idea-最新安装破解方法-针对2019.1.2版本-mac-osx系统">IDEA 最新安装破解方法 (针对2019.1.2版本, Mac OSX系统)</h1>
<p>IntelliJ IDEA 2019 for mac 是一款非常好用的 Java 集成开发环境的软件，是目前开发效率最高的工具，它整合了开发过程中实用的众多功能，几乎可以不用鼠标可以方便的完成你要做的任何事情，最大程度的加快开发的速度。简单而又功能强大。与其他的一些繁冗而复杂的 IDE 工具有鲜明的对比。</p>
<h2 id="下载软件安装包">下载软件安装包</h2>
<p>下载安装 IntelliJ IDEA 2019.1.2 for mac.dmg</p>
<h2 id="下载软件破解包">下载软件破解包</h2>
<p>某盘链接: https://pan.baidu.com/s/1rWTWiwrPh-tyW0IP6fG6Hg 提取码: h4ee 将下载的破解包<code>JetbrainsCrack.jar</code>, 放置于<code>/Applications/IntelliJ IDEA.app/Contents/bin</code>路径下。(Windows/Linux平台，路径有所不同)</p>
<h2 id="修改配置文件">修改配置文件</h2>
<p>注意：不能直接修改在<code>bin</code>目录下的配置文件 <code>idea.vmoptions</code>。否则，将无法打开安装好的 <code>IntelliJ IDEA</code>，不然系统提示安装文件损毁，需要移除到回收站。</p>
<p>先打开idea试用30天，然后点击你要注册的IDE菜单：<code>“Help” -&gt; “Edit Custom VM Options …”</code>，如果提示是否要创建文件，请点 "是|Yes"。</p>
<h2 id="重新启-idea">重新启 IDEA</h2>
<h1 id="注册">注册</h1>
<p>注册"Help" -&gt; “Register”，选择License server方式，地址填入：http://jetbrains-license-server （应该会自动填上）。再次重启，看到Licensed to 用户名，即激活成功！</p>
<figure>
<img src="/2019/05/17/intelliJ-idea-install-crack/IDEA-licence.png" alt="Licence-IDEA"><span class="image-caption">Licence-IDEA</span><figcaption>Licence-IDEA</figcaption>
</figure>
<p>Credit: https://blog.csdn.net/qq_40914991/article/details/85543575</p>
<h1 id="odl-remote-debug">ODL remote debug</h1>
<p>什么是remote debugging?给我的感觉这像是一个java编译时的特性。</p>
<p>IDEs such as Eclipse and IntelliJ IDEA allow developpers to debug a locally running or remote running controller. Thankfully, the way you do either debugging is the same.</p>
<ol type="1">
<li>start ODL with a debug flag <code>path/karaf debug</code></li>
<li>attach your IDE to the running application via IP 2.1.</li>
</ol>
<p>就冲这一点，IntelliJ 就彻底征服了我！之前在Eclipse(ODL官方推荐的IDE开发环境)下配置remote debugging环境的时候，Eclipse下根本就识别不了我在<code>~/.ssh/config</code>中定义的配置(如果我当时没有操作失误的话)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/05/02/linux-networking/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/02/linux-networking/" class="post-title-link" itemprop="url">linux-networking</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-05-02 15:39:19 / 修改时间：23:00:52" itemprop="dateCreated datePublished" datetime="2019-05-02T15:39:19+08:00">2019-05-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="linux-iptables-命令">Linux iptables 命令</h1>
<p>VPS 上安装 kcptun 之后，最后弹出这样的信息: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">警告: 自动添加 iptables 规则失败</span><br><span class="line">如有必要, 请手动添加端口 29900 的防火墙规则:</span><br><span class="line">    iptables -I INPUT -p udp --dport 29900 -j ACCEPT</span><br><span class="line">    service iptables save</span><br><span class="line">    service iptables restart</span><br><span class="line">+ sleep 3</span><br><span class="line">+ systemctl enable supervisord.service</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/supervisord.service to /etc/systemd/system/supervisord.service.</span><br></pre></td></tr></table></figure></p>
<p>那么问题来了: 这条防火墙规则不添加的话，是否会影响 kcptun 的使用？是否对 kcptun 加速性能有影响？</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/04/23/linux-command-note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/23/linux-command-note/" class="post-title-link" itemprop="url">linux_command_note</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-23 16:16:53" itemprop="dateCreated datePublished" datetime="2019-04-23T16:16:53+08:00">2019-04-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-07 15:26:44" itemprop="dateModified" datetime="2020-06-07T15:26:44+08:00">2020-06-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>关于Linux的学习，结合多年学习以及操作经验，个人推荐Ubuntu。原因如下：</p>
<ul>
<li>很多软件以及开源项目都首先以Ubuntu为开发基础，因为采坑的可能性更小。例如docker(https://docs.docker.com/engine/security/rootless/)</li>
<li></li>
</ul>
<h1 id="linux-nohup-command">linux nohup command</h1>
<p>If you want to run some commands over SSH connection and keep it running after the SSH connection close, nohup command is your friend.</p>
<p>如果你正在运行一个进程，而且你觉得在退出帐户时该进程还不会结束，那么可以使用nohup命令。该命令可以在你退出帐户/关闭终端之后继续运行相应的进程。nohup就是不挂起的意思( no hang up)。</p>
<p>一般都是在linux下nohup格式:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup &lt;your_command&gt;</span><br></pre></td></tr></table></figure>
<p>or <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup &lt;your_command&gt; &amp;</span><br></pre></td></tr></table></figure></p>
<p>这二者之间的差别是带<code>&amp;</code>的命令行，即使terminal关闭，或者电脑死机程序依然运行（前提是你把程序递交到服务器上）；它把标准输出（STDOUT）和标准错误（STDERR）结果输出到<code>nohup.txt</code>文件. 这个看似很方便，但是当输出很大的时候，nohup.txt文件会非常大，或者多个后台命令的时候大家都会输出到nohup.txt文件，不利于查找结果和调试程序。所以能够重定向输出会非常方便。下面要介绍标准输出，标准输入 和标准错误了。</p>
<h2 id="note-for-linux-command-redirection">Note for linux command redirection</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;your_command&gt; &gt; output</span><br></pre></td></tr></table></figure>
<p>这其中的<code>&gt;</code>就是标准输出符号，其实是 <code>1&gt;output</code> 的缩写 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;your_command&gt; 2&gt; output</span><br></pre></td></tr></table></figure></p>
<p>这里的<code>2&gt;</code>就是stand err输出到output文件里。而 <code>0&lt;</code> 则是标准输入了。 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup &lt;your_command&gt; &gt; output 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure></p>
<p>主要是中间的 <code>2&gt;&amp;1</code> 的意思. 这个意思是把stand err（2）重定向到标准输出中 stdout（1），而标准输出又导入文件 output 里面. 所以结果是标准错误和标准输出都导入文件output里面了。</p>
<p>至于为什么需要将标准错误重定向到标准输出的原因，那就归结为标准错误没有缓冲区，而stdout有。 这就会导致 <code>&gt;output 2&gt;output</code> 文件output被两次打开，而stdout和stderr将会竞争覆盖，这肯定不是我门想要的. 这就是为什么有人会写成： <code>nohup ./command.sh &gt;output 2&gt;output</code> 出错的原因了</p>
<p>最后谈一下<code>/dev/null</code>文件的作用 这是一个无底洞，任何东西都可以定向到这里，但是却无法打开。 所以一般很大的stdou和stderr当你不关心的时候可以利用stdout和stderr定向到这里 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./command.sh &gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure></p>
<p>关于 <code>time</code> 命令的使用：</p>
<p><code>time</code> writes its output to stderr, so you need to pipe stderr instead of stdout. But it's also important to remember that time is part of the syntax of bash, and it times an entire pipeline. Consequently, you need to wrap the pipeline in braces, or run it in a subshell: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ &#123; time ls -l &gt;/dev/null; &#125; 2&gt;&amp;1 | grep real</span><br><span class="line">real   0m0.005s</span><br></pre></td></tr></table></figure></p>
<p>怪不得 我用sed替换命令咋都不好使呢，原来<code>time</code>的输出在<code>stderr</code>里！</p>
<p>With Bash v4.0 (probably universal on Linux distributions but still not standard on Mac OS X), you can use |&amp; to pipe both stdout and stderr: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; time ls -l &gt;/dev/null; &#125; |&amp; grep real</span><br></pre></td></tr></table></figure></p>
<h2 id="sed教程">sed教程</h2>
<p>https://www.tutorialspoint.com/unix/unix-regular-expressions.htm</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repeat 100 &#123;(time example/bls &lt; param/a.param) 2&gt;&amp;1 &gt;/dev/null | grep total&#125; | cut -d' ' -f11 | awk '&#123;print $1*1000&#125;' | pbcopy</span><br></pre></td></tr></table></figure>
<p>tar 常用命令 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar cvzf pbc-song.tar.gz .</span><br></pre></td></tr></table></figure></p>
<p>如何产生95%置信区间？？？ https://stackoverflow.com/questions/44603615/plot-95-confidence-interval-errorbar-python-pandas-dataframes</p>
<p>Docker image and container management https://linuxize.com/post/how-to-remove-docker-images-containers-volumes-and-networks/</p>
<p>How to hash into Elliptic curve? https://eprint.iacr.org/2009/226.pdf</p>
<h1 id="如何只执行一个shell脚本里的某一个函数而不是全部">如何只执行一个shell脚本里的某一个函数而不是全部？</h1>
<p>The <code>dot</code> operator or <code>source</code> builtin in bash is analogous to the <code>import</code> statement in Java.</p>
<p>假如你有一个名叫 run_demo.sh 的脚本文件，里面有一个名为 start_demo 的函数，除此之外还有一些其他的初始化，包安装的函数，你只想执行 start_demo函数呢？ <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source run_demo.sh; start_demo</span><br></pre></td></tr></table></figure></p>
<p>This commit works. Even though Ordered Multi-Signature (OMS) does not work, HTTP can be sent out and acknowledged. I don't know when I modify start.sh, which is entry point of container. Container sf1 and sf2 cannot be started. Even thought I roll back to a previously operational commit, these two containers still cannot be launched.</p>
<h1 id="ps-的时候如何避免显示进程-grep---color-...">ps 的时候，如何避免显示进程 grep --color ...</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ps aux | grep &quot;[f]nord&quot;</span><br></pre></td></tr></table></figure>
<p>By putting the brackets around the letter and quotes around the string you search for the regex, which says, "Find the character 'f' followed by 'nord'."</p>
<p>But since you put the brackets in the pattern 'f' is now followed by ']', so grep won't show up in the results list. Neato!</p>
<h1 id="awk-命令在-double-quote-环境下失效问题">awk 命令在 double quote 环境下失效问题</h1>
<p>参考: https://superuser.com/questions/178425/awk-doesnt-work-when-inside-double-quotes</p>
<p>Variable interpolation is performed within double quotes, so here's what I think might be happening: when you type in <code>ssh $HOST "ls -l | awk '{print $1}'"</code>, your shell (the one on your local computer, where you are running the SSH client) sees $1 within the double quotes and replaces it with the value of the variable $1, which will be blank. It isn't able to detect that the <code>$1</code> is nested within single quotes within the double quotes. So what winds up getting sent to the remote server is <code>ls -l | awk '{print }'</code>, which is basically equivalent to <code>ls -l | cat</code>, i.e. it just prints out the output of <code>ls -l</code>.</p>
<p>Solution: escape the $ with a backslash, <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh $HOST &quot;ls -l | awk &apos;&#123;print \$1&#125;</span><br></pre></td></tr></table></figure></p>
<p>According to this comment, if I want to kill a proces within a container, I shoud do as follows: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">for i in sf1 sf2; do </span><br><span class="line">    echo "Kill sfc_agent.py in container $i"</span><br><span class="line">    docker exec -it $i /bin/bash -c "ps aux | grep [s]fc/sfc_agent.py | awk '&#123;print \$2&#125;'";</span><br><span class="line">done</span><br></pre></td></tr></table></figure></p>
<h1 id="如何重启docker下的通过entry启动的进程">如何重启docker下的通过ENTRY启动的进程？？？</h1>
<p>我一直想通过docker exec命令解决，但是实际上重启一下不就好了？？？</p>
<h1 id="how-to-enable-sudo-command-without-requiring-passowrd">How to enable sudo command without requiring passowrd?</h1>
<p>Open the /etc/sudoers file (as root, of course!) by running: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo visudo</span><br></pre></td></tr></table></figure></p>
<p>You should never edit <code>/etc/sudoers</code> with a regular text editor, such as <code>Vim</code> or <code>nano</code>, because they do not validate the syntax like the <code>visudo</code> editor.</p>
<p>At the end of the /etc/sudoers file add this line: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;username&gt;     ALL=(ALL) NOPASSWD:ALL`</span><br></pre></td></tr></table></figure></p>
<p>Replace <username> with your account username, of course. Save the file and exit with <esc>wq. If you have any sort of syntax problem, visudo will warn you and you can abort the change or open the file for editing again.</esc></username></p>
<p>It is important to add this line at the end of the file, so that the other permissions do not override this directive, since they are processed in order.</p>
<h1 id="locale-cannot-set-lc_all-to-default-locale-no-such-file-or-directory">locale: Cannot set LC_ALL to default locale: No such file or directory</h1>
<p>参考下面这个链接 https://www.skyminds.net/linux-cannot-set-default-locale/</p>
<h1 id="linux-进程相关知识">Linux 进程相关知识</h1>
<h2 id="linux">Linux</h2>
<p>答案： （1）、不可中断状态：进程处于睡眠状态，但是此刻进程是不可中断的。不可中断， 指进程不响应异步信号。 （2）、暂停状态/跟踪状态：向进程发送一个 SIGSTOP 信号，它就会因响应该信号 而进入 TASK_STOPPED 状态;当进程正在被跟踪时，它处于 TASK_TRACED 这个特殊的状态。 “正在被跟踪”指的是进程暂停下来，等待跟踪它的进程对它进行操作。 （3）、就绪状态：在 run_queue 队列里的状态 （4）、运行状态：在 run_queue 队列里的状态 （5）、可中断睡眠状态：处于这个状态的进程因为等待某某事件的发生（比如等待 socket 连接、等待信号量），而被挂起 （6）、zombie 状态（僵尸）：父亲没有通过 wait 系列的系统调用会顺便将子进程的尸体（task_struct）也释放掉 （7）、退出状态</p>
<p>D 不可中断 Uninterruptible（usually IO） R 正在运行，或在队列中的进程 S 处于休眠状态 T 停止或被追踪 Z 僵尸进程 W 进入内存交换（从内核 2.6 开始无效） X 死掉的进程</p>
<h1 id="du-和-df-的定义以及区别">du 和 df 的定义，以及区别？</h1>
<ul>
<li>du 显示目录或文件的大小</li>
<li>df 显示每个<文件>所在的文件系统的信息，默认是显示所有文件系统。 （文件系统分配其中的一些磁盘块用来记录它自身的一些数据，如 i 节点，磁盘分布图，间接块，超级块等。这些数据对大多数用户级的程序来说是不可见的，通常称为 Meta Data。）</文件></li>
<li>du 命令是用户级的程序，它不考虑 Meta Data，而 df 命令则查看文件系统的磁盘分配图并考虑 Meta Data。</li>
<li>df 命令获得真正的文件系统数据，而 du 命令只查看文件系统的部分情况。</li>
</ul>
<h1 id="当你需要给命令绑定一个宏或者按键的时候应该怎么做呢">当你需要给命令绑定一个宏或者按键的时候，应该怎么做呢？</h1>
<p>答案： 可以使用<code>bind</code>命令，<code>bind</code>可以很方便地在<code>shell</code>中实现宏或按键的绑定。 在进行按键绑定的时候，我们需要先获取到绑定按键对应的字符序列。 比如获取<code>F12</code>的字符序列获取方法如下：先按下<code>Ctrl+V</code>,然后按下<code>F12</code> .我们就可以得到<code>F12</code>的字符序列 <code>^[[24~</code>。接着使用bind进行绑定。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# bind ‘”\e[24~&quot;:&quot;date&quot;&apos;</span><br></pre></td></tr></table></figure></p>
<p>注意：相同的按键在不同的终端或终端模拟器下可能会产生不同的字符序列。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">rennsong</p>
  <div class="site-description" itemprop="description">Personal blog site, to note technique and life related articles</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">67</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hansomesong" title="GitHub → https://github.com/hansomesong" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rennsong</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->



  















  

  

  

</body>
</html>
