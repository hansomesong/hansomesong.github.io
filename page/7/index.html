<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rennesong.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Personal blog site, to note technique and life related articles">
<meta property="og:type" content="website">
<meta property="og:title" content="Rennesong&#39;s blog">
<meta property="og:url" content="http://rennesong.com/page/7/index.html">
<meta property="og:site_name" content="Rennesong&#39;s blog">
<meta property="og:description" content="Personal blog site, to note technique and life related articles">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="rennsong">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://rennesong.com/page/7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Rennesong's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Rennesong's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Blog my life from now on!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2015/08/02/ssh-tuto/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/08/02/ssh-tuto/" class="post-title-link" itemprop="url">Simplify your life with SSH</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-08-02 14:22:43" itemprop="dateCreated datePublished" datetime="2015-08-02T14:22:43+08:00">2015-08-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-08 14:31:27" itemprop="dateModified" datetime="2020-06-08T14:31:27+08:00">2020-06-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SSH/" itemprop="url" rel="index"><span itemprop="name">SSH</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="background-and-motivation">Background and motivation</h1>
<p>I have one Ubuntu Linux server (I will call it as remote server in the following of this post) in my office, which is behind a NAT router and restrictive rewall. Now I want to SSH to the remote server while I'm away from my office. How should I do?</p>
<figure>
<img src="/.com//reverse_ssh_illustration.png" alt="Reverse SSH Tunnel Illustration"><span class="image-caption">Reverse SSH Tunnel Illustration</span><figcaption>Reverse SSH Tunnel Illustration</figcaption>
</figure>
<h1 id="part-1-reverse-ssh-tunnel">Part 1: Reverse SSH Tunnel</h1>
<p>关于 SSH port forwaring 概念的介绍。这个帖子: <code>http://www.linux-france.org/prj/edu/archinet/systeme/ch13s04.html</code> 以及 <code>https://www.ssh.com/ssh/tunneling/example</code>讲的还挺好的。</p>
<p>SSH portforwarding will certainly be an option. However, port forwarding can become tricky if you are dealing with multiple nested NAT environment. Besides, it can be interfered with under various ISP-specific conditions, such as restrictive firewalls which block forwarded ports, or carrier-grade NAT which shares IPv4 addresses among users.</p>
<p>One alternative to SSH port forwarding is reverse SSH tunneling. The concept of reverse SSH tunneling is simple. For this, you will need another host (so-called &quot;relay host&quot;) outside your restrictive office network, which you can connect to via SSH from where you are. You could set up a relay host using a VPS instance with a public IP address. What you do then is to set up a persistent SSH tunnel from the remote server in your office network to the public relay host. With that, you can connect &quot;back&quot; to the remote server from the relay host (which is why it's called a &quot;reverse&quot; tunnel). As long as the relay host is reachable to you, you can connect to your remote server wherever you are, or however restrictive your NAT or firewall is in your office network.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -fN -R &lt;your_selected_port&gt;:localhost:22 &lt;relayserver_username&gt;@relayserver</span><br></pre></td></tr></table></figure>
<p>Some explanations about the above command: * term <code>&lt;your_selected_port&gt;</code> is any arbitrary unoccupied port number (e.g. 10222) that you can choose on the relay server(for exampler, your VPS). Similarly, term <code>&lt;relayserver_username&gt;</code> should be replaced by your user name on the relay server; * with the option combination <code>fN</code>, SSH will go right into the background once you successfully authenticate with an SSH server (in this case, relay server). This option is useful when you do not want to execute any command on a remote SSH server, and just want to forward ports; * option <code>R</code>, along side with string <code>&lt;your_selected_port&gt;:localhost:22</code> defines a reverse SSH tunnel. It forwards traffic received by port <code>&lt;your_selected_port&gt;</code> of relay server to port 22 of homeserver.</p>
<p>Now I will log into my VPS with root user and check the opening port on my VPS:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;user_name&gt;@&lt;your_machine_name&gt;:~# netstat -autn | grep 22222</span><br><span class="line">tcp        0      0 127.0.0.1:22222         0.0.0.0:*               LISTEN</span><br><span class="line">tcp6       0      0 ::1:22222               :::*                    LISTEN</span><br></pre></td></tr></table></figure>
<p>Now that you can ssh into your remote server with the following command: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@vps639023:~# ssh -p &lt;your_selected_port&gt; &lt;username_at_remote_server&gt;@localhost</span><br></pre></td></tr></table></figure> , where <code>&lt;your_selected_port&gt;</code> should be replaced by port number such as 22222.</p>
<h2 id="dynamic-port-forwarding">Dynamic port forwarding</h2>
<p>可以用来翻墙 但是网速。。。很慢。。。</p>
<h2 id="special-case-outgoing-port-22-i.e.-for-ssh-is-filtered-by-firewall">Special case: outgoing port 22 (i.e. for SSH) is filtered by firewall</h2>
<p>During the establishment of reverse SSH tunnel (i.e. from remote server to relay server), it is very possible that the remote server has no outbound SSH access to a machine on the public Internet (in my case: my VPS instance), because port <code>22</code> is blokced by restrictive firewall. With port <code>22</code> open allows malicious attackers establishing reverse tunnel and bypassing completely bypassing the firewall. Thus, in practice, some enterprise may block the outbound port 22 for the sake of network security. In this case, how we could establish reverse SSH tunnel?</p>
<p>The answer is yes if: * the outbound port 443 (i.e. for HTTPS) is not filtered by the firewall in the network of remote server; * web server (Apache2 or Nginx), SSH server and SSLH<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> are installed on the relay server. Please refer to~ for more details.</p>
<h2 id="compilation-and-installation-of-sslh">Compilation and Installation of SSLH</h2>
<ol type="1">
<li>Download source code</li>
<li>Install pre-requisites: take Debian-based system (e.g. Ubuntu 16.04) as example libwrap0-dev libsystemd-dev libcap-dev libbsd-dev</li>
<li>Compilation and Installation</li>
</ol>
<p>Provided that the operations on the relay server side are done, we now log into the home server can establish a reverse SSH tunnel with relay server with the following command: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -fN -R 10022:localhost:22 root@&lt;your&gt;.&lt;own&gt;.&lt;ip&gt;.&lt;address&gt; -p 443</span><br></pre></td></tr></table></figure> Some explanaition about above command: * with option <code>p</code>, the destination port of SSH is set as 443, instead of 22, which is the default port for SSH. In other words, remote server will establish ssh connection with destination port <code>443</code>, which won't be blocked by firewall.</p>
<h1 id="part-3-execute-command-on-remote-server-over-ssh-connection">Part 3: execute command on remote server over SSH connection</h1>
<p>在实际使用Linux的过程中，我们经常会碰到这样的场景：登录到远程服务器上，执行某个命令，比如查看下某个文件夹下的目录，然后再退出。常规的思路是： 1. Run the command &quot;ssh username@host&quot; to log in to the system 2. At the command prompt, run &quot;top&quot; to view process activity on the remote system 3. Exit top and be dropped to the remote command line 4. Type &quot;Exit&quot; to close the command</p>
<p>SSH已经考虑到了用户的这种需求，可以一条命令完成上述四步：<code>ssh -t username@host 'top'</code>。命令中的选项<code>-t</code>, 作用是分配一个为terminal界面给当前命令，允许用户进行一些交互。比如当你需要执行需要sudo的命令时，<code>-t</code>保证了当需要输入管理员密码的时候，可以通过当前的terminal输入密码。</p>
<h1 id="part-2-enable-ssh-connection-without-password">Part 2: Enable SSH connection without password</h1>
<p>There are some issues with this password based authentication, mainly, it allows brute-force password guessing. SSH provides better authentication process: <code>SSH Public key access</code>, which allows to password-less log in.</p>
<p>To this end, first you have to generate a public and private key pair in your relay server, namely your VPS <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@vps639023:~# ssh-keygen -t rsa -P &#39;&#39;</span><br></pre></td></tr></table></figure> Then, you have to transfer the newly generated public key to your target server: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@vps639023:~# ssh-copy-id -i .ssh&#x2F;id_rsa.pub &lt;user_at_remote_server&gt;@localhost -p 22222</span><br></pre></td></tr></table></figure> Note that command <code>ssh-copy-id</code> relies on scp that uses port 22 as default port. Here we explicitly specify here the used port is 22222. Without option <code>i</code>, <code>ssh-copy-id</code> will copy whatever keys it finds to the remote (might be multiple)!</p>
<h2 id="一些疑问">一些疑问：</h2>
<ol type="1">
<li>产生公钥/私钥对的时候，会被询问是否设置<code>passphrase</code>, 这个和<code>password</code>有何异同(比如会比password更长)? 什么时候需要设置<code>passphrase</code>? 设置了<code>passphrase</code>是否还是真正的<code>password-less</code>登录？</li>
<li><code>SSH agent</code> 又是啥？和SSH 客户端又有何不同呢？SSH <code>agent forwarding</code> 是什么？ <code>SSH agent</code> 第一个用途是用来解决 <code>unlocking private key with a secret passphrase upon each connection</code> 这个问题的。即，采用被<code>passphrase</code>保护的私钥登录remote server时候(<code>ssh -i path/to/private-key remote-server</code>)时, 虽然不再需要输入登录远程服务器所需要的密码，但是我们需要输入<code>passphrase</code>才能获得对本地私钥的使用权！这其实不就是另一种形式的密码么，而且每次登录都需要输入更长的字符！根本不是我们想要的password-less登录。<code>ssh-agent</code>可以解决这个问题。执行<code>ssh-add path/to/your/private-key</code>, 之后在执行<code>ssh -i path/to/private-key remote-server</code>。第一次还需要输入<code>passphrase</code>，之后再登录remoter-server就不再需要输入<code>passphrase</code>了，因为指定的私钥就会被存储在<code>ssh-agent</code>中(私钥应该是存储在内存中了)。</li>
</ol>
<p>SSH agent forwarding can be used to make deploying to a server simple. It allows you to use your local SSH keys instead of leaving keys (without passphrases!) sitting on your server.</p>
<p>SSH agent forwarding特性有两种方式启用：1）命令行模式下的参数<code>-A</code>, 2）配置文件(如<code>~/.ssh/config</code>)中在相应的Host下，加入directive: <code>ForwardAgent yes</code>。 3.</p>
<h1 id="part-3-how-make-a-tunnel-persistent-autossh_ssh_tunneling">Part 3: How make a tunnel persistent <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></h1>
<p>By persistent I mean, that it is made sure the tunnel will always run. For example, once your ssh connection times out (By server-side timeout), your tunnel should be re-established automatically.</p>
<p>Many NAT firewalls time out idle sessions after a certain period of time to keep their trunks clean. Sometimes the interval between session drops is 24 hours, but on many commodity firewalls, connections are killed after as little as 300 seconds.</p>
<h2 id="ssh-command-option-serveraliveinterval-and-serveralivecountmax">3.1 SSH command option <code>ServerAliveInterval</code> and <code>ServerAliveCountMax</code></h2>
<p>To avoid having your SSH sessions become unresponsive after e.g. 5 minutes, do the following (On Linux machine):</p>
<p>To enable the keep alive system-wide (root access required), edit <code>/etc/ssh/ssh_config</code>; to set the settings for just your user, edit <code>~/.ssh/config</code> (create the file if it doesn’t exist).</p>
<p>Insert the following snipet of code: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">    ServerAliveInterval 300</span><br><span class="line">    ServerAliveCountMax 2</span><br></pre></td></tr></table></figure> Alternatively, you can also make your OpenSSH server keep alive all connections with clients by adding the following to <code>/etc/ssh/sshd_config</code>: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">    ClientAliveInterval 300</span><br><span class="line">    ClientAliveCountMax 2</span><br></pre></td></tr></table></figure> These settings will make the SSH client or server send a null packet to the other side every 300 seconds (5 minutes), and give up if it doesn’t receive any response after 2 tries, at which point the connection is likely to have been discarded anyway.</p>
<p>修改完openssh-server的配置之后，可以采取两种方式使配置生效： <code>sudo service ssh restart</code> # 重启ssh server <code>sudo service ssh reload</code> # 重载ssh server 相关配置</p>
<p>如果你已经安装了openssh-server的话(没有的话,要安装),因为Ubuntu已经使用Upstart来进行管理/etc/init.d里面的任务. 所以<code>/etc/init.d/sshd start</code>已经无效了. 注意: 应该用<code>sudo service ssh start</code>(<strong><em>注意: 是ssh,不是sshd</em></strong>)启动sshd服务,之后可以通过进程查看sshd进程已在运行.</p>
<p> describes how to use different terminal color schema when establishing SSH connection.</p>
<h2 id="autossh">3.2 AutoSSH</h2>
<p>Autossh is a program to start a copy of ssh and monitor it, restarting it as necessary should it die or stop passing traffic.</p>
<p>AutoSSH basic usage: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usage: autossh [-V] [-M monitor_port[:echo_port]] [-f] [SSH_OPTIONS]</span><br></pre></td></tr></table></figure> The important part to remember is that <code>-f</code> (run in background) is not passed to the ssh command, but handled by autossh itself. Apart from that you can then use it just like you would use ssh to create any forward or reverse tunnels.</p>
<p><strong>Note 1</strong>: Before you use autossh, make sure the connection works as expected by trying it with ssh first.</p>
<p><strong>Note 2</strong>: Make sure you use public/private key authentification instead of password-based authentification when you use <code>-f</code>. This is required for ssh as well as for autossh, simply because in a background run a passphrase cannot be entered interactively.</p>
<p>With option <code>-M</code> AutoSSH will continuously send data back and forth through the pair of monitoring ports in order to keep track of an established connection. If no data is going through anymore, it will restart the connection. The specified monitoring and the port directly above (+1) must be free. The first one is used to send data and the one above to receive data on. For example, if you specify 11111 as monitoring port, then 11112 will be automatically used for receving data. You shoul ensure that both ports are unoccupied.</p>
<p>Unfortunately, this is not too handy, as it must be made sure both ports (the specified one and the one directly above) are free (not used). So in order to overcome this problem, there is a better solution:</p>
<p>Options <code>ServerAliveInterval</code> and <code>ServerAliveCountMax</code> of ssh command. They cause the SSH client to send traffic through the encrypted link to the server. This will keep the connection alive when there is no other activity and also when it does not receive any alive data, it will tell AutoSSH that the connection is broken and AutoSSH will then restart the connection.</p>
<p>The AutoSSH man page also recommends the second solution: &gt;-M [:echo_port], &gt;… &gt;In many ways this [ServerAliveInterval and ServerAliveCountMax options] may be a better solution than the monitoring port.</p>
<p>You can disable the built-in AutoSSH monitoring port by giving it a value of 0: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autossh -M 0</span><br></pre></td></tr></table></figure> Additionally you will also have to specify values for <code>ServerAliveInterval</code> and <code>ServerAliveCountMax</code>: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autossh -M 0 -o "ServerAliveInterval 30" -o "ServerAliveCountMax 3"</span><br></pre></td></tr></table></figure></p>
<table>
<colgroup>
<col style="width: 48%">
<col style="width: 51%">
</colgroup>
<thead>
<tr class="header">
<th>Option</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ServerAliveInterval</td>
<td style="text-align: left;">ServerAliveInterval: number of seconds that the client will wait before sending a null packet to the server (to keep the connection alive). Default: 30</td>
</tr>
<tr class="even">
<td>ServerAliveCountMax</td>
<td style="text-align: left;">Sets the number of server alive messages which may be sent without ssh receiving any messages back from the server. If this threshold is reached while server alive messages are being sent, ssh will disconnect from the server, terminating the session. Default: 3</td>
</tr>
</tbody>
</table>
<h1 id="part-4-enable-the-tunnel-at-system-boot">Part 4: Enable the tunnel at system boot</h1>
<p>To make sure that even the remote server is restarted, we still have this reverse SSH tunnel, we configure that this server executes this command at boot time.</p>
<p>In recent years, Linux distributions have increasingly transitioned from other <code>init</code> systems to <code>systemd</code>. The systemd suite of tools provides a fast and flexible init model for managing an entire machine from boot onwards. Refer to <a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> for a quick tutorial for systemd.</p>
<h2 id="under-ubuntu-system">4.1 Under Ubuntu system</h2>
<h3 id="modify-etcrc.local">Modify <code>/etc/rc.local</code></h3>
<p>We are going to edit the <code>/etc/rc.local</code> file. This script normally does nothing, but gets executed at boot. If you make any errors in this script, your machine might not boot so make sure to do this correctly.</p>
<p>Add the following instruction with your preferred editor into <code>/etc/rc.local</code> % credit:https://tex.stackexchange.com/questions/116534/lstlisting-line-wrapping <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autossh -M 10984 -N -f -o &quot;PubkeyAuthentication&#x3D;yes&quot; -o &quot;PasswordAuthentication&#x3D;no&quot; -i &#x2F;path&#x2F;to&#x2F;.ssh&#x2F;id_rsa -R 6666:localhost:22 remy@middleman -p 2222 &amp;</span><br></pre></td></tr></table></figure> We have three new things in this command:</p>
<ul>
<li><code>-N</code>: Do not execute a command on the middleman machine</li>
<li><code>-f</code>: drop in the background</li>
<li><code>&amp;</code>: Execute this command but do not wait for output or an exit code. If this is not added, your machine might hang at boot.</li>
</ul>
<p>Save the file, and as make it executable if necessary: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /etc/rc.local</span><br></pre></td></tr></table></figure></p>
<h3 id="use-cron-command">Use <code>cron</code> command</h3>
<p>TBD</p>
<h3 id="create-systemd-service">Create systemd service</h3>
<p>If you want a permanent SSH tunnel already created during boot time, you will (nowadays) have to create a systemd service and enable it. There is however an important thing to note about systemd and <code>AutoSSH: -f</code> (background usage) already implies <code>AUTOSSH_GATETIME=0</code>, however <code>-f</code> is not supported by systemd.</p>
<blockquote>
<p>http://www.freedesktop.org/software/systemd/man/systemd.service.html […] running programs in the background using “&amp;”, and other elements of shell syntax are not supported.</p>
</blockquote>
<p>So in the case of systemd we need to make use of AUTOSSH_GATETIME. Let’s look at a very basic service:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># The following command should be run with root priviledge</span><br><span class="line">$ vim &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;revtun2vps.service</span><br><span class="line">[Unit]</span><br><span class="line">Description&#x3D;AutoSSH managed reverse SSH tunnel service to bind local port 22 with port 22222 on VPS server</span><br><span class="line">After&#x3D;network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Environment&#x3D;&quot;AUTOSSH_GATETIME&#x3D;0&quot;</span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;autossh -M 0 -o &quot;ServerAliveInterval 30&quot; -o &quot;ServerAliveCountMax 3&quot; -N -R 22222:localhost:22 &lt;user_name&gt;@&lt;vps.host.name&gt; -p 443</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>
<p>One can refer to <a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> for more details about the directives such as <code>after=</code>, <code>WantedBy</code>.</p>
<p>Note 1: 以上systemd service将会以root身份启动autossh进程，如果root身份从未跟VPS建立过SSH connection的话，通过<code>systemctl status revtun2vps.service</code>, 将会看到SSH connection实际上并没有被创建，由于<code>host key verification failed</code>的错误。最后我的解决办法是，<code>sudo su</code> 切换为root，然后<code>ssh-keygen</code>创建root专属的公私钥，最后再<code>ssh-copy-id -i .ssh/id_rsa.pub root@vps.ip.addr -p 443</code>使得root可以免密登录VPS. 之后再启动<code>revtun2vps</code> service，将会顺利创建reverse tunnel了。</p>
<p>虽然我之前一直都以qsong的身份在和VPS建立SSH连接, 但是 VPS 的host key确实被保存在/home/qsong/.ssh/known_hosts文件中的，当我第一次以root身份去发起连接的时候，root用户的工作目录(即/root)下并没有known_hosts这么一个文件！</p>
<p>问题：难道 systemd service 启动的 autossh 难道不需要指明运行在后台？</p>
<p>Tell systemd that we have added some stuff: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure></p>
<p>Start the service: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start revtun2vps.service</span><br></pre></td></tr></table></figure></p>
<p>Enable during boot time: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable revtun2vps.service</span><br><span class="line">root@vps273731:~# systemctl enable revtun2vps.service</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/revtun2vps.service to /etc/systemd/system/revtun2vps.service.</span><br></pre></td></tr></table></figure> Once the service is correctly started: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">qsong-P650SE# systemctl status revtun2vps.service</span><br><span class="line">● revtun2vps.service - AutoSSH managed reverse SSH tunnel creation service to bind local 22 with port 22222 on remote VPS server</span><br><span class="line">   Loaded: loaded (&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;revtun2vps.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since ven. 2019-05-17 18:23:37 CEST; 11s ago</span><br><span class="line"> Main PID: 21307 (autossh)</span><br><span class="line">    Tasks: 2</span><br><span class="line">   Memory: 1.3M</span><br><span class="line">      CPU: 19ms</span><br><span class="line">   CGroup: &#x2F;system.slice&#x2F;revtun2vps.service</span><br><span class="line">           ├─21307 &#x2F;usr&#x2F;lib&#x2F;autossh&#x2F;autossh -M 0 -o ServerAliveInterval 30 -o ServerAliveCountMax 3 -N -R 22222:localhost:22 root@xx.xx.xx.xx -p 443</span><br><span class="line">           └─21319 &#x2F;usr&#x2F;bin&#x2F;ssh -o ServerAliveInterval 30 -o ServerAliveCountMax 3 -N -R 22222:localhost:22 -p 443 root@xx.xx.xxx.xx</span><br><span class="line"></span><br><span class="line">mai 17 18:23:37 qsong-P650SE systemd[1]: Started AutoSSH managed reverse SSH tunnel creation service to bind local 22 with port 22222 on remote VPS server.</span><br><span class="line">mai 17 18:23:37 qsong-P650SE autossh[21307]: port set to 0, monitoring disabled</span><br><span class="line">mai 17 18:23:37 qsong-P650SE autossh[21307]: starting ssh (count 1)</span><br><span class="line">mai 17 18:23:37 qsong-P650SE autossh[21307]: ssh child pid is 21319</span><br></pre></td></tr></table></figure></p>
<h2 id="under-mac-osx">4.2 Under Mac OSX</h2>
<p>On Mac, the alternative to service and systemctl is launchctl. Mac OSX relies on <code>launchctl</code> to manage the services that need to be started at boot time. Unfortunately, Systemd, which systemctl is a part of, is a service manager designed specifically for Linux and uses interfaces and constructs specific to it such as <code>cgroups</code>. There is no port of it to Mac OS.</p>
<p><code>launchd</code>, a unified service-management framework, starts, stops and manages daemons, applications, processes, and scripts in mac OS. <code>launchd</code> has two main tasks. The first is to boot the system, and the second is to load and maintain services.</p>
<h1 id="part-5-simplify-your-life-with-an-ssh-config-file-ssh_config_tuto">Part 5: Simplify your life With an SSH Config File <a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></h1>
<p>Create a SSH config file under path <code>~/.ssh/config</code>. This is the per-user configuration file. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> My personal VPS serves as a broker <span class="keyword">for</span> connection from my Mac to my Ubnuntu server</span></span><br><span class="line">Host my_vps</span><br><span class="line">  HostName &lt;your&gt;.&lt;own&gt;.&lt;ip&gt;.&lt;address&gt;</span><br><span class="line">  User root</span><br><span class="line">  Port 443</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> my remote Ubuntu server</span></span><br><span class="line">Host ubuntu_server</span><br><span class="line"><span class="meta">#</span><span class="bash"> example: ProxyCommand ssh -q my_vps nc -qo hostname.or.IP.address.internal.machine 22</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> change hostname.or.IP.address.internal.machine and port 22 to machine you like to reach</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">if</span> you would from the `my_vps` machine</span></span><br><span class="line">ProxyCommand ssh -q my_vps nc -q0 localhost 22222</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> my vagrant vm running <span class="keyword">in</span> my ubuntu_server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the following ssh <span class="built_in">command</span> options are obtained from `ps aux | grep ssh` on my ubuntu_server.</span></span><br><span class="line">Host sfc103-vm</span><br><span class="line">  ProxyJump qsong@ubuntu_server</span><br><span class="line">  HostName 127.0.0.1</span><br><span class="line">  User vagrant</span><br><span class="line">  Port 2222</span><br><span class="line">  LogLevel FATAL</span><br><span class="line">  Compression yes</span><br><span class="line">  DSAAuthentication yes</span><br><span class="line">  IdentitiesOnly yes</span><br><span class="line">  StrictHostKeyChecking no</span><br><span class="line">  UserKnownHostsFile /dev/null</span><br><span class="line">  IdentityFile ~/Documents/sfc-patch/sfc-demo/sfc103/.vagrant/machines/odl/virtualbox/private_key</span><br></pre></td></tr></table></figure> Also note that now you have a single SSH host target name for it, you can use this in other applications as well. E.g.: SCP to copy files. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp somefile user@internalmachine:~/</span><br></pre></td></tr></table></figure> Copy your public key from A directly to C: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i .ssh/id_rsa.pub qsong@ubuntu_server</span><br></pre></td></tr></table></figure> This allows one to SSH from A to C without password.</p>
<p>On my macbook pro, I have <code>openssh 7.9p1</code> installed. From OpenSSH 7.3, <code>ProxyJump</code> is supported in <code>ssh_config</code>. I find that even though my remote <code>ubuntu_server</code> (having OpenSSH 7.2) have no support for such an option, this does not bother the using of <code>ProxyJump</code> on my macbook pro.</p>
<h1 id="part-6-ssh-connection-with-gui">Part 6: SSH connection with GUI</h1>
<p>This <a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-vnc-on-ubuntu-16-04" target="_blank" rel="noopener">post</a> gives a very detailed tutorial about how to install Xfce and VNC server on Ubuntu 16.04.</p>
<p>One thing we need to indicate is: I have to establish one reverse SSH tunnel with my VPS.</p>
<p>On the Ubunutu server, add the following codes into file <code>~/.ssh/config</code>: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host vnc_tunnel_vps</span><br><span class="line">    HostName &lt;vps.ip.address.or.name&gt;</span><br><span class="line">    User &lt;your-user-name&gt;</span><br><span class="line">    Port 443</span><br><span class="line">    RemoteForward 59000 127.0.0.1:5901</span><br></pre></td></tr></table></figure> Port <code>59000</code> at VPS server will be on state of listening. Any traffic to this port on VPS will be forwarded to port <code>5901</code> on the remote Ubuntu server.</p>
<p>Thus, On the macbook pro, we have to also add some local port forwarding configuration in file <code>~/.ssh/config</code>: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Establish one tunnel between this machine and my vps</span></span><br><span class="line">Host tunnel_vps</span><br><span class="line">  HostName &lt;vps.ip.address.or.name&gt;</span><br><span class="line">  LocalForward 33333 127.0.0.1:22222</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Establish one tunnel to <span class="built_in">bind</span> <span class="built_in">local</span> 59000 with remote 59000 on my vps</span></span><br><span class="line">  LocalForward 59000 127.0.0.1:59000</span><br><span class="line">  User &lt;your-user-name&gt;</span><br><span class="line">  Port 443</span><br></pre></td></tr></table></figure> Note that in the above command, SSH will create two local port forwarding.</p>
<p>If you want to access to the VNC server running on Ubuntu server, you can either install VNC client or use <code>Screen sharing program</code> integrated into Mac OSX.</p>
<p>Open <code>Finder</code> application, click menu <code>Go</code> and further click <code>Connect to Server...</code>. On the prompted window, type the following command: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vnc://127.0.0.1:59000</span><br></pre></td></tr></table></figure> You will be required to type password, which is the one you set when installing VNC server.</p>
<h1 id="part-7-mount-remote-directory-on-a-remote-server-with-sshfs">Part 7: Mount remote directory on a remote server with SSHFS</h1>
<p>If you use SSHFS on MacOS and the end point stops responding or crashes, you need to do new SSHFS connection. You need to either restart your mac or umount the old connection first. I use sshfs to access data on my vmware ( Ubuntu ) – if that restarts, or crashes – I end up with the following error message: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount_osxfuse: mount point /xx/yy/zz is itself on a OSXFUSE volume</span><br></pre></td></tr></table></figure> This post gives the cause and solution<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>. Simply speaking, the remote directory is not correctly unmounted. We need to find its mount point and unmount it another time.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshfs -o defer_permissions root@hostname.or.ip.address:/path/to/your/folder /mnt/path/to/your/mount_point</span><br></pre></td></tr></table></figure>
<ul>
<li>-o <code>defer\_permissions</code>: without this option, we will encounter error <code>permission defined</code> if we try to write something into the mounted directory.</li>
</ul>
<h2 id="problem-description">Problem description</h2>
<p>Now I have three machines: my working laptop (Mac OSX), my remote server (Ubuntu 16.04) and VPS server. I want to mount a directory in my remote Ubuntu server on my working laptop.</p>
<h2 id="fuse-for-os-x">FUSE for OS X</h2>
<p>The first step to using SSHFS is to install <a href="https://osxfuse.github.io/" target="_blank" rel="noopener">FUSE for OS X</a> (There’s a prior version called MacFUSE, you don’t want that). Once installed, reboot your Mac. By itself, FUSE for OS X doesn’t do much, it provides the layer for userspace filesystems, but no filesystems itself, so <a href="https://osxfuse.github.io/" target="_blank" rel="noopener">download</a> (found on the FfOSX page) and install SSHFS as well.</p>
<h2 id="key-idea">key idea</h2>
<p>All one has to do is bind the one local port (e.g. 33333) of my VPS to a port (e.g. 22222) on remote server. The port of remote server is the one used to establish reverse SSH tunnel.</p>
<h2 id="concret-steps">concret steps</h2>
<h3 id="bind-one-local-port-with-port-in-relay-server">1. Bind one local port with port in relay server</h3>
<p>One one terminal and type into the following command: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -L 33333:localhost:22222 &lt;user_on_relay_server&gt;@&lt;relay_server_addr&gt;</span><br></pre></td></tr></table></figure> With above command, one has to keep this terminal window open. If you want to keep this binding running in the background: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ssh -NfL 33333:localhost:22222 &lt;user_on_relay_server&gt;@&lt;relay_server_addr&gt;</span></span><br></pre></td></tr></table></figure> Remember to adapt <code>&lt;user_on_relay_server&gt;</code> and <code>&lt;relay_server_addr&gt;</code> for your own case. The <code>-N</code> prevents SSH from executing a command on the remote system. This is useful when just forwarding ports.</p>
<p>If you have a slow network, you may wish to include the <code>-C</code> option in both the ssh and sshfs commands as well to enable compression. Don't bother if you are on a fast network as in the time taken to compress the file and send the smaller version, you can instead just get the uncompressed version quicker.</p>
<h3 id="create-a-local-mount-point-and-mount-the-remote-file-system">2.create a local mount point and mount the remote file system</h3>
<p>Then, mounting the directory <code>my_remote_server:/home/path/to/folder</code> to a local foler for example named <code>pcB</code> on <code>my_working_laptop</code>. First create a mount point: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir /mnt/pcB</span></span><br></pre></td></tr></table></figure> Where you mount it matters as that’s where the drive icon will appear. In the above example, I create the local mount point in the Desktop folder, which makes the drive appear on the Desktop when mounted. The downside of that, is then when the drive is not mounted, you have an empty folder that appear on the Desktop.</p>
<p>Another popular approach is to mount it in <code>/Volumes</code>, where OS X traditionally mounts drives. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir /Volumes/server</span></span><br></pre></td></tr></table></figure></p>
<p>Then mount the folder with the following command: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshfs -o defer_permissions -o port=33333 -o volname=sfc103demo &lt;user_at_my_remote_server&gt;@localhost:/home/path/to/folder /mnt/pcB</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>-o defer_permissions</code>: this option is very important. Without this option, we will encounter error <code>permission defined</code> if we try to write something into the mounted directory.</li>
<li><code>-o volname=Server</code> sets the name that the volume will have in the Finder. Otherwise it’s called something like <code>OSXFUSE Volume 0</code> (sshfs)</li>
</ul>
<p>By default, the file system is only visible to the person that mounted it. To allow other users to see it you can add <code>-o allow_other</code> to the command line. This can be a little dangerous when combined with <code>-o defer_permissions</code> as everyone will have the permissions of the account that was used for the SSH connection. Use this option with care.</p>
<h3 id="unmount-the-file-system">3.unmount the file system</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount &#x2F;mnt&#x2F;pcB</span><br></pre></td></tr></table></figure>
<p>Remember to replace <code>/mnt/pcB</code>. In Mac OSX, one can also eject the mounted file system in the Finder. (key combination <code>cmd+shift+G</code> to open any folder within Finder window)。</p>
<p>If you encounter the following messages: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount(/mnt/pcB): Resource busy -- try 'diskutil unmount'</span><br></pre></td></tr></table></figure> or <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> fusermount -u /mnt/pcB/</span></span><br></pre></td></tr></table></figure> You may use: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diskutil unmount &#x2F;mnt&#x2F;pcB</span><br></pre></td></tr></table></figure> You can refer to <a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a> for more details.</p>
<h3 id="killing-the-tunnel-mount_remote_fs">4.Killing the tunnel <a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a></h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ps ax | grep <span class="string">"ssh_command"</span> | awk <span class="string">'&#123;print $1&#125;'</span> | \</span></span><br><span class="line">  xargs -i kill &#123;&#125; 2&gt;/dev/null</span><br></pre></td></tr></table></figure>
<p>Firstly, ps is used to find all running processes. We then pipe the output to grep which looks for &quot;ssh_command&quot; (which should be replaced with whichever command you used to establish the tunnel). Then we use awk to return only the PID numbers for the relevant processes and these are finally piped to kill to terminate the process. All errors are redirected to /dev/null. For a simple explanation of output redirection, see this <a href="http://www.xaprb.com/blog/2006/06/06/what-does-devnull-21-mean/" target="_blank" rel="noopener">tutorial</a>.</p>
<h1 id="part-8-git-over-ssh-git_over_ssh">Part 8: Git over SSH <a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a></h1>
<h1 id="part-9-rsync-through-an-ssh-tunnel">Part 9: Rsync through an SSH tunnel</h1>
<p>Ref: http://toddharris.net/blog/2005/10/23/rsyncing-through-an-ssh-tunnel/</p>
<p><code>curl</code>, the HTTP client used by Git, supports SOCKS proxies as provided by <code>ssh -D</code> dynamic tunnel.</p>
<ol type="1">
<li>Set up a dynamic (SOCKS) tunnel with: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &lt;username&gt;@serverA -D 1080 -N</span><br></pre></td></tr></table></figure></li>
<li>Configure Git to use it as a proxy: Globally (or per-repository) <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config [--global] http.proxy socks5:&#x2F;&#x2F;localhost:1080</span><br></pre></td></tr></table></figure> For a single command: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git -c http.proxy&#x3D;socks5:&#x2F;&#x2F;localhost:1080 clone http:&#x2F;&#x2F;serverB&#x2F;repo.git</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="tcpdump-over-ssh-tunnel-and-read-capture-with-local-wireshark">Tcpdump over SSH tunnel and read capture with local wireshark</h1>
<p>It’s often more useful to capture packets using <code>tcpdump</code> rather than <code>wireshark</code>. For example, you might want to do a remote capture and either don’t have GUI access or don’t have Wireshark installed on the remote machine.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i &lt;interface-name&gt; -s 65535 -w &lt;some-file&gt;</span><br></pre></td></tr></table></figure>
<p>Imagine now you want to capture traffic on remote server and use local wirehshark to read captured traffic. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &lt;remote_server&gt; "sudo tcpdump -s0 -w - 'port 8080'" | wireshark -k -i -</span><br></pre></td></tr></table></figure></p>
<p><code>tcpdump</code> requires priveldged right to be launched. To avoid inputing password, it is better enable password-less <code>sudo</code></p>
<h2 id="open-the-etcsudoers-file-as-root-of-course-by-running">Open the /etc/sudoers file (as root, of course!) by running:</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo visudo</span><br></pre></td></tr></table></figure>
<p><strong>Note that you should never edit /etc/sudoers with a regular text editor, such as Vim or nano, because they do not validate the syntax like the visudo editor!</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username     ALL=(ALL) NOPASSWD:ALL</span><br></pre></td></tr></table></figure>
<p>Replace username with your account username, of course. Save the file and exit. If you have any sort of syntax problem, visudo will warn you and you can abort the change or open the file for editing again.</p>
<p>It is important to add this line at the end of the file, so that the other permissions do not override this directive, since they are processed in order.</p>
<h1 id="use-ssh-to-create-vpn">Use SSH to create VPN</h1>
<p>Refer to this tutorial: https://www.kancloud.cn/kancloud/unix-toolbox/50744</p>
<h1 id="rsync-over-ssh">Rsync over ssh</h1>
<p>https://gist.github.com/KartikTalwar/4393116</p>
<p><code>c arcfour</code>: use the weakest but fastest SSH encryption. Must specify &quot;Ciphers arcfour&quot; in sshd_config on destination. 自从 OpenSSH 7.6(?) 之后, OpenSSH 不再支持这么一个Cipher了。https://www.reddit.com/r/archlinux/comments/9wf2nd/ssh_no_arcfour_cipher/ 这个帖子里说，时代在进步，其实有其他的 Cipher 不比 arcfour 慢，但同时还更安全，干嘛不用呢？比如 chacha20-poly1305@openssh.com</p>
<p>Rsync 在大量小文件的情况下，速度要比scp快的多</p>
<p>As a test, you can change into /tmp directory and type as follows: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -aHAXxv --numeric-ids --delete --progress -e &quot;ssh -T -c chacha20-poly1305@openssh.com -o Compression&#x3D;no -x&quot; ubuntu_server:~&#x2F;Documents&#x2F;sfc-patch .</span><br></pre></td></tr></table></figure> 关于上述命令的解释:</p>
<ul>
<li>a: archive mode - rescursive, preserves owner, preserves permissions, preserves modification times, preserves group, copies symlinks as symlinks, preserves device files.</li>
<li>H: preserves hard-links</li>
<li>A: preserves ACLs</li>
<li>X: preserves extended attributes</li>
<li>x: don't cross file-system boundaries</li>
<li>--delete: delete extraneous files from destination dirs (differential clean-up during sync)</li>
<li>--progress: show progress during transfer</li>
<li>--numeric-ds: don't map uid/gid values by user/group name</li>
</ul>
<p>离开法国之前，我打算把在里尔的ubuntu_server上所有document下的数据全部拷贝至我的移动硬盘 rsync --exclude-from='rsync_exclude_file.txt' -aHAXxv --numeric-ids --delete --progress -e 'ssh -T -c chacha20-poly1305@openssh.com -o Compression=no -x' ubuntu_server:~/Documents/bake /Volumes/Memory/lille_ubunt_server/bake 注意: 原本bake这个文件夹并不存在，命令执行之后，这个文件夹会被自动创建</p>
<p>最近通过里尔ubuntu_server机器下载了一个新西兰大学网站的一个数据集，该数据集无法通过国内的网址下载获得(不知何故)，现在需要将下载好的文件从ubuntu_server下载到我的Macbook Pro上。但是，通过翻墙服务器建立的SSH链接很不稳定，经常性出现连接中断的问题。导致马上就要下载好的文件，还需要从新下载，很是不方便。经过搜索，发现rsync对于文件夹还是单个文件，都支持断点续传功能。只需要加上<code>--partial</code>参数即可。需要注意的是，对于单个大型文件，用<code>--partial</code>参数的优势非常明显，但是如果在拷贝大量文件（可能有很多小文件不需要进行文件内断点续传）的时候，就要考虑时间上的问题的了。不用-P应该可以节省不少时间。</p>
<p><code>-c aes128-ctr</code>：选择一个较弱但较快的SSH加密。其他人指定arcfour，这将需要在目标主机上手动修改ssh_config。这并非总是可能的，并且这种加密对我来说效果很好。因为传输的是一个单个大文件，所以我发现采用压缩比不压缩的传输效果好。即<code>compression=yes</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">split -a 2 -d -b 10m bigfile.tar.gz bigfile.tar.gz #将压缩包切片</span><br><span class="line">cat bigfile.tar.gz* &gt; bigfile.tar.gz #合并压缩包切片</span><br><span class="line">tar xvf bigfile.tar.gz #解压</span><br></pre></td></tr></table></figure>
<p>对于一个单一的大文件来说, 参考链接: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for d in &#96;ssh ubuntu_server &#39;find ~&#x2F;Documents&#x2F;comp_aukland -name &quot;dataset.tar.gz[0-9][0-9]&quot;&#39;&#96;; do</span><br><span class="line">    #d&#x3D;$&#123;d%$&#39;\n&#39;&#125;   # Remove a trailing newline.</span><br><span class="line">    #echo &quot;Start to fetch $&#123;d&#125;...\n&quot;</span><br><span class="line">    rsync -aHAXxv --numeric-ids --delete --progress --partial -e &#39;ssh -T -c aes128-ctr -o Compression&#x3D;yes -x&#39; ubuntu_server:&quot;$d&quot; Downloads&#x2F;comp_aukland&#x2F; &amp;</span><br><span class="line">done</span><br></pre></td></tr></table></figure></p>
<p>ssh -t ubuntu_server 'find ~/Documents/comp_aukland -name &quot;dataset.tar.gz[0-9][0-9]&quot;' | parallel -j 4 rsync -aHAXxv --numeric-ids --delete --progress --partial -e &quot;ssh -T -c aes128-ctr -o Compression=yes -x&quot; ubuntu_server:{='uq'=} ~/Downloads/comp_aukland/</p>
<p><code>ssh ubuntu_server 'find ~/Documents/comp_aukland -name &quot;dataset.tar.gz[0-9][0-9]&quot;'</code> 一旦加上<code>-t</code>,则文件末尾会莫名其妙地多了<code>#015</code>，导致无法发现真正的文件 /home/qsong/Documents/comp_aukland/dataset.tar.gz10</p>
<p>parallel通过添加选项<code>v</code>，可以帮助debug. <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rsync -av --progress --partial -e ssh -T -c aes128-ctr -o Compression&#x3D;yes -x ubuntu_server:&#39;dataset.tar.gz00 &#39; Downloads&#x2F;comp_aukland&#x2F;</span><br><span class="line">Unexpected remote arg: ubuntu_server:dataset.tar.gz00</span><br><span class="line">rsync error: syntax or usage error (code 1) at main.c(1374) [sender&#x3D;3.1.3]</span><br></pre></td></tr></table></figure> 不知道为啥文件名dataset.tar.gz00在parallel语句中被额外添加了单引号呢？？？</p>
<p>最终有效的命令是： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat test-rsync.txt | parallel --will-cite -v -j 4 rsync -aHPAXxv --numeric-ids --delete --progress -e \&quot;ssh -T -c aes128-ctr -o Compression&#x3D;yes -x\&quot; ubuntu_server:&#123;&#x3D;&#39;uq&#39;&#x3D;&#125; ~&#x2F;Downloads&#x2F;comp_aukland&#x2F;</span><br></pre></td></tr></table></figure> 注意： 1. find命令的name域不采用双引号，即-name dataset.tar.gz[0-9][0-9],则name后面的数据将不会按照正则表达式去解释，无法达到预期效果。 2. parallel里如果需要使用quote,使用转义 3. cat命令输出作为parallel输入的时候，{}作为替换字符串，默认是会加上single quote的，这样会导致rsync出现执行错误，需要使用{='uq'=}避免引入single quote</p>
<p>最终我发现一个很有意思的想象：把一个100M的大文件切割成10多个代销为10M的文件在进行传输，传输的速度是以前的4-10倍！！这一定跟rsync底层实现有关！！！可能是避免了不断来回计算两边的差异么？？？</p>
<h1 id="part-x-troubleshooting-and-tips">Part X: Troubleshooting and tips</h1>
<h2 id="connection-closed-by-remote-host-after-one-month-without-any-activity">1. connection closed by remote host after one month without any activity</h2>
<p>I haven't connected to my Ubuntu server in my office from my Macbook Pro at home since one month. In the meantime, both my VPS and my Ubuntu server have never been shut down. However, I surprisingly observe that the SSH server on my Ubuntu server does not work. When I log into my VPS and further try to ssh into my laptop server, the following error are prompted (in the terminal of my VPS): <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh_exchange_identification: Connection closed by remote host</span><br></pre></td></tr></table></figure> At the terminal of my laptop server at school, such an error message prompts up: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connect_to localhost port 22: failed.</span><br></pre></td></tr></table></figure></p>
<p>I found that <code>sshd</code> daemon is not running at my Ubuntu server. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~ ps aux | grep sshd</span><br><span class="line">qsong    31271  0.0  0.0  15972   952 pts/2    S+   00:40   0:00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn sshd</span><br></pre></td></tr></table></figure> Naturally, I tried to restart sshd service: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">~ sudo service sshd restart</span><br><span class="line">[sudo] password for qsong: </span><br><span class="line">Job for ssh.service failed because the control process exited with error code. See &quot;systemctl status ssh.service&quot; and &quot;journalctl -xe&quot; for details.</span><br><span class="line">~ sudo systemctl restart sshd</span><br><span class="line">Job for ssh.service failed because the control process exited with error code. See &quot;systemctl status ssh.service&quot; and &quot;journalctl -xe&quot; for details.</span><br><span class="line">~ sudo systemctl status ssh.service </span><br><span class="line">● ssh.service - OpenBSD Secure Shell server</span><br><span class="line">   Loaded: loaded (&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;ssh.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: failed (Result: start-limit-hit) since mer. 2019-03-13 00:42:14 CET; 15s ago</span><br><span class="line">  Process: 31500 ExecStartPre&#x3D;&#x2F;usr&#x2F;sbin&#x2F;sshd -t (code&#x3D;exited, status&#x3D;255)</span><br><span class="line"> Main PID: 12601 (code&#x3D;exited, status&#x3D;0&#x2F;SUCCESS)</span><br><span class="line"></span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: Failed to start OpenBSD Secure Shell server.</span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: ssh.service: Unit entered failed state.</span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: ssh.service: Failed with result &#39;exit-code&#39;.</span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: ssh.service: Service hold-off time over, scheduling restart.</span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: Stopped OpenBSD Secure Shell server.</span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: ssh.service: Start request repeated too quickly.</span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: Failed to start OpenBSD Secure Shell server.</span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: ssh.service: Unit entered failed state.</span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: ssh.service: Failed with result &#39;start-limit-hit&#39;.</span><br></pre></td></tr></table></figure></p>
<p>Finally, I solve this issue by reinstalling <code>openssh-server</code> again. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get purge openssh-server</span><br><span class="line">sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure></p>
<p>Now the sshd daemon is runing again. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~ps aux | grep sshd</span><br><span class="line">root      1390  0.0  0.0  65512  5404 ?        Ss   00:46   0:00 /usr/sbin/sshd -D</span><br><span class="line">root      1510  0.0  0.0  96980  6964 ?        Ss   00:47   0:00 sshd: qsong [priv]</span><br><span class="line">qsong     1576  0.0  0.0  96980  3332 ?        S    00:47   0:00 sshd: qsong@pts/15</span><br><span class="line">qsong     2085  0.0  0.0  15940  1020 pts/15   S+   01:07   0:00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn sshd</span><br></pre></td></tr></table></figure></p>
<h2 id="how-to-check-if-a-certain-port-is-open-or-used">How to check if a certain port is open or used?</h2>
<p>We can use <code>lsof</code>. The syntax is: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo lsof -i -P -n</span><br><span class="line">$ sudo lsof -i -P -n | grep LISTEN</span><br><span class="line">$ doas lsof -i -P -n | grep &lt;A port Number&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="section"></h2>
<p>在国内，SSH连接经常会断掉，某一次断掉之后的DEBUG信息(远程VPS的IP地址已经被隐藏)如下: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">debug1: client_input_channel_req: channel 0 rtype keepalive@openssh.com reply 1</span><br><span class="line">debug3: send packet: type 100</span><br><span class="line">debug3: receive packet: type 98</span><br><span class="line">debug1: client_input_channel_req: channel 0 rtype keepalive@openssh.com reply 1</span><br><span class="line">debug3: send packet: type 100</span><br><span class="line">debug3: receive packet: type 98</span><br><span class="line">debug1: client_input_channel_req: channel 0 rtype keepalive@openssh.com reply 1</span><br><span class="line">debug3: send packet: type 100</span><br><span class="line">debug3: send packet: type 1</span><br><span class="line">debug1: channel 0: free: client-session, nchannels 1</span><br><span class="line">debug3: channel 0: status: The following connections are open:</span><br><span class="line">  #0 client-session (t4 r0 i0&#x2F;0 o0&#x2F;0 e[write]&#x2F;0 fd 4&#x2F;5&#x2F;6 sock -1 cc -1)</span><br><span class="line"></span><br><span class="line">debug3: fd 1 is not O_NONBLOCK</span><br><span class="line">Connection to XX.XX.XX.XX closed by remote host.</span><br><span class="line">Connection to XX.XX.XX.XX closed.</span><br><span class="line">Transferred: sent 5912, received 8848 bytes, in 2888.1 seconds</span><br><span class="line">Bytes per second: sent 2.0, received 3.1</span><br><span class="line">debug1: Exit status -1</span><br></pre></td></tr></table></figure></p>
<p>Refereces:</p>
<section class="footnotes">
<hr>
<ol>
<li id="fn1"><p>RUTSCHLE YVES, SSLH, http://www.rutschle.net/tech/sslh/README.html.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>SSH TUNNELLING FOR FUN AND PROFIT: AUTOSSH, https://www.everythingcli.org/ssh-tunnelling-for-fun-and-profit-autossh/<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>Systemd Essentials: Working with Services, Units, and the Journal, https://www.digitalocean.com/community/tutorials/systemd-essentials-working-with-services-units-and-the-journal<a href="#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p>Understanding Systemd Units and Unit Files, https://www.digitalocean.com/community/tutorials/understanding-systemd-units-and-unit-files<a href="#fnref4" class="footnote-back">↩</a></p></li>
<li id="fn5"><p>Simplify Your Life With an SSH Config File, https://nerderati.com/2011/03/17/simplify-your-life-with-an-ssh-config-file/<a href="#fnref5" class="footnote-back">↩</a></p></li>
<li id="fn6"><p>https://phpsolved.com/mount-point-xyz-osxfuse-volume/<a href="#fnref6" class="footnote-back">↩</a></p></li>
<li id="fn7"><p>FUSE and SSHFS on OS X, https://stuff-things.net/2015/05/20/fuse-and-sshfs-on-os-x/<a href="#fnref7" class="footnote-back">↩</a></p></li>
<li id="fn8"><p>Mounting file systems over two SSH hops, https://www.larkinweb.co.uk/computing/mounting_file_systems_over_two_ssh_hops.html<a href="#fnref8" class="footnote-back">↩</a></p></li>
<li id="fn9"><p>Tunneling git through ssh (to get past a firewall): port specification interperted as relative path?, https://superuser.com/questions/1117698/tunneling-git-through-ssh-to-get-past-a-firewall-port-specification-interpert<a href="#fnref9" class="footnote-back">↩</a></p></li>
</ol>
</section>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2015/08/01/how-to-install-ns-3-in-Ubuntu-15-04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/08/01/how-to-install-ns-3-in-Ubuntu-15-04/" class="post-title-link" itemprop="url">Ubuntu 15.04下安装NS-3</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-08-01 20:00:41" itemprop="dateCreated datePublished" datetime="2015-08-01T20:00:41+08:00">2015-08-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-25 18:27:10" itemprop="dateModified" datetime="2019-03-25T18:27:10+08:00">2019-03-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>官方教程</p>
<h1 id="prerequists">Prerequists</h1>
<p>关于Ubuntu下的Prerequistes，[1]中有很详细的解释。 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 版本管理软件</span></span><br><span class="line">sudo apt-get install git cvs mercurial</span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">sudo apt-get install gcc g++ python python-dev qt4-dev-tools bzr cmake libc6-dev libc6-dev-i386 g++-multilib gdb valgrind gsl-bin libgsl0-dev libgsl0ldbl flex bison libfl-dev sqlite sqlite3 libsqlite3-dev libxml2 libxml2-dev libgtk2.0-0 libgtk2.0-dev vtun lxc uncrustify doxygen graphviz imagemagick python-sphinx dia python-pygraphviz python-kiwi python-pygoocanvas libgoocanvas-dev libboost-signals-dev libboost-filesystem-dev openmpi-bin openmpi-common openmpi-doc libopenmpi-dev p7zip-full rar unrar autoconf </span><br><span class="line">sudo apt-get install python-pygccxml</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">Note: Sphinx version &gt;= 1.12 required <span class="keyword">for</span> ns-3.15. To check your version, <span class="built_in">type</span> <span class="string">"sphinx-build"</span>. To fetch this package alone, outside of the Ubuntu package system, try <span class="string">"sudo easy_install -U Sphinx"</span>.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">跟Tex有关的包，由于体积交大，所以最后再安装</span></span><br><span class="line">sudo apt-get install texlive texlive-extra-utils texlive-latex-extra</span><br></pre></td></tr></table></figure> # 安装 # 安装方式有好多种，我们选择Bake方法 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir repos &amp;&amp; cd repos</span><br><span class="line">hg clone http://code.nsnam.org/bake</span><br><span class="line">export PATH=$PATH:$BAKE_HOME</span><br><span class="line">export PYTHONPATH=$PYTHONPATH:$BAKE_HOME</span><br></pre></td></tr></table></figure> 执行./bake.py check, 输出为： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">qsong@sony:~/Documents/repos/bake$ ./bake.py check</span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> Python - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> GNU C++ compiler - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> Mercurial - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> CVS - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> GIT - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> Bazaar - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> Tar tool - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> Unzip tool - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> Unrar tool - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> 7z  data compression utility - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> XZ data compression utility - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> Make - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> cMake - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> patch tool - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> autoreconf tool - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> Path searched <span class="keyword">for</span> tools: /usr/<span class="built_in">local</span>/sbin /usr/<span class="built_in">local</span>/bin /usr/sbin /usr/bin /sbin /bin /usr/games /usr/<span class="built_in">local</span>/games </span></span><br><span class="line"> /home/qsong/Documents/repos/bake/bake </span><br><span class="line"> /home/qsong/Documents/repos/bake/bake bin  </span><br><span class="line"> /home/qsong/Documents/repos/bake/bake</span><br></pre></td></tr></table></figure> 上面的输出表明：一切就绪，可以安装NS-3了。首先需要告诉bake我们需要下载代码，build的版本是 3.23. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">./bake.py configure -e ns-3.23</span><br><span class="line">./bake.py show</span><br><span class="line">module: pybindgen-0.17.0.886 (enabled)</span><br><span class="line">  No dependencies!</span><br><span class="line">module: g++ (enabled)</span><br><span class="line">  No dependencies!</span><br><span class="line">module: qt4 (enabled)</span><br><span class="line">  No dependencies!</span><br><span class="line">module: python-dev (enabled)</span><br><span class="line">  No dependencies!</span><br><span class="line">module: pygraphviz (enabled)</span><br><span class="line">  No dependencies!</span><br><span class="line">module: pygoocanvas (enabled)</span><br><span class="line">  No dependencies!</span><br><span class="line">module: netanim-3.106 (enabled)</span><br><span class="line">  depends on:</span><br><span class="line">     qt4 (optional:False)</span><br><span class="line">     g++ (optional:False)</span><br><span class="line">module: pyviz-prerequisites (enabled)</span><br><span class="line">  depends on:</span><br><span class="line">     python-dev (optional:True)</span><br><span class="line">     pygraphviz (optional:True)</span><br><span class="line">     pygoocanvas (optional:True)</span><br><span class="line">module: ns-3.23 (enabled)</span><br><span class="line">  depends on:</span><br><span class="line">     netanim-3.106 (optional:True)</span><br><span class="line">     pybindgen-0.17.0.886 (optional:True)</span><br><span class="line">     pyviz-prerequisites (optional:True)</span><br><span class="line"></span><br><span class="line">-- System Dependencies --</span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> g++ - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> pygoocanvas - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> pygraphviz - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> python-dev - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> qt4 - OK</span></span><br></pre></td></tr></table></figure> 一切就绪，可以开始Download代码，并且编译(build) <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">qsong@sony:~/Documents/repos/bake$ ./bake.py download</span><br><span class="line"><span class="meta"> &gt;</span><span class="bash">&gt; Downloading pybindgen-0.17.0.886 - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash">&gt; Searching <span class="keyword">for</span> system dependency g++ - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash">&gt; Searching <span class="keyword">for</span> system dependency qt4 - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash">&gt; Searching <span class="keyword">for</span> system dependency python-dev - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash">&gt; Searching <span class="keyword">for</span> system dependency pygraphviz - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash">&gt; Searching <span class="keyword">for</span> system dependency pygoocanvas - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash">&gt; Downloading netanim-3.106 - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash">&gt; Downloading ns-3.23 - OK</span></span><br></pre></td></tr></table></figure> 教程里没有提的是，我们需要进入pybindgen-0.17.0.886，执行： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo python setup.py install</span><br></pre></td></tr></table></figure> 否则接下来的编译阶段会报错的(其实即使做了上一步还是会有错，出乎意料了，google无果。) <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qsong@sony:~/Documents/repos/bake$ ./bake.py build</span><br></pre></td></tr></table></figure> 那不如试试用waf来配置编译吧 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> change into the <span class="built_in">source</span> directory of ns-3.23</span></span><br><span class="line">cd source/ns-3.23</span><br><span class="line"><span class="meta">#</span><span class="bash"> 清楚之前编译配置而生成的文件</span></span><br><span class="line">./waf clean</span><br><span class="line"><span class="meta">#</span><span class="bash"> 采用debug的profile来配置</span></span><br><span class="line">./waf --build-profile=debug --enable-examples --enable-tests configure</span><br><span class="line"><span class="meta">#</span><span class="bash"> 编译, 不需要打 build 命令</span></span><br><span class="line">./waf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 输出结果</span></span><br><span class="line">Modules built:</span><br><span class="line">antenna                   aodv                      applications</span><br><span class="line">bridge                    buildings                 config-store</span><br><span class="line">core                      csma                      csma-layout</span><br><span class="line">dsdv                      dsr                       energy</span><br><span class="line">fd-net-device             flow-monitor              internet</span><br><span class="line">lr-wpan                   lte                       mesh</span><br><span class="line">mobility                  mpi                       netanim (no Python)</span><br><span class="line">network                   nix-vector-routing        olsr</span><br><span class="line">point-to-point            point-to-point-layout     propagation</span><br><span class="line">sixlowpan                 spectrum                  stats</span><br><span class="line">tap-bridge                test (no Python)          topology-read</span><br><span class="line">uan                       virtual-net-device        visualizer</span><br><span class="line">wave                      wifi                      wimax</span><br><span class="line"></span><br><span class="line">Modules not built (see ns-3 tutorial for explanation):</span><br><span class="line">brite                     click                     openflow</span><br></pre></td></tr></table></figure> 既然执行test中例子，看是否都可以通过 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">qsong@sony:~/Documents/repos/bake/source/ns-3.23$ ./test.py -c core</span><br><span class="line"><span class="meta">#</span><span class="bash"> 由于输出过程，这里我只贴出部分输出，其他以省略号代替</span></span><br><span class="line">...</span><br><span class="line">PASS: TestSuite lr-wpan-spectrum-value-helper</span><br><span class="line">PASS: TestSuite lte-cqi-generation</span><br><span class="line">PASS: TestSuite lte-x2-handover-measures</span><br><span class="line">PASS: TestSuite lte-frequency-reuse</span><br><span class="line">...</span><br><span class="line">201 of 204 tests passed (201 passed, 3 skipped, 0 failed, 0 crashed, 0 valgrind errors)</span><br><span class="line">List of SKIPped tests: ns3-tcp-cwnd</span><br><span class="line">    ns3-tcp-interoperability</span><br><span class="line">    nsc-tcp-loss</span><br></pre></td></tr></table></figure> 结果满意！</p>
<p>CTTC(加泰罗尼亚理工)对NS-3d的贡献(http://networks.cttc.es/mobile-networks/software-tools/ns-3/)</p>
<h1 id="参考资料">参考资料</h1>
<p>[1][NS-3官方Wiki安装文档](https://www.nsnam.org/wiki/Installation) <a href="http://askubuntu.com/questions/162391/how-do-i-fix-my-locale-issue" target="_blank" rel="noopener">How do I fix my locale issue?</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2015/08/01/win10-ubuntun-dual-boot-system/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/08/01/win10-ubuntun-dual-boot-system/" class="post-title-link" itemprop="url">Windows 10 和 Ubuntu 15.04 dual-boot 系统安装全攻略</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-08-01 16:33:47" itemprop="dateCreated datePublished" datetime="2015-08-01T16:33:47+08:00">2015-08-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-25 18:27:10" itemprop="dateModified" datetime="2019-03-25T18:27:10+08:00">2019-03-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>2015年7月末，微软终于发布了新一代操作系统Windows 10。据说相对于Windows 8有了非常大的改进，加上利用学校的邮箱可以免费下载到MSNAA的ISO镜像并且附送激活码，更重要的是，现在手里有一台购于2013年西天，型号为SVE141CCW的SONY电脑闲置。所以，我决定抽出一两天的时间，在这台PC上搭建一个 Windows 10&amp;Ubuntu 15.04 双系统：像文字处理，游戏之类的可以在 windows 平台下处理；开发编程Geek相关的东西可以在 Linux(Ubuntu)下来处理。完美！</p>
<h1 id="安装-windows-10">安装 Windows 10</h1>
<h2 id="下载-windows-10镜像">下载 Windows 10镜像</h2>
<p>国外上学的孩子比较幸福的一点儿就是，可以通过学校的邮箱来免费使用微软收费的软件，比如各种操作系统。现在Windows发布了，我当然不能错过这样的机会了。登陆我的MSNAA账号，发现与以往不同，对于Windows 10 有好多版本，不知所云。 <img src="http://7xkqa9.com1.z0.glb.clouddn.com/available-win10-version.png" alt="Available windows 10 version proposed by DreamSpark"><span class="image-caption">Available windows 10 version proposed by DreamSpark</span></p>
<p>来看看<a href="http://www.reddit.com/r/Windows10/comments/3f14bg/win10_just_popped_up_in_my_dreamspark_premium_but/," target="_blank" rel="noopener" title="reddit">Reddit讨论帖</a>里面大家是怎么说吧 &gt;Windows 10 EDU and Windows 10 Multiple versions are probably the only ones of interest to you. &gt;Windows 10 EDU is a educational version which is similar in feature set to Windows 10 enterprise &gt;Windows 10 (Multiple Editions) will give you the option to install Windows 10 home or professional. &gt;The N versions are identical but do not include media software such as windows media player or dvd playback software. These versions are provided as I believe it is a law for the EU to have an option that gives users choice for what software to use rather than the Microsoft default. &gt;The Features on demand only contains the core basic components of Windows and others can be chosen to be installed. &gt;The IoT versions are stripped down version meant to be used on low power hardware like a Raspberry Pi. &gt;The language packs I believe are just provide options for localising Windows in to different languages. &gt;The debug checked and symbols versions are versions which are more suitable for development and debugging of OS like features. They do not use as much compiler optimisation so identifying and diagnosing operating-system-level problems are easier. So stuff like drivers would be developed on these versions.</p>
<p>关于下载镜像，还有一个插曲：最开始我是通过Mac来下载ISO的，家里网速较慢没有下载完我就去睡觉了，第二天醒来发现下载的ISO文件只有不到3G，当时就很奇怪：不是说 windows 10的安装镜像是3 G多么？为啥我的只有2.3G呢？我想莫非学生优惠版的确实就是小么？后来用这个镜像刻录出来的U盘是无法启动的！再后来我在 Windows 平台又下载同样的文件，显示是3.8G 这才是Win10镜像的正常大小！而且下载速度也是快的多。可惜微软没有提供这些镜像的哈希值，我们也无从校验我们下载的东西是否完整，通过这个事儿，第一次感觉到，下载完大文件之后，核对下哈希值还是很有必要的。</p>
<h2 id="制作-windows-10-usb-bootable-安装盘">制作 Windows 10 USB-bootable 安装盘</h2>
<p>现在最流行的操作系统安装方式便是通过制作 USB-bootable 启动盘了。我是用的制作工具是：<a href="https://rufus.akeo.ie/" target="_blank" rel="noopener">Rufus</a>。下面是我当时查看的教程<a href="http://www.groovypost.com/howto/create-windows-10-bootable-usb-flash-drive/" target="_blank" rel="noopener">Create a Windows 10 USB Bootable Flash Drive (Updated)</a>。后来才意思到这其实做的是不支持UEFI的安装盘，其实这也给我带来了些许困扰。因为下面我要说的 Ubuntu 15.04 的安装盘确实支持 UEFI的。虽然我勾选了: MBR partition scheme for BIOS or UEFI computers。写这篇文章的时候才发现还可以通过Rufus来制作 UEFI-supported 的安装盘。请看教程<a href="http://news.mydrivers.com/1/440/440478.htm" target="_blank" rel="noopener">教你制作支持UEFI PC的Win10安装U盘</a></p>
<h2 id="uefi-vs-legacy-mode">UEFI vs Legacy mode</h2>
<p>帖子<a href="http://ubuntuforums.org/showthread.php?t=2248301" target="_blank" rel="noopener">Can i install windows 10 tech preview along ubuntu 14.04?</a>中指出，windows installer 会把 Windows boot loader 安装在每一个硬盘分区上。这意味着，如果我们的PC如果之前就安装有 Ubuntu 的话，安装 Windows 之后，我们将没有办法直接登录 Ubuntu 了，需要使用 <a href="https://help.ubuntu.com/community/Boot-Repair" target="_blank" rel="noopener">Boot Repair</a>来做一些修复。</p>
<p>这个UEFI实在是太折磨人了，感觉完全颠覆了我之前的安装系统的习惯啊 用U盘刻录了一个USB-installer，使用Assist-&gt;F11(用光盘/USB启动)，结果发现显示opertation system not found。给我郁闷了，好在这是一个常见问题，视频<a href="https://www.youtube.com/watch?v=65Kb3meWeDs" target="_blank" rel="noopener">How To Fix Operating System Not Found Error In Sony Vaio</a>给我解答了我的问题。总结一下思路就是：进入BIOS设置，将Boot mode由 UEFI转换为Legacy, 并且External Bootable device由 disable变为 enable。这个时候就可以使用 win10-usb-installer了。</p>
<p><a href="https://help.ubuntu.com/community/UEFI" target="_blank" rel="noopener">UEFI</a> 目前主流的启动模式为：UEFI mode 以及 BIOS mode。BISO mode我们都比较熟悉了，这里不做介绍。如今预装win8的机器都采用的UEFI模式。</p>
<h2 id="开始安装">开始安装</h2>
<p>因为一个星期前，我才刚把这台可怜的电脑上的 Windows 8 彻底格式化安装了 Ubuntu, 现在我又需要把后者再格式掉，全硬盘安装 Windows 10(可惜了我刚安装好的NS-3)。 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Windows cannot be installed to this disk. The selected disk is of the GPT partition style. Windows cannot be installed to this hard disk space. Windows must be installed to a partition formatted as NTFS. Windows cannot be installed to this hard disk space. The partition is of an unrecognized type.</span><br></pre></td></tr></table></figure> 在把所有 Windows installer 无法识别的分区都删除掉之后，我们看到有一个将近700 G的未分配空间，如下图所示。 <img src="http://7xkqa9.com1.z0.glb.clouddn.com/win10-installation-unallocated-disk.jpg" alt="全硬盘安装 windows 10"><span class="image-caption">全硬盘安装 windows 10</span> 很有意思，为了安装 windows 10，系统会额外给我创建一个500 MB的 system reserved 分区处理，特此截图留念： <img src="http://7xkqa9.com1.z0.glb.clouddn.com/win10-installation-after-allocation.jpg" alt="为 windows 10 分配磁盘空间"><span class="image-caption">为 windows 10 分配磁盘空间</span></p>
<h2 id="硬盘分区">硬盘分区</h2>
<p>安装完Windows之后，现在就一个硬盘分区，安装完 windows 10，系统文件占了将近20 G，记得以前学校的老师说过，建议把所有的软件都安装到C盘，这样可以避免一些意想不到的问题。所以我觉得分150G 给C盘比较合适，如果以后安装了游戏，可以考虑放到D盘什么。受Linux还有Mac使用经验影响，我决定再只分出一个D盘专门用来存放非系统文件。剩余的将近150G空间则给Linux之用。分区工具我使用的是<a href="http://www.disktool.cn/download.html" target="_blank" rel="noopener">分区助手</a>，确实还是蛮好用的，下图是分区完毕之后： <img src="http://7xkqa9.com1.z0.glb.clouddn.com/hard_disk_repartition.PNG"></p>
<p>#安装 Ubuntu 15.04 现在开始安装 Ubuntu 15.04, 第一个麻烦就是：电脑无法识别我U盘里的Ubuntu，又是头一次遇到这种问题，屏幕上只显示： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SYSLINUX 4.04 EDD 20110518 Copyright (C) 1994-2013 H. Peter Anvin et al</span><br></pre></td></tr></table></figure> 还好有人遇到跟我一样的问题，我马上怀疑是不是又是由于 UEFI/legacy mode的缘故。为了安装 Windows 10 我把这个设定由UEFI变成了 Legacy mode，而现在我制作的 Ubuntu安装盘应该是 UEFI模式，只有切换回来，电脑才可以找到操作系统入口，事实证明，我的猜想是正确的。不过在一开始安装Ubuntu的时候，安装程序就检测出来了有非UEFI模式下安装的其他操作系统存在，如下图所示： <img src="http://7xkqa9.com1.z0.glb.clouddn.com/warning.png" alt="警告"><span class="image-caption">警告</span> 仔细阅读之后，我觉得我应该选<em>Go Back</em>，回过头来看，这里的<em>Go Back</em>应该指的是用Legacy mode(而不是UEFI模式)。另外，下图佐证了：我安装的 Windows 10是基于MBR的，因为Disklabel type: dos，如果是基于GPT的，我们应该看到的是：Disklabel type: gpt。 <img src="http://7xkqa9.com1.z0.glb.clouddn.com/ubuntu_fdisk_output.png" alt="Ubuntu fdisk 结果"><span class="image-caption">Ubuntu fdisk 结果</span> <img src="http://7xkqa9.com1.z0.glb.clouddn.com/partition_root.png" alt="Root分区分配示意图"><span class="image-caption">Root分区分配示意图</span> 关于swap分区介绍(https://www.maketecheasier.com/swap-partitions-on-linux/) 设置为primary分区是无法继续分割的。。。 <img src="http://7xkqa9.com1.z0.glb.clouddn.com/hard_partion_ubuntu_installation.png" alt="xxx"><span class="image-caption">xxx</span> <img src="http://7xkqa9.com1.z0.glb.clouddn.com/partition_swap.png" alt="Swap分区分配示意图"><span class="image-caption">Swap分区分配示意图</span> <img src="http://7xkqa9.com1.z0.glb.clouddn.com/partition_resume.png" alt="最终分区示意图"><span class="image-caption">最终分区示意图</span> 其实做完分区开始安装还是蛮紧张的，因为生怕安装了 Ubuntu了以后，就再也没法启动 windows 了，最坏的情况就是，就是两个系统都进不去了(现在想想，好像没有道理无法登陆 Ubuntu)。 <img src="http://7xkqa9.com1.z0.glb.clouddn.com/update_grub_output.png" alt="Ubuntu update-grub 结果"><span class="image-caption">Ubuntu update-grub 结果</span> 因为是在UEFI模式下读取的U盘但是安装的是非UEFI模式，所以开机的时候，又是Operation system not found。选择回 Legacy mode，终于顺利启动！ 为了进一步验证，现在Ubuntu处于Legacy模式下，输入下面命令： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">如果/sys/firmware/efi文件夹存在，则显示<span class="string">"EFI boot on HDD"</span>。不然则显示<span class="string">"Legacy boot on HDD"</span></span></span><br><span class="line">[ -d /sys/firmware/efi ] &amp;&amp; echo "EFI boot on HDD" || echo "Legacy boot on HDD"</span><br></pre></td></tr></table></figure> 结果显示为&quot;Legacy boot on HDD&quot;。(曾经显示为EFI boot on HDD)</p>
<p>最后还有个问题就是：每次在Windows和Ubuntu之间切换时间就不一致了。</p>
<h1 id="参考资料">参考资料</h1>
<p><a href="http://askubuntu.com/questions/221835/installing-ubuntu-on-a-pre-installed-windows-8-64-bit-system-uefi-supported" target="_blank" rel="noopener">Installing Ubuntu on a Pre-Installed Windows 8 (64-bit) System (UEFI Supported)</a> <a href="http://linuxbsdos.com/2015/01/18/tip-for-dual-booting-windows-10-preview-and-linux-on-a-pc-with-uefi-firmware/" target="_blank" rel="noopener">Tip for dual-booting Windows 10 preview and Linux on a PC with UEFI firmware</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2015/07/30/Common-used-vim-commands/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/07/30/Common-used-vim-commands/" class="post-title-link" itemprop="url">常用 VIM 命令备忘</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-07-30 23:59:36" itemprop="dateCreated datePublished" datetime="2015-07-30T23:59:36+08:00">2015-07-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-25 18:27:10" itemprop="dateModified" datetime="2019-03-25T18:27:10+08:00">2019-03-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>利用此贴记录下自己常用的VIM的命令，备忘： 在command mode下，键入 shift+G: 跳转至文章的最后一行 gg: 跳转至文章的开头 o: 跳转至光标当前所在行的下一行并进入insert mode</p>
<p>Error trying to parse settings: Unexpected character, expected a comma or closing bracket in Packages/OmniMarkupPreviewer/OmniMarkupPreviewer.sublime-settings:88:103</p>
<p><a href="http://www.tecmint.com/35-practical-examples-of-linux-find-command/" target="_blank" rel="noopener">35 Practical Examples of Linux Find Command</a></p>
<p>网页链接<a href="http://www.ruanman.net/archives/7623.html#comments" target="_blank" rel="noopener">Mac Office 2016正式版下载附破解补丁</a>里面较全面详细地介绍了如何下载，安装以及破解Office 2016 for Mac.</p>
<p>问题在于：</p>
<p>需要一个Microsoft account这个还蛮有意思的，这是在效仿Apple嘛。在开机初始化阶段关联一个Account。</p>
<p>安装完之后，无线网卡的驱动是有的，这点儿还是蛮欣慰的。至少这样我有网络连接去下载其他驱动啊。显卡驱动显然没有安装，画面看着真是巨渣。</p>
<p>其实升级到Win10后无需再像以前那样繁琐地检测系统硬件、显卡型号，然后再到处搜索下载驱动程序。在Windows 10中，只需通过Windows更新即可方便地下载安装驱动程序。开始-&gt;settting-&gt;update&amp;security-&gt;Windows update</p>
<p>#汉字字符显示问题 关键：将non-Unicode编码为 汉语</p>
<p>#应用程序安装 第一个先安装Google chrome 改变默认程序的方法： To chagne your default apps, go to Settings-&gt;System-&gt;Default apps 第二个是office QQ, skype之类的还有 其他也确实想不到该去安装什么了(目前)</p>
<p>Ubuntu的社区对Grub2有很好的说明的。</p>
<p>#Ubuntu开发环境搭建 (这个其实可以专门写个文章了) 更新系统软件仓库 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get udpate</span><br></pre></td></tr></table></figure> 安装openssh-server, 以便从mac上ssh进入这台机器, 安装VIM，以方便编辑配置文件 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssh-server vim</span><br><span class="line">ps aux | grep sshd</span><br></pre></td></tr></table></figure> 如果发现有sshd守护进程运行，则说明openssh server成功安装并且启动。 接下来在Ubuntu下创建公钥私钥，以便可以不需要密码接入 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure> 接下来将Mac上的公钥copy到Ubuntu下 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ssh-copy-id可以通过Homebrew安装</span></span><br><span class="line">ssh-copy-id qsong@10.35.130.207</span><br></pre></td></tr></table></figure> 还是不习惯使用Utity界面，还是使用传统界面吧 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gnome-session-flashback</span><br></pre></td></tr></table></figure> 安装完毕之后，log out再log in就生效了。 用命令行访问 Windows 10 分区 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">首先需要知道 哪个分区(sdaX)是我们需要访问的分区</span></span><br><span class="line">cat /proc/partitions</span><br><span class="line"><span class="meta">#</span><span class="bash">接下来在/mnt创建一个文件夹，用以挂载我们需要访问的分区</span></span><br><span class="line">mkdir /mnt/win</span><br><span class="line"><span class="meta">#</span><span class="bash">接下来, 挂载分区。注意将X换成相应的数字，比如3</span></span><br><span class="line">mount /dev/sdaX /mnt/win</span><br><span class="line"><span class="meta">#</span><span class="bash">我们可以通过命令行访问分区了</span></span><br><span class="line">cd /mnt/win</span><br></pre></td></tr></table></figure> 不过，现在 Ubuntu 系统都会默认把 windows partition 挂载在某个挂载点的(通常在/media之下)。如何获取哪个分区挂载哪个挂载点之下呢？有以下几种方法 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">方法一：</span></span><br><span class="line">cat /etc/mtab</span><br><span class="line"><span class="meta">#</span><span class="bash">方法二：</span></span><br><span class="line">df</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2015/07/29/How-to-install-node-js-and-npm-on-Mac/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/07/29/How-to-install-node-js-and-npm-on-Mac/" class="post-title-link" itemprop="url">如何在Mac Yosemite中安装node.js以及NPM</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-07-29 21:04:34" itemprop="dateCreated datePublished" datetime="2015-07-29T21:04:34+08:00">2015-07-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-08 12:06:52" itemprop="dateModified" datetime="2020-06-08T12:06:52+08:00">2020-06-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>想要使用 Githubs pages 和 hexo 搭建一个静态博客站点，因为 hexo 是台湾小伙儿 tommy3551 使用 Node.js 开发的一个模板引擎，以及我的工作电脑的操作系统系统是 Mac 10.10.4 (Yosemite)。因此，为了使用 hexo, 我首先需要在Mac下安装 node 以及 npm。经过调查，发现 Node js在Mac下有两种安装方式:</p>
<ul>
<li>基于pkg installer安装</li>
<li>通过Homebrew安装</li>
<li>通过NVM安装</li>
</ul>
<p>由于最近使用Homebrew比较多，以及Homebrew以其卓越的用户体验，让我渐渐觉得，好像Mac下凡是跟开发有关的工具/环境都应该通过brew安装。登陆Node.js的官网，看到还有pkg安装包的安装包的方式，猛一下的困惑了，这两种方式我究竟该用哪个呢？</p>
<h1 id="误入歧途">误入“歧途”</h1>
<p>Google is your teacher. 习惯性的先上网搜了一下，Stack overflow上有一篇帖子讨论了在Mac下究竟哪种方式更方便。看完之后，我感觉，哦，好像直接使用pkg安装包更合适了，心想也是啊，其他开发工具，没有pkg我才使用Homebrew呢，现在有pkg installer,我干嘛不用呢？</p>
<p>于是，直接下载安装一气呵成。使用的时候，比如输入 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo -g</span><br></pre></td></tr></table></figure> 系统提示需要管理员权限，Mac下不用sudo好多年啊，好吧，那就sudo一下呗，心想，要是用brew安装不久没这个不便了么，其实我应该使用brew的呀。再后来，使用bew的时候，习惯性地来了个 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">brew doctor</span></span><br></pre></td></tr></table></figure> 输出显现，/usr/local下面有跟node有关的文件，不是被brew管理的，虽然我不是个有洁癖或者强迫症的人，但是看了一下基本上/usr/local/bin里面的文件，基本owner都是自己啊，现在突然多了一下root的感觉还是怪不爽的，年轻人就是喜欢折腾，我还是删了pkg安装的node改用brew再安装一遍吧。自己就是作啊。。。</p>
<h1 id="弃暗投明">弃暗投明</h1>
<p>第一步需要删除已安装的node, 这个帖子：https://gist.github.com/TonyMtz/d75101d9bdf764c890ef 好评如潮，事实证明，确实是好用，不过我对其略有补充，所以这里再把使用的命令粘过来。 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> First list what files are installed by pkg-installer with <span class="built_in">command</span> lsbom</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Use a loop <span class="keyword">in</span> shell to delete them</span></span><br><span class="line">lsbom -f -l -s -pf /var/db/receipts/org.nodejs.pkg.bom | while read f; do  sudo rm /usr/local/$&#123;f&#125;; done</span><br><span class="line"><span class="meta">#</span><span class="bash"> Then delete all node-related bin files under /usr/<span class="built_in">local</span>/bin</span></span><br><span class="line">sudo rm -rf /usr/local/lib/node /usr/local/lib/node_modules /var/db/receipts/org.nodejs.*</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> To recap, the best way (I<span class="string">'ve found) to completely uninstall node + npm is to do the following:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">go to /usr/<span class="built_in">local</span>/lib and delete any node and node_modules</span></span><br><span class="line">cd /usr/local/lib</span><br><span class="line">sudo rm -rf node*</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> go to /usr/<span class="built_in">local</span>/include and delete any node and node_modules directory</span></span><br><span class="line">cd /usr/local/include</span><br><span class="line">sudo rm -rf node*</span><br></pre></td></tr></table></figure> 现在我们可以使用Homebrew来安装node.js以及npm了，很简单： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew instal node</span><br></pre></td></tr></table></figure> 应该会成功。。。吧。。。 # 柳暗花明 不过，让我震惊的是，我居然得到了一些错误信息： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Bash completion has been installed to:</span><br><span class="line">  /usr/local/etc/bash_completion.d</span><br><span class="line">Error: The `brew link` step did not complete successfully</span><br><span class="line">The formula built, but is not symlinked into /usr/local</span><br><span class="line">Could not symlink share/systemtap/tapset/node.stp</span><br><span class="line">/usr/local/share/systemtap/tapset is not writable.</span><br></pre></td></tr></table></figure> 我第一反应就是：还是之前由于pkg安装后的遗毒啊。网上有些人遇到了跟我一样的问题，比如这篇帖子：<a href="http://stackoverflow.com/questions/31374143/trouble-install-node-js-with-homebrew" target="_blank" rel="noopener">Trouble install node.js with homebrew</a>。这篇帖子印证了我的猜想，我猜测这是因为pkg包安装node的时候，以root身份创建了文件/usr/local/share/systemtap/tapset。现在Homebrew再来安装的时候，没有办法对该文件读写。于是爆出了上述错误。好的补救措施如下： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将yourusername以及yourgroupename换成你需要的名字</span></span><br><span class="line">chown -R &lt;yourusername&gt;:&lt;yourgroupname&gt; systemtap</span><br><span class="line">brew link node</span><br></pre></td></tr></table></figure></p>
<p>现在大功告成啦！</p>
<h1 id="风云再起">风云再起</h1>
<p>2016年伊始，又想重新开始使用hexo记录博客了，没想到hexo不工作了，而且越倒腾越乱，好像网友有人推荐彻底卸载node npm hexo重新再安装，于是乎，发现了一种更灵活的node体系安装方法：通过NVM（Node Version Manager）, 以下是网友给出的很详细的教程：(http://icarus4.logdown.com/posts/175092-nodejs-installation-guide)</p>
<h1 id="总结">总结</h1>
<p>其实并不是用Homebrew安装node+npm就一定比用编译好的pkg安装包好，只是我个人的喜欢觉得还是用brew管理的更好而已，重要的是选择自己用着觉着顺手的就行。</p>
<h1 id="参考资料">参考资料</h1>
<p><a href="http://blog.teamtreehouse.com/install-node-js-npm-mac" target="_blank" rel="noopener">How to Install Node.js and NPM on a Mac</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2015/07/28/Apply-USA-VISA-in-Paris/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/07/28/Apply-USA-VISA-in-Paris/" class="post-title-link" itemprop="url">2015年巴黎申请美国10年签证全攻略</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-07-28 22:19:24" itemprop="dateCreated datePublished" datetime="2015-07-28T22:19:24+08:00">2015-07-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-27 21:56:52" itemprop="dateModified" datetime="2019-03-27T21:56:52+08:00">2019-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AD%BE%E8%AF%81/" itemprop="url" rel="index"><span itemprop="name">签证</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言">前言</h1>
<p>话说，今年3月向 VTC2015fall 投了一篇论文，5月中下旬的时候收到邮件说论文被接收了，很开心。一方面这是自己人生的第一篇Paper, 另一方面会议的地点是Boston。利用这次开会的机会，终于有机会亲赴美帝，好好了解一下这个建国不过三百年却跻身为蓝星历史上第一强权的国家。另外女朋友Y之前也从来没有去过美国，也对这个国家充满了好奇(其实是shopping), 而且博士期间也很有可能要去美国开会。刚好利用这次机会，我们俩准备一起申请美国签证，旅游学术爱情三不误。</p>
<p>梦想是美好的，现实是残酷的。由于众所周知的原因， 持有中国国籍的在读博士在法国申请赴美签证不是那么容易的，一般都要经历所谓的 <strong><em>check</em></strong> 阶段，时间从一周至三个月不等。网上因为被check各种求助该怎么办的帖子一搜一大堆。比如我认识的 Rennes 读博士的小伙伴，不论是去开会还是旅游，都经历过万恶的 check。甚至有人因为 check 时间过久而最终没能去参加会议。其实不只是对于中国人是这样，外国友人也不能例外啊，比如委内瑞拉的小伙伴，也经过过3个星期的等待。所以得知论文被接受之后，Xavier 就跟我说，要我抓紧时间申请 VISA，以免跟上次大师兄一样，会议前3天才拿到。不过Y身边的朋友跟我得到信息却是相反的，因她的朋友们申请美国会议签证基本都是秒过，最长的也没有超过一周，从来没有遇到我们雷恩小伙伴的这种窘境。不过不管谁是对的，作为万里长征的第一步，我们必须赶快着手把签证搞起来，这样即使被 check 了，6，7，8月三个月还是等的起的。还好一切都是出奇的顺利，我6月2日开始填写DS-160表格(女朋友是6月17开始填的表格)，结果7月3，4日我俩就先后收到各自带有10年美国签证的护照。这期间人品是各种的好！在去面签的那天，我俩就说过，如果签证顺利拿到了，就赶紧把着申请流程记录下来，既是一段美好的回忆又可以帮到其他有需要的同学。何乐而不为呢？另外, 我这次申请的是会议签证，Y申请的是旅游签证，常见的赴美签证类型一下子就都被我俩囊括了。所以记录下整个流程我相信是有价值的，希望可以帮到更多的朋友。</p>
<p>整个签证的申请可以用下面这个时间线来概括。接下来我就详细地介绍下我们是如何一步步完成签证申请并且最终顺利拿到签证的。 * 2015-06-02 填写 DS-160 表格 * 2015-06-10 完成 DS-160 表格 * 2015-06-16 签证费转账成功预约面签时间 * 2015-06-30 巴黎美国大使馆面签 * 2015-07-03 收到带签证护照</p>
<h1 id="ds-160填写"><a href="https://ceac.state.gov/genniv/" target="_blank" rel="noopener">DS-160填写</a></h1>
<p>个人感觉申请美国签证最麻烦最“困难”的一个环节是 DS-160 表格的填写。不过还好，众多拿到过美国签证的小伙伴们都充分发挥了共产主义精神，在网上详细的填写说明俯拾皆是。不过好多帖子的日期都是过去一两年的了，DS-160 表格也有一些变化，所以我在这里做一个总结性的工作，详细地介绍每一页我是怎么填写的</p>
<h2 id="step-1-创建申请">step 1: 创建申请</h2>
<p>由于博主身在法国留学，自然而然应该选择 France,Paris 了，然后点击 <strong>Start an Application</strong>。系统会给你创建一个 Appplication ID 的，记好这个ID。 <img src="/images/USA_VISA/DS-160-step-1.png" class title="DS-160 主页"></p>
<h2 id="step-2-申请者个人信息">step 2: 申请者个人信息</h2>
<p>个人信息分由两页构成。以下都是不完全截图，博主用红色方框勾出了值得注意的地方 <img src="/images/USA_VISA/DS-160-Personal-information-1.png" class title="Personal information 1"></p>
<p>下图中的 National Identification Number指的是身份证号而非护照号，护照号需要在以后的页面中填写。 <img src="/images/USA_VISA/DS-160-Personal-Information-2.png" class title="Personal information 2"></p>
<h2 id="step-3-地址及联系方式">step 3: 地址及联系方式</h2>
<p>如实填写即可，为了避免本文图片过多，影响加载速度，所以这里不予贴图。后面的step 6,7,9,11也是类似情况。</p>
<h2 id="step-4-护照信息">step 4: 护照信息</h2>
<p>需要指出的是：Passport Book Number这一项，对于我们中国护照而言，就是护照信息页右边竖着写的那8位数字, 而不是我们的Passport number <img src="/images/USA_VISA/DS-160-Passport-information.png" class title="Passport information"></p>
<h2 id="step-5-旅行信息">step 5: 旅行信息</h2>
<p>博主以及博主女朋友去美国签证都是B类型的，不管商务会议还是旅游，都选择 B1&amp;B2 <img src="/images/USA_VISA/DS-160-Travel-information.png" class title="Travel information"></p>
<h2 id="step-6-同行者信息">step 6: 同行者信息</h2>
<p>虽然我们俩个是一起去美国，但是我是去开会，女朋友是去旅游，所以这一页面，我们选择的都是No。</p>
<h2 id="step-7-之前的美国旅行">step 7: 之前的美国旅行</h2>
<p>之前从未去过美国，所以都是No</p>
<h2 id="step-8-美国联系人信息">step 8: 美国联系人信息</h2>
<p>这是我花费时间最多的地方，鉴于我是去参加会议，所以之前一直以为这一页我应该填写 VTC 这个会议 General Chair 的信息。同事说，这类信息都会在会议发的邀请信上写出来的。所以一开始我填到这页时候就停了下来，等着 VTC 给我发信息了。谁知道 VTC 今年的组织比较混乱，我迟迟拿不到邀请信(现在都木有！！！)，所以最后我 Google 了一下 Chair 信息自己填了进去。后来网上说，其实填写你居住酒店的联系方式都是可以的。 <img src="/images/USA_VISA/DS-160-Point-of-contact.png" class title="Point of contact information in USA"></p>
<h2 id="step-9-父母信息">step 9: 父母信息</h2>
<p>这一页无他可言。</p>
<h2 id="step-10-工作教育培训">step 10: 工作/教育/培训</h2>
<p>这一项里我犯过一个错误。我当时只填写了自己的研究生教育经历（居然忘记了填写自己的本科经历），因为我对网页上一条信息理解有误: 我以为只要填最近的一次教育经历就行。女朋友比我填 DS-160 的时间晚，所以我提醒了她要注意。不过事实证明，没有填写本科学习经历没有导致拒签，不过不建议效仿。 <img src="/images/USA_VISA/DS-160-Previous-education.png" class title="Previous working&#x2F;education&#x2F;formation experience"></p>
<h2 id="step-11-犯罪记录">step 11: 犯罪记录</h2>
<p>这一页我基本是当做拓展词汇量的阅读来做了，都是些很有意思的问题，基本上选择的都是 No 吧。</p>
<p>当一切信息都填写完毕之后，会让你上传照片的。我是用自己的Mac在自己的办公室照的，可以通过这个<a href="http://travel.state.gov/content/visas/english/general/photos/digital-image-requirements.html" target="_blank" rel="noopener">网站</a>来检验是不是符合标准。而且最后VISA上面用的就是我自己照的这张照片（色调偏暗，没有大使馆里的Photomaton照出来的清晰，这是后话。）回顾起来，填写 DS-160 表格，我居然用了两个星期！！！尤其是填写Point of Contact in USA。其他小伙伴在填写时候记得避免我这样的错误。</p>
<h1 id="面签预约"><a href="https://ais.usvisa-info.com/fr-FR/niv" target="_blank" rel="noopener">面签预约</a></h1>
<p>DS-160 表格填写完之后，就可以通过点击上面标题的链接去注册账号然后预约RDV（面签）啦！不过只有美国大使馆那边先收到你的汇款你才有可能去选择RDV日期。汇款支持两种方式：银行卡支付以及转账。根据我搜集到的帖子，没有人通过银行卡支付成功的，最后都是选的转账模式。我在下面贴出来了当时我收到邮件（里的附件）截图。出于保护个人隐私需要，我把附件里的那个PIN码遮住了一半，转账的要点就是：</p>
<ul>
<li>转账也有Deadline的，要赶紧转</li>
<li>转账的时候一定要写上那个PIN码</li>
<li>转账金额是152欧（不知道以后是否会变）其中包含了护照寄给你的邮费</li>
</ul>
<p>通过网银转账后，一般2，3个工作日，大使馆就能收到你的汇款，系统也就允许你选RDV日期了。我记得我是6月13日左右发出转账申请，6月15号我才可以选择RDV日期。当我进入选日期页面发现最早的RDV也是7月4，5号了。要命的是，我7月11日要跟女朋友去西班牙旅游啊，据说Easyjet登机的时候要求查看护照啊！如果我选择7月11日之前的 RDV，万一不幸被 check 了（就算是秒过，也很难保证我7月11日之前就拿到护照啊），那我的西班牙之旅岂不是就泡汤了。也就说为了保证不耽误西班牙之旅，我只能选择最早7月20日的 RDV！！！我心里当时对自己的那个恨啊。。。后来我心想：那就没事儿多刷刷 RDV 吧，看有没有更早的日期可选，没想到第二天早上就出现了个6月30日的。二话不说，赶紧预约上。女朋友也是，好像是6月20左右才可以选 RDV，当时能选的日期也很靠后了，后来也跟我一样，刷出来了6月30日的。(PS: 事实证明，从法国去西班牙，Easyjet 几乎不查看护照，Vuling 倒是要求了看护照，我直接给人家看了我的 Titre de sejour (长期居留卡)，人家也没说啥。) <img src="/images/USA_VISA/VISA-Payment-Instruction.png" class title="VISA Payment Instructions"></p>
<h1 id="材料准备">材料准备</h1>
<p>首先列出来我们共同准备的材料清单 * RDV确认单， * 所有银行的存款证明 * 工资单 * 酒店预订信息 * 护照有效页和Titre de séjour的复印件 * 个人简历(据说博士们会被要求个人简历的) 我因为开会而额外准备的材料： * VTC会议注册付款记录 * 学校出具的支付我旅行费用的证明 女朋友额外准备的材料(因为是旅游，所以她准备好多好多好多。。。) * convention d'accueil * 旅行计划 * 学校注册证名 * 住房合同 * 出生公证 其实在接下来要介绍的面签过程中，大部分的材料都没有排上用场，但是还是建议准备材料要不厌其详，因为核心目的都是为了证明，你去了美国还会回来的。</p>
<h1 id="开会面签过程">开会面签过程</h1>
<p>美国大使馆的位置相当好找：地铁1号线 concorde 站下车即可，不管从哪个口出来，手机导航很方便就可以找到。进入大使馆需要过两关：第一关位于大使馆大门外，跟个碉堡似得，这个地方需要出示护照以及RDV的确认表格。门卫会看你的 RDV 时间适时让你进去。当时我女朋友的 RDV 是8h30而我的是9h30，我们是8h25左右到的大使馆。理论上只能是我女朋友进去而我需要在门口等到9点30左右，我当时试着问可不可以我俩一起进去，门卫说不可以。因为我俩来的时候把材料都放在一起了，既然不让一起进去，我俩就在门口分材料，女朋友进去以后，我发现我忘了要零钱，就让门卫帮我递个零钱啥的，后来他们也觉得这样好麻烦，于是索性就让我俩一起进去了。哈哈，好幸运！！！</p>
<p>之后就是在大使馆庭院里排队等第二关安检。随身的吃喝的要放在门外木柜上，手机他们会拿个透明塑料袋给你保管起来，给你的牌子。只允许带着自己的护照材料等进入大使馆内部，所以之后的几个小时木有手机可以玩哦，不过可以跟其他人聊聊天啥的也蛮不错的。过了第二关，正式进入大使馆内部了。门口有个美女欢迎你，她会要求你出示护照，RDV 确认单以及 5x5cm 的照片。如果一切无误，她会给你发个排队小票的。这张小票一定要保管好。关于 5x5cm 的照片，可以自己提前准备号，也可以用大使馆里面的 photomaton，女朋友自己花了4欧去照了标准证件照，而我比较幸运，门口的美女估计心情很好，看我 RDV确认单上的照片应该符合规定，但是她也说，要是里面的 consulat 觉得照片不符合要求，我还是需要再到 photomaton 这边补照。所以还是建议大家在 photomaton 那儿花点钱提前把照片准备好吧，以免横生枝节。</p>
<p>具体的面试也是分两步：第一步显示按号码去录指纹，我跟大妈用法语交流的。当时大妈问我要照片，我说我已经把我的照片电子版上传到系统了，她看了下确认合格，就让我录了指纹。然后我就又做回等候区去等待 consulat 给我面试。下面我介绍我当时面试的流程。C代表 Consulat, S代表我, 面试官首先问我愿意用法语还是英语，鉴于我的英语已经深深地被法语影响了，我说我倾向于法语，面试开始：</p>
<p>C: 去美国做什么？ S: 去美国开会。（同时从材料夹里面取出了我 VTC paper的注册收据，上面有会议名称，地点，时间等等） 面试官拿着我给她的会议付款收据之后，就开始在电脑上记录信息不再理我了。 C: 你现在在法国做什么？ S: 还是学生 C: 几年级？ S: 博士一年级(我终于忍不住还是提了自己是在读博士这个事儿了，要诚实。。。) C: 什么专业？ S: (为了避免出现必被 check 的敏感词)通信 C: 通信里面哪个方向呢？ S: 移动通信，就是咱们用的手机网络(听上去很人畜无害有木有) 面试官接着又在电脑上敲了一通 C: 来法国多久了？ S: 我说2010年我就过来了 C: 毕业之后啥打算呢？(好俗的问题。。。) S: 回中国，比如进个运营商啥的。 C: 好了，你将会在大概一周左右收到你的护照(其实当时我没有听清，但是我很确定是说几天之后就可以好的意思) S：也就说，在7月11号之前我可以收到我的护照吧？ C: 是的</p>
<h1 id="旅游面签过程">旅游面签过程</h1>
<p>因为我是因为开会来面签的，现在贴出来女朋友Y的面签过程，鉴于面试过程都差不多，此处我只贴出女朋友和面签官的对话过程。同样的，C代表她遇到的面签官，Y代表她本人：</p>
<p>C：Bonjour Y：Bonjour （接着签证官自动转成英语） C: 去美国做什么？ Y: Travel。（同时从材料夹里面取出了我的行程单，上面有我想去玩的景点，时间安排等等）边掏边跟她说我是9月＊＊号过去，然后9月＊＊后回来。这儿还有我的酒店预订单。 （这个时候面试官一直忙着在电脑上记录信息，只是摆了摆手说不用拿了） C：你来法国多久了？ Y：三四年了，从2011年开始 C：你怎样支付这次美国旅行？ Y：我自己来支付，这有我的工资单，银行的存款证明 （她示意我把这俩样东西拿给她看看） Y：我还带了我的博士合同，你需要看吗？（因为合同上面也有工资金额的证明以及博士的起止日期，可以证明我从美国玩完还得回来继续读书） C：那个不用看了 （面试官在电脑上又是一通狂敲） C: Sorry，你能再重复一下你来法国多久了吗？我忘记了。。。 Y：四年了，2011年过来读 master 的 C：谢谢，你现在还是学生？ Y：是的 C: 你学校名字是？ S: Telecom ParisTech （我又一次想出示我的合同） C: 不用了，I trust you （天哪，签证官说trust me，何等荣幸啊，当时心里就一阵激动，想着 visa 肯定没问题了） C: 毕业之后你要去哪呢？ Y: 当然是回中国啦。 （以下纯属和笑眯眯的签证官闲扯的问答） C：你最喜欢哪个城市？So far Y：巴黎就不错呀，浪漫啊 C：是的 Y：罗马也不错，很多名胜古迹 C：确实，我也很喜欢罗马 Y：我希望波士顿也是一个漂亮的城市 C：It should be，你会喜欢上它的。。。 C：OK，你的 visa 会在今天签发，一周左右你会收到你的护照 Y：一周之内吗？因为我下周末要去西班牙玩，到时需要护照的 C: 差不多，10天之内肯定可以拿到 Y：太谢谢你了，have a nice day!</p>
<p>我和女朋友差不多是同时结束面签的，交流了一下，我们觉得应该都是顺利获签的，然后就去老佛爷逛街了。下午的时候，去<a href="https://ceac.state.gov/CEACStatTracker/Status.aspx" target="_blank" rel="noopener">大使馆系统</a>上查询状态，就发现我的已经是 Issued 的状态了，传说中的秒过!还是对博士的秒过!真是撞大运了。</p>
<p>这里有个小插曲：当我查询完我的状态以后，Y同学也要我帮她看看结果是啥，我俩都觉得应该也是 Issued 吧，没想到她的显示的是 Administrative Processing! 传说中的check!!当时女朋友整个人都不好了，抱怨着，不是说相信我么，为毛还要check我呢。。。我莫非要是我们学校第一个被check的人，呜呜呜。。。我当时安慰她说，毕竟她这是去旅游，没有个凭据啥的，你想啊，人家连你的简历啥的都木有收，这里的 Administrative processing 也就是稍微处理下你的信息而已，而不是真的check。。。第二天估计就会是Issued的状态了，人家面试官不会骗你的。事实证明，第二天下午，果真就是Issued的状态了。</p>
<h1 id="行程单">行程单</h1>
<p>因为女朋友去美国是办理的旅游签证，所以按照网上的攻略，最好是有一份行程单。</p>
<h1 id="收回护照">收回护照</h1>
<p>6月30日面签之后，7月3日顺利收到带有10年签证的护照。</p>
<h1 id="总结">总结</h1>
<p>这次美国签证的申请感觉真是幸运的很，对于在读博士而言，我个人感觉，我的那个VTC会议付款凭据起了很大作用，因为 consulat 拿着我那个收据记录了很多信息，也估计是因为我教过钱，所以确订我确实是去美国回来，开完会还要回来接着念书，完全没有移民的想法。</p>
<h1 id="参考资料">参考资料</h1>
<p>此处列出当时对我有帮助的帖子，既是参考文献，也是对这些愿意花时间把自己的经历写出来的小伙伴的答谢。 <a href="http://bbs.xineurope.com/thread-1986840-1-1.html" target="_blank" rel="noopener">2015年3月，在巴黎申请美国10年签证</a> <a href="http://bbs.xineurope.com/thread-1962434-1-1.html" target="_blank" rel="noopener">2014年巴黎办理美国10年签证经验分享</a> <a href="http://www.mafengwo.cn/i/3314229.html" target="_blank" rel="noopener">2015年申请美国签证被CHECK后通过的经验教训</a> <a href="http://www.douban.com/group/topic/31575167/" target="_blank" rel="noopener">美国签证US VISA-巴黎美领馆-签证全攻略-2012.07.31-ZYY</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2015/07/28/How-to-establish-personal-blog-with-Github-pages-and-hexo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/07/28/How-to-establish-personal-blog-with-Github-pages-and-hexo/" class="post-title-link" itemprop="url">Github Pages 和 hexo 建立个人博客教程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-07-28 16:00:46" itemprop="dateCreated datePublished" datetime="2015-07-28T16:00:46+08:00">2015-07-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-25 18:27:10" itemprop="dateModified" datetime="2019-03-25T18:27:10+08:00">2019-03-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言">前言</h1>
<p>一直有亲自搭建一个个人博客记录下自己生活学习中点滴的想法, 但每次都以“没有时间”为托词将这个想法压了下去。久而久之这个“宏大”的想法也就被抛诸脑后了。2015年7月，学校里的老师同学差不多都去度假了。老板走之前给我留下了一堆任务，比如 NS-3 的安装使用。于是又像往常一样。在各种技术博客的帮助下，我总算是把 NS-3 调理顺了。</p>
<p>跟以前一样，我觉得这时候把这些安装配置搞得清楚，指不定过了几个月就有都忘了。一想到之前的人生就是不断地在记住遗忘之中度过，我觉得这次不可以再拖了，必须着手搞一搞自己的私人博客了，既可以锻炼自己 web 方面的技能，又可以记录下自己的学习生活。实在妙极！刚好这两周老板不在，利用这个时间给我充个电~</p>
<h1 id="更新-2016-10-20">更新 2016-10-20</h1>
<p>好久不写博客了，怎么现在重新拾起，却发现，诸如 npm, hexo 之类的命令不管用了, 我怀疑莫非是因为系统升级导致了这样的情况？但是我的 node.js 是通过 Homebrew 安装的啊，npm/hexo 又是通过 node 管理的。不太理解。。。</p>
<h1 id="技术方案选择">技术方案选择</h1>
<p>Google 了一下，网上推荐度最高的就是个人博客方案就是: Github pages + hexo + 多说 + 七牛 + Doddady + DNSPro了，所以其他技术方案，也有各自的亮点，但是本博客就不予考虑了。Pelican 我也考察过，但是感觉还是 hexo 更简单方便一些。</p>
<h1 id="环境准备">环境准备</h1>
<p>本博客主要是针对 Mac 环境下的个人博客搭建，如果是Windows平台的，可以移步至 cnfeat 前辈的大作，目前知乎上推荐度最高的，个人博客搭建教程：<a href="http://cnfeat.com/2014/05/10/2014-05-11-how-to-build-a-blog/" target="_blank" rel="noopener">如何搭建一个独立博客——简明Github Pages与Hexo教程</a>。</p>
<h2 id="安装git-node.js-npm">安装git, node.js, npm</h2>
<p>网上相关的安装教程多如牛毛，我个人推荐使用Homebrew安装，具体流程参见： <a href="http://www.moncefbelyamani.com/how-to-install-xcode-homebrew-git-rvm-ruby-on-mac/" target="_blank" rel="noopener">How to Install Xcode, Homebrew, Git, RVM, Ruby &amp; Rails on Mac OS X (From Snow Leopard to Yosemite)</a> <a href="http://rennesong.com/2015/07/29/How-to-install-node-js-and-npm-on-Mac/">如何在Mac Yosemite中安装node.js以及NPM</a></p>
<h2 id="安装-hexo-以及必须的-node.js-模块">安装 hexo 以及必须的 node.js 模块</h2>
<p>首先在电脑中自己觉得合适的位置，创建一个专门用来写博客的文件夹，并且切换至这个文件夹 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir Personal_Blog &amp;&amp; cd Personal_Blog</span><br></pre></td></tr></table></figure> 接着使用Node.js的包管理器npm安装hexo模板引擎，注意选项g代表了gloablly <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo -g</span><br></pre></td></tr></table></figure> 待 hexo 安装完毕后，用 hexo 初始化这个文件夹(和 git 的用法很相似) <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init</span><br></pre></td></tr></table></figure> 这时候 Terminal 里会出现提示： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INFO  Copying data to ~/Documents/Personal_Blog</span><br><span class="line">INFO  You are almost done! Don't forget to run 'npm install' before you start blogging with Hexo!</span><br></pre></td></tr></table></figure> 而且，这个文件夹会多出一些文件(一开始是空的)： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">total 24</span><br><span class="line">drwxr-xr-x   8 qsong  staff   272B Jul 30 14:30 .</span><br><span class="line">drwx------+ 36 qsong  staff   1.2K Jul 30 14:30 ..</span><br><span class="line">-rw-r--r--   1 qsong  staff    65B Jul 30 14:30 .gitignore</span><br><span class="line">-rw-r--r--   1 qsong  staff   1.4K Jul 30 14:30 _config.yml</span><br><span class="line">-rw-r--r--   1 qsong  staff   442B Jul 30 14:30 package.json</span><br><span class="line">drwxr-xr-x   5 qsong  staff   170B Jul 30 14:30 scaffolds</span><br><span class="line">drwxr-xr-x   3 qsong  staff   102B Jul 30 14:30 source</span><br><span class="line">drwxr-xr-x   3 qsong  staff   102B Jul 30 14:30 themes</span><br></pre></td></tr></table></figure> 根据系统的提示，我们需要安装node.js需要的模块，只需要执行： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure> 为了让hexo把网站代码推送到githubs上，我们还需要下面这个module <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure> 至此，我们可以说个人博客就这么搭建好了，简单吧。</p>
<h2 id="hexo-配置文件">hexo 配置文件</h2>
<p>网站搭建完成后，就可以根据自己爱好来对 Hexo 生成的网站进行设置了，对整站的设置，只要修改项目目录的 _config.yml 就可以了，这是我的设置，可供参考。 另外需要特别指出的是，如果需要将 github pages 的原始域名 (e.g., hansomesong.github.io) 变成自己购买的个性化域名 (rennesong.com), 需要在 source 文件夹下，创建一个名为 CNAME 的文件，这个文件只有一行，记录自己的个性化域名，比如我的域名就是 rennesong.com</p>
<h1 id="社会化评论支持">社会化评论支持</h1>
<p>Hexo默认支持的第三方社会化评论插件是Disqus, 国内多使用<strong><em>多说</em></strong>。鉴于本博客由汉语书写，主要针对中国同胞了，所以决定采用多说。具体安装过程参见zipperary大作<a href="http://zipperary.com/2013/05/30/hexo-guide-4/" target="_blank" rel="noopener">hexo系列教程:(四) hexo博客的优化技巧</a>。其实很简单，概括起来就是：第一要去多说网站上注册一个账户，创建一个域名。第二就是把相应的Javascript代码粘贴到自己使用模板的相应文件里(具体代码文件因模板而异)。比如 zipperary 上面的帖子就只是针对他使用的主题 light 的，但是他依然给出了含有Hexo默认主题的相关 Javascript 的代码的帖子。</p>
<h1 id="生成站点地图">生成站点地图</h1>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-sitemap --save</span><br></pre></td></tr></table></figure>
<p>然后编辑 _config.xml 文件(注意不是 theme 的 _config.xml 文件)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plugins:</span><br><span class="line">- hexo-generator-sitemap</span><br><span class="line">sitemap:</span><br><span class="line">	path: sitemap.xml</span><br></pre></td></tr></table></figure>
<p>注意 YAML 格式的配置文件要求冒号之后面<strong><em>有一个空格</em></strong>。我曾经因为在编辑 deploy 的配置的时候，冒号之后少加了空格，而导致无法将本地生成的静态文件上传到 github.</p>
<h1 id="hexo-推荐主题">Hexo 推荐主题</h1>
<p>The highly recommanded theme, in my opinon, is: <a href="https://github.com/theme-next" target="_blank" rel="noopener">NexT</a>, thanks to its detailed documentation and well orginzed code repositories</p>
<p>To use Next theme, please change to direcotry &quot;themes&quot; of your website and issue the following command: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;theme-next&#x2F;hexo-theme-next.git next</span><br></pre></td></tr></table></figure></p>
<p>Modify the your site _config.ymal to specify the applied theme.</p>
<h1 id="hexo-常见命令">Hexo 常见命令</h1>
<p>这里有必要提下 Hexo 常用的几个命令： hexo clean: 删除本地生成的 public 文件夹 hexo generate (hexo g) 生成静态文件，会在当前目录下生成一个新的叫做 public 的文件夹 hexo server (hexo s) 启动本地web服务，用于博客的预览 hexo deploy (hexo d) 部署播客到远端（比如 github, heroku 等平台）</p>
<h1 id="hexo-升级之后的坑">Hexo 升级之后的坑</h1>
<p>At the time of this writing，Hexo was still at version of 2.X. 目前 Hexo 已经从 2.x 系列升级为 3.x 系列。导致一了一些模板以及插件不能正常使用的情况。比如我在执行 hexo g 的时候，报错如下： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Template render error: (unknown path) [Line 7, Column 23]</span><br><span class="line">  Error: Unable to call &#96;the return value of (posts[&quot;first&quot;])[&quot;updated&quot;][&quot;toISOString&quot;]&#96;, which is undefined or falsey</span><br></pre></td></tr></table></figure> 原因就是插件 hexo-generate-feed 还有 hexo-generate-sitemap 和 hexo3 不兼容！<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> According to <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>, this is due to the lack support of plugin primitive in configuration script (i.e. _config.yml)</p>
<h1 id="参考文献">参考文献</h1>
<section class="footnotes">
<hr>
<ol>
<li id="fn1"><p>http://kuangqi.me/tricks/enable-table-of-contents-on-hexo/<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>http://www.luckyonecn.com/blog/update-hexo-to-3-2-2/<a href="#fnref2" class="footnote-back">↩</a></p></li>
</ol>
</section>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2015/06/24/%E4%BB%8A%E5%A4%A9%E7%BB%83%E8%BD%A6%E5%8F%88%E6%9C%89%E4%B8%80%E4%B8%AA%E6%8C%AB%E8%B4%A5%E6%84%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/06/24/%E4%BB%8A%E5%A4%A9%E7%BB%83%E8%BD%A6%E5%8F%88%E6%9C%89%E4%B8%80%E4%B8%AA%E6%8C%AB%E8%B4%A5%E6%84%9F/" class="post-title-link" itemprop="url">法国学车感悟(2)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-06-24 17:57:49" itemprop="dateCreated datePublished" datetime="2015-06-24T17:57:49+08:00">2015-06-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-27 22:17:22" itemprop="dateModified" datetime="2019-03-27T22:17:22+08:00">2019-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%A9%BE%E9%A9%B6/" itemprop="url" rel="index"><span itemprop="name">驾驶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今天练车又有一个挫败感：</p>
<p>第一个错误：忘记了放手刹。起步五部曲，怎么突然之间忘了个精光！ 第二个错误：il y avait un paneau 30 avant le roint point, 我又错过了 30 的限速牌，结果又没看到解除限速30的盘子 第三个错误：进入 Roind point 太快！减速不够，教练说了N次速度过快。莫非我是看其他视频看的。 第四个错误：错过了直行道的 Ceder le passage。 第五个错误：stop停车的事后位置不对，我需要再确认一下，如果 ligne de stop 之前有 passage a pieton, 我该停在哪里？ 第六：不敢加速，不愿减速，降挡太晚是不是因为我减速的太晚？ 第七：选择道路的时候，居然没有选择最右边</p>
<p>中途教练专门停车教育我：tu n'exploit pas bien le moteur. Zone de 30 j'ai 进入大 Rond point 的问题 place aux feux, apres le carrefour，我居然没有靠右走。Il faut prendre plus de temps pour comprendre. Bien rester a droit. c'est un peu embetant. 还有的问题就是，高速度开久了，居然就不想遵守 30 公里限速了。</p>
<p>左拐的时候，c'est parce que tu avance pas. 有一个地方教练让我左拐，我居然没有看到 最左边还有一个道让左拐呢。拐过去之后，我又想占左边的道了。拐过去之后我又想占左边的道了。3挡降2挡的时候，左脚离合送的太快。Quand tu fais le 3 a 2, il faut lever doucement le pied a gauche. 还有因为有行人过马路的时候，我停在斑马线之前的时候，太靠近左边了，我右拐之前感觉要么就是不够靠右，要么就是转向不够。为啥 有一个地方明明只能前行，我居然啥也没看见！为啥教练看的见，而我却看不见！有一个Rond point的地方，我居然晕菜地想直接左转。之前我没有注意到两个rond point的牌子。tu cherche pas assez. il te faut passer plus de temps pour lire les paneau.</p>
<p>行驶过程中，又不观察，是不是有右行优先。</p>
<p>教练说: &gt;Quand tu veux tourner a gaucher, il faut chercher la rue. On prend la prochaine rue a gauche, quand tu cherche une rue, 要通过左车窗搜索。</p>
<p>抗压能力不行，有一次，教练让我左转，我在心事重重之下，一直觉得他是让我左转，结果后面的车占了坐车道了，我们就没法儿过去了。唉。。。越开越搓！</p>
<p>我唯一对自己满意的就是：现在我终于开始避让行人了。然后对于看远这个要求有了进一步的体会。</p>
<p>Je vois bien que tu a peur pour le feux orange.</p>
<p>Il te faut plus changer ton allure. 我就是永远保持在一个 档位上 跑。</p>
<p>在进三档四档这个问题上，我感觉我已经习惯了听到Vincent说il faut accelerer我才减速进挡的，不然我就是在等。。。</p>
<p>还有一个Ronde point差点儿就压着中间的 Anneau 过去了。。。教练 oh la la 了。。。到最后他已经是无可奈何: Tu me fait peur dans le rond point.</p>
<p>为什么今天会在 <code>Zone 30</code> 里面 一直超速呢？</p>
<p>在一个并道的地方：有一辆车占据了左道了，而且左道马上就要跟我所在的路并道。我一没有注意进入道路之前我有50限速，我第二没有保持Allure.我选择了减速！教练说 C'est panique</p>
<p>il faut beaucoup plus changer ton allure. Il faut oser changer l'allure. 我的问题：只是松开了油门，没有减速!</p>
<p>总体来说：上车练车我表现是不错的，我自己也想不到，因为这么久没开车，不但没有觉得手生，反而觉得随心所欲了不少。虽然当中也有一些错误，但是总体上教练说是不错的。最大的问题在于，我还是容易漏过一些paneau。比如说交通信号灯上面的禁止左行的标志。今天开车感觉又回到了之前胡开的状态了，导致我现在真的是好有挫败感。现在列举出来2015年8月6日这次seance中我犯下的错误，以及从中得到的经验教训。</p>
<h1 id="erreur-eliminatoire">Erreur eliminatoire</h1>
<h2 id="起步时候胡来">起步时候胡来</h2>
<p>真的很难想象，在已有16个小时的驾龄的情况下，我起步的时候居然不过脑子的胡来：我居然没有放手刹也没有打转向灯的情况下就要启动了！正常的起步五部曲：一踩，二挂，三放，四观察，五打，六走。</p>
<h2 id="观察不够">观察不够</h2>
<p>本次 seance 真是不知道又错过了几个paneau了。一开始就没有注意到进入了<code>zone 30</code>乱加速，结果又漏了 <code>fin de zone 30</code> 而不敢加速。后来有一次出 <code>Rond point</code> 的时候，居然又没注意到有 50公里的限速 其实转弯的时候，是有很多信息需要处理的。比如新的路段限速多少，比如这条路是死路么，比如这条路有没有交叉口，交叉口处我是否有优先权。</p>
<p>如果两条路都可以左转，我是选右侧的路还是左侧的路，如果你右边的道路也可以左转的时候，你转到路那边的时候，是不能选最有那条路的。</p>
<p>我发现我最容易忘记看到的路盘就是转弯处的。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2015/06/18/%E4%BB%8A%E5%A4%A9%E6%98%AF%E5%BC%80%E8%BD%A6%E7%9A%84%E7%AC%AC20%E4%B8%AA%E5%B0%8F%E6%97%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/06/18/%E4%BB%8A%E5%A4%A9%E6%98%AF%E5%BC%80%E8%BD%A6%E7%9A%84%E7%AC%AC20%E4%B8%AA%E5%B0%8F%E6%97%B6/" class="post-title-link" itemprop="url">法国学车感悟(1)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-06-18 17:57:49" itemprop="dateCreated datePublished" datetime="2015-06-18T17:57:49+08:00">2015-06-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-27 22:32:49" itemprop="dateModified" datetime="2019-03-27T22:32:49+08:00">2019-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%A9%BE%E9%A9%B6/" itemprop="url" rel="index"><span itemprop="name">驾驶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今天是开车的第20个小时：刚刚建立起来的自信在大雨中又被打压下去了。</p>
<p>Une route plus representive, en campagne, il y a bcp de priorites à droit. Comme en campagne, il y n'a pas de personenes. Du coup, il a bcp de priorites à droit. 今天我们去了 教练号称是很有代表性的 法国相间小路上练车。教练说，乡间道上是会有很多 右行优先的情况，因为布置 arrter, stop的成本很高啊。所以教练让我练习提早发现交叉路口，及早判断优先级，以及及时降速准备让人。 Des que tu vois il pour que tu puisse arreter ici.</p>
<p>De loin, on percoit un baton, un pancare, autre indice, camnion de poupelle. 一旦看到远方有</p>
<p>由于在法国 垃圾车是不太可能估计到每一个地方的，所以如果在前方路边看到了垃圾桶，那么很有可能，是有交叉路口的。当然也有可能是 chemin privee</p>
<p>on gere allure comme l'autre jour. Feux croissment, eussi-pluie climatisation pour eliminer la brume.</p>
<p>教练说我，提速降速太慢，做决定太慢。</p>
<p>进Rond point 如果不太确定是哪个出口出来，尽量早些时候并道右边道路上去。</p>
<p>比如除了Rond point 之后，是个弯道，我到底敢不敢一脚油门踩下去来加速呢？</p>
<p>乡间小路上，有一次，没有注意到右边小路上有车过来，可是教练很早就远远地看到了， 我还是只盯着我眼前的路了，其实最近相比于之前，我漏过录盘，现在已经好很多了。</p>
<p>Prendre ton temps pour bien freiner et retrograder pour comprendre ce qu'il passe.</p>
<p>还有就是 小上坡处的 stop/ceder le passager, 记得上坡以后挂成一档。</p>
<p>拐弯处刹车不够，而且应该是在进入 virage之前完成刹车降挡。il faut acceler un peu plus fort. 因为我低速的时候，没有降挡，以至于加速的时候速度上不去。这是一个需要克服的。 开车的时候，有时候太过路中间，</p>
<p>Tu ne chagne pas assez allure.</p>
<p>我居然有一次是用二档起步的。</p>
<p>Tu met trop de temps faire des choses.</p>
<p>进Rond point 的时候，有一次只盯着一辆迟疑不进的车，而忘记观察正常的行驶的车辆了。Vue fixee</p>
<p>进三档的时间过长，距离过远。</p>
<p>换挡过猛，手握方向盘过猛，举止不够果断，加速就是加速，刹车就是刹车。Tu me la pied sur le frein, mais tu freine pas.</p>
<p>有一次教练让我左转，我鬼斧神差地不减速降挡，因为我死死得盯着后面的大卡车。</p>
<p>还有就是 Ralentir 太早。下次跟教练解释下我为啥这么做，</p>
<p>还有就是转完弯，或者说是在转弯的后程，我就可以加速走人了。</p>
<p>结论就是：以后自己开车要自主，不要想着Vicent会给你指挥</p>
<p>因为有一次换一档太晚导致自己右拐的弯儿拐的真大。</p>
<p>占用道路问题，经常会选不好道路啊。。。</p>
<p>Il y a des trotoires 前方左右，是不该加速的。 Tourner bien le volant.</p>
<p>在 Zone 30 里面，教练经常说我做的不够好的有：Tourner bien le volant, Changer beaucoup plus d'allure.</p>
<p>那我肯定跟车会有问题了</p>
<p>我简直无法理解，为什么下雨天，我居然脚放在刹车上却不踩刹车？！！！</p>
<h1 id="驾驶课程21环城高速">驾驶课程21：环城高速</h1>
<p>主要问题在于：Voie d'insertion上加速还是不够果断。方向盘握的太紧，观察的时候不自觉松开油门，下高速的时候在高速上减速，减速道上不减速。为啥教练老是说我减速不够呢？还有就是死角观察的不对。扭头太夸张，教练说，如果这个时候前车刹车了，那就悲剧了。</p>
<p>=》看的还是不够远，方向盘居然在我不握的时候，都不会咋偏啊。。。。</p>
<p>对了，教练说，并道的时候，至少要向左右观察两次，才打灯。</p>
<p>是不是要学会跟车呢？</p>
<h1 id="section">2015-08-19</h1>
<p>今天开车又是一肚子郁闷。。。 stationnement en bataille stationnement en creneau</p>
<p>第一个错误：有停车位启动，还是先打左灯告诉别人，我们要走，然后再换向。 第二个错误：停车的时候记得打灯！我一次没有记得！ 第三个错误：bataille停车的时候，记得掌握前轮回正的时机。这个很关键！要不然会歪掉！！ 第四个错误：从停车位出来，记得大灯！！又忘了！！！比如刚从garage en bataille出来的时候记得打右转灯，en bataille en marchant avant 的时候，没有打左转向灯！ 第五个错误：en bataille en marchant avant 的时候，很容易太靠右或者太靠左。这个时候，记得倒车（期间不要转向）直到倒出来以后，我觉得倒出来以后应该转个向的，然后回正，然后向前。 第六个错误：倒车出库时候，方向盘往哪儿转，打哪边的灯。倒车出库的时候，要跟后车留一些安全余量。不然一旦溜车，就撞到后车了。 第七个错误：左转向到新道路的时候，看前方，也要记得看眼后视镜，不要耽误后车。 第八个错误：教练让我在Rond point里面左拐，我打了左转灯了，但是却走的右转的道，然后看也不看就想直接拐到左道去了。 第九个错误: 2挡的时候，太过注意 priorite a droit, 结果走的还没自行车快，我感觉可以30km跑，但是注意看看有没有车。30km是可以随时刹住的 第十个错误：还是右转弯的时候，trop large. =》 拐弯的时候，看的不够远。 第十一个错误: 二档的时候居然没有挂上一档，挂的是空挡。发动机空转我也没反应过来是为啥。 第十二个错误：ceder le passgaer 那个地方还是 挂一档挂的有点儿早了。 第十三个错误：右拐的太慢！！为啥呢！！！ 第十四个错误：刹车以后，我等好久才挂2档，这个时候我的注意力就在手上而不是车外面了！！！！会不会是刹车太早了呢 第十五个错误：有一次进入Rond point的时候太快，因为我只关心了我眼前的线，没有看在rond point的车辆。很危险！！！ 第十六个错误：前方施工的 障碍物 我居然不知道降二挡！！！我指望着三档过呢，然后前方有trotoirre的时候，我也蛮上3档。 第十七个错误：前方路口右拐，不知道降挡。因为我判断失误！！我一直以为是前方的红绿灯处。 第十八个错误：并道的时候，只要在确定可以动方向盘的时候才打灯。我指的是 前方道路消失的时候。</p>
<p>今天坐李悦的车的时候，突然有种感觉：我之所以看不到路盘，容易手忙脚乱，甚至看不远，根本原因是因为我的注意力一是始终注意听Vincent的指令去了，二是始终盯着表盘，太过频繁的看表盘了！所以看不远，因为潜意思觉得看远了，就来不及看速度盘了。而且是不是应该刻意练习下，感觉出来当前车速。</p>
<p>通过开车，我发现了我认知(注意力分配)中存在的BUG：我大部分注意力放在了速度盘上，少部分注意力分给了看远方的路。实际上，我应该是注意力大部分用在观察外面的情况，经常性的看看速度盘就可以了。这就是为何坐别人的车的时候，不会漏过什么东西，</p>
<p>另外自己开车的时候，跟别人指路的时候，转向的注意力(处理流程)是不一样的：别人指路的时候，比如说到左转，那首先要观察后视镜，左后视镜，死角，然后打转向，减速降挡，等速度下来了可控了，就可以从容地找要去的路在哪里。如果是自己开车明确知道在某个地方左转(比如高速并道的时候)，首先要观察时机, （1，2，3），确定可以转向操作的时候，打转向灯，然后并道操作。注意这两种模式下的不同。</p>
<p>Vicent 对我的评价： &gt;Quand on voit plus claire, on accelere pas. Quand on a des obstacles, on ne freine pas.</p>
<p>半联动状态操作不熟，首先是稳定半联动点不行，其实是半联动点状态下的刹车，第一是离合踩到底，第二个是踩刹车，而不是刹车半踩 简直一路都在犯错！！！怎么搞得。。。</p>
<p>侧位停车的要领：和侧面的车保持合适的距离，在合适的位置停下。然后开始缓慢倒车。以后轮完全在旁边的车之后停车。后轮和前车车尾的距离决定了你最后停好车的时候和前车的距离，车子停好后，方向回正，缓慢移动使得车体和侧方位的车呈约35-45度之间。注意如果这个时候有汽车通过，我们要停止操作，让行驶车辆通过。因为我们没有优先级。车辆角度调好后，确定人行道没有人之后，观察左后视镜缓慢倒车使得后车轮的va toucher la ligne de pointille上挺住。这个时候再次观看后视镜没有人之后，把方向盘像左打死。记得左转向灯哦！！！然后缓慢倒车，大约车辆完全在 Creneau里面的时候，将方向盘回正。其实斜坡上侧方停车</p>
<p>这次换挡动作已经轻柔了很多，不知道方向盘是不是依然握的紧啊。</p>
<p>Rond point, 城乡切换，Rocade, 停车，无一不错。</p>
<p>Rond point: 进入速度太快，进入速度太慢，进入Rond point不看在Roind point里面的车辆的动向，出Rond point的时候不看死角，在Rond point行驶中不看后视镜右视镜。 转向灯经常长时间忘记关闭。</p>
<p>我是不是太注意听教练口令了，然后注意力就不分配给其他地方了。注意力要放在前方，左右，后而不是教练那里！！！ 判断局势不果断！！！犹豫不决！！！比如进入Rond point之前，减速过早，刹车踩得不给力，迟迟不降挡，出了Rond point迟迟不加速！！！</p>
<p>惯性太大，老是习惯性保持在一个速度上。比如加速起来了，连行人都不愿意让。减速了又迟迟不加速！！！</p>
<p>不注意观察，或者说观察不到位。感觉我的注意力还是在脚上！！！都这么久了 你好意思么。。。还是没有形成类似条件反射。</p>
<p>第一次进入Rocade的时候，判断局势明朗，等待教练指令，这个不完全怪我。因为我习惯了等他发出加速指令。</p>
<p>又犯了一个 La prochaine rue a droite的错误。我一直以为是前方红绿灯那个地方，谁知道就在不远的附近。其实如果真是在红绿灯那里的话，教练不会那么早就下指令的，所以当时我就应该有所警觉：会不会是在附近有个不是很明显的 交叉口。最后匆忙降挡，右转，没有注意右边的自行车道，直接就转，看后视镜了？看右后视镜了么？看自行车道了么？</p>
<p>下高速道的时候是不看左也不看右的。</p>
<h1 id="section-1">2015-08-21</h1>
<p>我在高速上观察居然是 减速的 就是说我一看后视镜，一定要注意观察后视镜的时候不要松油门，要不然你会一直觉得 后车离你越来越近啊。。。</p>
<h1 id="第33.5小时">2015-09-16 第33.5小时</h1>
<p>从美国回来后的第一次课，大约一个星期没有摸车加上之前的打击，让我开始对开车有了一种恐惧。我臆想着，这一次的seance我估计会把Vincent气死。没想到，虽然好多操作却有生疏，但是总体还是让Vincent满意的。 因为一直让我痛苦没脸见人的，进出环城的时候的加速减速以及观察，并线之前的观察以及开始便道的一脚油门都没有再犯。尤其是，进入Rond point的时候，知道了减速，知道了观察，知道了冷静做决定。但是有一种按下了葫芦起了瓢的感觉，比如平直道路上的 Ceder le passage不够敏感了，看着前车冲过去了，自己也就不假思索地往上冲了，这样的问题犯了两次。还有就是 禁止通行的路盘，那么大的路盘，我居然可以忽视掉。。。我是不是一个特别懒得思考的人，就只知道一门心思的低头蛮干的主儿。</p>
<h1 id="第34.5小时">2015-09-18 第34.5小时</h1>
<p>从美国回来以后的第二次练车，这次练车总体来说还是失败的。因为Rond point进的不抢了，但是太犹豫。Ceder le passage还是一塌糊涂，甚至之前已经消失的漏看路盘的问题又如野草般死灰复燃。 总结下，本次课程中重大问题，前事不忘后事之师：</p>
<ul>
<li><p>第一：从stationnment en creneau中启动出发，之前从来都没有过问题，这次有了。 问题是，方向盘在已经左打死，在车子刚动起来的时候，我就完全松了离合了，虽然是一档但是速度相对于半联动来说还是过快，跟我把方向盘回正的时间以及距离都太短，以至于我的车都已经跑到对面行车道了，这对自己以及别人而言都是一个巨大的安全隐患。正确的做法是：在车子刚启动还没有完全进入正轨之前，半联动处理之，车子可控。</p></li>
<li><p>第二：进 Rond point 的时候，虽然速度慢下来了，但是慢下来并不是目的，Vincent我都是在最后一刻才做决定走与不走的，让我决定再早一些。我回想起来也是啊，如果 Rond point 的入口一直没车辆进入，而我离 rond point 只有三四米的时候，在自己还有速度的时候，赶紧加油门走人了。</p></li>
<li><p>第三：在环城上走的时候，太靠左了，我想我一直没有理解Vincent的所谓 mettre ton volant au milieu de la route, 现在在写分析的时候，突然想到，他的意思是不是让我调整方向盘然后使得方向盘处在路中间啊？这样的话，车身即使有点儿靠右但也不会是靠左的，也不会给左边超车的人带来危险。</p></li>
<li><p>第四：还是如何出3道Rond point. 还是在B-com那个地方，虽然那个地方我已经走了无数次了，但是我心里还是多少有些阴影的。因为总是在这个<code>Rond point</code>里出问题啊。第一个问题就是在rond point里行车要注意看的内后视镜，而不是右后视镜，因为看中后视镜的时候，是可以很快的继续看前边的路的，因为Rond point里车辆是一直处于转弯状态的。看右后视镜的时候不太安全。所以Vincent经常会用手敲打着后视镜，提示我：注意看后视镜！！！</p></li>
<li><p>最后非常最要的一点儿： 刹车的时候记得楼一眼后视镜啊。。。</p></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">rennsong</p>
  <div class="site-description" itemprop="description">Personal blog site, to note technique and life related articles</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">69</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hansomesong" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hansomesong" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rennsong</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
