<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rennesong.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Personal blog site, to note technique and life related articles">
<meta property="og:type" content="website">
<meta property="og:title" content="Rennesong&#39;s blog">
<meta property="og:url" content="http://rennesong.com/page/6/index.html">
<meta property="og:site_name" content="Rennesong&#39;s blog">
<meta property="og:description" content="Personal blog site, to note technique and life related articles">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="rennsong">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://rennesong.com/page/6/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Rennesong's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Rennesong's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Blog my life from now on!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/04/08/scapy-learning/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/08/scapy-learning/" class="post-title-link" itemprop="url">scapy教程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-08 23:18:53" itemprop="dateCreated datePublished" datetime="2019-04-08T23:18:53+08:00">2019-04-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-10 16:29:43" itemprop="dateModified" datetime="2020-06-10T16:29:43+08:00">2020-06-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tools/" itemprop="url" rel="index"><span itemprop="name">tools</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Scapy is a powerful Python-based interactive packet manipulation program and library.</p>
<h1 id="scapy-开发的历史演变">Scapy 开发的历史演变</h1>
<p>scapy在安装的时候，最让人困惑的就是各种各样的发行版本. 主要有：</p>
<ul>
<li>从版本 2.2.0 开始，scapy 社区有人创建了一个只支持 python 3 的项目克隆(fork). 遗憾的是，该项目克隆发展有些混乱，并且没有将共享回馈给 scapy 社区。更严重的是，这个项目克隆被有些 Linux 发行版被打包成<code>python3-scapy</code>软件包，被 PyPI 收录成为了<code>scapy-python3</code>. 这给用户的使用带来了更大的困扰.</li>
<li>从版本 2.4.0 开始, scapy 同时支持 python 3 和 Python 2. 开源项目都建议以 Scapy v2.4.0 官方代码基础. 该项目克隆被重命名为 <a target="_blank" rel="noopener" href="https://github.com/phaethon/kamene">kamene</a>. Kamene is more than buggy and outdated. It’s based on a 2015 version of scapy, and is missing around 3000 commits (in year of 2018)</li>
<li></li>
</ul>
<h1 id="scapy-安装">Scapy 安装</h1>
<p>https://github.com/secdev/scapy 这个明显更活跃 功能也最全面 比如有对NSH的支持 通过git下载源码</p>
<h1 id="scapy-读取pcap文件">scapy 读取PCAP文件</h1>
<h1 id="scapy-教程">Scapy 教程</h1>
<p>https://thepacketgeek.com/scapy-sniffing-with-custom-actions-part-1/</p>
<h1 id="scapy-api-查询">Scapy API 查询</h1>
<p>https://fossies.org/dox/scapy-2.4.2/namespacescapy_1_1sendrecv.html</p>
<h1 id="section"></h1>
<p>sniff The filter parameter needs a BPF filter. The correct syntax is hence <code>filter=&quot;ether dst aa:bb:cc:dd:ee:ff&quot;</code>.</p>
<p>Paramter <code>count</code> allows to limite la capture à 5 paquets (0 indique «sans arrêt»).</p>
<p><code>filter</code> permet de donner une expression de filtrage avec la syntaxe de <code>tcpdump</code>.</p>
<h1 id="send-back-modified-packet">send back modified packet</h1>
<ul>
<li>send(): send a Layer 3 packet</li>
<li>sendp(): send a Layer 2 packet</li>
</ul>
<h1 id="troubleshooting">Troubleshooting</h1>
<h2 id="通过-ssh-远程到另一台服务器上启动-scapy">通过 SSH 远程到另一台服务器上启动 scapy</h2>
<p>当我SSH进远程服务器试着执行<code>sudo scapy</code>的时候，遇到了如下错误. 有意思的是，通过teamviewer远程到远程服务器的时候，scapy 顺利启动并没有任何问题！ <figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Failed <span class="keyword">to</span> <span class="keyword">connect</span> <span class="keyword">to</span> Mir: Failed <span class="keyword">to</span> <span class="keyword">connect</span> <span class="keyword">to</span> <span class="keyword">server</span> socket: <span class="keyword">No</span> such file <span class="keyword">or</span> directory</span><br><span class="line">Unable <span class="keyword">to</span> init <span class="keyword">server</span>: Could <span class="keyword">not</span> <span class="keyword">connect</span>: <span class="keyword">Connection</span> refused</span><br><span class="line"></span><br><span class="line">(scapy:<span class="number">29722</span>): Gtk-<span class="built_in">WARNING</span> **: Locale <span class="keyword">not</span> supported <span class="keyword">by</span> C library.</span><br><span class="line">    <span class="keyword">Using</span> the fallback <span class="string">&#x27;C&#x27;</span> locale.</span><br><span class="line">Failed <span class="keyword">to</span> <span class="keyword">connect</span> <span class="keyword">to</span> Mir: Failed <span class="keyword">to</span> <span class="keyword">connect</span> <span class="keyword">to</span> <span class="keyword">server</span> socket: <span class="keyword">No</span> such file <span class="keyword">or</span> directory</span><br><span class="line">Unable <span class="keyword">to</span> init <span class="keyword">server</span>: Could <span class="keyword">not</span> <span class="keyword">connect</span>: <span class="keyword">Connection</span> refused</span><br><span class="line"></span><br><span class="line">(scapy:<span class="number">29722</span>): Gdk-CRITICAL **: gdk_cursor_new_for_display: <span class="keyword">assertion</span> <span class="string">&#x27;GDK_IS_DISPLAY (display)&#x27;</span> failed</span><br></pre></td></tr></table></figure> 解决方案： 在发起 SSH 连接的电脑(而不是被远程访问的电脑)终端里输入如下命令： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export DISPLAY=:0</span><br></pre></td></tr></table></figure> 有的网友说，在他们的机器里(Gnome on Ubuntu 16.04) <code>DISPLAY=:1</code> 有用.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/04/01/vagrant-virtualbox-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/01/vagrant-virtualbox-install/" class="post-title-link" itemprop="url">How to install VirtualBox and Vagrant under ubuntu 16.04</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-01 07:38:22" itemprop="dateCreated datePublished" datetime="2019-04-01T07:38:22+08:00">2019-04-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-10 16:39:37" itemprop="dateModified" datetime="2020-06-10T16:39:37+08:00">2020-06-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tools/" itemprop="url" rel="index"><span itemprop="name">tools</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>VirtualBox 5.2 is a major upgrade and the UI takes on a more polished and modern feel. There are a few additional features available;</p>
<ul>
<li>New ability to enable export VM to Oracle Cloud</li>
<li>Unattended guest installation</li>
<li>Virtual Media Manager and Snapshot Pane re-work</li>
</ul>
<p>Note that if Vagrant want to use VirtualBox 5.2 as provider, make sure that the version of installed Vagrant should be greater than 2.0.</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">wget</span> https://releases.hashicorp.com/vagrant/<span class="number">2</span>.<span class="number">2</span>.<span class="number">6</span>/vagrant_<span class="number">2</span>.<span class="number">2</span>.<span class="number">6</span>_x<span class="number">86</span>_<span class="number">64</span>.deb</span><br><span class="line"><span class="attribute">sudo</span> dpkg -i vagrant_<span class="number">2</span>.<span class="number">2</span>.<span class="number">6</span>_x<span class="number">86</span>_<span class="number">64</span>.deb</span><br></pre></td></tr></table></figure>
<h1 id="installation-of-virtualbox-5.2.x-on-ubuntu">Installation of Virtualbox 5.2.x on Ubuntu</h1>
<h2 id="step-1-update-ubuntu">step 1: Update Ubuntu</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update </span><br><span class="line">sudo apt-get upgrade</span><br><span class="line">sudo apt-get autoremove</span><br></pre></td></tr></table></figure>
<p>if you need to upgrade your linux system, you can: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get dist-upgrade</span><br></pre></td></tr></table></figure></p>
<h2 id="step-2-install-required-linux-headers">Step 2: Install Required Linux Headers</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -y install gcc make linux-headers-$(uname -r) dkms</span><br></pre></td></tr></table></figure>
<h2 id="step-3-add-virtualbox-repository-and-key">step 3: Add VirtualBox Repository and key</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget -q https://www.virtualbox.org/download/oracle_vbox_2016.asc -O- | sudo apt-key add -</span><br><span class="line">wget -q https://www.virtualbox.org/download/oracle_vbox.asc -O- | sudo apt-key add -</span><br></pre></td></tr></table></figure>
<p>Next run the commands below to add VirtualBox repository to your system. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sh -c &#x27;echo &quot;deb http://download.virtualbox.org/virtualbox/debian $(lsb_release -sc) contrib&quot; &gt;&gt; /etc/apt/sources.list&#x27;</span><br></pre></td></tr></table></figure></p>
<h2 id="step-4-remove-all-previously-installed-virtualbox">step 4: Remove all previously installed virtualbox</h2>
<p>Find installed package using below command: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -l | grep virtualbox </span><br></pre></td></tr></table></figure> For my cases: <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ii</span>  unity-scope-virtualbox                     <span class="number">0</span>.<span class="number">1</span>+<span class="number">13</span>.<span class="number">10</span>.<span class="number">20130723</span>-<span class="number">0</span>ubuntu<span class="number">1</span>                  <span class="literal">all</span>          VirtualBox scope for Unity</span><br><span class="line"><span class="attribute">rF</span>  virtualbox-<span class="number">5</span>.<span class="number">1</span>                             <span class="number">5</span>.<span class="number">1</span>.<span class="number">38</span>-<span class="number">122592</span>~Ubuntu~xenial                  amd<span class="number">64</span>        Oracle VM VirtualBox</span><br><span class="line"><span class="attribute">rc</span>  virtualbox-<span class="number">6</span>.<span class="number">0</span>                             <span class="number">6</span>.<span class="number">0</span>.<span class="number">0</span>-<span class="number">127566</span>~Ubuntu~xenial                   amd<span class="number">64</span>        Oracle VM VirtualBox</span><br><span class="line"><span class="attribute">ii</span>  virtualbox-dkms                            <span class="number">5</span>.<span class="number">1</span>.<span class="number">38</span>-dfsg-<span class="number">0</span>ubuntu<span class="number">1.16.04.3</span>                 <span class="literal">all</span>          x<span class="number">86</span> virtualization solution - kernel module sources for dkms</span><br><span class="line"><span class="attribute">rc</span>  virtualbox-qt                              <span class="number">5</span>.<span class="number">1</span>.<span class="number">38</span>-dfsg-<span class="number">0</span>ubuntu<span class="number">1.16.04.3</span>                 amd<span class="number">64</span>        x<span class="number">86</span> virtualization solution - Qt based user interface</span><br></pre></td></tr></table></figure></p>
<p>Then copy <Packages> and remove using dpkg or apt-get as below: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg --purge &lt;Packages&gt;</span><br></pre></td></tr></table></figure> <code>--force-all</code> optional</p>
<h2 id="step-4-install-virtualbox-5.2">Step 4: Install VirtualBox 5.2</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install -y virtualbox-5.2</span><br></pre></td></tr></table></figure>
<p>To verify if VirtualBox is installed, run the commands below. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VBoxManage -v</span><br></pre></td></tr></table></figure></p>
<h2 id="step-5-install-virtualbox-extension-pack">Step 5: Install VirtualBox Extension Pack</h2>
<p>Everytime you install VirtualBox make sure to install the extension pack as well. The pack enables VRDP (Virtual Remote Desktop Protocol) and many other enhancements.</p>
<p>Given that we install virtualbox 5.26, to install it, run the commands below <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -O http://download.virtualbox.org/virtualbox/5.2.26/Oracle_VM_VirtualBox_Extension_Pack-5.2.26-128414.vbox-extpack</span><br><span class="line">sudo VBoxManage extpack install Oracle_VM_VirtualBox_Extension_Pack-5.2.26-128414.vbox-extpack</span><br></pre></td></tr></table></figure> Agree to the terms and install.</p>
<p>Run the commands below to view the extension pack installed. <figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">VBoxManage list extpacks</span></span><br></pre></td></tr></table></figure></p>
<h2 id="step-6-check-and-install-vbox-guest-additions">Step 6: Check and install Vbox guest additions</h2>
<p>这玩意儿是不是必须的？如果不需要图形用户界面的话。。。 I install virtualbox 5.2.26, thus I have to download the corresponding iso file. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.virtualbox.org/virtualbox/5.2.26/VBoxGuestAdditions_5.2.26.iso</span><br></pre></td></tr></table></figure> Then create an empty directory in /media and mount it there: <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir <span class="regexp">/media/i</span>so</span><br><span class="line">sudo mount VBoxGuestAdditions_5.<span class="number">2.26</span>.iso <span class="regexp">/media/i</span>so</span><br></pre></td></tr></table></figure> Then go there and run the Linux installer: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /media/iso</span><br><span class="line">sudo ./VBoxLinuxAdditions.run</span><br></pre></td></tr></table></figure></p>
<p>Reboot your guest OS: <figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">reboot</span></span><br></pre></td></tr></table></figure> You should be able to access your shared folder under <code>/media/sf_[your_folder_name]</code></p>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>At this point, you may be able to open the new VirtualBox UI but in my case, I was not able to start any of my Old VM’s.</p>
<p>After struggling and panicking for 10 minutes I found that I needed to run the below command twice then everything just started working</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="regexp">/sbin/</span>vboxconfig</span><br></pre></td></tr></table></figure>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">qsong@lab01  ~/Documents/linuxkit-test  vagrant up</span><br><span class="line">No usable default provider could be found <span class="keyword">for</span> your system.</span><br><span class="line"></span><br><span class="line">Vagrant relies <span class="keyword">on</span> interactions <span class="keyword">with</span> <span class="number">3</span>rd party systems, known <span class="keyword">as</span></span><br><span class="line"><span class="string">&quot;providers&quot;</span>, <span class="keyword">to</span> provide Vagrant <span class="keyword">with</span> resources <span class="keyword">to</span> <span class="built_in">run</span> development</span><br><span class="line">environments. Examples are VirtualBox, VMware, Hyper-V.</span><br><span class="line"></span><br><span class="line">The easiest solution <span class="keyword">to</span> this message <span class="keyword">is</span> <span class="keyword">to</span> install VirtualBox, which</span><br><span class="line"><span class="keyword">is</span> available <span class="keyword">for</span> free <span class="keyword">on</span> all major platforms.</span><br><span class="line"></span><br><span class="line">If you believe you already have a provider available, make sure <span class="keyword">it</span></span><br><span class="line"><span class="keyword">is</span> properly installed <span class="keyword">and</span> configured. You can see more details <span class="keyword">about</span></span><br><span class="line">why a particular provider <span class="keyword">isn&#x27;t</span> working <span class="keyword">by</span> forcing usage <span class="keyword">with</span></span><br><span class="line">`vagrant up <span class="comment">--provider=PROVIDER`, which should give you a more specific</span></span><br><span class="line"><span class="keyword">error</span> message <span class="keyword">for</span> <span class="keyword">that</span> particular provider.</span><br></pre></td></tr></table></figure>
<p>出现上述错误的原因: vagrant版本和virtualbox版本不兼容。需要升级vagrant!</p>
<h1 id="vagrant-basic-usage">Vagrant basic usage</h1>
<h2 id="relaod">Relaod</h2>
<p>vagrant reload = vagrant halt + vagrant up. This command is usually required for changes made in the Vagrantfile to take into effect. After making any modifications to the Vagrantfile, a <code>reload</code> should be called. The configured provisoners will not run again, by default. You can force the provisioners to re-run by specifying the <code>--provision</code> flag.</p>
<h1 id="how-to-enable-x11-forwarding-for-running-x11-application-within-vagrant-box">How to enable X11 forwarding for running X11 application within vagrant box?</h1>
<p>First step, in your Vagrant file, please add two instructions: <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">config.ssh.forward_agent</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">config.ssh.forward_x11</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure></p>
<p>After such modification, the vagrant file should look like as follows: <figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Vagrant.<span class="built_in">configure</span>(VAGRANTFILE_API_VERSION) <span class="keyword">do</span> |config|</span><br><span class="line"></span><br><span class="line">  config.vm.box = <span class="string">&quot;generic/ubuntu1604&quot;</span></span><br><span class="line">  config.ssh.forward_agent = <span class="literal">true</span></span><br><span class="line">  config.ssh.forward_x11 = <span class="literal">true</span></span><br><span class="line">  <span class="meta"># config.vm.box = <span class="meta-string">&quot;bento/ubuntu-16.04&quot;</span></span></span><br><span class="line">  config.vm.provision <span class="string">&quot;shell&quot;</span>, <span class="keyword">inline</span>: $script</span><br><span class="line">  config.vm.provision <span class="string">&quot;docker&quot;</span></span><br><span class="line"></span><br><span class="line">  config.vm.synced_folder <span class="string">&quot;.&quot;</span>, <span class="string">&quot;/vagrant&quot;</span></span><br><span class="line">  <span class="meta"># config.vm.network <span class="meta-string">&quot;public_network&quot;</span></span></span><br><span class="line">  config.vm.define <span class="string">&quot;consul&quot;</span> <span class="keyword">do</span> | con |</span><br><span class="line">    con.vm.provider <span class="string">&quot;consul&quot;</span> <span class="keyword">do</span> | c |</span><br><span class="line">      c.name = <span class="string">&quot;consul&quot;</span></span><br><span class="line">      c.memory = <span class="number">512</span></span><br><span class="line">      c.cpus = <span class="number">2</span></span><br><span class="line">    end</span><br><span class="line">    con.vm.network <span class="string">&quot;private_network&quot;</span>, ip: <span class="string">&quot;192.168.1.11&quot;</span></span><br><span class="line">    con.vm.hostname = <span class="string">&quot;consul&quot;</span></span><br><span class="line">  end</span><br></pre></td></tr></table></figure></p>
<p>Second, ssh into your target vagrant box (e.g. your VM), make sure that option <code>X11Forwarding</code> is set to <code>yes</code>, this is actually done thanks to the configuration in Vagrant file. You also need to add the following configuration: <figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">X11UseLocalhost</span> <span class="literal">no</span></span><br></pre></td></tr></table></figure> By setting <code>X11UseLocalhost</code> to <code>no</code>, we speicify that the forwarding server should be bound to the wildcard address. By default, this argument is set to <code>yes</code>, and sshd<code>binds the forwarding server to the loopback address and sets the hostname part of the</code>DISPLAY` environment variable to ``localhost''. This prevents remote hosts from connecting to the proxy display.</p>
<p>Don't forget to <code>vagrant reload --provision</code> so that all the above modifications will take into effect.</p>
<p>Third, ensure that in your PC, where you would like to start an SSH session with X11 forwarding, the corresponding entry in <code>./ssh/config</code> has arguemnt such as <code>ForwardX11 yes</code>.</p>
<p>Until this step, normally you can run X11 application with GUI on host machine. To verify, you can simply test with <code>xeyes</code> or <code>xclocks</code> after establishing an SSH session.</p>
<p>At worse, you might need to replace the <code>-X</code> with a <code>-Y</code> if the remote system is untrusted.</p>
<p>Finally, I would like to say, the GUI rendered by XQuartz, under MacOSX platform, is really realy ugly! Why this project has never been updated since 2016?</p>
<p>iLBC library installation: https://launchpad.net/~linphone/+archive/ubuntu/release/+sourcepub/2295457/+listing-archive-extra</p>
<h1 id="vagrant-port-forwarding">vagrant port forwarding</h1>
<p>One way to set up a temporary terminal, besides opening up the VirtualBox settings, is to use <code>vagrant ssh</code>, with additional arguments given after the <code>--</code>: <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">vagrant</span> ssh -- -L <span class="number">3000</span>:localhost:<span class="number">3000</span></span><br></pre></td></tr></table></figure> This will forward port 3000 on the host to port 3000 on the guest. The first number is for the host. This will only last as long as your ssh session. If ssh gets disconnected, run it again. To make it persist after restarts, add it to your <code>Vagrantfile</code>.</p>
<p>References: https://websiteforstudents.com/virtualbox-5-2-on-ubuntu-16-04-lts-server-headless/ https://garywoodfine.com/install-virtual-box-5-2-ubuntu-16-04/</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/03/29/latest-sfc103demo-trial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/29/latest-sfc103demo-trial/" class="post-title-link" itemprop="url">latest-sfc103demo-trial</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-29 23:33:10" itemprop="dateCreated datePublished" datetime="2019-03-29T23:33:10+08:00">2019-03-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-06-11 11:15:25" itemprop="dateModified" datetime="2019-06-11T11:15:25+08:00">2019-06-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>The Southbound REST Plug-in is used to send configuration from datastore down to network devices supporting a REST API (i.e. they have a configured REST URI). It supports POST/PUT/DELETE operations, which are triggered accordingly by changes in the SFC data stores.</p>
<p>Network devices supporting REST API (provided by sfc-agent.py)</p>
<p>we developped a proof-of-concept (PoC) implementation for the proposed schema in the context of SFC environment. The key idea is to carry OMS signature into NSH header we describe the service chain in a high level policy language, let service orchestrator to instantiate the required service nodes and chain them by OpenDaylight SFC feature. To this end,</p>
<p>The difficulties we are faced with are: 1) how to initialize and distribute OMS parameters (such as publick key, secrete id, etc) for each involved service function on a chain; 2) how to carry and transport generated signature;</p>
<h1 id="network-topology">Network topology</h1>
<p>In our proof-of-work, we use Vagrant and Docker to create network topology illustrated in Fig.XX. Each node is instantiated as a container and configure to listen on a port. ODL serves as the SDN controller to stich these nodes together to construct a service function chain on leveraging SFC feature. ODL SFC provides a set of northbound RESTFul to receive high level SFC chaining and translate them into low level OVS instructions and concrete service function settings , which are further sent to create corresponding container to create classifers and service function forwarders and configuration setting to create corresponding service function.</p>
<p>The service function chain information is described by a JSON format file re</p>
<h1 id="ibe-pki">IBE PKI</h1>
<p>The proposed OMS is built on top of Identity Based Encrption, and thus requires an IBE Public key infrastructure. We developped such a PKI with PBC, PyPBC (a Python binding for PBC) and Python Flask web framework. In such a PKI, a master server listening an occupied TCP port is in charge of receiving service function chain information (identities of each involved service function, their connnection order) and cryptography setting (elliptic curve type, key size, etc.). Once that OMS related parameters, such as pairing function, public key, etc, verification parameters in Eq.(5.1), Eq.(5.2), Eq.(5.6), Eq.(5.7), Eq.(5.8). Once these information is ready, master server proactively send them to each involved service functions.</p>
<h1 id="design-of-nsh-and-oms-aware-service-function">Design of NSH and OMS aware service function</h1>
<p>The proposed idea requires service functions capable of parsing NSH header and inserting, updating and removing OMS signature into transmitted packet. SFC community provides an open source NSH-aware service function implementation provide service function types such as such as firewall, NAT, IDS, etc. The main difficulty to extend these service functions into NSH and OMS aware ones is how to put generated signature (according to the construction methodology in Sec.5.3) into packet. A intuitive solution is to carry the signature into metadata field of NSH header. Recall that NSH has two types: type 1 and type 2. Type 1 has a fixed length of 16 bytes, whose capactiy is not enough to carray secure signature. Athough NSH type 2 header provi a variable length, theoretically able to carray OMS signature, it is yet implemented. Moreever, the metadata is designed to carry some shared information by service function in data center.</p>
<p>We proposed to use NSH type 1 to carry signature. The idea is to insert signature between NSH header and the its orignal payload. The signature size is stored by each service function at the inital stage. The first signer of a given chain is in charge of generating and inserting this signature. The last service function on a chain, is in charge first do the last time signature generation, and then do the verification. To this end, each node should know if it is the first node or last node on a given chain (indicated by field SP and SI). The SI of first node and last node can be derived from JSON file describing service function chain. In our design, the workflow of an NSH and OMS aware service function is illustrated in Fig. XX.</p>
<h1 id="impl.">Impl.</h1>
<p>Recall that our proposal is aimed to check if the consistency of a given SFC chain is guaranteed. Once man-in-the-middle attacks happens, if any packet transmitted after the occurence of attack is sent alongside the SFP, the anormaly can be detected at receiver because the signature verification is failed. Thus, we don't need to sign and verify every packet over the given SFP. Instead, we can let NSH and OMS aware SF sign and verify the packet in a probabilisic way. Concretely, at the initialisation stage (i.e. establishment of SFC and key distribution), a threshold value <span class="math inline">\(p\)</span>, in range [0,1] will be sent to the evolved SF alongside with other OMS paramters. In the first SF, namely the first signer of a SFP, it randomly select a value in [0,1] according to uniform distribution and compare it with previously stored threshold, to determine if it should signer the received packet. This probabilistic schema avoid high signature related latency at the cost of some latency to detect the attack. How to efficently use the proposed schema, concretely speaking, how to rationaly choose threshold value, to get a trade off between lower transmission overhead and higher attack sensitivity, is left to a future work. How to choose the threshold value is the job of network administrator. For network service with intensive packet exchange, such as video streaming, big file download, this value can be set as small as 0.1%. For network service such as smart metering that may upload a message per hour even per day, this value can be set as 1.</p>
<h2 id="现阶段任务">现阶段任务：</h2>
<p>1） 创建一个 shell script, 这个script要可以杀掉container中的某个进程同时重新启动该进程 这脚本叫做 lite_run_demo.sh 2） 创建一个建议版本的setup_sfc.py</p>
<h1 id="重大喜讯">重大喜讯：</h1>
<p>之前发送HTTP request虽然会成功但是要等好久。这个问题在社区邮件的帮助下，终于被解决了！ 思路是需要关闭tx offload功能，做法是在容器<code>sf1</code>以及容器<code>sf2</code>里，分别输入: <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ethtool</span> --offload  eth<span class="number">0</span>  rx <span class="literal">off</span>  tx <span class="literal">off</span></span><br></pre></td></tr></table></figure> 在容器<code>sf2</code>中输入: 我在vagrant虚拟机也做了操作 <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ethtool</span> --offload docker<span class="number">0</span>  rx <span class="literal">off</span>  tx <span class="literal">off</span></span><br></pre></td></tr></table></figure> 目前不知道是，这两条指令一起作用，还是只需要在容器里操作就行。</p>
<h1 id="关于-sfc-py-的探索">关于 sfc-py 的探索</h1>
<h2 id="sfc-agent.py">sfc-agent.py</h2>
<p>这实际上是启动了一个 RESTFul server, 跟 HTTP server 及其相似，都是可以接受REST Request(put/get action), 区别在于 sfc-agent.py 启动的 server 监听的其实是 ODL相关的端口，默认是 5000.</p>
<h2 id="sfccommonservices.py">sfc/common/services.py</h2>
<p>接受，处理，转发 packet！！ 这个脚本里但凡有异常发生，就无法 HTTP client 就无法 联系到 HTTP server了！！！</p>
<h1 id="python3中-str-bytes-bytesarray-网络数据转换">python3中 str, bytes, bytesarray 网络数据转换</h1>
<p>从网络数据包中得到的数据其实是个 bytes. 长得很像是str, 但是并不是！！！ 看看这个帖子 https://learning-python.com/strings30.html</p>
<h1 id="ovs-push-nsh操作导致的checksum问题">ovs push-nsh操作导致的checksum问题</h1>
<p>问题描述: 在同一个主机内创建虚拟机以创建 service chain 的时候，虽然最终包会发送成功但是延时特比大，因为checksum问题</p>
<p>在实验开始之前 vagrant based VM 网卡的情况： <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">vagrant</span>@odl:~$ ip addr</span><br><span class="line"><span class="attribute">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="number">1</span></span><br><span class="line">    <span class="attribute">link</span>/loopback <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">    <span class="attribute">inet</span> <span class="number">127.0.0.1</span>/<span class="number">8</span> scope host lo</span><br><span class="line">       <span class="attribute">valid_lft</span> forever preferred_lft forever</span><br><span class="line"><span class="attribute">2</span>: eth<span class="number">0</span>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc pfifo_fast state UP group default qlen <span class="number">1000</span></span><br><span class="line">    <span class="attribute">link</span>/ether <span class="number">08</span>:<span class="number">00</span>:<span class="number">27</span>:<span class="number">0</span>b:<span class="number">11</span>:<span class="number">28</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    <span class="attribute">inet</span> <span class="number">10.0.2.15</span>/<span class="number">24</span> brd <span class="number">10.0.2.255</span> scope global eth<span class="number">0</span></span><br><span class="line">       <span class="attribute">valid_lft</span> forever preferred_lft forever</span><br><span class="line"><span class="attribute">3</span>: docker<span class="number">0</span>: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu <span class="number">1500</span> qdisc noqueue state DOWN group default</span><br><span class="line">    <span class="attribute">link</span>/ether <span class="number">02</span>:<span class="number">42</span>:<span class="number">2</span>a:a<span class="number">0</span>:ee:b<span class="number">6</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    <span class="attribute">inet</span> <span class="number">172.17.0.1</span>/<span class="number">16</span> brd <span class="number">172.17.255.255</span> scope global docker<span class="number">0</span></span><br><span class="line">       <span class="attribute">valid_lft</span> forever preferred_lft forever</span><br></pre></td></tr></table></figure></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="number">1</span></span><br><span class="line">    <span class="attribute">link</span>/loopback <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">    <span class="attribute">inet</span> <span class="number">127.0.0.1</span>/<span class="number">8</span> scope host lo</span><br><span class="line">       <span class="attribute">valid_lft</span> forever preferred_lft forever</span><br><span class="line"><span class="attribute">2</span>: eth<span class="number">0</span>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc pfifo_fast state UP group default qlen <span class="number">1000</span></span><br><span class="line">    <span class="attribute">link</span>/ether <span class="number">08</span>:<span class="number">00</span>:<span class="number">27</span>:<span class="number">0</span>b:<span class="number">11</span>:<span class="number">28</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    <span class="attribute">inet</span> <span class="number">10.0.2.15</span>/<span class="number">24</span> brd <span class="number">10.0.2.255</span> scope global eth<span class="number">0</span></span><br><span class="line">       <span class="attribute">valid_lft</span> forever preferred_lft forever</span><br><span class="line"><span class="attribute">3</span>: docker<span class="number">0</span>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc noqueue state UP group default</span><br><span class="line">    <span class="attribute">link</span>/ether <span class="number">02</span>:<span class="number">42</span>:<span class="number">2</span>a:a<span class="number">0</span>:ee:b<span class="number">6</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    <span class="attribute">inet</span> <span class="number">172.17.0.1</span>/<span class="number">16</span> brd <span class="number">172.17.255.255</span> scope global docker<span class="number">0</span></span><br><span class="line">       <span class="attribute">valid_lft</span> forever preferred_lft forever</span><br><span class="line"><span class="attribute">4</span>: ovs-gretap<span class="number">0</span>@NONE: &lt;BROADCAST,MULTICAST&gt; mtu <span class="number">1462</span> qdisc noop state DOWN group default qlen <span class="number">1000</span></span><br><span class="line">    <span class="attribute">link</span>/ether <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line"><span class="attribute">5</span>: erspan<span class="number">0</span>@NONE: &lt;BROADCAST,MULTICAST&gt; mtu <span class="number">1450</span> qdisc noop state DOWN group default qlen <span class="number">1000</span></span><br><span class="line">    <span class="attribute">link</span>/ether b<span class="number">2</span>:<span class="number">63</span>:<span class="number">44</span>:<span class="number">84</span>:<span class="number">64</span>:<span class="number">73</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line"><span class="attribute">6</span>: ovs-ip<span class="number">6</span>gre<span class="number">0</span>@NONE: &lt;NOARP&gt; mtu <span class="number">1448</span> qdisc noop state DOWN group default qlen <span class="number">1</span></span><br><span class="line">    <span class="attribute">link</span>/gre<span class="number">6</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="attribute">7</span>: ovs-ip<span class="number">6</span>tnl<span class="number">0</span>@NONE: &lt;NOARP&gt; mtu <span class="number">1452</span> qdisc noop state DOWN group default qlen <span class="number">1</span></span><br><span class="line">    <span class="attribute">link</span>/tunnel<span class="number">6</span> :: brd ::</span><br><span class="line"><span class="attribute">9</span>: br-ff<span class="number">8</span>a<span class="number">34</span>d<span class="number">3</span>f<span class="number">77</span>c: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu <span class="number">1500</span> qdisc noqueue state DOWN group default</span><br><span class="line">    <span class="attribute">link</span>/ether <span class="number">02</span>:<span class="number">42</span>:<span class="number">7</span>a:b<span class="number">9</span>:<span class="number">11</span>:<span class="number">45</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    <span class="attribute">inet</span> <span class="number">192.168.1.5</span>/<span class="number">24</span> brd <span class="number">192.168.1.255</span> scope global br-ff<span class="number">8</span>a<span class="number">34</span>d<span class="number">3</span>f<span class="number">77</span>c</span><br><span class="line">       <span class="attribute">valid_lft</span> forever preferred_lft forever</span><br><span class="line"><span class="attribute">11</span>: veth<span class="number">1</span>c<span class="number">0</span>a<span class="number">779</span>@if<span class="number">10</span>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc noqueue master docker<span class="number">0</span> state UP group default</span><br><span class="line">    <span class="attribute">link</span>/ether ce:<span class="number">71</span>:<span class="number">48</span>:f<span class="number">1</span>:<span class="number">7</span>f:e<span class="number">4</span> brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">0</span></span><br></pre></td></tr></table></figure>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="number">1</span></span><br><span class="line">    <span class="attribute">link</span>/loopback <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">    <span class="attribute">inet</span> <span class="number">127.0.0.1</span>/<span class="number">8</span> scope host lo</span><br><span class="line">       <span class="attribute">valid_lft</span> forever preferred_lft forever</span><br><span class="line"><span class="attribute">2</span>: eth<span class="number">0</span>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc pfifo_fast state UP group default qlen <span class="number">1000</span></span><br><span class="line">    <span class="attribute">link</span>/ether <span class="number">08</span>:<span class="number">00</span>:<span class="number">27</span>:<span class="number">0</span>b:<span class="number">11</span>:<span class="number">28</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    <span class="attribute">inet</span> <span class="number">10.0.2.15</span>/<span class="number">24</span> brd <span class="number">10.0.2.255</span> scope global eth<span class="number">0</span></span><br><span class="line">       <span class="attribute">valid_lft</span> forever preferred_lft forever</span><br><span class="line"><span class="attribute">3</span>: docker<span class="number">0</span>: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu <span class="number">1500</span> qdisc noqueue state DOWN group default</span><br><span class="line">    <span class="attribute">link</span>/ether <span class="number">02</span>:<span class="number">42</span>:<span class="number">2</span>a:a<span class="number">0</span>:ee:b<span class="number">6</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    <span class="attribute">inet</span> <span class="number">172.17.0.1</span>/<span class="number">16</span> brd <span class="number">172.17.255.255</span> scope global docker<span class="number">0</span></span><br><span class="line">       <span class="attribute">valid_lft</span> forever preferred_lft forever</span><br><span class="line"><span class="attribute">4</span>: ovs-gretap<span class="number">0</span>@NONE: &lt;BROADCAST,MULTICAST&gt; mtu <span class="number">1462</span> qdisc noop state DOWN group default qlen <span class="number">1000</span></span><br><span class="line">    <span class="attribute">link</span>/ether <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line"><span class="attribute">5</span>: erspan<span class="number">0</span>@NONE: &lt;BROADCAST,MULTICAST&gt; mtu <span class="number">1450</span> qdisc noop state DOWN group default qlen <span class="number">1000</span></span><br><span class="line">    <span class="attribute">link</span>/ether b<span class="number">2</span>:<span class="number">63</span>:<span class="number">44</span>:<span class="number">84</span>:<span class="number">64</span>:<span class="number">73</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line"><span class="attribute">6</span>: ovs-ip<span class="number">6</span>gre<span class="number">0</span>@NONE: &lt;NOARP&gt; mtu <span class="number">1448</span> qdisc noop state DOWN group default qlen <span class="number">1</span></span><br><span class="line">    <span class="attribute">link</span>/gre<span class="number">6</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="attribute">7</span>: ovs-ip<span class="number">6</span>tnl<span class="number">0</span>@NONE: &lt;NOARP&gt; mtu <span class="number">1452</span> qdisc noop state DOWN group default qlen <span class="number">1</span></span><br><span class="line">    <span class="attribute">link</span>/tunnel<span class="number">6</span> :: brd ::</span><br><span class="line"><span class="attribute">9</span>: br-ff<span class="number">8</span>a<span class="number">34</span>d<span class="number">3</span>f<span class="number">77</span>c: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc noqueue state UP group default</span><br><span class="line">    <span class="attribute">link</span>/ether <span class="number">02</span>:<span class="number">42</span>:<span class="number">7</span>a:b<span class="number">9</span>:<span class="number">11</span>:<span class="number">45</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    <span class="attribute">inet</span> <span class="number">192.168.1.5</span>/<span class="number">24</span> brd <span class="number">192.168.1.255</span> scope global br-ff<span class="number">8</span>a<span class="number">34</span>d<span class="number">3</span>f<span class="number">77</span>c</span><br><span class="line">       <span class="attribute">valid_lft</span> forever preferred_lft forever</span><br><span class="line"><span class="attribute">15</span>: veth<span class="number">674</span>a<span class="number">731</span>@if<span class="number">14</span>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc noqueue master br-ff<span class="number">8</span>a<span class="number">34</span>d<span class="number">3</span>f<span class="number">77</span>c state UP group default</span><br><span class="line">    <span class="attribute">link</span>/ether <span class="number">96</span>:<span class="number">50</span>:<span class="number">59</span>:<span class="number">81</span>:<span class="number">9</span>e:<span class="number">1</span>a brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">2</span></span><br><span class="line"><span class="attribute">17</span>: veth<span class="number">6</span>d<span class="number">4196</span>c@if<span class="number">16</span>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc noqueue master br-ff<span class="number">8</span>a<span class="number">34</span>d<span class="number">3</span>f<span class="number">77</span>c state UP group default</span><br><span class="line">    <span class="attribute">link</span>/ether <span class="number">3</span>e:<span class="number">12</span>:<span class="number">4</span>a:<span class="number">9</span>f:b<span class="number">6</span>:d<span class="number">7</span> brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">4</span></span><br><span class="line"><span class="attribute">19</span>: vetha<span class="number">350</span>c<span class="number">67</span>@if<span class="number">18</span>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc noqueue master br-ff<span class="number">8</span>a<span class="number">34</span>d<span class="number">3</span>f<span class="number">77</span>c state UP group default</span><br><span class="line">    <span class="attribute">link</span>/ether c<span class="number">6</span>:df:c<span class="number">1</span>:f<span class="number">6</span>:<span class="number">5</span>d:<span class="number">09</span> brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">1</span></span><br><span class="line"><span class="attribute">21</span>: vethd<span class="number">84</span>d<span class="number">1</span>f<span class="number">8</span>@if<span class="number">20</span>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc noqueue master br-ff<span class="number">8</span>a<span class="number">34</span>d<span class="number">3</span>f<span class="number">77</span>c state UP group default</span><br><span class="line">    <span class="attribute">link</span>/ether d<span class="number">2</span>:<span class="number">7</span>a:f<span class="number">2</span>:<span class="number">6</span>e:<span class="number">7</span>b:<span class="number">67</span> brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">3</span></span><br><span class="line"><span class="attribute">23</span>: vethc<span class="number">20</span>c<span class="number">33</span>c@if<span class="number">22</span>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc noqueue master br-ff<span class="number">8</span>a<span class="number">34</span>d<span class="number">3</span>f<span class="number">77</span>c state UP group default</span><br><span class="line">    <span class="attribute">link</span>/ether e<span class="number">2</span>:bd:<span class="number">03</span>:<span class="number">8</span>b:c<span class="number">8</span>:<span class="number">1</span>f brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">5</span></span><br><span class="line"><span class="attribute">25</span>: veth<span class="number">58754</span>f<span class="number">3</span>@if<span class="number">24</span>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc noqueue master br-ff<span class="number">8</span>a<span class="number">34</span>d<span class="number">3</span>f<span class="number">77</span>c state UP group default</span><br><span class="line">    <span class="attribute">link</span>/ether ae:fc:e<span class="number">0</span>:<span class="number">04</span>:<span class="number">28</span>:<span class="number">46</span> brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>在 docker-compos 之后，我们发现多了一个docker netwwork <code>vagrant_sfc103_mgmt</code> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vagrant<span class="variable">@odl</span>:<span class="operator">~</span>$ docker network ls</span><br><span class="line">NETWORK ID          NAME                  DRIVER              <span class="keyword">SCOPE</span></span><br><span class="line">b5886910b27e        bridge                bridge              <span class="keyword">local</span></span><br><span class="line"><span class="number">77</span>a1ac9dcff2        host                  host                <span class="keyword">local</span></span><br><span class="line"><span class="number">0950370</span>f3d6f        <span class="keyword">none</span>                  <span class="keyword">null</span>                <span class="keyword">local</span></span><br><span class="line">ff8a34d3f77c        vagrant_sfc103_mgmt   bridge              <span class="keyword">local</span></span><br></pre></td></tr></table></figure></p>
<h1 id="apt-get-update-stuck-at-0-percent">apt-get update stuck at 0 percent</h1>
<p>https://medium.com/<span class="citation" data-cites="lifez/solved-apt-get-update-stuck-connecting-to-security-ubuntu-com-dbe41eeb5a0b">@lifez/solved-apt-get-update-stuck-connecting-to-security-ubuntu-com-dbe41eeb5a0b</span></p>
<p>我不知道具体原因，但是一定是跟学校网络设置有关 <code>generic/ubuntu1604</code> 的源就是没有办法连接ubuntu 16.04的软件仓库</p>
<p>I tried to check the DNS configuration of my Ubuntu server, deployed within school's network.vagrant@odl:~$ <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat /etc/resolv.conf</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Dynamic resolv.conf(5) file <span class="keyword">for</span> glibc resolver(3) generated by resolvconf(8)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN</span></span><br><span class="line">nameserver 4.2.2.1</span><br><span class="line">nameserver 4.2.2.2</span><br><span class="line">nameserver 208.67.220.220</span><br><span class="line">search imtld.local</span><br></pre></td></tr></table></figure></p>
<p>IP address such as <code>4.2.2.1</code> is reachable by ping command. However, I don't know why DNS function does not work. One thing I can make sure is, this error is due to the fact that my Ubuntu server works behind school's proxy, because within my home network, this error does not exist.</p>
<p>A working around I found is to add the following command in Vagrant file: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;nameserver 10.0.2.3&quot; | sudo tee /etc/resolv.conf</span><br></pre></td></tr></table></figure> With this command, you will see the content of initial <code>/etc/resolv.conf</code> will be replaced by <code>nameserver 10.0.2.3</code>.</p>
<p>In NAT networking mode of Virtualbox, each VM is isolated. VM can access host, but host cannot access VM unless if you configure port forwarding.</p>
<ul>
<li>IP:10.0.2.15</li>
<li>Gateway：10.0.2.2</li>
<li>DNS server: 10.0.2.3</li>
</ul>
<h1 id="failed-to-fetch-ubuntukylin-in-host-ubuntu-environment">Failed to fetch ubuntukylin in host Ubuntu environment</h1>
<p>Failed to fetch http://archive.ubuntukylin.com:10006/ubuntukylin/dists/xenial/InRelease 因为 Host Ubuntu 16.04 安装了搜狗输入法，所以需要用到 ubuntukylin. 为了防止不必要的麻烦。 进入系统设置－软件更新－其他软件，找到ubuntukylin的项目，点击编辑，把precise改成trusty，把non-free改成main</p>
<h1 id="各种奇葩错误居然独独缺少了-classifier1">各种奇葩错误：居然独独缺少了 classifier1:</h1>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">vagrant</span>@odl:~$ docker container ls</span><br><span class="line"><span class="attribute">CONTAINER</span> ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line"><span class="attribute">a6c8b387fac4</span>        sfc-service-node    <span class="string">&quot;/app/start.sh&quot;</span>     <span class="number">47</span> seconds ago      Up <span class="number">45</span> seconds                           sff<span class="number">2</span></span><br><span class="line"><span class="attribute">fed2b6d2aab0</span>        sfc-service-node    <span class="string">&quot;/app/start.sh&quot;</span>     <span class="number">47</span> seconds ago      Up <span class="number">46</span> seconds                           classifier<span class="number">2</span></span><br><span class="line"><span class="attribute">e42ee4b0a36d</span>        sfc-service-node    <span class="string">&quot;/app/start.sh&quot;</span>     <span class="number">47</span> seconds ago      Up <span class="number">45</span> seconds                           sff<span class="number">1</span></span><br><span class="line"><span class="attribute">4bfb58d272e8</span>        sfc-service-node    <span class="string">&quot;/app/start.sh&quot;</span>     <span class="number">47</span> seconds ago      Up <span class="number">46</span> seconds                           sf<span class="number">1</span></span><br><span class="line"><span class="attribute">0166b549fa07</span>        sfc-service-node    <span class="string">&quot;/app/start.sh&quot;</span>     <span class="number">47</span> seconds ago      Up <span class="number">46</span> seconds                           sf<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>邪门了啊 为啥就是classifier1没有被创建！！从来没有发生过啊！！！ 但是换了 vagrant 的源就没有这种问题！！这都是什么奇葩事儿！！！</p>
<p>这应该还是跟 vagrant 创建的虚拟机无法正常使用 DNS 服务有关？？？</p>
<h1 id="操蛋了">操蛋了。</h1>
<p>sudo add-apt-repository ppa:webupd8team/java -y 这个java安装源居然出了问题。。。what's the fuck... 从2019年04月16号变得</p>
<p>试试Java11是否可以 https://www.linuxuprising.com/2018/10/how-to-install-oracle-java-11-in-ubuntu.html</p>
<h1 id="sf1sf2-容器居然无法启动">sf1,sf2 容器居然无法启动！！！</h1>
<p>This post saves me! https://www.matthewsetter.com/basic-docker-compose-debugging/</p>
<p>Thanks a lot. 即使我删了虚拟机，从头来过都不行！！！那这说明这应该跟镜像有关？？？ 网上搜到了下面这个命令: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vagrant@odl:/vagrant$ docker-compose ps</span><br><span class="line">   Name          Command      State    Ports</span><br><span class="line">--------------------------------------------</span><br><span class="line">classifier1   /app/start.sh   Up</span><br><span class="line">classifier2   /app/start.sh   Up</span><br><span class="line">sf1           /app/start.sh   Exit 1</span><br><span class="line">sf2           /app/start.sh   Exit 1</span><br><span class="line">sff1          /app/start.sh   Up</span><br><span class="line">sff2          /app/start.sh   Up</span><br></pre></td></tr></table></figure></p>
<p>然后输入如下命令 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">vagrant@odl:/vagrant$ docker-compose logs --follow sf1</span><br><span class="line">Attaching to sf1</span><br><span class="line">sf1            | ++ hostname</span><br><span class="line">sf1            | + host=sf1</span><br><span class="line">sf1            | + &#x27;[&#x27; sf1 == classifier1 &#x27;]&#x27;</span><br><span class="line">sf1            | + &#x27;[&#x27; sf1 == classifier2 &#x27;]&#x27;</span><br><span class="line">sf1            | + &#x27;[&#x27; sf1 == sff1 &#x27;]&#x27;</span><br><span class="line">sf1            | + &#x27;[&#x27; sf1 == sff2 &#x27;]&#x27;</span><br><span class="line">sf1            | + &#x27;[&#x27; sf1 == sf1 &#x27;]&#x27;</span><br><span class="line">sf1            | + cd /sfc/sfc-py</span><br><span class="line">sf1            | ++ cat /pbc/param/a_test.param</span><br><span class="line">sf1            | cat: /pbc/param/a_test.param: No such file or directory</span><br><span class="line">sf1            | + sec_param_str=</span><br><span class="line">sf1            | ++ hostname</span><br><span class="line">sf1            | + host=sf1</span><br><span class="line">sf1            | + &#x27;[&#x27; sf1 == classifier1 &#x27;]&#x27;</span><br><span class="line">sf1            | + &#x27;[&#x27; sf1 == classifier2 &#x27;]&#x27;</span><br><span class="line">sf1            | + &#x27;[&#x27; sf1 == sff1 &#x27;]&#x27;</span><br><span class="line">sf1            | + &#x27;[&#x27; sf1 == sff2 &#x27;]&#x27;</span><br><span class="line">sf1            | + &#x27;[&#x27; sf1 == sf1 &#x27;]&#x27;</span><br><span class="line">sf1            | + cd /sfc/sfc-py</span><br><span class="line">sf1            | ++ cat /pbc/param/a_test.param</span><br><span class="line">sf1            | cat: /pbc/param/a_test.param: No such file or directory</span><br><span class="line">sf1            | + sec_param_str=</span><br><span class="line">sf1 exited with code 1</span><br></pre></td></tr></table></figure> 某次代码问题，导致虚拟机crash之后，重新启动VM, 重新创建container又遇到了类似问题，这次的故障是: <figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">sf1            | <span class="type">++ hostname</span></span><br><span class="line">sf1            | <span class="type">+ host</span>=sf1</span><br><span class="line">sf1            | <span class="type">+ &#x27;[&#x27; sf1</span> == classifier1 &#x27;]&#x27;</span><br><span class="line">sf1            | <span class="type">+ &#x27;[&#x27; sf1</span> == classifier2 &#x27;]&#x27;</span><br><span class="line">sf1            | <span class="type">+ &#x27;[&#x27; sf1</span> == sff1 &#x27;]&#x27;</span><br><span class="line">sf1            | <span class="type">+ &#x27;[&#x27; sf1</span> == sff2 &#x27;]&#x27;</span><br><span class="line">sf1            | <span class="type">+ &#x27;[&#x27; sf1</span> == sff3 &#x27;]&#x27;</span><br><span class="line">sf1            | <span class="type">+ &#x27;[&#x27; sf1</span> == sff4 &#x27;]&#x27;</span><br><span class="line">sf1            | <span class="type">+ &#x27;[&#x27; sf1</span> == sf1 &#x27;]&#x27;</span><br><span class="line">sf1            | <span class="type">+ cd</span> /sfc/sfc-py</span><br><span class="line">sf1            | <span class="type">+ pip3</span> install -r requirements.txt</span><br><span class="line">sf1            | <span class="type">Collecting</span> ecdsa==<span class="number">0.13</span> (from -r requirements.txt (line <span class="number">1</span>))</span><br><span class="line">sf1            | <span class="type">Exception</span>:</span><br><span class="line">sf1            | <span class="type">Traceback</span> (most recent call last):</span><br><span class="line">sf1            |   <span class="type">File</span> <span class="string">&quot;/usr/share/python-wheels/urllib3-1.13.1-py2.py3-none-any.whl/urllib3/connection.py&quot;</span>, line <span class="number">137</span>, <span class="built_in">in</span> _new_conn</span><br><span class="line">sf1            |     <span class="type">(self</span>.host, self.port), self.<span class="built_in">timeout</span>, **extra_kw)</span><br><span class="line">sf1            |   <span class="type">File</span> <span class="string">&quot;/usr/share/python-wheels/urllib3-1.13.1-py2.py3-none-any.whl/urllib3/util/connection.py&quot;</span>, line <span class="number">67</span>, <span class="built_in">in</span> create_connection</span><br><span class="line">sf1            |     <span class="type">for</span> res <span class="built_in">in</span> socket.getaddrinfo(host, port, <span class="number">0</span>, socket.SOCK_STREAM):</span><br><span class="line">sf1            |   <span class="type">File</span> <span class="string">&quot;/usr/lib/python3.5/socket.py&quot;</span>, line <span class="number">732</span>, <span class="built_in">in</span> getaddrinfo</span><br><span class="line">sf1            |     <span class="type">for</span> res <span class="built_in">in</span> _socket.getaddrinfo(host, port, family, type, proto, flags):</span><br><span class="line">sf1            | <span class="type">socket</span>.gaierror: [Errno <span class="number">-3</span>] Temporary failure <span class="built_in">in</span> name resolution</span><br><span class="line">sf1            |</span><br><span class="line"><span class="type">sf1</span>            | <span class="type">During</span> handling of the above exception, another exception occurred:</span><br><span class="line">sf1            |</span><br><span class="line"><span class="type">sf1</span>            | <span class="type">Traceback</span> (most recent call last):</span><br><span class="line">sf1            |   <span class="type">File</span> <span class="string">&quot;/usr/share/python-wheels/urllib3-1.13.1-py2.py3-none-any.whl/urllib3/connectionpool.py&quot;</span>, line <span class="number">560</span>, <span class="built_in">in</span> urlopen</span><br><span class="line">sf1            |     <span class="type">body</span>=body, headers=headers)</span><br><span class="line">sf1            |   <span class="type">File</span> <span class="string">&quot;/usr/share/python-wheels/urllib3-1.13.1-py2.py3-none-any.whl/urllib3/connectionpool.py&quot;</span>, line <span class="number">346</span>, <span class="built_in">in</span> _make_request</span><br><span class="line">sf1            |     <span class="type">self</span>._validate_conn(conn)</span><br><span class="line">sf1            |   <span class="type">File</span> <span class="string">&quot;/usr/share/python-wheels/urllib3-1.13.1-py2.py3-none-any.whl/urllib3/connectionpool.py&quot;</span>, line <span class="number">787</span>, <span class="built_in">in</span> _validate_conn</span><br><span class="line">sf1            |     <span class="type">conn</span>.connect()</span><br><span class="line">sf1            |   <span class="type">File</span> <span class="string">&quot;/usr/share/python-wheels/urllib3-1.13.1-py2.py3-none-any.whl/urllib3/connection.py&quot;</span>, line <span class="number">217</span>, <span class="built_in">in</span> connect</span><br><span class="line">sf1            |     <span class="type">conn</span> = self._new_conn()</span><br><span class="line">sf1            |   <span class="type">File</span> <span class="string">&quot;/usr/share/python-wheels/urllib3-1.13.1-py2.py3-none-any.whl/urllib3/connection.py&quot;</span>, line <span class="number">146</span>, <span class="built_in">in</span> _new_conn</span><br><span class="line">sf1            |     <span class="type">self</span>, <span class="string">&quot;Failed to establish a new connection: %s&quot;</span> % e)</span><br><span class="line">sf1            | <span class="type">requests</span>.packages.urllib3.exceptions.NewConnectionError: &lt;requests.packages.urllib3.connection.VerifiedHTTPSConnection object <span class="built_in">at</span> <span class="number">0x7f5ffeef2668</span>&gt;: Failed to establish a new connection: [Errno <span class="number">-3</span>] Temporary failure <span class="built_in">in</span> name resolution</span><br></pre></td></tr></table></figure> 看起来像是网络问题啊。。。这都遇到的是啥奇葩事儿啊。。。原来原因还是跟VM的DNS server无法通过学校防火墙有关。/etc/resolv.conf 还是虚拟机模板之前的内容，我通过一个shell script改变为10.0.2.3并没生效</p>
<p>因为vagrant relaod (=vagrant halt + vagrant up) 默认并不是执行provisioner，而我改变/etc/resolv.conf的内容恰恰是通过shell script来做的。</p>
<h1 id="classifier1-cannot-be-correctly-launched">classifier1 cannot be correctly launched</h1>
<p>因为需要对 HTTP request (下载文件) 延时进行测试，所以需要通过编译源码安装 <code>httping</code> utility. 下载地址: https://github.com/flok99/httping 执行<code>make</code>命令时候，发现以下错误: <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">classifier1    | # Oh, blatant plu<span class="variable">g:</span> http://www.vanheusden.<span class="keyword">com</span>/wishlist.php</span><br><span class="line">classifier1    | msgfmt -<span class="keyword">o</span> nl.mo nl.<span class="keyword">po</span></span><br><span class="line">classifier1    | <span class="keyword">make</span>: msgfm<span class="variable">t:</span> Command not found</span><br><span class="line">classifier1    | Makefile:<span class="number">135</span>: recipe <span class="keyword">for</span> target <span class="string">&#x27;nl.mo&#x27;</span> failed</span><br><span class="line">classifier1    | <span class="keyword">make</span>: *** [nl.mo] Error <span class="number">127</span></span><br><span class="line">classifier1 exited with code <span class="number">2</span></span><br></pre></td></tr></table></figure> https://stackoverflow.com/questions/9500898/compiler-error-msgfmt-command-not-found</p>
<p>发现原因是 <code>gettext</code>包的缺失。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/03/28/opnfv-sfc-tuto/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/28/opnfv-sfc-tuto/" class="post-title-link" itemprop="url">OPNFV SFC 实验笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-28 10:28:57" itemprop="dateCreated datePublished" datetime="2019-03-28T10:28:57+08:00">2019-03-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-01 00:18:46" itemprop="dateModified" datetime="2019-04-01T00:18:46+08:00">2019-04-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="two-sfc-scenarios-in-opnfv-fraser">1.Two SFC scenarios in OPNFV Fraser</h1>
<ul>
<li>os-odl-sfc-noha</li>
<li>os-odl-sfc-ha</li>
</ul>
<h1 id="两种部署方法">2.两种部署方法</h1>
<h2 id="xci-tool">XCI tool</h2>
<ul>
<li>integration not finished yet. (这话怎么理解？)</li>
<li>tested only for mini and noha flavors of XCI</li>
</ul>
<h2 id="apex-installer-似乎odl-sfc社区更推崇这种方法">APEX installer (似乎ODL SFC社区更推崇这种方法)</h2>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/03/27/odl-sfc-design-implementation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/27/odl-sfc-design-implementation/" class="post-title-link" itemprop="url">OpenDayLight SFC design and its implementation</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-27 16:59:46" itemprop="dateCreated datePublished" datetime="2019-03-27T16:59:46+08:00">2019-03-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-07-19 19:05:57" itemprop="dateModified" datetime="2019-07-19T19:05:57+08:00">2019-07-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SDN/" itemprop="url" rel="index"><span itemprop="name">SDN</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="nsh">NSH</h1>
<p><img src="NSH-header-md-type1.png" alt="NSH header MD type 1" /><span class="image-caption">NSH header MD type 1</span> IETF NSH Only NSH Metadata type 1 is implemented.</p>
<h1 id="odl-sfc-architecturecisco-odl-sfc14">ODL SFC architecture[^cisco-odl-sfc14]</h1>
<p><img src="odl-sfc-architecture.png" alt="Opendaylight sfc architecture" /><span class="image-caption">Opendaylight sfc architecture</span> * ODL SFC in essence a point to multipoint architecture * <strong><em>SFC</em></strong> Provider manages all configuration information provided by orchestration system or admin. * <strong><em>SFC</em></strong> Provider writes constructed Service Function Paths and Rendered Service Path to the datastore * <strong><em>Protocol datastore listeners</em></strong> are notified of service objects creation * These listeners will process RSP information and communicate to their controlled southbound devices</p>
<p>&quot;How do you prove that traffic follows the sugguested path?&quot;. Proof-of-Transit is proposed by Cisco to solve this problem.</p>
<p>Key elements to support this: * in-site (in-band) OAM: the key idea behind is to transport operation/administration/manintenance related information within the packet, insteading using a dedicated packet (such as ping, traceroute, etc.).</p>
<ul>
<li>transportation of OAM: basically two catogories:
<ul>
<li>design a dedicated encapsulation layer
<ul>
<li>we need to assign a protocol number for this new layer, for example, if iOAM header is behind NSH header, we have to indicate in NSH header that the next protocol is (NP=IOAM_Trace)</li>
<li>proposal already exists, iOAM header, (still an IETF draft)</li>
</ul></li>
<li>transported within existing header
<ul>
<li>NSH type 2 metadata</li>
<li>IPv6 option</li>
</ul></li>
</ul></li>
<li>Proof-of-transit design
<ul>
<li>current mechanism: Shamir’s secret sharing (SSS).</li>
<li>ordered Proof-of-transit, to keep ordering</li>
</ul></li>
<li>Implementation:
<ul>
<li>control plane:
<ul>
<li>support in ODL from release Carbon</li>
</ul></li>
<li>data plane <a target="_blank" rel="noopener" href="https://www.cisco.com/c/dam/m/en_us/network-intelligence/service-provider/digital-transformation/knowledge-network-webinars/pdfs/0628-techad-ckn.pdf">link</a>:
<ul>
<li>FD.io/VPP (iOAM/PoT implemented as plug-in)</li>
<li>IOS (ISR-G2) -P131: an OS in Cisco switch/router</li>
</ul></li>
</ul></li>
</ul>
<p>参考文献 [^cisco-odl-sfc14]: &quot;ODL: Service function chaining&quot;, https://events.static.linuxfound.org/sites/events/files/slides/odl%20summit%20sfc%20v5.pdf</p>
<p>张老师，跟你update下最近的工作。跟montida讨论的结果，汉语说快。我发现Cisco提出了一种叫做 iOAM-Pot的机制，解决的正是我们这个Securecom文章要解决的问题：&quot;How do you prove that traffic follows the sugguested path?&quot;.</p>
<p>Cisco提出的iOAM-Pot由两部分组成，第一个是iOAM. 简单说就是跟network service有关的operation/administration/maintenance的信息(比如延时，带宽之类的信息)。伴随这service种传递的packet一起发送。Ciso提出很多种方案实现iOAM，比如利用NSH type2 metadata(和我们希望传递北邮设计的签名是一样的思路)，比如设计一个iOAM专用协议层放在NSH header后面。</p>
<p>第二个就是PoT, Proof-of-Transit的简写。就是一种数据用以证明携带这个PoT的packet确实被希望的service function处理了。PoT是依赖于Shamir’s secret sharing机制实现的。这个PoT被认为是一种OAM信息。所以PoT可以被配置为通过NSH type2 metadata传递，也可以放在专用协议头里传递。</p>
<p>目前这个工作成熟度很高。Cisco写了不少 IETF draft(尚未标准化成RFC)。 ODL里有control plane的支持，data plane有个叫做FD.io/VPP的开源项目去实现。Cisco的产品里也实现了对这种机制的支持。</p>
<p>我跟montida进行了深入讨论：这个其实就是她之前一直在弄的idea. 最后被否定了。iOAM-PoT的问题在于hamir’s secret sharing是无法保证order的 如果需要保障order的话，需要设计ordered-PoT机制。IETF其实也给出了设计方案(symmetric masking机制)，PoT是被实现的，不知道这个ordered-PoT实现情况。年初Montida的工作，其实就是ordered PoT + NSH type2 meta data传递。后来被替换了成现在北邮设计的签名机制。</p>
<p>问题：我们这个工作目前最直相关的工作其实就是 iOAM-PoT机制了。我在journal版论文里应该提这个工作，也应该对比iOAM-PoT和我们提出的ordered multiple signature (OMS)之间的性能。我还没有弄出来基于iOAM-PoT的SFC完整性检测实现，但我看了他们这个机制 ，大概率会比我们的 ordered multiple signature (OMS)机制性能好得多。比如，我们设计的签名在保证最低安全限度的前提下, 签名大约要占99 bytes. IOAM-PoT 这个32个字节(如果要保障order的情况下)当然差多少，需要具体实验对比验证尤。</p>
<h1 id="section"></h1>
<p><a target="_blank" rel="noopener" href="https://www.slideshare.net/frankbrockners/proof-of-transit-securely-verifying-a-path-or-service-chain">关于PoT最最详细的介绍</a> <a target="_blank" rel="noopener" href="https://www.slideshare.net/frankbrockners/nextgen-network-telemetry-is-within-your-packets-inband-oam">关于IOAM最最详细的介绍</a></p>
<h1 id="文章的组织结构">文章的组织结构</h1>
<ul>
<li><p>Approach Add meta-data to all packets that traverse a path or service chain. The added meta-data allows a verifying node (egress node) to check whether a packet traversed the servcie chain correctly or not. Security mechanisms are used on the meta-data to protect against incorrect or miuse (i.e. configuration mistakes, peoply playing tricks with routing, capturing, spoofing and replaying packets.) The meta-dat is secured through the use of keys. Sercivce functions retrieve the keys from a controller over a secure channel.</p></li>
<li>Related
<ul>
<li>Compose the onion + PoT</li>
<li>symmetric masking + PoT</li>
</ul></li>
<li>The mathmatics</li>
<li>Protocol Aspects</li>
<li><p>Implementation and Demo side</p></li>
</ul>
<p>in-band solution 可以被批判的点： 1. 最后一个service function 负责贡献最后一份秘钥 同时还负责检验。在SDN环境中，如果 service function 不幸被compromised了。那就完全不可信了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/03/27/sfc-mailing-list-takeaways/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/27/sfc-mailing-list-takeaways/" class="post-title-link" itemprop="url">Key takeaways from ODL SFC mailing list</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-27 15:43:14" itemprop="dateCreated datePublished" datetime="2019-03-27T15:43:14+08:00">2019-03-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-28 05:51:29" itemprop="dateModified" datetime="2019-03-28T05:51:29+08:00">2019-03-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>On Oxygen, it states [^odl-oxygen-release-notes]</p>
<blockquote>
<p>SFC needs changes in OVS to include the Network Service Headers (NSH) Chaining encapsulation feature. This patch has been ongoing for quite a while, but has finally been officially merged in OVS 2.8. OpenDaylight will be updated to use this new version of OVS in the Fluorine release. Until then, SFC will use a branched version of OVS based on 2.6.1, called the “Yi Yang Patch”, located here. Previous versions of this OVS patch only supported VXLAN-GPE + NSH encapsulation, but this version supports both ETH + NSH and VXLAN-GPE + ETH + NSH.</p>
</blockquote>
<p>On Fluorine</p>
<blockquote>
<p>Support for Network Service Headers (NSH) has been officially implemented in the OVS 2.9 release. As a result, support for the older, unofficial branched OVS versions has been removed, and now only OVS 2.9 is supported.</p>
</blockquote>
<p>So OVS version 2.10.1 will only work with SFC at ODL release Fluorine or newer.</p>
<p>https://github.com/yyang13/ovs_nsh_patches/ are only for ovs 2.5.98</p>
<p>The patchset for ovs 2.6.1 is https://github.com/yyang13/ovs_nsh_patches/tree/master/v2.6.1 it can be built on almost any Linux distribution (kernel version &gt;= 3.11, &lt;= 4.8) (但是我试了 高于4.3 内核版本都不行的)</p>
<p>References: [^odl-oxygen-release-notes]: https://docs.opendaylight.org/en/stable-oxygen/release-notes/projects/sfc.html</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/03/26/patched-ovs-older-odl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/26/patched-ovs-older-odl/" class="post-title-link" itemprop="url">Experimentation note on setting up service function chaining based on ODL oxygen and OVS 2.6.1 with NSH support</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-26 15:26:38" itemprop="dateCreated datePublished" datetime="2019-03-26T15:26:38+08:00">2019-03-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-28 02:15:18" itemprop="dateModified" datetime="2019-03-28T02:15:18+08:00">2019-03-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux-networking/" itemprop="url" rel="index"><span itemprop="name">linux networking</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="troubleshooting">Troubleshooting</h1>
<h2 id="ovs-2.6.1-with-nsh-support-compilation-and-setup">OVS-2.6.1 with NSH support compilation and setup</h2>
<p>If you want to test OVS 2.6 with NSH patch, remember to use linux kernel older than 4.3.x <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configure: error: Linux kernel in /lib/modules/4.4.0-141-generic/build is version 4.4.162, but version newer than 4.3.x is not supported (please refer to the FAQ for advice)</span><br></pre></td></tr></table></figure></p>
<p>Afert linux kernel downgrade, when trying to configure the source code of OVS, we are encountered with the following error: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configure: error: source dir /lib/modules/4.2.0-42-generic/build doesn&#x27;t exist</span><br></pre></td></tr></table></figure> The solution is to install the correpsonding linux kernel headers. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install linux-headers-`uname -r`</span></span><br></pre></td></tr></table></figure></p>
<h2 id="ovs-2.6.1-cannot-create-ovs-bridge">OVS-2.6.1 cannot create ovs-bridge</h2>
<p>when executing with my vagrant machine <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> exec -it classifier<span class="number">1</span> ovs-ofctl dump-flows -OOpenflow<span class="number">13</span> br-sfc</span><br></pre></td></tr></table></figure> The response is: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ovs-ofctl: br-sfc is not a bridge or a socket</span><br></pre></td></tr></table></figure> I checked the log <code>/var/log/openvswitch/ovs-vswitchd.log</code>. I surprisingly found that: <figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="number">2019</span><span class="number">-03</span><span class="number">-26</span>T23:<span class="number">18</span>:<span class="number">27.931</span>Z|<span class="type">00007</span>|<span class="type">dpif_netlink</span>|<span class="type">WARN</span>|<span class="type">Generic</span> Netlink family &#x27;ovs_datapath&#x27; does not exist. The <span class="keyword">Open</span> vSwitch kernel module is probably not loaded.</span><br><span class="line"><span class="number">2019</span><span class="number">-03</span><span class="number">-26</span>T23:<span class="number">18</span>:<span class="number">27.931</span>Z|<span class="type">00008</span>|<span class="type">dpif</span>|<span class="type">WARN</span>|<span class="type">failed</span> to enumerate system datapaths: No such file or directory</span><br><span class="line"><span class="number">2019</span><span class="number">-03</span><span class="number">-26</span>T23:<span class="number">18</span>:<span class="number">27.931</span>Z|<span class="type">00009</span>|<span class="type">dpif</span>|<span class="type">WARN</span>|<span class="type">failed</span> to create datapath ovs-system: No such file or directory</span><br><span class="line"><span class="number">2019</span><span class="number">-03</span><span class="number">-26</span>T23:<span class="number">18</span>:<span class="number">27.933</span>Z|<span class="type">00010</span>|<span class="type">ofproto_dpif</span>|<span class="type">ERR</span>|<span class="type">failed</span> to open datapath of type system: No such file or directory</span><br><span class="line"><span class="number">2019</span><span class="number">-03</span><span class="number">-26</span>T23:<span class="number">18</span>:<span class="number">27.933</span>Z|<span class="type">00011</span>|<span class="type">ofproto</span>|<span class="type">ERR</span>|<span class="type">failed</span> to open datapath br-sfc: No such file or directory</span><br><span class="line"><span class="number">2019</span><span class="number">-03</span><span class="number">-26</span>T23:<span class="number">18</span>:<span class="number">27.933</span>Z|<span class="type">00012</span>|<span class="type">bridge</span>|<span class="type">ERR</span>|<span class="type">failed</span> to create bridge br-sfc: No such file or directory</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>Then I tried: <figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># ovs-vsctl <span class="keyword">add</span>-<span class="keyword">br</span> <span class="keyword">br</span>-test</span><br></pre></td></tr></table></figure> The</p>
<p>the container's linux kernel version is identique to its host: <code>3.13.0-167-generic</code></p>
<h2 id="section"></h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR: Service &#x27;sff1&#x27; failed to build: The command &#x27;/bin/sh -c apt-get update &amp;&amp; apt-get install -y vim ping git libtool m4 autoconf automake make     libssl-dev libcap-ng-dev python3 python3-pip python-six vlan iptables wget     net-tools init-system-helpers kmod uuid-runtime&#x27; returned a non-zero code: 100</span><br></pre></td></tr></table></figure>
<p>Because docker use Ubuntu 15.10 image. <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">W: Failed to fetch http:<span class="regexp">//</span>archive.ubuntu.com<span class="regexp">/ubuntu/</span>dists<span class="regexp">/wily-security/u</span>niverse<span class="regexp">/binary-amd64/</span>Packages  <span class="number">404</span>  Not Found [IP: <span class="number">91.189</span>.<span class="number">88.161</span> <span class="number">80</span>]</span><br></pre></td></tr></table></figure> Its repository URL is not valid any more.</p>
<h2 id="add-apt-repository-command-not-found-within-ubuntu-14.04-kernel-4.2">add-apt-repository: command not found, within ubuntu 14.04, kernel 4.2</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vagrant@odl:~/sfc/karaf/target/assembly$ sudo add-apt-repository ppa:webupd8team/java -y</span><br><span class="line">sudo: add-apt-repository: command not found</span><br></pre></td></tr></table></figure>
<p>Solution: The error is simple. The package add-apt-repository is not installed on your system. So, open a terminal and use this command:</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">sudo</span> apt-<span class="meta">get</span> install software-properties-<span class="meta">common</span></span><br></pre></td></tr></table></figure>
<h2 id="ovs-in-docker-cannot-creata-ovs-bridge">OVS in docker cannot creata ovs bridge</h2>
<p>Because docker containers share the same kernel with its host. Thus, we have to install ovs package in host first then install within docker container.</p>
<h2 id="anormal-error-logs-in-varlogopenvswitchovs-vswitchd.log">Anormal error logs in /var/log/openvswitch/ovs-vswitchd.log</h2>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">2019</span>-<span class="number">03</span>-<span class="number">27</span>T<span class="number">09</span>:<span class="number">01</span>:<span class="number">08</span>.<span class="number">093</span>Z|<span class="number">00006</span>|bridge|INFO|ovs-vswitchd (Open vSwitch) <span class="number">2</span>.<span class="number">6</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">2019</span>-<span class="number">03</span>-<span class="number">27</span>T<span class="number">09</span>:<span class="number">01</span>:<span class="number">08</span>.<span class="number">246</span>Z|<span class="number">00007</span>|ofproto_dpif|INFO|system@ovs-system: Datapath does not support recirculation</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">03</span>-<span class="number">27</span>T<span class="number">09</span>:<span class="number">01</span>:<span class="number">08</span>.<span class="number">246</span>Z|<span class="number">00008</span>|ofproto_dpif|INFO|system@ovs-system: MPLS label stack length probed as <span class="number">0</span></span><br><span class="line"><span class="attribute">2019</span>-<span class="number">03</span>-<span class="number">27</span>T<span class="number">09</span>:<span class="number">01</span>:<span class="number">08</span>.<span class="number">246</span>Z|<span class="number">00009</span>|ofproto_dpif|INFO|system@ovs-system: datapath does not support masked set action feature.</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">03</span>-<span class="number">27</span>T<span class="number">09</span>:<span class="number">01</span>:<span class="number">08</span>.<span class="number">246</span>Z|<span class="number">00010</span>|ofproto_dpif|INFO|system@ovs-system: Datapath does not support truncate action</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">03</span>-<span class="number">27</span>T<span class="number">09</span>:<span class="number">01</span>:<span class="number">08</span>.<span class="number">246</span>Z|<span class="number">00011</span>|ofproto_dpif|INFO|system@ovs-system: Datapath does not support unique flow ids</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">03</span>-<span class="number">27</span>T<span class="number">09</span>:<span class="number">01</span>:<span class="number">08</span>.<span class="number">246</span>Z|<span class="number">00012</span>|ofproto_dpif|INFO|system@ovs-system: Datapath does not support ct_state</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">03</span>-<span class="number">27</span>T<span class="number">09</span>:<span class="number">01</span>:<span class="number">08</span>.<span class="number">246</span>Z|<span class="number">00013</span>|ofproto_dpif|INFO|system@ovs-system: Datapath does not support ct_zone</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">03</span>-<span class="number">27</span>T<span class="number">09</span>:<span class="number">01</span>:<span class="number">08</span>.<span class="number">246</span>Z|<span class="number">00014</span>|ofproto_dpif|INFO|system@ovs-system: Datapath does not support ct_mark</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">03</span>-<span class="number">27</span>T<span class="number">09</span>:<span class="number">01</span>:<span class="number">08</span>.<span class="number">246</span>Z|<span class="number">00015</span>|ofproto_dpif|INFO|system@ovs-system: Datapath does not support ct_label</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">03</span>-<span class="number">27</span>T<span class="number">09</span>:<span class="number">01</span>:<span class="number">08</span>.<span class="number">246</span>Z|<span class="number">00016</span>|ofproto_dpif|INFO|system@ovs-system: Datapath does not support ct_state_nat</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">03</span>-<span class="number">27</span>T<span class="number">09</span>:<span class="number">01</span>:<span class="number">08</span>.<span class="number">249</span>Z|<span class="number">00017</span>|ofproto_dpif|WARN|system@ovs-system: variable-length userdata feature probe failed (Invalid argument)</span><br></pre></td></tr></table></figure>
<h2 id="empty-openflow-tables">Empty OpenFlow tables:</h2>
<p>We notice that, even with RESTCONF API, the openflow tables are still empty!!! <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@classifier1:/# ovs-ofctl dump-flows -OOpenflow13 br-sfc</span><br><span class="line">OFPST_FLOW reply (OF1.3) (xid=0x2):</span><br><span class="line">root@classifier1:/#</span><br></pre></td></tr></table></figure></p>
<p>I think this is due to the lack of <code>openvswitch-datapath-dkms*</code> package. As per its name, this package is important for data path of OVS.</p>
<h2 id="rebuild-docker-image-after-modification-of-dockerfiledocker-compose.yaml">Rebuild docker image after modification of Dockerfile/docker-compose.yaml</h2>
<p>I tried to install <code>openvswitch-datapath-dkms*</code> in each involved docker container. However, no matter how I modify the <code>Dockerfile</code>, I finally found that the required package has not been installed within each container.</p>
<p>The reason relies in that if you run <code>docker-composer up</code> without option <code>build</code>, docker always create container with previousl built image, which has no required package.</p>
<h2 id="section-1"></h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2019-03-27T09:03:20.805Z|00036|dpif|WARN|system@ovs-system: execute 2 failed (Invalid argument) on packet vlan_tci=0x0000,dl_src=46:27:01:57:2f:78,dl_dst=01:23:00:00:00:01,dl_type=0x88cc</span><br><span class="line"> mtu 0</span><br><span class="line">2019-03-27T09:03:23.948Z|00037|dpif|WARN|system@ovs-system: execute 2 failed (Invalid argument) on packet vlan_tci=0x0000,dl_src=46:27:01:57:2f:78,dl_dst=01:23:00:00:00:01,dl_type=0x88cc</span><br><span class="line"> mtu 0</span><br><span class="line">2019-03-27T09:03:28.945Z|00038|dpif|WARN|system@ovs-system: execute 2 failed (Invalid argument) on packet vlan_tci=0x0000,dl_src=46:27:01:57:2f:78,dl_dst=01:23:00:00:00:01,dl_type=0x88cc</span><br></pre></td></tr></table></figure>
<p>Still invalid argument problem!! but why??</p>
<h1 id="appendix">Appendix</h1>
<h2 id="how-to-downgrade-linux-kernel-version-under-ubuntu-16.04">How to downgrade linux kernel version (under Ubuntu 16.04)</h2>
<p>If you don't know the exact name of target linux kernel. Take linux kerenl 4.2.x as example, use the following command: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-cache search linux-image | grep linux-image-4.2</span></span><br></pre></td></tr></table></figure></p>
<p>Install the selected kernel <figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install linux-image<span class="number">-4.2</span><span class="number">.0</span><span class="number">-42</span>-generic</span><br></pre></td></tr></table></figure></p>
<p>The output should be similar to the following: <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Generating</span> grub configuration file ...</span><br><span class="line"><span class="attribute">Warning</span>: Setting GRUB_TIMEOUT to a non-zero value when GRUB_HIDDEN_TIMEOUT is set is no longer supported.</span><br><span class="line"><span class="attribute">Found</span> linux image: /boot/vmlinuz-<span class="number">4</span>.<span class="number">4</span>.<span class="number">0</span>-<span class="number">31</span>-generic</span><br><span class="line"><span class="attribute">Found</span> initrd image: /boot/initrd.img-<span class="number">4</span>.<span class="number">4</span>.<span class="number">0</span>-<span class="number">31</span>-generic</span><br><span class="line"><span class="attribute">Found</span> linux image: /boot/vmlinuz-<span class="number">4</span>.<span class="number">2</span>.<span class="number">0</span>-<span class="number">42</span>-generic</span><br><span class="line"><span class="attribute">Found</span> initrd image: /boot/initrd.img-<span class="number">4</span>.<span class="number">2</span>.<span class="number">0</span>-<span class="number">42</span>-generic</span><br><span class="line"><span class="attribute">Found</span> memtest<span class="number">86</span>+ image: /memtest<span class="number">86</span>+.elf</span><br><span class="line"><span class="attribute">Found</span> memtest<span class="number">86</span>+ image: /memtest<span class="number">86</span>+.bin</span><br><span class="line"><span class="attribute">done</span></span><br></pre></td></tr></table></figure></p>
<p>You can also verify with the following command: <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">dpkg</span> -l | grep <span class="number">4</span>.<span class="number">2</span>.<span class="number">0</span>-<span class="number">42</span>-generic</span><br></pre></td></tr></table></figure></p>
<p>Now we configure <code>grub</code> so that the system starts with kernel 4.2.x. Edit the following configuration file with your preferred text editor: <figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim <span class="regexp">/etc/</span><span class="keyword">default</span>/grub</span><br></pre></td></tr></table></figure></p>
<p>Modify as follows: <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">GRUB_DEFAULT</span>=<span class="string">&quot;Advanced options for Ubuntu&gt;Ubuntu, with Linux 4.2.0-42-generic&quot;</span></span><br></pre></td></tr></table></figure> Note that replace the <code>4.2.0-42-generic</code> with your own kernel version.</p>
<p>Save, quit and update grub: <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> sudo <span class="built_in">update-grub</span></span><br></pre></td></tr></table></figure></p>
<p>Then reboot your system and check the linux kernel version!</p>
<p>If you need to remove the kernel versions that you don't need any more. <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo</span> apt-get remove linux-headers-<span class="number">4</span>.<span class="number">15</span>.<span class="number">0</span>-<span class="number">33</span></span><br></pre></td></tr></table></figure></p>
<p>参考： https://blog.csdn.net/u013431916/article/details/82530523 https://www.jianshu.com/p/a593067fe9fc</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/03/25/linux-ovs-vxlan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/25/linux-ovs-vxlan/" class="post-title-link" itemprop="url">How to create VxLAN with Open Vswitch</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-25 20:49:27" itemprop="dateCreated datePublished" datetime="2019-03-25T20:49:27+08:00">2019-03-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-08 18:46:13" itemprop="dateModified" datetime="2019-04-08T18:46:13+08:00">2019-04-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux-networking/" itemprop="url" rel="index"><span itemprop="name">linux networking</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="creation-of-vxlan-port-with-default-udp-service-port">Creation of VxLAN port with default UDP service port:</h1>
<p><code>key=flow</code> is meant to get the tunnel ID from the flow and <code>remote_ip=flow</code> is meant to get the tunnel destination IP address from the flow <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> br-tun is the name of ovs bridge</span></span><br><span class="line">ovs-vsctl add-port br-tun vxlan0 -- set Interface vxlan0  type=vxlan  options:remote_ip=flow options:key=flow</span><br></pre></td></tr></table></figure></p>
<h1 id="create-the-vxlan-port-by-specifying-udp-destination-port-5000.">create the VxLAN port by specifying UDP destination port, 5000.</h1>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ovs-vsctl add-port br-tun vxlan1 -- set Interface vxlan1 type=vxlan options:remote_ip=flow options:key=flow options:dst_port=5000</span><br></pre></td></tr></table></figure>
<h1 id="create-openflow-flows-without-having-to-have-external-openflow-controller">Create Openflow flows without having to have external Openflow controller</h1>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ovs-ofctl add-flow br-tun &quot;in_port=LOCAL actions=set_tunnel:1,set_field:172.16.2.3-&gt;tun_dst,output:1&quot; </span><br></pre></td></tr></table></figure>
<p>or <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ovs-ofctl add-flow br-tun &quot;in_port=LOCAL actions=set_field:172.16.2.3-&gt;tun_dst, set_field:1-&gt;tun_id, output:1</span><br></pre></td></tr></table></figure> <code>set_tunnel</code> is used to specify the VNI. <code>set_field</code> to specify the tunnel destination.</p>
<h1 id="ovs-nsh-测试脚本手动实验">OVS NSH 测试脚本手动实验</h1>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">AT_BANNER<span class="params">([network service header (NSH)</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">### -----------------------------------------------------------------</span></span><br><span class="line"><span class="comment">###   Simple NSH matching test case</span></span><br><span class="line"><span class="comment">### -----------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">AT_SETUP<span class="params">([nsh - matching])</span></span><br><span class="line"></span><br><span class="line">OVS_VSWITCHD_START<span class="params">([dnl</span></span><br><span class="line"><span class="params">    set bridge br0 <span class="attr">datapath_type</span>=dummy \</span></span><br><span class="line"><span class="params">        <span class="attr">protocols</span>=OpenFlow10,OpenFlow13,OpenFlow14,OpenFlow15 -- \</span></span><br><span class="line"><span class="params">    add-port br0 p1 -- set Interface p1 <span class="attr">type</span>=dummy <span class="attr">ofport_request</span>=1 -- \</span></span><br><span class="line"><span class="params">    add-port br0 p2 -- set Interface p2 <span class="attr">type</span>=dummy <span class="attr">ofport_request</span>=2])</span></span><br><span class="line"></span><br><span class="line">AT_DATA<span class="params">([flows.txt], [dnl</span></span><br><span class="line"><span class="params">    <span class="attr">table</span>=0,<span class="attr">in_port</span>=1,<span class="attr">dl_type</span>=0x894f,<span class="attr">nsh_ttl</span>=63,<span class="attr">nsh_mdtype</span>=1,<span class="attr">nsh_np</span>=3,<span class="attr">nsh_spi</span>=0x123456,<span class="attr">nsh_si</span>=255,<span class="attr">nsh_c1</span>=0x11223344,<span class="attr">actions</span>=set_field:0x2-&gt;nsh_flags,set_field:254-&gt;nsh_si,set_field:0x44332211-&gt;nsh_c1,2</span></span><br><span class="line"><span class="params">])</span></span><br><span class="line"></span><br><span class="line">AT_CHECK<span class="params">([</span></span><br><span class="line"><span class="params">    ovs-ofctl del-flows br0</span></span><br><span class="line"><span class="params">    ovs-ofctl -Oopenflow13 add-flows br0 flows.txt</span></span><br><span class="line"><span class="params">    ovs-ofctl -Oopenflow13 dump-flows br0 | ofctl_strip | sort | grep actions</span></span><br><span class="line"><span class="params">], [0], [dnl</span></span><br><span class="line"><span class="params"> <span class="attr">in_port</span>=1,<span class="attr">dl_type</span>=0x894f,<span class="attr">nsh_ttl</span>=63,<span class="attr">nsh_mdtype</span>=1,<span class="attr">nsh_np</span>=3,<span class="attr">nsh_spi</span>=0x123456,<span class="attr">nsh_si</span>=255,<span class="attr">nsh_c1</span>=0x11223344 <span class="attr">actions</span>=set_field:2-&gt;nsh_flags,set_field:254-&gt;nsh_si,set_field:0x44332211-&gt;nsh_c1,output:2</span></span><br><span class="line"><span class="params">])</span></span><br><span class="line"></span><br><span class="line">AT_CHECK<span class="params">([</span></span><br><span class="line"><span class="params">    ovs-appctl ofproto/trace br0 &#x27;<span class="attr">in_port</span>=1,<span class="attr">dl_type</span>=0x894f,<span class="attr">nsh_ttl</span>=63,<span class="attr">nsh_mdtype</span>=1,<span class="attr">nsh_np</span>=3,<span class="attr">nsh_spi</span>=0x123456,<span class="attr">nsh_si</span>=255,<span class="attr">nsh_c1</span>=0x11223344,<span class="attr">nsh_c2</span>=0x55667788,<span class="attr">nsh_c3</span>=0x99aabbcc,<span class="attr">nsh_c4</span>=0xddeeff00&#x27;</span></span><br><span class="line"><span class="params">], [0], [dnl</span></span><br><span class="line"><span class="params">Flow: <span class="attr">in_port</span>=1,<span class="attr">vlan_tci</span>=0x0000,<span class="attr">dl_src</span>=00:00:00:00:00:00,<span class="attr">dl_dst</span>=00:00:00:00:00:00,<span class="attr">dl_type</span>=0x894f,<span class="attr">nsh_flags</span>=0,<span class="attr">nsh_ttl</span>=63,<span class="attr">nsh_mdtype</span>=1,<span class="attr">nsh_np</span>=3,<span class="attr">nsh_spi</span>=0x123456,<span class="attr">nsh_si</span>=255,<span class="attr">nsh_c1</span>=0x11223344,<span class="attr">nsh_c2</span>=0x55667788,<span class="attr">nsh_c3</span>=0x99aabbcc,<span class="attr">nsh_c4</span>=0xddeeff00,<span class="attr">nw_proto</span>=0,<span class="attr">nw_tos</span>=0,<span class="attr">nw_ecn</span>=0,<span class="attr">nw_ttl</span>=0</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">bridge(&quot;br0&quot;)</span></span><br><span class="line"><span class="params">-------------</span></span><br><span class="line"> 0. in_port=1,dl_type=0x894f,nsh_ttl=63,nsh_mdtype=1,nsh_np=3,nsh_spi=0x123456,nsh_si=255,nsh_c1=0x11223344, priority 32768</span><br><span class="line">    <span class="keyword">set</span>_field<span class="function">:2-</span>&gt;nsh_flags</span><br><span class="line">    <span class="keyword">set</span>_field<span class="function">:254-</span>&gt;nsh_si</span><br><span class="line">    <span class="keyword">set</span>_field<span class="function">:0x44332211-</span>&gt;nsh_c1</span><br><span class="line">    output<span class="function">:2</span></span><br><span class="line"></span><br><span class="line">Final flow: in_port=1,vlan_tci=0x0000,dl_src=00<span class="function">:00</span><span class="function">:00</span><span class="function">:00</span><span class="function">:00</span><span class="function">:00</span>,dl_dst=00<span class="function">:00</span><span class="function">:00</span><span class="function">:00</span><span class="function">:00</span><span class="function">:00</span>,dl_type=0x894f,nsh_flags=2,nsh_ttl=63,nsh_mdtype=1,nsh_np=3,nsh_spi=0x123456,nsh_si=254,nsh_c1=0x44332211,nsh_c2=0x55667788,nsh_c3=0x99aabbcc,nsh_c4=0xddeeff00,nw_proto=0,nw_tos=0,nw_ecn=0,nw_ttl=0</span><br><span class="line">Megaflow: recirc_id=0,eth,in_port=1,dl_type=0x894f,nsh_flags=0,nsh_ttl=63,nsh_mdtype=1,nsh_np=3,nsh_spi=0x123456,nsh_si=255,nsh_c1=0x11223344</span><br><span class="line">Datapath actions: <span class="keyword">set</span><span class="params">(nsh(<span class="attr">flags</span>=2,<span class="attr">ttl</span>=63,<span class="attr">spi</span>=0x123456,<span class="attr">si</span>=254,<span class="attr">c1</span>=0x44332211)</span>),2</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">OVS_VSWITCHD_STOP</span><br><span class="line">AT_CLEANUP</span><br></pre></td></tr></table></figure>
<p>我觉得 这里面 <code>dnl</code> 应该指代的是 <code>ovs-vsctl add-bridge br0</code>. 比如如下命令：<code>--</code> 双横线好像是代表 <figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ovs-vsctl<span class="built_in"> add-br </span>br0 -- set<span class="keyword"> bridge</span> br0 datapath_type=netdev</span><br></pre></td></tr></table></figure></p>
<h1 id="延伸阅读">延伸阅读</h1>
<p><a target="_blank" rel="noopener" href="http://netsecinfo.blogspot.com/2013/07/linux-ovs-vxlan-based-virtual-networks.html">Linux OVS &amp; VxLAN based virtual networks</a> <a target="_blank" rel="noopener" href="http://netsecinfo.blogspot.com/2011/12/vxlan-virtual-extensible-lan-virtual.html">VXLAN (Virtual eXtensible LAN) - Virtual Data Centers - Tutorial</a> <a target="_blank" rel="noopener" href="https://that.guru/blog/gnu-autotest/">GNU AUTOTEST</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/03/25/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/25/hello-world/" class="post-title-link" itemprop="url">Hexo 安装，配置，使用以及更新基本命令以及 Markdown 基本语法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-25 18:27:10" itemprop="dateCreated datePublished" datetime="2019-03-25T18:27:10+08:00">2019-03-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-09 22:14:49" itemprop="dateModified" datetime="2020-06-09T22:14:49+08:00">2020-06-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="hexo-4.2.1-安装">Hexo 4.2.1 安装</h1>
<h2 id="安装node.js">安装Node.js</h2>
<h1 id="the-must-to-know-command-of-hexo">The must-to-know command of Hexo</h1>
<h2 id="create-a-new-post">Create a new post</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br><span class="line">$ hexo server</span><br><span class="line">$ hexo generate</span><br><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>Please refer to <a target="_blank" rel="noopener" href="http://hexo.io/docs/writing.html">hexo official webiste</a> for more information.</p>
<h1 id="latex-format-mathmatical-equations-in-hexo">LaTeX format mathmatical equations in Hexo</h1>
<p>This present personal blog is powered by <a target="_blank" rel="noopener" href="https://theme-next.org/"><code>next</code> theme</a>. Next has a good support for <code>Mathjax</code>.参考<a target="_blank" rel="noopener" href="https://github.com/theme-next/hexo-theme-next/blob/master/docs/MATH.md">链接</a>以获取更多信息(比如方程的编号问题)</p>
<h2 id="基础配置">基础配置</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install eslint@4.x babel-eslint@8 --save</span><br></pre></td></tr></table></figure>
<p>同时对于添加脚注也是一样的，一开始不管怎么 <code>hexo clean &amp;&amp; hexo g</code> 都不工作，后来咋就突然好了呢？ 为了强制浏览器更新资源文件，可以采用’Ctrl+F5’来刷新。</p>
<h3 id="如何让插入图片居中">如何让插入图片居中？</h3>
<p>Markdown 没有提供居中图片或者文字的命令，但是 Markdown 支持嵌入的 HTML/CSS 语句。 <figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">div</span> style=<span class="string">&quot;text-align:center&quot;</span> markdown=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">![Alt Text](<span class="regexp">/path/</span>to/image <span class="string">&quot;Caption&quot;</span>)</span><br><span class="line">&lt;/<span class="keyword">div</span>&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="如何给插入的图片居中并且添加caption">如何给插入的图片居中并且添加caption?</h3>
<p>参加帖子: http://fantding.coding.me/2019/06/12/hexo%E4%B8%BA%E5%9B%BE%E7%89%87%E6%B7%BB%E5%8A%A0caption/</p>
<p>https://luodian.ink/2018-03-08/Next%E4%B8%BB%E9%A2%98%E4%B8%8B%E5%A6%82%E4%BD%95%E8%AE%A9%E5%9B%BE%E7%89%87%E8%87%AA%E5%8A%A8%E5%B1%85%E4%B8%AD/ 我只参考了博文中的第二点，就实现了图片居中的设置。</p>
<h2 id="hexo博客如何添加脚注footnote">Hexo博客如何添加脚注(footnote)?</h2>
<p>删除 Hexo 默认安装的 hexo-renderer-marked 模块， <figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm un hexo-renderer-marked <span class="comment">--save</span></span><br></pre></td></tr></table></figure> 安装 <code>hexo-renderer-markdown-it</code> 模块 <figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-renderer-markdown-<span class="keyword">it</span> <span class="comment">--save</span></span><br></pre></td></tr></table></figure> The following code snippet is one example: basic footnote<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> here is an inline footnote[^2] (inline footnote) and another one<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> and another one<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<p>source:http://www.icms.org.uk/downloads/stocpro/Blaszczyszyn_2.pdf source:http://www.chriskrycho.com/2015/academic-markdown-and-citations.html, Academic Markdown and Citations</p>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>basic footnote content<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>paragraph<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>footnote content with some <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Markdown">markdown</a><a href="#fnref3" class="footnote-back">↩</a></p></li>
</ol>
</section>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/03/25/docker-tuto/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/25/docker-tuto/" class="post-title-link" itemprop="url">A brief and concise Docker tutorial</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-25 11:21:48" itemprop="dateCreated datePublished" datetime="2019-03-25T11:21:48+08:00">2019-03-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-01-15 20:01:31" itemprop="dateModified" datetime="2021-01-15T20:01:31+08:00">2021-01-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="docker-以及容器">Docker 以及容器</h1>
<p>我们往往会把容器和docker这两个词混为一谈。仔细说来，容器其实指的更多是 Linux container (LXC)技术，LXC 核心的技术是 namespace以及Cgroups。Docker是一家专注于在LXC技术基础上推出更容易管理使用容器技术的公司，Docker同时也是该公司推出的容器引擎。</p>
<p>说到容器技术，也不是什么新技术，只是非常的小众。然而, 随着2013年3月 dotcloud 公司推出了一项新的容器技术 Docker。Docker的出现，降低了容器技术使用的门槛，带来了无可比拟的优势，所以迅速在IT行业内普及。</p>
<p>docker教程整理:https://www.jianshu.com/p/4b808c2341bd</p>
<p>Docker 是基于容器技术的轻量级虚拟化技术。其虚拟化技术是基于内核的Cgroup以及Namespace技术。处理逻辑与内核深度融合，所以在很多方面，性能与物理机非常接近。通信上，Docker并不会直接和内核交互，它是通过一个更底层的工具libcontainer与内核交互的。Libcontainer是真正意义上的容器引擎。它通过clone系统调用直接创建容器，通过<code>pivot_root</code> system call 进入容器，且通过直接操作<code>cgroupfs</code>文件实现对资源的管控，而docker本身则侧重于处理更上层的业务。</p>
<h1 id="层级镜像的概念">层级镜像的概念</h1>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -ti -v <span class="variable">$PWD</span>:<span class="regexp">/traces --net container:classifier1 nicolaka/</span>netshoot tcpdump –i eth0 -w <span class="regexp">/traces/</span>sfc103demo.pcap</span><br></pre></td></tr></table></figure>
<p>一些说明: * <code>-v $PWD:/traces</code>: mount current working directory on host machine as <code>traces</code> folder under root directory of target container. Please refer to <a target="_blank" rel="noopener" href="https://docs.docker.com/storage/volumes/">Docker’s guide to Volumes</a> for more information. It is also possible specify volume mount without specifying location of source folder in host machine by syntax such as <code>-v /traces</code>. Command <code>docker inspect &lt;container_name&gt;</code> allows to check the source file in host machine corresponding to volume mounted in container. * <code>--net container:classifier1</code>: monitor a certain container. Rememer to replace <code>classifier1</code> with regard to your need. * <code>nicolaka/netshoot</code> is a very powerful network troubleshooting docker image. Refer to <a target="_blank" rel="noopener" href="https://github.com/nicolaka/netshoot">nicolaka/netshoot</a> for more details. * <code>tcpdump –i eth0 -w /traces/sfc103demo.pcap</code> is actually how to use tcpdump command: - <code>–i eth0</code>: listen for interface <code>eth0</code> - <code>-w /traces/sfc103demo.pcap</code>: output monitored traffic to a PCAP file.</p>
<p><a target="_blank" rel="noopener" href="https://medium.com/the-code-review/top-10-docker-run-command-options-you-cant-live-without-a-reference-d256834e86c1">Top 10 options for docker run</a> # Volume in container Container 内部数据持久化的问题 =&gt; 解决之道: data volume 机制 3 options are available in docker: * bind mount * volume * tmpfs mount</p>
<p>Among them,volumes are the preferred mechanism for persisting data generated by and used by Docker containers. While bind mounts are dependent on the directory structure of the host machine, volumes are completely managed by Docker. Volumes have several advantages over bind mounts</p>
<h1 id="run-script-within-a-dockerfile">Run script within a Dockerfile</h1>
<p>A short but nice explanation: https://stackoverflow.com/questions/34549859/run-a-script-in-dockerfile</p>
<h1 id="kill-all-containers-in-a-command-line">Kill all containers in a command line</h1>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">container</span> <span class="keyword">ls</span> | awk <span class="string">&#x27;&#123;if (NR&gt;1) print $1&#125;&#x27;</span> | xargs docker kill</span><br></pre></td></tr></table></figure>
<h1 id="rootless-docker-usage">Rootless docker usage</h1>
<p>今天发现一个很奇怪的现象：通过创建用户组<code>docker</code>并添加自己账户之后， 通过SSH链接的qsong账户，可以无sudo执行docker命令，然而通过teamviewer访问(等同于直接在host上操作)，却依然要求sudo. 这个问题困扰了我许久，下午突然灵光一现，想到了原因：通过创建用户组<code>docker</code>并添加自己账户之后，需要退出重新登录. 我在host上并没有执行log out then log in的操作。</p>
<h1 id="docker无法使用本地dns服务">Docker无法使用本地DNS服务</h1>
<p>参考： 1. https://medium.com/<span class="citation" data-cites="faithfulanere/solved-docker-build-could-not-resolve-archive-ubuntu-com-apt-get-fails-to-install-anything-9ea4dfdcdcf2">@faithfulanere/solved-docker-build-could-not-resolve-archive-ubuntu-com-apt-get-fails-to-install-anything-9ea4dfdcdcf2</span> 2. https://github.com/moby/moby/issues/23910 3. https://stackoverflow.com/questions/39400886/docker-cannot-resolve-dns-on-private-network</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="builtin-name">run</span> busybox nslookup www.google.com</span><br><span class="line">;;<span class="built_in"> connection </span>timed out; <span class="literal">no</span> servers could be reached</span><br></pre></td></tr></table></figure>
<p>出现这种现象的原因是：当docker进程检测到主机使用的DNS服务器地址为本机环路地址，即（<code>127.0.0.1</code>）,它会转而使用谷歌的公共DNS服务，即<code>8.8.8.8</code>. 然而不幸的是，有些公司/学校是禁止使用外部公共DNS服务的. 所以，最终<code>docker</code>无法使用DNS服务，导致出现一系列问题。</p>
<p>解决办法：</p>
<ul>
<li>Adding a <code>/etc/docker/daemon.json</code> that passed in the docker0 bridge IP as a DNS server =&gt; 应该是把host实际使用的DNS地址存放进去, 而且如果要设定的机器需要经常性地</li>
<li>Adding a /etc/NetworkManager/dnsmasq.d/docker-bridge.conf file that directs the NM-managed DNS cache to listen to the docker0 bridge IP as well as <code>127.0.1.1</code></li>
<li>docker build --network=host -t my-image-name 运行容器的时候，采用和host一样的网络协议栈，但是缺乏足够的隔离性，有安全隐患</li>
</ul>
<p>Now container DNS lookups go through your local dnsmasq instance, so DNS in the container should work just as well as DNS on the host.</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> /etc/resolv.<span class="keyword">conf</span></span><br><span class="line"># Dynamic resolv.<span class="keyword">conf</span>(5) <span class="keyword">file</span> <span class="keyword">for</span> glibc resolver(3) generated <span class="keyword">by</span> resolvconf(8)</span><br><span class="line">#     <span class="keyword">DO</span> NOT <span class="keyword">EDIT</span> THIS <span class="keyword">FILE</span> <span class="keyword">BY</span> HAND -- YOUR CHANGES WILL BE OVERWRITTEN</span><br><span class="line">nameserver 127.0.1.1</span><br><span class="line"><span class="keyword">search</span> imtld.<span class="keyword">local</span></span><br></pre></td></tr></table></figure>
<p>我们会发现dns服务器为<code>127.0.1.1</code>，记住不是<code>127.0.0.1</code>!好奇葩的一个地址. 原来ubuntu下有一个本地的dns服务叫做<code>dnsmasq</code>，它是由<code>NetworkManager</code>控制的. 它监听的本地地址，<code>--listen-address=127.0.1.1</code> (ubuntu12.04及之前的版本是 127.0.0.1), 这个地址是一个本地回环地址,而你真实的dns服务器地址，是被这个服务管理维护着的 由一张图表示就是： <code>local process -&gt; local dnsmasq -&gt; router -&gt; ISP dns</code> 问题是：为什么<code>dnsmasq</code>不接受来自container的请求呢？</p>
<p>我们发现，在学校内网中，即使显示地要求docker采用谷歌提供的DNS服务器地址，DNS请求依然无法被解析。 <figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run <span class="comment">--dns 8.8.8.8  busybox nslookup www.google.com</span></span><br><span class="line">;; <span class="keyword">connection</span> timed <span class="keyword">out</span>; <span class="keyword">no</span> servers could be reached</span><br></pre></td></tr></table></figure> 我之后试着<code>ping 8.8.8.8</code>，发现有回复，这说明，虽然我可以ping通谷歌公共DNS服务器，然而学校的网络配置却禁止我使用外部DNS，为什么呢？</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">$:nmcli dev show | grep IP4.DNS</span></span><br><span class="line"><span class="section">IP4.DNS[1]:                             10.59.130.129</span></span><br><span class="line"><span class="section">IP4.DNS[2]:                             10.59.130.130</span></span><br></pre></td></tr></table></figure>
<p>注意：<code>nmcli</code> only applies to systems running <code>NetworkManager</code>, there is not an equivalent for other setups.</p>
<h1 id="dockerfile命令">Dockerfile命令</h1>
<p>https://yeasy.gitbook.io/docker_practice/image/dockerfile 在 Docker 官方的 Dockerfile 最佳实践文档 中要求，尽可能的使用 COPY，因为 COPY 的语义很明确，就是复制文件而已，而 ADD 则包含了更复杂的功能，其行为也不一定很清晰。最适合使用 ADD 的场合，就是所提及的需要自动解压缩的场合。</p>
<h1 id="docker-run-和-docker-exec-区别">docker run 和 docker exec 区别？</h1>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/storage/volumes/">Docker’s guide to Volumes</a> <a target="_blank" rel="noopener" href="http://goinbigdata.com/docker-run-vs-cmd-vs-entrypoint/">Docker RUN vs CMD vs ENTRYPOINT</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">rennsong</p>
  <div class="site-description" itemprop="description">Personal blog site, to note technique and life related articles</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">77</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rennsong</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->




  















  

  

</body>
</html>
