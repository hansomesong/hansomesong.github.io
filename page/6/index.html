<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rennesong.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Personal blog site, to note technique and life related articles">
<meta property="og:type" content="website">
<meta property="og:title" content="Rennesong&#39;s blog">
<meta property="og:url" content="http://rennesong.com/page/6/index.html">
<meta property="og:site_name" content="Rennesong&#39;s blog">
<meta property="og:description" content="Personal blog site, to note technique and life related articles">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Rennesong&#39;s blog">
<meta name="twitter:description" content="Personal blog site, to note technique and life related articles">

<link rel="canonical" href="http://rennesong.com/page/6/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Rennesong's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Rennesong's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Blog my life from now on!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/03/25/hexo-sublime-blog-writting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/25/hexo-sublime-blog-writting/" class="post-title-link" itemprop="url">How to gracefully write blog with Sublime Text and Hexo (without command line)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-25 10:49:59" itemprop="dateCreated datePublished" datetime="2019-03-25T10:49:59+08:00">2019-03-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-27 21:52:01" itemprop="dateModified" datetime="2019-03-27T21:52:01+08:00">2019-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Productivity-tools/" itemprop="url" rel="index"><span itemprop="name">Productivity tools</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Sublime is a powerful, easy-to-use, lightweight and elegent text editor. Hexo is a light but powerful static personal blog framework. This post focuses on how to combine sublime and hexo allowing us to write and deploy blogs without any command line.</p>
<h1 id="build-system-of-sublime-text">Build system of Sublime Text</h1>
<h2 id="build-system-script-for-hexo-new-command">Build system script for "hexo new command"</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"shell_cmd"</span>: <span class="string">"title=\\<span class="variable">$(date +%H%M%S)</span> &amp;&amp; hexo new \\<span class="variable">$title</span> &amp;&amp; subl /Users/mac/Documents/blog/source/_posts/\\<span class="variable">$title</span>.md"</span>,</span><br><span class="line">    <span class="string">"working_dir"</span>: <span class="string">"/Users/mac/Documents/blog/"</span>,</span><br><span class="line">    <span class="string">"path"</span>: <span class="string">"/Applications/Sublime Text.app/Contents/SharedSupport/bin:<span class="variable">$PATH</span>"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note: *<strong>remember to adapt shell_cmd and working_dir with your own computer</strong></p>
<p>Just click File&gt;&gt;Save and use default save location to save as "hexo-new-blog.sublime-build". In Mac OSX, the default build system scripts path is:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/Library/Application Support/Sublime Text 3/Packages/User</span><br></pre></td></tr></table></figure>
<p>On Linux, the path should be: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/&lt;username&gt;/.config/sublime-text-3/Packages/User</span><br></pre></td></tr></table></figure></p>
<h2 id="build-system-script-for-hexo-server">Build system script for "hexo server"</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"shell_cmd"</span>: <span class="string">"ps -ef|grep hexo|grep -v grep|awk '&#123;print \"kill -9 \"\\<span class="variable">$2</span>&#125;'|sh &amp;&amp; hexo clean &amp;&amp; hexo server --debug"</span>,</span><br><span class="line">    <span class="string">"working_dir"</span>: <span class="string">"/Users/mac/Documents/blog/"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then save as "hexo-start.sublime-build"</p>
<h2 id="build-system-script-for-hexo-deploy">Build system script for "hexo deploy"</h2>
<p>Click Sublime&gt;&gt;Tools&gt;&gt;Build System&gt;&gt;New Build System…，put the following contents： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"shell_cmd"</span>: <span class="string">"hexo clean &amp;&amp; hexo g -d"</span>,</span><br><span class="line">    <span class="string">"working_dir"</span>: <span class="string">"/Users/mac/Documents/blog/"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/03/25/israel-visa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/25/israel-visa/" class="post-title-link" itemprop="url">2019年巴黎申请以色列旅游签证</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-25 01:19:32" itemprop="dateCreated datePublished" datetime="2019-03-25T01:19:32+08:00">2019-03-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-06 21:15:40" itemprop="dateModified" datetime="2019-04-06T21:15:40+08:00">2019-04-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/签证/" itemprop="url" rel="index"><span itemprop="name">签证</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="需要的材料">需要的材料</h1>
<ul>
<li>Une demande de visa d’entrée en Israël, remplie et signée</li>
<li>Passeport en cours de validité au minimum dans les six mois suivants la date de retour d’Israël(<strong><em>这个是硬性指标，必须满足</em></strong>)</li>
<li>Carte de séjour ou Visa Schengen en cours de validité au minimum dans les six mois suivants la date de retour d’Israël(<strong><em>我的长居实际上是6月30日到期，最后签证官并没有因为这个为难我</em></strong>)</li>
<li>Deux photos de passeport format de 5cms/5cms (<strong><em>注意照片的尺寸不是办理法国长居的那种照片规格(即35mmX45mm), <a href="http://www.photomaton.fr/produit/photos-identite-visa-etats-unis/" target="_blank" rel="noopener">Photomaton官网链接</a>支持查询哪些Photomaton机器支持拍摄5cmX5cm尺寸的照片</em></strong>)</li>
<li>Justificatif de domicile (contrat de location ou autre)</li>
<li>Contrat de travail</li>
<li>Une lettre de l'employeur confirmant que le demandeur retrouve son emploi à la fin duséjour</li>
<li>Les trois derniers bulletins de salaire (<strong><em>我是今年二月才入职，所有只能提供2月以及去年十月十一月的工资单，签证官没有为难我</em></strong>)</li>
<li>Les trois derniers relevés de banque</li>
<li>Programme détaillé des visites et excursions en Israël : lieux, adresses et numéros de téléphone</li>
<li>Attestation de réservation de vols et hôtels</li>
<li>Attestation de souscription à l'assurance annulation et rapatriement</li>
</ul>
<p>Aucun visa ne sera délivré sans présentation de l’ensemble des documents exigés. D'autres documents peuvent être nécessaires dans certainscas.Laprésence à l'Ambassade lors de la demande de visa est OBLIGATOIRE.</p>
<h1 id="巴黎递签">巴黎递签</h1>
<p>似乎是从2017年之后，办理以色列签证需要在线(<a href="https://consulate-secure-form-01.itor.co.il/Apt.aspx?clh=bf1u1707-2014-8ufv-gumq-a6f3g2b2Paris" target="_blank" rel="noopener">预约链接</a>)预约RDV递签</p>
<p>以色列驻巴黎大使馆安检极为严格，虽然是受邀的学术访问，但是在门口也被盘问了6，7分钟左右。进入大厅之后，等待时间倒是不久，很快就在H-5窗口办理，只是签证官态度不是很好。因为我们是受邀学术访问，之后其他什么都没有问就让我缴费，然后下周三来取了。周四上午办理，最早下周三来取，看来从递签到拿到签证至少5个工作日。</p>
<h1 id="行程安排">行程安排</h1>
<h2 id="巴黎取回带签证护照">03-28: 巴黎取回带签证护照</h2>
<p>可以取签证的时间为周一到周四的15:00-16:30, 和递签一样，在门口排队，交上递签那天发给你的缴费凭证，在门口耐心等待大约20分钟左右，有个大叔会帮你把护照取出来。</p>
<p><img src="/2019/03/25/israel-visa/meteo_15jours.png" alt="以色列未来两周天气"><span class="image-caption">以色列未来两周天气</span> ## 准备衣物： * T恤 (从巴黎带回来一件) * Olygan polo 衫 * 换洗内衣，袜子 * 蓝色冲锋服 * 匡威鞋子 还是 NB透气鞋 * 牙膏+牙刷 * 洁面摩斯</p>
<h2 id="随身物品">随身物品</h2>
<ul>
<li>护照+长居+家里钥匙+随身书包</li>
<li>剃须刀 (出发前充满电，不带充电线了)</li>
<li>电脑/手机，配属充电器，屏幕转接器</li>
<li>耳机 (在书包里)</li>
<li>新秀丽小登机箱</li>
<li>备用眼镜一副 (有总比没有好)</li>
<li>戒指</li>
</ul>
<h2 id="安息日前往机场">安息日前往机场</h2>
<p><img src="/2019/03/25/israel-visa/485-timetable.png" alt="485路公交车时刻表"><span class="image-caption">485路公交车时刻表</span> 2019年4月5日是以色列安息日，485最后一班车的时间是下午5点</p>
<p><img src="/2019/03/25/israel-visa/485-getin-place.png" alt="485路公交车上车地点"><span class="image-caption">485路公交车上车地点</span> 如上图所以，上车地点在 central station 附近</p>
<p>最后我们坐的是阿拉伯人的大巴车，一人67块谢克尔，到机场大约只用了50分钟不到。</p>
<h2 id="kosher-食物">Kosher 食物</h2>
<p>犹太人吃饭规则超多。犹太人给他们吃饭的规矩，还创造了一个专有的名词，叫做<code>kosher</code>，国内把它翻译成犹太洁食。如果你不了解“kosher”，你就不能真正了解犹太人。<code>kosher</code> 说白了就是一种饮食禁忌，习惯多多，但都是来源于宗教。虔诚的犹太教徒，对于不kohser的食物是不能吃。对于食物的<code>koseher</code>与否，犹太教有一部《膳食法令》专门做了说明。大体的原则就是动物必须是反刍并且蹄分四瓣的才可以吃，唯一能吃的牛羊后部的某些筋健不能吃，海里的东西没有鳞片和腮不能吃。动物的血液不能吃；自死的动物不能吃。另外由于圣经记载，吃了母羊的奶，就不能吃她的孩子，慢慢演化成了，奶和肉也不能同食。肉和奶不可同食。</p>
<p>有网友反映，以色列的物价特别高，随便路边小店里吃个简餐，人均也要100谢克尔左右（近200元人民币）。就是在路边吃个最简单的三明治、披萨一个人也要50谢克尔。我这次的感觉并不是这样。午餐我一般都要个 falfel，加一瓶可乐基本上不到25-40谢克尔之间吧。晚餐如果要去餐馆的话，可能却是需要50块以上。</p>
<h2 id="圣殿山">圣殿山</h2>
<p>圣殿山是以色列方面的称呼。公元前973年，所罗门在这座山上修建了规模宏大的圣殿，用以朝拜和祭奠犹太教的主神，并保存约柜。公元前586年，耶路撒冷被巴比伦人占领，圣殿被夷为平地。公元前1世纪，希律王重建圣殿，但在公元70年被罗马人再次摧毁。只留下的遗存，就是现在位于圣殿山西南侧的哭墙。</p>
<p>圣殿山有两个清真寺，分别是金色圆顶清真寺和阿克萨清真寺。金顶清真寺，建于公元691年，这座八角形的蓝色清真寺，是为了纪念穆罕默德从一块巨石上登天，聆听真主的启示而建造的。</p>
<p>圣殿山只在周日到周四白天的两段时间开放（4-9月：7:30-11:00, 13:30-14:30；10月-次年3月：7:30-10:00,12:30-13:30）。所有游客必须经过长时间细致的盘问和安检，通过特殊栈道上山。</p>
<h1 id="关于退税">关于退税</h1>
<p>进入T3航站楼，很容易就可以发现标识为<code>VAT</code>的柜台，就是退税处，在那儿需要出具商家给出的退税单，进入以色列拿到的蓝色入境卡</p>
<p>当打印完登机牌，托运行李，过完安检，就会来到机场的免税商品区，很容易找到一个退税点，拿着刚进入机场(过安检之前的区域)退税单，这个退税点会要求填写一个退税确认单，如下图所示： <img src="/2019/03/25/israel-visa/vat-refund-form.png" alt="退税单填写"><span class="image-caption">退税单填写</span> 不得不说以色列的退税还是有些坑，退税居然还有再交出去一笔手续费，号称是<code>17%</code>的退税率，但是实际上拿到手的钱除以当时消费总额，实际退税率只有<code>10%</code>左右。</p>
<h1 id="兑换以色列本地货币">兑换以色列本地货币</h1>
<p>第一选择就是到达以色列的时候，在机场直接通过ATM机取钱，我取了700谢克尔，回来之后查看了下银行账户扣掉了176.16欧，汇率相当于是3.97</p>
<p>第二种选择就是直接在法国取好欧元在耶路撒冷旧城区兑换点换钱，我看有些网点可以给出4.04的汇率。以我取现700谢克尔的情况来看，可以省下来将近3欧吧</p>
<p>如果有多于的谢克尔，目前来看也还是在耶路撒冷旧城兑换回欧元较为划算</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2019/03/24/ovs-tuto/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/24/ovs-tuto/" class="post-title-link" itemprop="url">Open vSwitch 详细介绍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-24 17:57:49" itemprop="dateCreated datePublished" datetime="2019-03-24T17:57:49+08:00">2019-03-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-11 04:41:09" itemprop="dateModified" datetime="2019-04-11T04:41:09+08:00">2019-04-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux-networking/" itemprop="url" rel="index"><span itemprop="name">linux networking</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ovs">OVS</h1>
<h2 id="ovs-实现中的主要模块">OVS 实现中的主要模块</h2>
<p>OVS 实现中，主要模块如下图所示: <img src="/2019/03/24/ovs-tuto/ovs-main-components.png" alt="OVS main components"><span class="image-caption">OVS main components</span> 最新代码包主要包括以下模块和特性： * ovs-vswitchd: 核心模块，实现交换功能的守护程序（daemon），和 Linux 内核模块一起，实现基于流的交换； * ovsdb-server ：提供轻量级数据库查询服务。其保存了整个OVS的配置信息，包括接口，流表，VLAN等。ovs-vswitchd从其查询配置信息； * ovsdb-tool: 不通过ovs-server就能直接操控数据库 * ovsdb-client: 直接通过ovs-server数据库操作 * ovs-brcompatd：让 ovs-vswitch 替换 Linux bridge，包括获取 bridge ioctls 的 Linux 内核模块； * ovs-dpctl：dapapath control.  用来配置 switch 内核模块，可以控制转发规则； * ovs-vsctl: 获取或者更改ovs-vswitchd的配置信息，此工具操作的时候会更新ovsdb-server数据库； * ovs-appctl：openvswitch apply control, 发送命令来运行相关 daemon(很少使用)； * ovsdbmonitor: GUI 工具，用于显示 OVS 数据库中的相关数据。</p>
<p>此外， OVS 也提供了支持 OpenFlow 的特性实现，包括: * ovs-openflowd：一个简单的 OpenFlow 交换机； * ovs-controller：一个简单的 OpenFlow 控制器； * ovs-ofctl :openvswitch openflow control, 用来控制OVS作为OpenFlow交换机工作时的流表内容； * ovs-pki：OpenFlow 交换机创建和管理公钥框架； * ovs-tcpundump：实现类似tcpdump 的抓包分析功能</p>
<p>既然ovs-vswitchd是Open vSwitch的核心模块，咱们就来深入研究下它 vswitchd 模块主要包括 bridge、ofproto 等模块。作为主模块，负责解析和执行其他各个 ovs 命令。vswitchd 的主要功能就是不断检测并调用所有 bridge 上的 ofproto，执行其上的处理函数。 ovs-vswitchd.c 中有 main 函数，分析 vswitchd 可以从这里开始，这里包含以下头文件，其中大部分都是与业务无关的代码，其中与业务有关的也就 bridge.h、dpif.h、netdev.h、openflow/openflow.h、ovsdb-idl.h、vconn.h、lib/vswitch-idl.h。以下代码注释来自<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;bridge.h&quot; //the bridge module,需要访问ovsdb-server获取配置信息，与ofprotos和ofproto-dpif也有些关系。</span><br><span class="line">#include &quot;command-line.h&quot;</span><br><span class="line">#include &quot;compiler.h&quot;</span><br><span class="line">#include &quot;daemon.h&quot; //守护进程管理模块</span><br><span class="line">#include &quot;dirs.h&quot; //目录管理模块</span><br><span class="line">#include &quot;dpif.h&quot; //dpif, the DataPath InterFace.ovs-vswitchd使用这个接口与内核模块通信，ovs-dpctl也会使用</span><br><span class="line">#include &quot;dummy.h&quot;</span><br><span class="line">#include &quot;memory.h&quot;</span><br><span class="line">#include &quot;netdev.h&quot; //Generic interface to network devices (&quot;netdev&quot;s).用来管理网络设备的模块</span><br><span class="line">#include &quot;openflow/openflow.h&quot; //openflow协议规格定义</span><br><span class="line">#include &quot;ovsdb-idl.h&quot; //Open vSwitch Database Interface Definition Language (OVSDB IDL).应该是访问ovsdb-server进程的接口</span><br><span class="line">#include &quot;poll-loop.h&quot; //High-level wrapper around the &quot;poll&quot; system call.poll系统调用的封装模块</span><br><span class="line">#include &quot;process.h&quot; //Starting and monitoring subprocesses.进程监控模块</span><br><span class="line">#include &quot;signals.h&quot; //signals系统调用的封装模块</span><br><span class="line">#include &quot;simap.h&quot; //数据结构定义和hash map的封装操作接口模块</span><br><span class="line">#include &quot;stream-ssl.h&quot; //SSL安全网络通信封装模块接口</span><br><span class="line">#include &quot;stream.h&quot; //网络通信封装模块接口</span><br><span class="line">#include &quot;svec.h&quot; //SVEC数据结构操作模块，SVEC是什么？</span><br><span class="line">#include &quot;timeval.h&quot; //计时相关系统接口封装模块</span><br><span class="line">#include &quot;unixctl.h&quot; //Unix domain socket control connection.UNIX相关网络通信模块</span><br><span class="line">#include &quot;util.h&quot;</span><br><span class="line">#include &quot;vconn.h&quot; //virtual connections to OpenFlow devices.</span><br><span class="line">#include &quot;vlog.h&quot;</span><br><span class="line">#include &quot;lib/vswitch-idl.h&quot; //自动生成的文件，应该是Open vSwitch Interface Definition Language，可能是openflow协议的具体内容实现</span><br></pre></td></tr></table></figure></p>
<h2 id="ovs-中基本概念5">OVS 中基本概念<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></h2>
<h3 id="packet">1.Packet</h3>
<p>网络转发的最小数据单元。每个包都来自某个端口，最终会被发往一个或多个目标端口，转发数据包的过程就是网络的唯一功能 ### 2.Bridge Open vSwitch中的一个网桥就是一台以太网交换机。这里交换机不限于二层转发 ### 3.Port 端口是收发数据包的单元，和物理以太网交换机的端口概念类似. Open vSwitch中，每个端口都属于一个特定的网桥。端口收到的数据包会经过流规则的处理，发往其他端口；也会把其他端口来的数据包发送出去。Open vSwitch支持的端口有以下几种： - Normal port: 用户可以把操作系统中的网卡绑定到Open vSwitch上，Open vSwitch会生成一个普通端口处理这块网卡进出的数据包。 - Internal port: 当设置端口类型为internal，Open vSwitch会创建一快虚拟网卡，此端口收到的所有数据包都会交给这块网卡，网卡发出的包会通过这个端口交给Open vSwitch。 当Open vSwitch创建一个新网桥时，默认会创建一个与网桥同名的Internal Port - Patch port: 当机器中有多个Open vSwitch网桥时，可以使用Patch Port把两个网桥连起来。Patch Port总是成对出现，分别连接在两个网桥上，在两个网桥之间交换数据。 - Tunnel port: 隧道端口是一种虚拟端口，支持使用 GRE 或 VxLAN 等隧道技术与位于网络上其他位置的远程端口通讯。</p>
<h3 id="interfaceiface接口">4.Interface(iface/接口)</h3>
<p>它是连接到 Port 的网络接口设备。Open vSwitch 通过 Interface 与外部交换数据包。在通常情况下，Port 和 Interface 是一对一的关系, 只有在配置 Port 为 bond 模式后，Port 和 Interface 才是一对多的关系。一个接口就是操作系统的一块网卡，这块网卡可能是 Open vSwitch生成的虚拟网卡，也可能是物理网卡挂载在Open vSwitch上，也可能是操作系统的虚拟网卡（TUN/TAP）挂载在 Open vSwitch 上。</p>
<h3 id="datapath">5.Datapath</h3>
<p>由于流可能非常复杂，对每个进来的数据包都去尝试匹配所有流，效率会非常低，所以有了datapath。Datapath 对流进行缓存，把流的执行结果保存起来，当下次遇到匹配到同一条流的数据包，直接通过 datapath 处理。考虑到转发效率，datapath 完全是在内核态实现的，并且默认的超时时间非常短，好像是3秒。</p>
<blockquote>
<p>再重新看一下上面的模块图，datapath是不是可以视作一个交换机，或者说一个桥的实体模块？ 因为传统交换机缓存MAC地址并根据MAC地址进行数据包的转发，而Datapath缓存Flow（流）并根据流进行数据包的转发。 A datapath is a collection of physical or virtual ports that are exposed over OpenFlow as a single switch. Datapaths and the collections of ports that they contain may be fixed or dynamic.</p>
</blockquote>
<h3 id="flow-table">6.Flow table</h3>
<p>每个 datapath 都和一个"flow table"关联，当 datapath 接收到数据之后， OVS 会在 flow table 中查找可以匹配的 flow，执行对应的操作, 例如转发数据到另外的端口。</p>
<h2 id="端口镜像设置6">端口镜像设置<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></h2>
<p>设置镜像端口的主要作用就是利用tcpdump进行抓包。 首先要添加 <strong>虚拟网络适配器 <code>dumm0</code></strong> 并启用 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip link add name dumm0 type dummy</span><br><span class="line">ip link set dev dumm0 up</span><br></pre></td></tr></table></figure></p>
<h3 id="监听指定网桥的特定端口数据包">1. 监听指定网桥的特定端口数据包</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将虚拟网络适配器`dumm0` 连接到需要监视的网桥<span class="built_in">test</span>-bridge上</span></span><br><span class="line">ovs-vsctl add-port test-bridge dumm0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建名为 `mirrors` 的镜像端口, <span class="built_in">test</span>-port 是OVS上之前添加的端口</span></span><br><span class="line">ovs-vsctl -- set Bridge br-sfc mirrors=@m \</span><br><span class="line">-- --id=@dumm0 get Port dumm0  \</span><br><span class="line">-- --id=@sff0-dpl get Port sff0-dpl \</span><br><span class="line">-- --id=@m create Mirror name=ovsMirror \</span><br><span class="line">select-dst-port=@sff0-dpl \</span><br><span class="line">select-src-port=@sff0-dpl \</span><br><span class="line">output-port=@dumm0 select_all=1</span><br></pre></td></tr></table></figure>
<p>查看镜像端口 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># ovs-vsctl list Mirror</span><br></pre></td></tr></table></figure></p>
<p>删除镜像端口 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ovs-vsctl clear bridge br-sfc mirrors</span><br></pre></td></tr></table></figure></p>
<h3 id="监听整个网桥镜像">2. 监听整个网桥镜像</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ovs-vsctl -- --id=@m create mirror name=ovsMirror \</span><br><span class="line">  -- add bridge br-sfc mirrors @m \</span><br><span class="line">  -- --id=@dumm0 get port dumm0 \</span><br><span class="line">  -- set mirror ovsMirror select_all=true output-port=@dumm0</span><br></pre></td></tr></table></figure>
<p>没有时间来得及细看这个教程 https://arthurchiao.github.io/blog/trafic-mirror-with-ovs/ 看样子也不是不错的！</p>
<h1 id="docker-network-troubleshooting">docker network troubleshooting</h1>
<h2 id="tcpdump-in-docker-container-7">tcpdump in docker container <a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></h2>
<p>overlay network traffic in swarm does not go thru docker0 or docker_gwbridge. There are 2 options: ### option 1: Go inside container and do tcpdump: nicolaka/netshoot is container with all network debug tools. <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -ti --net container: &lt;container name/id&gt; nicolaka/netshoot</span><br><span class="line">tcpdump -i &lt;eth0&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="option-2">Option 2:</h3>
<p>Go inside network namespace of overlay network and do tcpdump: First find overlay network id with docker network inspect Start debug container mounting network namespace: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm -v /var/run/docker/netns:/var/run/docker/netns --privileged=true nicolaka/netshoot</span><br></pre></td></tr></table></figure></p>
<p>All namespaces are listed under: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/run/docker/netns</span><br></pre></td></tr></table></figure></p>
<p>Find your swarm overlay network namespace matching with overlay networkid of previous command. Then nsenter into network namespace: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nsenter --net=/var/run/docker/netns/ sh</span><br><span class="line">tcpdump -i vxlan0</span><br></pre></td></tr></table></figure></p>
<h2 id="case-study-opendaylight-项目中的-demo-sfc103">case study: OpenDayLight 项目中的 demo: sfc103</h2>
<p>OVS is more powerful bridge than linux bridge, but since it is still a L2 bridge, some general bridge conventions it has to conform to<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function ovs_start &#123;</span><br><span class="line">    service openvswitch-switch start</span><br><span class="line">    # In the passive mode, OVS connects to an ODL instance </span><br><span class="line">    # (6640 is the IANA registered port for ovsdb)</span><br><span class="line">    ovs-vsctl set-manager tcp:192.168.1.5:6640</span><br><span class="line">    ovs-vsctl add-br br-sfc</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="如何理解这段代码">如何理解这段代码</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function ovs_add_app_veth-br &#123;</span><br><span class="line">    # 创建名为 &apos;app&apos; 的 Linux 网络命名空间(network name space)</span><br><span class="line">    ip netns add app </span><br><span class="line">    # 增加一对 veth 虚拟网卡, 名字分别为: veth-app 以及 veth-br</span><br><span class="line">    # 我知道了 因为在sfc103这个demo中，发送http请求的client和classfier1</span><br><span class="line">    # 处于同一个容器中, 作者想把他们隔离开来</span><br><span class="line">    ip link add veth-app type veth peer name veth-br</span><br><span class="line">    ovs-vsctl add-port br-sfc veth-br</span><br><span class="line">    # dev 指的是 device 的意思</span><br><span class="line">    ip link set dev veth-br up</span><br><span class="line">    # 将 veth-app 添加到 app 虚拟网络环境</span><br><span class="line">    # 注意: 从此 ip link show type veth 将看不到 veth-app</span><br><span class="line">    # 只有在命名空间 app 中才看得到 </span><br><span class="line">    ip link set veth-app netns app</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>network namespace 是实现网络虚拟化的重要功能，它能创建多个隔离的网络空间，它们有独自的网络栈信息。不管是虚拟机还是容器，运行的时候仿佛自己就在独立的网络中。 Initially everything is in the global namespace 对于每个 network namespace。 来说，它会有自己独立的网卡、路由表、ARP 表、iptables 等和网络相关的资源。</p>
<h1 id="ovs-使用命令">ovs 使用命令</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 测试flow 匹配执行情况，但并不发送真的packet</span><br><span class="line">ovs-appctl ofproto/trace br-sfc in_port=1,tcp,nw_src=192.168.2.1,nw_dst=192.168.2.2,nw_ttl=64,tcp_dst=80,tcp_flags=syn -generate</span><br></pre></td></tr></table></figure>
<h1 id="how-can-i-figure-out-the-openflow-port-number-for-a-given-port-you-can-print-the-entire-mapping-with">How can I figure out the OpenFlow port number for a given port? you can print the entire mapping with</h1>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ovs-vsctl -- --columns=name, ofport list Interface</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加一条flow</span></span><br><span class="line">ovs-ofctl add-flow -OOpenFlow13 br-sfc "table=0,tcp,priority=1002,in_port=1,nw_src=192.168.2.0/24,nw_dst=192.168.2.0/24,tp_dst=80,actions=encap(nsh),set_field:0x49-&gt;nsh_spi,set_field:255-&gt;nsh_si,set_field:0x1-&gt;nsh_c1,set_field:0x2-&gt;nsh_c2,set_field:0x3-&gt;nsh_c3,set_field:0x4-&gt;nsh_c4, encap(ethernet),load:0xc0a80114-&gt;NXM_NX_TUN_IPV4_DST[],output:2"</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加一条flow, 最后将修改过的packet输出至多个端口</span></span><br><span class="line">ovs-ofctl add-flow -OOpenFlow13 br-sfc "table=0,tcp,priority=1002,in_port=1,nw_src=192.168.2.0/24,nw_dst=192.168.2.0/24,tp_dst=80,actions=encap(nsh),set_field:0x49-&gt;nsh_spi,set_field:255-&gt;nsh_si,set_field:0x1-&gt;nsh_c1,set_field:0x2-&gt;nsh_c2,set_field:0x3-&gt;nsh_c3,set_field:0x4-&gt;nsh_c4, encap(ethernet),load:0xc0a80114-&gt;NXM_NX_TUN_IPV4_DST[],output:2,output:3"</span><br></pre></td></tr></table></figure>
<h1 id="prerequisite-knowledge">prerequisite knowledge</h1>
<h2 id="network-namespace-之间通信">network namespace 之间通信</h2>
<p>默认情况下，network namespace 是不能和主机网络，或者其他 network namespace 通信的。</p>
<p>有了不同 network namespace 之后，也就有了网络的隔离，但是如果它们之间没有办法通信，也没有实际用处。要把两个网络连接起来，linux 提供了<code>veth pair</code> 。可以把 <code>veth pair</code>当做是双向的 pipe（管道），从一个方向发送的网络数据，可以直接被另外一端接收到；或者也可以想象成两个 namespace 直接通过一个特殊的虚拟网卡连接起来，可以直接通信。</p>
<p>我们可以使用 ip link add type veth 来创建一对 veth pair 出来，需要记住的是 veth pair 无法单独存在，删除其中一个，另一个也会自动消失。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ip netns exec app ifconfig veth-app 192.168.2.1/24 up</span><br><span class="line"># 配置 veth-app 网卡 MAC 地址</span><br><span class="line">ip netns exec app ip link set dev veth-app  addr 00:00:11:11:11:11</span><br><span class="line"># 选项s: 设置主机 IP 地址和 MAC 的静态映射</span><br><span class="line"># 选项i: 后跟接口, 指定要操作 arp 缓冲区的网络接口 veth-app 是本地接口</span><br><span class="line">ip netns exec app arp -s 192.168.2.2 00:00:22:22:22:22 -i veth-app</span><br><span class="line">ip netns exec app ip link set dev veth-app up</span><br><span class="line"># 为何要把 loopback 设备也开启呢？网上好多例子都是这样</span><br><span class="line">ip netns exec app ip link set dev lo up</span><br><span class="line">ip netns exec app ifconfig veth-app mtu 1400</span><br><span class="line">ovs-vsctl show</span><br></pre></td></tr></table></figure>
<p>A veth device pair is a virtual ethernet cable, packets sent on one end come out the other (and vice versa of course) <a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>.</p>
<h1 id="create-tunnel-devices-using-rtnetlink-interface">create tunnel devices using rtnetlink interface</h1>
<p>Developers of network layer protocol handlers can use RTNETLINK to modify and monitor different components of networking, such as the routing table and network interfaces<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>. =&gt; 这个功能是否可以帮助我实现 Montida's paper 的实现？</p>
<p>It helps reduce the complexity of the kernel code if you implement these protocols in user space.</p>
<p>rtnetlink就是一组操作rtnetlink消息的宏<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>。</p>
<p>rtnetlink是基于netlink机制的一个内核和协议栈相关操作的机制。其允许用户程序对内核的路由表进行读写。这个功能非常重要，在很多基础的工具中的使用也非常广泛。但是很少资料直接对 rtnetlink 的具体使用进行讲解，中文的资料只有一些对 <a href="http://man7.org/linux/man-pages/man7/rtnetlink.7.html" title="RTNETLINK(7)" target="_blank" rel="noopener">Manual</a> 的翻译和补充。Linux Journal<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a> 有非常详细的一篇框架文章，但是对具体过程解释不详细。另一方面，由于现实的应用中，对路由表等的处理较为复杂，没有比较简单直接的例子。并且其 <a href="http://man7.org/linux/man-pages/man7/rtnetlink.7.html" title="RTNETLINK(7)" target="_blank" rel="noopener">Manual</a> 中说到这个是 Linux IPv4 的路由 socket，但是其支持 Ipv6，应该是 <a href="http://man7.org/linux/man-pages/man7/rtnetlink.7.html" title="RTNETLINK(7)" target="_blank" rel="noopener">Manual</a> 太久没更新的缘故。 因此，这篇文章并不对rtnetlink的数据结构或<a href="http://man7.org/linux/man-pages/man7/rtnetlink.7.html" title="RTNETLINK(7)" target="_blank" rel="noopener">Manual</a>进行详细的解释，而是解释其使用方式，并且举一个具体的使用样例。对一些操作和数据结构的构成有疑惑，可以直接看 <a href="http://man7.org/linux/man-pages/man7/rtnetlink.7.html" title="RTNETLINK(7)" target="_blank" rel="noopener">Manual</a>。</p>
<h1 id="基于-vxlan-的-nsh-封装sdn-lab">基于 VxLAN 的 NSH 封装<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a></h1>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn1" role="doc-endnote"><p>https://blog.csdn.net/zhengmx100/article/details/54729272<a href="#fnref1" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn2" role="doc-endnote"><p>https://blog.csdn.net/zhengmx100/article/details/54729272<a href="#fnref2" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn3" role="doc-endnote"><p>http://blog.kompaz.win/2017/03/19/OpenVSwitch%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/#%E7%89%B9%E5%AE%9A%E7%AB%AF%E5%8F%A3%E9%95%9C%E5%83%8F%E8%AE%BE%E7%BD%AE<a href="#fnref3" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn4" role="doc-endnote"><p>https://forums.docker.com/t/how-to-tcpdump-inter-service-traffic/23463/4<a href="#fnref4" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn5" role="doc-endnote"><p>https://arthurchiao.github.io/blog/ovs-deep-dive-6-internal-port/<a href="#fnref5" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn6" role="doc-endnote"><p>https://matthewarcus.wordpress.com/2018/02/04/veth-devices-network-namespaces-and-open-vswitch/<a href="#fnref6" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn7" role="doc-endnote"><p>https://www.linuxjournal.com/article/8498<a href="#fnref7" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn8" role="doc-endnote"><p>https://blog.csdn.net/iteye_18932/article/details/82139564<a href="#fnref8" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn9" role="doc-endnote"><p>https://www.linuxjournal.com/article/8498<a href="#fnref9" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn10" role="doc-endnote"><p>https://www.sdnlab.com/16610.html<a href="#fnref10" class="footnote-back" role="doc-backlink">↩</a></p></li>
</ol>
</section>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2016/10/23/french-useful-phrases/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/10/23/french-useful-phrases/" class="post-title-link" itemprop="url">法语积累</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-10-23 00:21:48" itemprop="dateCreated datePublished" datetime="2016-10-23T00:21:48+08:00">2016-10-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-23 17:00:38" itemprop="dateModified" datetime="2019-10-23T17:00:38+08:00">2019-10-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/外语/" itemprop="url" rel="index"><span itemprop="name">外语</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Ce qui m'effare... 让我惊讶的是... formellement ce ne fait que penser qu'a ca magouille 勾心斗角 menopause 更年期 apres confirmation de votre part, la carte bancaire qui a servi au paiment sera creditee du montant a rembourser. Ton discours te rend nerveux？ ca prouve que tu es pas detache！ fringue 俗语衣服 quelles chaussures je mets？ 我穿哪双鞋子? je fais ton numero par d'erreur. Tu m'as planque tous mes fringues. Tu aimerais vraiment avaler ca？你真得想吃下去？ Ca me rappelle mon enfance. 这让我想起了我小时候 une fille tartinee avec configure. Le francais procede du latin. cette maniere de faire nuit a sa reputation.这种做法损害了他的声望。 homme de parole. 守信用 On trouve en lui du pedant. 我们在他身上看到了学究气. Tout ca ne me regarde pas. 所有的一切都与我无关 sereinement defaite Je porte tous les resposabilites. 我承担一切责任. Je n'ai qu'un seul bras valide. rend-moi service. 帮帮忙 tu n'as pas ete retenu. La voiture recule pour mieux braquer. 车子为了拐弯忘往后倒开 Je m'apercois dans la glace. 我在照镜子 il pleut. il neige. il gele. il tonne il est temps que vous pensiez a votre avenir. si on vient a rencontrer. 万一我们碰到的话 regrouper par famille. post-it tout vient a l'esprit. les allemands aurrait-ils atteint leur point de ras-le-bol？ une allemangne desireuse de reprendre en main son destin. mettre en lumiere les effets deleteres de cette construction baroque. il faut gratter les fonds de tiroir. 搜集抽屉里的钱 faire preuve de..显示出 si la grece sort de l'euro, c'est l'allemagne trinque. 德国倒霉 effondrement 倒塌崩溃 plan d'austerite. 紧缩政策 il a cru deroger en faisant ce metier.他过去认为干这一行有失身份 vent favorable 顺风 par coutume 按惯例 Point d'exclamation 感叹号 vous pouvez etre bien cale dans votre fauteuil Vous ne sentez pas à l'aise. Je viens d'avoir Gillaume au téléphone. 我刚刚接了Gillaume的电话 A noter que tous les postes sont a pouvoir rapidement. 注意 所以职位近期即将履新 vulgarisation scientifique 科普 glaner des renseignements 收集信息</p>
<p>claquage: claquage du a la tenaion intetcaler: en anglais, intercalate fusible mise aux encheres C'est une explication plausible. 这倒是个说的过去的解释。 Il faut voir le bon cote des choses. 要往好的方面看。。 il fait une chute. Ne vous tracassez pas. 你就别操心了。 J'ai eleve deux filles en vain. pourquoi vous torturer ici？ C'est son testament. 这是他的遗书。 et puis apres？ Fait attention à ta sante. Cela me fait de peine. Je vous demande une faveur. C'est tres injuste pour toi. 这对你也太不公平了。 promet-le-moi.答应我。 Je me plie à mon destine. 我认命。 N'a rien a voir avec lui. 和他没有关系。 Je viens t'apporter une noubelle exceptionnelle. retablir sa sante. 恢复健康 Quand je suis retabli, 当我康复的时候。。 Ca saute aux yeux. 明摆着么。 Je laisse la famille à tes soins. 家就交给你了。 Je te confie mon parent. 我父母就拜托给你了。 Les japonais sont capitule. 日本人投降了。 Ce rire jaune me fait peur. 他的苦笑让我感觉害怕。 J'ai confiance en toi. 我相信你。 ecarte le main. 松手。 tout sera eclairci. 一切都会真想大白。 n'agis pas a la legere. 不要鲁莽行事。 sous alimentation 营养不良。 Faire rebondir la conservation. 使谈话重新活跃起来 voisins de palier 同一楼层的邻居 la syntaxe d'utilisation d'un composant dans une discription est la suivante. quand je l'ai vu, j'étais hypnotise et fasciné Je déverse toute ma haine sur une personne. Toute fois, une erreur s'est glissé dans le jugement puisque le tribunal a estimé à tort que ce poste était occupé par lui. epidemie de grippe. J'ai traversé la rue pour rejoindre ma voiture . Debrouillez vous! 你自己想法应付吧！ Elle est geniable de ce truc! Je les emmène pour interroger. Malgré les sanctions prises par la communauté internationale contre Damas et l'interdiction de vente de l'arme a la Serie, ce vente de ces technologies n 'est pas proscrite. Aux pays bas, votre voiture est confisqué. La France a un double langage: lors qu'il y a des émeutes en France, son gouvernement est trop dur, mais quand il se passe en chine, les émeutiers sont des héros. On a débordé. 我们超时了。 Il m'a plaqué parce que je le refuserais. j'ai un service a vous demander. 我想请你帮个忙 de quels droits doit-t-il beneficier？ je voulais creer des situations de communication authentique pour eux, malheusement, les eleves etaient tres peu engages！ si un élève s'intéresse à peine à l'école ,pourquoi s'intéresserait il à lire un blog publié par une classe à propos de leur école ? de corpulence. 身材胖 Le dock dw gauche est affreux avec des icones de styles differents. accolade 大括号 crochet 方括号 parentheses 小括号 le déclic devrait se faire. quand elle eternuait...当她打喷嚏时 J'ai du mal à avaler.我难以置信。 autopsie 验尸 L'affaire a raté de peu. 工亏一亏 Je ne sais pas si c'est pertinent de le dire. 我不知道这么说是否合适。 prix usuraire 高利贷 il est très grossier.他很粗鲁 percée = breakthrough. Président sortant 任满的总统 postgres est a psql ce que root est a Ubuntu.</p>
<p>Pour l’instant, sa grossesse se passe bien et elle devrait accoucher dans 10 jours. 目前来说，她身体状况良好估计在10天以后分娩。</p>
<p>Linux Mint <strong><em>se décline en</em></strong> deux versions: l'une est basée sur Ubuntu et l'autre est basée sur Debian testing.</p>
<p>Il nous faut maintenant en tirer le meilleur parti possible = We have to make the best of it and to make optimum use of it.</p>
<p>A l’heure où les données deviennent une source de valeur essentielle pour l’entreprise, leur sauvegarde est un facteur de pérennité pour l’activité de l’entreprise. 时值数据正成为企业最重要的价值来源，数据的存储成了企业生产活动永恒的因素。</p>
<p>L’ARCEP(Autorité de Régulation des Communications Electroniques et des Postes)met en consultation publique (公开听众会) les modalités d’attribution et les obligations pour les candidats à la 5G sur la bande de 3.4 GHz à 3.8 GHz. 300 MHz de bandes seront mis en enchère (拍卖) en automne 2019.</p>
<p>Je m'incline au nom de toute la nation entiere devant le douleur des familles</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2016/10/22/tuto-magie-file-system/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/10/22/tuto-magie-file-system/" class="post-title-link" itemprop="url">tuto_magie_file_system</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-10-22 01:50:29" itemprop="dateCreated datePublished" datetime="2016-10-22T01:50:29+08:00">2016-10-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-25 18:27:10" itemprop="dateModified" datetime="2019-03-25T18:27:10+08:00">2019-03-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="文件系统最初的由来">文件系统最初的由来</h1>
<p>文件系统最开始不过是个简单的 *** 磁盘管理器 ***</p>
<p>操作系统中，所有需要进行读写操作的进程都必须通过这个模块才能对磁盘进行读写。如此一来， 不同进程占用不同的磁盘分区就可以有条不紊地进行。</p>
<p>为了在磁盘中定位文件，文件夹的概念得以引入。至此，数据了有了树状结构。 # 所谓的 虚拟文件系统 文件系统的概念获得了巨大的成功。后来我们将文件系统的概念进行了扩展。以至于我们常说：“一切皆文件”。</p>
<p>树状表示很好，为什么我们不用来表示除磁盘数据之外的东西呢？比如，用 PID 命名的文件夹里 管理正在执行中的进程的信息。这就是挂载在挂载点 /proc 之下的文件系统的功能。</p>
<p>对于连接在电脑上的外设，我们也采用同样的思路：挂载在挂载点 /dev 之下。</p>
<p>同样的思路，为什么我们不可以在内存空间(而不是磁盘空间)中开辟一块空间，来管理一些临时文件呢？这样大大加速一些程序的执行。这就是 tmpfs 的使命。</p>
<p>这样的例子，在计算机中，不胜枚举。</p>
<p>对于这样的例子，我们一定要明白，我们始终贯彻的是“一切皆文件”的理念。</p>
<p>开发基于 FUSE 的文件系统的好处是：不需要动内核。但代价是性能的下降。但是：为啥我们需要这么一个文件系统呢？</p>
<p>Live CD 最大的难点在于：如何在只读载体上，比如CD上，创造出来一个允许我们读写的文件系统？</p>
<p>文章出处：La Magie des Filesystems: 1-Tour d'Horizon, Linux Magazine, 2014, Fevrier</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2016/10/22/TP-IPv6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/10/22/TP-IPv6/" class="post-title-link" itemprop="url">IPv6 实验课准备以及遇到的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-10-22 01:04:42" itemprop="dateCreated datePublished" datetime="2016-10-22T01:04:42+08:00">2016-10-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-25 18:27:10" itemprop="dateModified" datetime="2019-03-25T18:27:10+08:00">2019-03-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>需要熟练记忆的命令 实验室网络拓扑结构图：</p>
<ul>
<li>在privileged mode下
<ul>
<li>show ipv6 interface brief</li>
<li>show ipv6 route</li>
</ul></li>
<li>在configuration mode下 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Routeur# configure terminal</span><br><span class="line">Routeur(config)# interface FastEthernet0/1.101</span><br><span class="line">Routeur(config-if)# ipv6 address 2001:660:7301:27_1::/64 eui-64</span><br><span class="line">Routeur(config-if)# exit</span><br><span class="line">Routeur(config)# exit</span><br><span class="line">Routeur#</span><br></pre></td></tr></table></figure></li>
</ul>
<p>以上代码块用来配置面向内网的那块以太网卡的 IPV6 地址的 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Routeur# configure terminal</span><br><span class="line">Routeur(config)# interface FastEthernet0/0</span><br><span class="line">Routeur(config-if)# no shutdown</span><br><span class="line">Routeur(config-if)# ipv6 address 2001:660:7301:2700::_/64</span><br><span class="line">Routeur(config-if)# ipv6 enable</span><br><span class="line">Routeur(config-if)# exit</span><br><span class="line">Routeur(config)#</span><br></pre></td></tr></table></figure></p>
<p>以上代码块是用来配置面向 Reseau d’Interconnextion 的那块儿以太网卡的IPv6的地址。</p>
<p>配置路由器接口 IPv6 的方法其实有两种，第一种是：直接给出完完整的IPv6地址，第二种是，只告诉这块网卡的网络前缀，然后指定 EUI-64 模式，然后根据该接口的MAC地址，自己生成IPv6地址。</p>
<p>还没有搞清楚的问题： 在配置模式下，命令ipv6 unicast-routing 是什么意思？ 思科路由器的virtual interface的概念 问题是 在配置模式下，为什么 命令 interface fastethernet 0/1.101 可以直接通过呢？是不是0/1.501之类的命令也可以通过呢？ 路由器属于哪些multicast group里，这个有什么用？ 其实一直没有闹明白，思科路由器下面的 redistribute connected 究竟是个什么意思呢？ 为什么 RA一下子要 3连发呢？ 什么又是 MLD sol???</p>
<p>no shutdown 其实相当于 开启了 路由器的某一块儿网卡，</p>
<p>通过本次试验我们可以知道，配置了IPv6的路由器，是不会提供 DNS 服务的</p>
<p>其实要是想完全搞懂，还得懂DHCP IPV4 是怎么搞的</p>
<p>昨天配置完 DNS 服务之后，ping6 serveur.tp 一直无法工作，一直很困惑，Bruno的提示说，通过查看 /var/log/syslog 的内容，才发现问题所在，其实就是少了一个小数点，经验就是 bind9 这个服务，不管你的配置文件正确不正确，都会正常开启的，需要 debug 的时候，注意看 /var/log/syslog 的内容。不过一个新的问题就是，命令 dmesg又显示的是哪个文件的内容呢？</p>
<p>Solicited-node multicast address 是IPv6体系之下一种layer3类型地址，在Neighbour Discovery过程之中的，是用来获取目标硬件的 layer-2，也即是 MAC地址的时候，使用的 IPV6地址，我们一般用ARP协议与之类比。</p>
<p>NDP (Neighbour Discovery Protocol) 的基础是 Neighbour Advertisement 信息，所有的 IPv6-enable的机器都会 周期性的 向谁？to other hosts present on the same network (那我怀疑这里的目的地址应该是：ff02::1 了) 发送 包含自己 link-local 的地址，以便其他人在做 ND的时候可以发现你。</p>
<p>IPv6 DAD or Duplicate Address Detection is a neighbor solicitations function.</p>
<p>这个教程讲 IPv6真是不错：http://howdoesinternetwork.com/2012/ndp-ipv6-neighbor-discovery-protocol</p>
<p>本次TP中，有组学生非常认真，他们仔细对了课本上讲的知识以及他们实际观察到的traces是否一致，有个地方问住了我（因为我也确实不熟悉），就是为什么 Host想router所在的组(ff02::2)发送了Neighbour Solicitation 请求，但是router一直没有回复呢？ 猛一下把我问住了，因为对DAD机制不熟悉，所以不敢造次，后来才知道，其实没有回复就是最好的回复。因为只有真的有其他机器跟自己使用了一样的Global address，它才会看到有人回复自己。</p>
<p>需要使用 DHCPv6 的机器，是不会自己自动发起请求，要求分配一个 IPv6 地址的，需要在客户端有个软件发起请求。</p>
<p>DHCPV6的工作流程大致可以分为 Solicite, advertise, request, reply. 在solicite的时候，目的地址应该是 FF02::1:3 还是 FF02::1:2?(因为poly上写的可是FF02::1:2啊，为啥我们的答案里写的确实FF02::1:3呢？）=》在PC2发出SOLICITE message 的时候，目的地址确实为多播类型（FF02::1:2）, 而思科路由器在做Relay的时候，目的地址是FF02::1:3, 因为后者代表的是所有的 DHCPv6 server.</p>
<p>今天有学生问的问题还是很犀利的： 问题是：为什么使用了DHCPv6了，我们还是需要发送这些 RA 之类的信息？ 我无法作答。</p>
<p>另一个问题是：有一组学生做DHCP的时候，非常奇怪，他们观察到了 client给relais(routor)发送的 solicte, 也确实看到了，router给DHCP serveur 转发的 soliste, DHCP serveur 看起来也确实是给 router 发送 transmit advertise了，但是workflow就卡在了这一步。。。后来进一步试验发现，在 DHCP server 上我们没有办法 ping6 通 router 的 virtual interface 0/1.101 反之却可以！使用什么命令？没想到这Cisco路由器里，即使是ping一个IPv6的地址，依然用的是ping命令。可能不同的Router型号，最后使用的命令不同的</p>
<p>后来学生们自己发现了问题，就是eth1接口在一开始的时候就被配置上了 global ip v6 的地址，所以ping router的时候，貌似使用的是这个地址！所以无法工作！！</p>
<p>他们后来删除了给 eth1 配置的 IPv6地址，一切工作正常。</p>
<p>有组学生比较懒，在Banc4上没有删除之前学生的工作，方便了他们但是给我造成了很大的麻烦！！！ 比如不知道为什么，他们的 PC du serveur 上 eth1 被分配了 公共IPv6的地址，但是 eth0 却一直没有自动生成 Global IPv6 address, 最后我的解决方案是：让他们先把两个网卡都关掉，然后只开启 eth0, 然后等待 20 秒左右，之后果然 eth0 被分配了 IPv6 地址，然后再开启 eth1, 并且删除掉其上的 <span class="citation" data-cites="IP">@IP</span>，因为 eth1 上的 <span class="citation" data-cites="IP">@IP</span> 会影响之后的实验。那么，我困惑的是，eth1所在的端口明明被配置成了 monitoring, 并且在 VLAN1 上？为什么会被配置一个 IPv6的地址？</p>
<p>在本次TP中，我们使用如下命令来禁止一些 IPv6的功能（在eth1上），我们使用如下命令: echo 0 &gt; /proc/sys/net/ipv6/conf/eth1/accept_ra</p>
<p>首先需要知道accept_ra是个啥，这个链接解释了此变量的作用： http://www.tldp.org/HOWTO/Linux+IPv6-HOWTO/proc-sys-net-ipv6..html 我概括一下，这个变量的是一个布尔类型的，如果被设置为真，则会接受 Router 发送的 RA 信心，并且据此来配置自己的 Global IPv6 地址。如果设置为假（即数值0），此接口不再接受 来自 routor 的RA。也就没有办法采用自动模式配置 IPv6 的地址了。</p>
<p>有一个问题：A quel groups multicast est abonne le routeur？ 答案是：FF02::1 FF02::2 FF02::XXXX::XXXX (Multicast solicite) 什么是 Multicast solicite？为什么要有这种多播地址？</p>
<p>有一组学生遇到了个我无法解决的问题：PC1（作为DHCPv6 server）配置正常，工作正常，PC2（作为DHCPv6 client）配置正常，工作正常。但是Wireshark中观察到了 PC2向Cisco Router发出的 SOLICIT message, 但是奇怪的是，并没有观察到 Router relay的 SOLICIT message（to PC1）啊，但是查看了下 Router的配置，显示一切正常啊。</p>
<p>=&gt; Google is your teacher. 再我准备放弃的时候，突然想到，不如最后google一下，看看有木有什么解决方案。在这个帖子[https://supportforums.cisco.com/document/118551/stateful-dhcpv6-relay-configuration-example]中, 终于找到了线索。貌似Router没有被指明Relay的地址是哪里啊？也是啊，管理员如果不明确说明relay的地址，那么Router在接到SOLICIT message的时候，它又如何知道这个SOLICIT message该转发至何处呢？</p>
<p>还有学生问我：在思科路由器配置完毕，PC1上的 DHCPv6的 server 已经运转起来，为啥进行PC1上的 server里的output停在 skip the blabla...上了呢？ 答案是：不要忘记了运行 PC2上的DHCPv6的client软件啊。。。即使在IPv6下，DHCP request可是不会自己自主进行的。。。</p>
<p>passion process vs uniform distribution.</p>
<p>mais en cadre...</p>
<p>ratasuk date rate paler citation... limitation de vitesse....</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2016/10/22/TP-Ethernet-md/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/10/22/TP-Ethernet-md/" class="post-title-link" itemprop="url">Ethernet 交换实验准备工作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-10-22 00:52:33" itemprop="dateCreated datePublished" datetime="2016-10-22T00:52:33+08:00">2016-10-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-25 18:27:10" itemprop="dateModified" datetime="2019-03-25T18:27:10+08:00">2019-03-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="生成树算法">生成树算法</h1>
<p>介绍下，计算机科学中的经典算法。理论部分</p>
<h1 id="交换机中生成树算法工作原理">交换机中生成树算法工作原理</h1>
<p>概括来讲，STP的工作流程可以分为三个阶段： * Root Brideg 选举 * Root Port (for non-root bridge) 选举 * Designated Port 选举 - 【http://www.omnisecu.com/cisco-certified-network-associate-ccna/how-spanning-tree-protocol-stp-select-designated-port.php】 - 这个帖子对Designated Port的选举给出了非常详细的解释</p>
<p>以下帖子对STP原理部分 给出了非常 【https://www.pluralsight.com/blog/software-development/spanning-tree-protocol-tutorial】</p>
<p>以后最好 保留一些 STP 的traces，用以展示STP协议发送的packet的内容，比如有没有IP层？ 无图无真相。 For the election of the Root Bridge (bridge is equivalent to Switch), the one that will be the initial point of reference, switches manipulate and analyze the Root Bridge ID and Sender Bridge ID fields. Both of these fields consist of a six byte MAC address header and a two byte Bridge Priority header. The switch with the smallest Bridge Priority is automatically elected as the Root Bridge. If Bridge Priority is the same on all switches then the switch with the smaller MAC address is elected as the Root Bridge.</p>
<p>在 交换机 默认配置下，据说只有ARP diffusion 通过，那么发出请求的机器是如何知道 对应IP地址的MAC地址的呢？</p>
<p>对这句话也不是很理解，</p>
<p>il est en full duplex, donc le protocole CSMA/CD est désactivé. 我想那是因为 full duplex 是因为 发送还有接受方，走的是不同的channel(比如不同的频率)，所以根本不需要运行 CSMA/CD 协议 il est en half duplex, donc le protocole CSMA/CD est activé. 因为采用的是半双工，所以 发送以及接受，占用的都是同样的channel. 那么当然需要一些 冲突避免机制。</p>
<p>在命令行模式下 show interfaces status 注意比较这俩命令的区别： show interfaces status show interfaces show interface 端口名字 一个是以列表形式把所有interfaces的信息汇集起来显示出来，一个是把每个interface的信息详细地显示出来， 而show interface 端口名字 则是只详细显示一个端口的信息</p>
<h1 id="tp-中遇到的问题">TP 中遇到的问题</h1>
<h2 id="路由器-and-mac">路由器 and MAC</h2>
<p>实际上，一个交换机并不一定只具有一个 MAC 地址。比如为了支持 Spanning Tree Protocol (STP)，交换机的每个接口就需要有一个专属的M AC 地址。我们以 Telecom Bretagne 实验室的配置情况为例：该实验采用的是 Cisco Catalyst 3560 交换机。该交换机配备有8个 FastEthernet端口以及1个 GigaEthernet 端口。我们可以通过如下命令查看下， 这9个端口的MAC地址： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Switch#show mac-address-table</span><br><span class="line">          Mac Address Table</span><br><span class="line">-------------------------------------------</span><br><span class="line"></span><br><span class="line">Vlan    Mac Address       Type        Ports</span><br><span class="line">----    -----------       --------    -----</span><br><span class="line"> All    0100.0ccc.cccc    STATIC      CPU</span><br><span class="line"> All    0100.0ccc.cccd    STATIC      CPU</span><br><span class="line"> All    0180.c200.0000    STATIC      CPU</span><br><span class="line"> All    0180.c200.0001    STATIC      CPU</span><br><span class="line"> All    0180.c200.0002    STATIC      CPU</span><br><span class="line"> All    0180.c200.0003    STATIC      CPU</span><br><span class="line"> All    0180.c200.0004    STATIC      CPU</span><br><span class="line"> All    0180.c200.0005    STATIC      CPU</span><br><span class="line"> All    0180.c200.0006    STATIC      CPU</span><br><span class="line"> All    0180.c200.0007    STATIC      CPU</span><br><span class="line"> All    0180.c200.0008    STATIC      CPU</span><br><span class="line"> All    0180.c200.0009    STATIC      CPU</span><br><span class="line"> All    0180.c200.000a    STATIC      CPU</span><br><span class="line"> All    0180.c200.000b    STATIC      CPU</span><br><span class="line"> All    0180.c200.000c    STATIC      CPU</span><br><span class="line"> All    0180.c200.000d    STATIC      CPU</span><br><span class="line"> All    0180.c200.000e    STATIC      CPU</span><br><span class="line"> All    0180.c200.000f    STATIC      CPU</span><br><span class="line"> All    0180.c200.0010    STATIC      CPU</span><br><span class="line"> All    ffff.ffff.ffff    STATIC      CPU</span><br><span class="line">   1    0008.e3ff.fc28    DYNAMIC     Gi0/1</span><br><span class="line">   1    000a.5e3f.61b0    DYNAMIC     Gi0/1</span><br><span class="line">   1    000a.f716.45f6    DYNAMIC     Gi0/1</span><br><span class="line">   1    0021.1cb9.8981    DYNAMIC     Gi0/1</span><br><span class="line">   1    0021.566a.0001    DYNAMIC     Gi0/1</span><br><span class="line">   1    0800.27c6.3745    DYNAMIC     Gi0/1</span><br><span class="line">   1    f029.2973.fd17    DYNAMIC     Gi0/1</span><br><span class="line">Total Mac Addresses for this criterion: 27</span><br></pre></td></tr></table></figure></p>
<p>STP的第一步是选择 Root Bridge, 选择标准是选择 Priority 最小的那个，如果所有的交换机的 Priority 的值都一样，那么选择 MAC 地址最小的那个。这里面，参与比较的 MAC 地址是交换机本身的 MAC 地址，而不是某个端口的 MAC 地址 （这一点，我有待确认，应该是这样的）。 所以我们可以通过命令 show spanning-tree 来查看 STP 有关的数据（其中必然其本身的 MAC 地址以及 Root Bridge MAC 地址）： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Switch#show spanning-tree</span><br><span class="line">VLAN0001</span><br><span class="line">  Spanning tree enabled protocol ieee</span><br><span class="line">  Root ID    Priority    32769</span><br><span class="line">             Address     0021.1cb6.9880</span><br><span class="line">             This bridge is the root</span><br><span class="line">             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec</span><br><span class="line"></span><br><span class="line">  Bridge ID  Priority    32769  (priority 32768 sys-id-ext 1)</span><br><span class="line">             Address     0021.1cb6.9880</span><br><span class="line">             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec</span><br><span class="line">             Aging Time 300</span><br><span class="line"></span><br><span class="line">Interface        Role Sts Cost      Prio.Nbr Type</span><br><span class="line">---------------- ---- --- --------- -------- --------------------------------</span><br><span class="line">Gi0/1            Desg FWD 19        128.1    Shr</span><br><span class="line">Fa0/1            Desg FWD 19        128.2    P2p</span><br><span class="line">Fa0/2            Desg FWD 19        128.3    P2p</span><br><span class="line">Fa0/4            Desg FWD 19        128.5    P2p</span><br></pre></td></tr></table></figure></p>
<p>通过 命令 show interface Fa0/1，其输出如下： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Switch#show interface Fa0/1</span><br><span class="line">FastEthernet0/1 is up, line protocol is up (connected)</span><br><span class="line">  Hardware is Fast Ethernet, address is 0021.1cb6.9882 (bia 0021.1cb6.9882)</span><br><span class="line">  MTU 1500 bytes, BW 100000 Kbit, DLY 100 usec,</span><br><span class="line">     reliability 255/255, txload 1/255, rxload 1/255</span><br><span class="line">  Encapsulation ARPA, loopback not set</span><br><span class="line">  Keepalive set (10 sec)</span><br><span class="line">  Full-duplex, 100Mb/s, media type is 10/100BaseTX</span><br><span class="line">  input flow-control is off, output flow-control is unsupported</span><br><span class="line">  ARP type: ARPA, ARP Timeout 04:00:00</span><br><span class="line">  Last input never, output 00:00:00, output hang never</span><br><span class="line">  Last clearing of &quot;show interface&quot; counters never</span><br><span class="line">  Input queue: 0/75/0/0 (size/max/drops/flushes); Total output drops: 0</span><br><span class="line">  Queueing strategy: fifo</span><br><span class="line">  Output queue: 0/40 (size/max)</span><br><span class="line">  5 minute input rate 0 bits/sec, 0 packets/sec</span><br><span class="line">  5 minute output rate 0 bits/sec, 0 packets/sec</span><br><span class="line">     53 packets input, 4450 bytes, 0 no buffer</span><br><span class="line">     Received 29 broadcasts (0 multicasts)</span><br><span class="line">     0 runts, 0 giants, 0 throttles</span><br><span class="line">     0 input errors, 0 CRC, 0 frame, 0 overrun, 0 ignored</span><br><span class="line">     0 watchdog, 4 multicast, 0 pause input</span><br><span class="line">     0 input packets with dribble condition detected</span><br><span class="line">     2169 packets output, 191447 bytes, 0 underruns</span><br><span class="line">     0 output errors, 0 collisions, 1 interface resets</span><br><span class="line">     0 babbles, 0 late collision, 0 deferred</span><br><span class="line">     0 lost carrier, 0 no carrier, 0 PAUSE output</span><br><span class="line">     0 output buffer failures, 0 output buffers swapped out</span><br></pre></td></tr></table></figure></p>
<p>我们不妨再看一看, show interface Ga0/1 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Switch#show interface GigabitEthernet0/1</span><br><span class="line">GigabitEthernet0/1 is up, line protocol is up (connected)</span><br><span class="line">  Hardware is Gigabit Ethernet, address is 0021.1cb6.9881 (bia 0021.1cb6.9881)</span><br><span class="line">  MTU 1500 bytes, BW 100000 Kbit, DLY 100 usec,</span><br><span class="line">     reliability 255/255, txload 1/255, rxload 1/255</span><br><span class="line">  Encapsulation ARPA, loopback not set</span><br><span class="line">  Keepalive not set</span><br><span class="line">  Half-duplex, 100Mb/s, link type is auto, media type is 10/100/1000BaseTX</span><br><span class="line">  input flow-control is off, output flow-control is unsupported</span><br><span class="line">  ARP type: ARPA, ARP Timeout 04:00:00</span><br><span class="line">  Last input 00:00:20, output 00:00:01, output hang never</span><br><span class="line">  Last clearing of &quot;show interface&quot; counters never</span><br><span class="line">  Input queue: 0/75/0/0 (size/max/drops/flushes); Total output drops: 0</span><br><span class="line">  Queueing strategy: fifo</span><br><span class="line">  Output queue: 0/40 (size/max)</span><br><span class="line">  5 minute input rate 0 bits/sec, 0 packets/sec</span><br><span class="line">  5 minute output rate 0 bits/sec, 0 packets/sec</span><br><span class="line">     1057 packets input, 155540 bytes, 0 no buffer</span><br><span class="line">     Received 508 broadcasts (0 multicasts)</span><br><span class="line">     0 runts, 0 giants, 0 throttles</span><br><span class="line">     0 input errors, 0 CRC, 0 frame, 0 overrun, 0 ignored</span><br><span class="line">     0 watchdog, 481 multicast, 0 pause input</span><br><span class="line">     0 input packets with dribble condition detected</span><br><span class="line">     1652 packets output, 128172 bytes, 0 underruns</span><br><span class="line">     0 output errors, 0 collisions, 1 interface resets</span><br><span class="line">     0 babbles, 0 late collision, 0 deferred</span><br><span class="line">     0 lost carrier, 0 no carrier, 0 PAUSE output</span><br><span class="line">     0 output buffer failures, 0 output buffers swapped out</span><br></pre></td></tr></table></figure></p>
<p>其实，命令 show version 返回的信息之中，也是包含有 switch 的 MAC 地址的，比如如下输出：</p>
<p>（需要补充。。。）</p>
<p>在配置模式下, 输入如下命令： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">conf t</span><br><span class="line">monitor session 1 source plan 1</span><br><span class="line">monitor session 1 destination interface Fa0/3</span><br><span class="line">exit</span><br></pre></td></tr></table></figure></p>
<p>在命令行模式下，继续输入：write</p>
<p>为了完成本次TP，还需要熟悉工具 Iperf 的用法</p>
<h2 id="stp-收敛问题">STP 收敛问题</h2>
<p>虽然采用 STP 可以有效避免 交换机环路问题，但是 STP 协议的收敛时间 通常为 40-50 秒。这 STP 收敛时间期间， 所有的交换机是无法进行数据转发的，对于大型网络来说，也许拓扑结构的改变是时有发生的（比如插拔网线），如果每次STP都需要40-50秒的时间来处理这种改变，那么带来的延时对用户来说是无法忍受的。所以，在什么网络中，什么情况下使用 STP 需要慎重考虑。</p>
<h2 id="关于如何删除更改-vlan">关于如何删除/更改 VLAN</h2>
<p>有些学生在 TP 开始的时候，忘记了初始化switch，尤其在制造 Loopback 观察 STP如何关闭port的时候。有可能会因为因为不同的端口位于不同的VLAN上导致看不到预想的情况。这种情况下，我们需要知道，如何在 switch 更改/删除 VLAN。 以下命令，可以更改VLAN <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interface range gigabitEThernet 1/0/3-6</span><br><span class="line">switchport access vlan 1</span><br><span class="line">exit</span><br></pre></td></tr></table></figure></p>
<p>以下命令，可以删除VLAN <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">no vlan 192</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2015/08/19/LTE-Basics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/08/19/LTE-Basics/" class="post-title-link" itemprop="url">LTE-Basics</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-08-19 18:32:09" itemprop="dateCreated datePublished" datetime="2015-08-19T18:32:09+08:00">2015-08-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-25 18:27:10" itemprop="dateModified" datetime="2019-03-25T18:27:10+08:00">2019-03-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>此贴是一个草稿性质的帖子，目的是记录下我对LTE的基础知识的理解和总结，若干时间后，此贴必将是一个宝贵的财富。</p>
<p>When a UE has packets to transmit, it performs random access (RA) during an allowable time slot. This timeslot is called an Access Grant Time Interval(ACGI) or RA opportunity (i.e., RA-slot).</p>
<p>The minimum resource scheduling unit for downlink and uplink transmission is referred to as an RB. One RB consists of 12 subcarriers (180 kHz) in the frequency domain and one subframe (1 ms) in the time domain. Details of the LTE-A physical layer is provided in [3GPP TS 36.300 V11.2.0, “Evolved Universal Terrestrial Radio Access (E-UTRA) and Evolved Universal Terrestrial Radio Access Network (EUTRAN), Overall Description,” June 2012., Sec. 5], and a brief review of M2M scheduling and signaling over LTE-A is provided in [4]. RA allows MTC devices to request a connection initialization. The RA-slots have bandwidth corresponding to six RBs (1.08 MHz) in the frequency domain, and the basic duration of an RA-slot is 1 ms in the time domain.</p>
<p>In LTE-Advanced networks, radio resources are usually divided into resource blocks (RBs) along the frequency domain per time slot, which is also referred to as subchannels in radio resource allocation.</p>
<p>In the LTE-A, RA can be used for initial access to establish a radio link, resource request when no uplink radio resource has been allocated, scheduling request if no dedicated scheduling request has been configured (i.e., no dedicated physical uplink control channel [PUCCH] is available), and re-establishing a radio link after failure.</p>
<p>在物理层方面 ： In order to meet the requirements of LTE- Advanced such as peak data rates of up to 1 Gb/s, more spectrum bands are needed. Besides the existing carriers for 3G networks, spectrum bands located at 450–470 MHz, 698–790 MHz, 2.3–2.4 GHz, and 3.4–3.6 GHz can be used for the deployment of LTE and LTE-Advanced networks. Moreover, LTE-Advanced has been defined to support scalable carrier bandwidth exceeding 20 MHz, potentially up to 100 MHz, in a variety of carriers for deployments.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2015/08/02/ssh-tuto/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/08/02/ssh-tuto/" class="post-title-link" itemprop="url">Simplify your life with SSH</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-08-02 14:22:43" itemprop="dateCreated datePublished" datetime="2015-08-02T14:22:43+08:00">2015-08-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-24 02:23:28" itemprop="dateModified" datetime="2020-04-24T02:23:28+08:00">2020-04-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SSH/" itemprop="url" rel="index"><span itemprop="name">SSH</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="background-and-motivation">Background and motivation</h1>
<p>I have one Ubuntu Linux server (I will call it as remote server in the following of this post) in my office, which is behind a NAT router and restrictive rewall. Now I want to SSH to the remote server while I'm away from my office. How should I do?</p>
<figure>
<img src="/2015/08/02/ssh-tuto/reverse_ssh_illustration.png" alt="Reverse SSH Tunnel Illustration"><span class="image-caption">Reverse SSH Tunnel Illustration</span><figcaption>Reverse SSH Tunnel Illustration</figcaption>
</figure>
<h1 id="part-1-reverse-ssh-tunnel">Part 1: Reverse SSH Tunnel</h1>
<p>关于 SSH port forwaring 概念的介绍。这个帖子: <code>http://www.linux-france.org/prj/edu/archinet/systeme/ch13s04.html</code> 以及 <code>https://www.ssh.com/ssh/tunneling/example</code>讲的还挺好的。</p>
<p>SSH portforwarding will certainly be an option. However, port forwarding can become tricky if you are dealing with multiple nested NAT environment. Besides, it can be interfered with under various ISP-specific conditions, such as restrictive firewalls which block forwarded ports, or carrier-grade NAT which shares IPv4 addresses among users.</p>
<p>One alternative to SSH port forwarding is reverse SSH tunneling. The concept of reverse SSH tunneling is simple. For this, you will need another host (so-called "relay host") outside your restrictive office network, which you can connect to via SSH from where you are. You could set up a relay host using a VPS instance with a public IP address. What you do then is to set up a persistent SSH tunnel from the remote server in your office network to the public relay host. With that, you can connect "back" to the remote server from the relay host (which is why it's called a "reverse" tunnel). As long as the relay host is reachable to you, you can connect to your remote server wherever you are, or however restrictive your NAT or firewall is in your office network.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -fN -R &lt;your_selected_port&gt;:localhost:22 &lt;relayserver_username&gt;@relayserver</span><br></pre></td></tr></table></figure>
<p>Some explanations about the above command: * term <code>&lt;your_selected_port&gt;</code> is any arbitrary unoccupied port number (e.g. 10222) that you can choose on the relay server(for exampler, your VPS). Similarly, term <code>&lt;relayserver_username&gt;</code> should be replaced by your user name on the relay server; * with the option combination <code>fN</code>, SSH will go right into the background once you successfully authenticate with an SSH server (in this case, relay server). This option is useful when you do not want to execute any command on a remote SSH server, and just want to forward ports; * option <code>R</code>, along side with string <code>&lt;your_selected_port&gt;:localhost:22</code> defines a reverse SSH tunnel. It forwards traffic received by port <code>&lt;your_selected_port&gt;</code> of relay server to port 22 of homeserver.</p>
<p>Now I will log into my VPS with root user and check the opening port on my VPS:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;user_name&gt;@&lt;your_machine_name&gt;:~# netstat -autn | grep 22222</span><br><span class="line">tcp        0      0 127.0.0.1:22222         0.0.0.0:*               LISTEN</span><br><span class="line">tcp6       0      0 ::1:22222               :::*                    LISTEN</span><br></pre></td></tr></table></figure>
<p>Now that you can ssh into your remote server with the following command: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@vps639023:~# ssh -p &lt;your_selected_port&gt; &lt;username_at_remote_server&gt;@localhost</span><br></pre></td></tr></table></figure></p>
<p>, where <code>&lt;your_selected_port&gt;</code> should be replaced by port number such as 22222.</p>
<h2 id="dynamic-port-forwarding">Dynamic port forwarding</h2>
<p>可以用来翻墙 但是网速。。。很慢。。。</p>
<h2 id="special-case-outgoing-port-22-i.e.-for-ssh-is-filtered-by-firewall">Special case: outgoing port 22 (i.e. for SSH) is filtered by firewall</h2>
<p>During the establishment of reverse SSH tunnel (i.e. from remote server to relay server), it is very possible that the remote server has no outbound SSH access to a machine on the public Internet (in my case: my VPS instance), because port <code>22</code> is blokced by restrictive firewall. With port <code>22</code> open allows malicious attackers establishing reverse tunnel and bypassing completely bypassing the firewall. Thus, in practice, some enterprise may block the outbound port 22 for the sake of network security. In this case, how we could establish reverse SSH tunnel?</p>
<p>The answer is yes if: * the outbound port 443 (i.e. for HTTPS) is not filtered by the firewall in the network of remote server; * web server (Apache2 or Nginx), SSH server and SSLH<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> are installed on the relay server. Please refer to~ for more details.</p>
<h2 id="compilation-and-installation-of-sslh">Compilation and Installation of SSLH</h2>
<ol type="1">
<li>Download source code</li>
<li>Install pre-requisites: take Debian-based system (e.g. Ubuntu 16.04) as example libwrap0-dev libsystemd-dev libcap-dev libbsd-dev</li>
<li>Compilation and Installation</li>
</ol>
<p>Provided that the operations on the relay server side are done, we now log into the home server can establish a reverse SSH tunnel with relay server with the following command: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -fN -R 10022:localhost:22 root@51.77.215.18 -p 443</span><br></pre></td></tr></table></figure></p>
<p>Some explanaition about above command: * with option <code>p</code>, the destination port of SSH is set as 443, instead of 22, which is the default port for SSH. In other words, remote server will establish ssh connection with destination port <code>443</code>, which won't be blocked by firewall.</p>
<h1 id="part-3-execute-command-on-remote-server-over-ssh-connection">Part 3: execute command on remote server over SSH connection</h1>
<p>在实际使用Linux的过程中，我们经常会碰到这样的场景：登录到远程服务器上，执行某个命令，比如查看下某个文件夹下的目录，然后再退出。常规的思路是： 1. Run the command "ssh username@host" to log in to the system 2. At the command prompt, run "top" to view process activity on the remote system 3. Exit top and be dropped to the remote command line 4. Type "Exit" to close the command</p>
<p>SSH已经考虑到了用户的这种需求，可以一条命令完成上述四步：<code>ssh -t username@host 'top'</code>。命令中的选项<code>-t</code>, 作用是分配一个为terminal界面给当前命令，允许用户进行一些交互。比如当你需要执行需要sudo的命令时，<code>-t</code>保证了当需要输入管理员密码的时候，可以通过当前的terminal输入密码。</p>
<h1 id="part-2-enable-ssh-connection-without-password">Part 2: Enable SSH connection without password</h1>
<p>There are some issues with this password based authentication, mainly, it allows brute-force password guessing. SSH provides better authentication process: <code>SSH Public key access</code>, which allows to password-less log in.</p>
<p>To this end, first you have to generate a public and private key pair in your relay server, namely your VPS <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@vps639023:~# ssh-keygen -t rsa -P &apos;&apos;</span><br></pre></td></tr></table></figure></p>
<p>Then, you have to transfer the newly generated public key to your target server: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@vps639023:~# ssh-copy-id -i .ssh/id_rsa.pub &lt;user_at_remote_server&gt;@localhost -p 22222</span><br></pre></td></tr></table></figure></p>
<p>Note that command <code>ssh-copy-id</code> relies on scp that uses port 22 as default port. Here we explicitly specify here the used port is 22222. Without option <code>i</code>, <code>ssh-copy-id</code> will copy whatever keys it finds to the remote (might be multiple)!</p>
<h2 id="一些疑问">一些疑问：</h2>
<ol type="1">
<li>产生公钥/私钥对的时候，会被询问是否设置<code>passphrase</code>, 这个和<code>password</code>有何异同(比如会比password更长)? 什么时候需要设置<code>passphrase</code>? 设置了<code>passphrase</code>是否还是真正的<code>password-less</code>登录？</li>
<li><code>SSH agent</code> 又是啥？和SSH 客户端又有何不同呢？SSH <code>agent forwarding</code> 是什么？ <code>SSH agent</code> 第一个用途是用来解决 <code>unlocking private key with a secret passphrase upon each connection</code> 这个问题的。即，采用被<code>passphrase</code>保护的私钥登录remote server时候(<code>ssh -i path/to/private-key remote-server</code>)时, 虽然不再需要输入登录远程服务器所需要的密码，但是我们需要输入<code>passphrase</code>才能获得对本地私钥的使用权！这其实不就是另一种形式的密码么，而且每次登录都需要输入更长的字符！根本不是我们想要的password-less登录。<code>ssh-agent</code>可以解决这个问题。执行<code>ssh-add path/to/your/private-key</code>, 之后在执行<code>ssh -i path/to/private-key remote-server</code>。第一次还需要输入<code>passphrase</code>，之后再登录remoter-server就不再需要输入<code>passphrase</code>了，因为指定的私钥就会被存储在<code>ssh-agent</code>中(私钥应该是存储在内存中了)。</li>
</ol>
<p>SSH agent forwarding can be used to make deploying to a server simple. It allows you to use your local SSH keys instead of leaving keys (without passphrases!) sitting on your server.</p>
<p>SSH agent forwarding特性有两种方式启用：1）命令行模式下的参数<code>-A</code>, 2）配置文件(如<code>~/.ssh/config</code>)中在相应的Host下，加入directive: <code>ForwardAgent yes</code>。 3.</p>
<h1 id="part-3-how-make-a-tunnel-persistent-autossh_ssh_tunneling">Part 3: How make a tunnel persistent <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></h1>
<p>By persistent I mean, that it is made sure the tunnel will always run. For example, once your ssh connection times out (By server-side timeout), your tunnel should be re-established automatically.</p>
<p>Many NAT firewalls time out idle sessions after a certain period of time to keep their trunks clean. Sometimes the interval between session drops is 24 hours, but on many commodity firewalls, connections are killed after as little as 300 seconds.</p>
<h2 id="ssh-command-option-serveraliveinterval-and-serveralivecountmax">3.1 SSH command option <code>ServerAliveInterval</code> and <code>ServerAliveCountMax</code></h2>
<p>To avoid having your SSH sessions become unresponsive after e.g. 5 minutes, do the following (On Linux machine):</p>
<p>To enable the keep alive system-wide (root access required), edit <code>/etc/ssh/ssh_config</code>; to set the settings for just your user, edit <code>~/.ssh/config</code> (create the file if it doesn’t exist).</p>
<p>Insert the following snipet of code: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">    ServerAliveInterval 300</span><br><span class="line">    ServerAliveCountMax 2</span><br></pre></td></tr></table></figure></p>
<p>Alternatively, you can also make your OpenSSH server keep alive all connections with clients by adding the following to <code>/etc/ssh/sshd_config</code>: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">    ClientAliveInterval 300</span><br><span class="line">    ClientAliveCountMax 2</span><br></pre></td></tr></table></figure></p>
<p>These settings will make the SSH client or server send a null packet to the other side every 300 seconds (5 minutes), and give up if it doesn’t receive any response after 2 tries, at which point the connection is likely to have been discarded anyway.</p>
<p>修改完openssh-server的配置之后，可以采取两种方式使配置生效： <code>sudo service ssh restart</code> # 重启ssh server <code>sudo service ssh reload</code> # 重载ssh server 相关配置</p>
<p>如果你已经安装了openssh-server的话(没有的话,要安装),因为Ubuntu已经使用Upstart来进行管理/etc/init.d里面的任务. 所以<code>/etc/init.d/sshd start</code>已经无效了. 注意: 应该用<code>sudo service ssh start</code>(<strong><em>注意: 是ssh,不是sshd</em></strong>)启动sshd服务,之后可以通过进程查看sshd进程已在运行.</p>
<p> describes how to use different terminal color schema when establishing SSH connection.</p>
<h2 id="autossh">3.2 AutoSSH</h2>
<p>Autossh is a program to start a copy of ssh and monitor it, restarting it as necessary should it die or stop passing traffic.</p>
<p>AutoSSH basic usage: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usage: autossh [-V] [-M monitor_port[:echo_port]] [-f] [SSH_OPTIONS]</span><br></pre></td></tr></table></figure></p>
<p>The important part to remember is that <code>-f</code> (run in background) is not passed to the ssh command, but handled by autossh itself. Apart from that you can then use it just like you would use ssh to create any forward or reverse tunnels.</p>
<p><strong>Note 1</strong>: Before you use autossh, make sure the connection works as expected by trying it with ssh first.</p>
<p><strong>Note 2</strong>: Make sure you use public/private key authentification instead of password-based authentification when you use <code>-f</code>. This is required for ssh as well as for autossh, simply because in a background run a passphrase cannot be entered interactively.</p>
<p>With option <code>-M</code> AutoSSH will continuously send data back and forth through the pair of monitoring ports in order to keep track of an established connection. If no data is going through anymore, it will restart the connection. The specified monitoring and the port directly above (+1) must be free. The first one is used to send data and the one above to receive data on. For example, if you specify 11111 as monitoring port, then 11112 will be automatically used for receving data. You shoul ensure that both ports are unoccupied.</p>
<p>Unfortunately, this is not too handy, as it must be made sure both ports (the specified one and the one directly above) are free (not used). So in order to overcome this problem, there is a better solution:</p>
<p>Options <code>ServerAliveInterval</code> and <code>ServerAliveCountMax</code> of ssh command. They cause the SSH client to send traffic through the encrypted link to the server. This will keep the connection alive when there is no other activity and also when it does not receive any alive data, it will tell AutoSSH that the connection is broken and AutoSSH will then restart the connection.</p>
<p>The AutoSSH man page also recommends the second solution: &gt;-M [:echo_port], &gt;… &gt;In many ways this [ServerAliveInterval and ServerAliveCountMax options] may be a better solution than the monitoring port.</p>
<p>You can disable the built-in AutoSSH monitoring port by giving it a value of 0: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autossh -M 0</span><br></pre></td></tr></table></figure></p>
<p>Additionally you will also have to specify values for <code>ServerAliveInterval</code> and <code>ServerAliveCountMax</code>: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autossh -M 0 -o "ServerAliveInterval 30" -o "ServerAliveCountMax 3"</span><br></pre></td></tr></table></figure></p>
<table>
<colgroup>
<col style="width: 48%">
<col style="width: 51%">
</colgroup>
<thead>
<tr class="header">
<th>Option</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ServerAliveInterval</td>
<td style="text-align: left;">ServerAliveInterval: number of seconds that the client will wait before sending a null packet to the server (to keep the connection alive). Default: 30</td>
</tr>
<tr class="even">
<td>ServerAliveCountMax</td>
<td style="text-align: left;">Sets the number of server alive messages which may be sent without ssh receiving any messages back from the server. If this threshold is reached while server alive messages are being sent, ssh will disconnect from the server, terminating the session. Default: 3</td>
</tr>
</tbody>
</table>
<h1 id="part-4-enable-the-tunnel-at-system-boot">Part 4: Enable the tunnel at system boot</h1>
<p>To make sure that even the remote server is restarted, we still have this reverse SSH tunnel, we configure that this server executes this command at boot time.</p>
<p>In recent years, Linux distributions have increasingly transitioned from other <code>init</code> systems to <code>systemd</code>. The systemd suite of tools provides a fast and flexible init model for managing an entire machine from boot onwards. Refer to <a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> for a quick tutorial for systemd.</p>
<h2 id="under-ubuntu-system">4.1 Under Ubuntu system</h2>
<h3 id="modify-etcrc.local">Modify <code>/etc/rc.local</code></h3>
<p>We are going to edit the <code>/etc/rc.local</code> file. This script normally does nothing, but gets executed at boot. If you make any errors in this script, your machine might not boot so make sure to do this correctly.</p>
<p>Add the following instruction with your preferred editor into <code>/etc/rc.local</code> % credit:https://tex.stackexchange.com/questions/116534/lstlisting-line-wrapping <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autossh -M 10984 -N -f -o &quot;PubkeyAuthentication=yes&quot; -o &quot;PasswordAuthentication=no&quot; -i /path/to/.ssh/id_rsa -R 6666:localhost:22 remy@middleman -p 2222 &amp;</span><br></pre></td></tr></table></figure></p>
<p>We have three new things in this command:</p>
<ul>
<li><code>-N</code>: Do not execute a command on the middleman machine</li>
<li><code>-f</code>: drop in the background</li>
<li><code>&amp;</code>: Execute this command but do not wait for output or an exit code. If this is not added, your machine might hang at boot.</li>
</ul>
<p>Save the file, and as make it executable if necessary: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /etc/rc.local</span><br></pre></td></tr></table></figure></p>
<h3 id="use-cron-command">Use <code>cron</code> command</h3>
<p>TBD</p>
<h3 id="create-systemd-service">Create systemd service</h3>
<p>If you want a permanent SSH tunnel already created during boot time, you will (nowadays) have to create a systemd service and enable it. There is however an important thing to note about systemd and <code>AutoSSH: -f</code> (background usage) already implies <code>AUTOSSH_GATETIME=0</code>, however <code>-f</code> is not supported by systemd.</p>
<blockquote>
<p>http://www.freedesktop.org/software/systemd/man/systemd.service.html […] running programs in the background using “&amp;”, and other elements of shell syntax are not supported.</p>
</blockquote>
<p>So in the case of systemd we need to make use of AUTOSSH_GATETIME. Let’s look at a very basic service:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># The following command should be run with root priviledge</span><br><span class="line">$ vim /etc/systemd/system/revtun2vps.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=AutoSSH managed reverse SSH tunnel service to bind local port 22 with port 22222 on VPS server</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Environment=&quot;AUTOSSH_GATETIME=0&quot;</span><br><span class="line">ExecStart=/usr/bin/autossh -M 0 -o &quot;ServerAliveInterval 30&quot; -o &quot;ServerAliveCountMax 3&quot; -N -R 22222:localhost:22 &lt;user_name&gt;@&lt;vps.host.name&gt; -p 443</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>One can refer to <a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> for more details about the directives such as <code>after=</code>, <code>WantedBy</code>.</p>
<p>Note 1: 以上systemd service将会以root身份启动autossh进程，如果root身份从未跟VPS建立过SSH connection的话，通过<code>systemctl status revtun2vps.service</code>, 将会看到SSH connection实际上并没有被创建，由于<code>host key verification failed</code>的错误。最后我的解决办法是，<code>sudo su</code> 切换为root，然后<code>ssh-keygen</code>创建root专属的公私钥，最后再<code>ssh-copy-id -i .ssh/id_rsa.pub root@vps.ip.addr -p 443</code>使得root可以免密登录VPS. 之后再启动<code>revtun2vps</code> service，将会顺利创建reverse tunnel了。</p>
<p>虽然我之前一直都以qsong的身份在和VPS建立SSH连接, 但是 VPS 的host key确实被保存在/home/qsong/.ssh/known_hosts文件中的，当我第一次以root身份去发起连接的时候，root用户的工作目录(即/root)下并没有known_hosts这么一个文件！</p>
<p>问题：难道 systemd service 启动的 autossh 难道不需要指明运行在后台？</p>
<p>Tell systemd that we have added some stuff: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure></p>
<p>Start the service: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start revtun2vps.service</span><br></pre></td></tr></table></figure></p>
<p>Enable during boot time: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable revtun2vps.service</span><br><span class="line">root@vps273731:~# systemctl enable revtun2vps.service</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/revtun2vps.service to /etc/systemd/system/revtun2vps.service.</span><br></pre></td></tr></table></figure></p>
<p>Once the service is correctly started: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">qsong-P650SE# systemctl status revtun2vps.service</span><br><span class="line">● revtun2vps.service - AutoSSH managed reverse SSH tunnel creation service to bind local 22 with port 22222 on remote VPS server</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/revtun2vps.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since ven. 2019-05-17 18:23:37 CEST; 11s ago</span><br><span class="line"> Main PID: 21307 (autossh)</span><br><span class="line">    Tasks: 2</span><br><span class="line">   Memory: 1.3M</span><br><span class="line">      CPU: 19ms</span><br><span class="line">   CGroup: /system.slice/revtun2vps.service</span><br><span class="line">           ├─21307 /usr/lib/autossh/autossh -M 0 -o ServerAliveInterval 30 -o ServerAliveCountMax 3 -N -R 22222:localhost:22 root@55.77.222.118 -p 443</span><br><span class="line">           └─21319 /usr/bin/ssh -o ServerAliveInterval 30 -o ServerAliveCountMax 3 -N -R 22222:localhost:22 -p 443 root@55.77.222.118</span><br><span class="line"></span><br><span class="line">mai 17 18:23:37 qsong-P650SE systemd[1]: Started AutoSSH managed reverse SSH tunnel creation service to bind local 22 with port 22222 on remote VPS server.</span><br><span class="line">mai 17 18:23:37 qsong-P650SE autossh[21307]: port set to 0, monitoring disabled</span><br><span class="line">mai 17 18:23:37 qsong-P650SE autossh[21307]: starting ssh (count 1)</span><br><span class="line">mai 17 18:23:37 qsong-P650SE autossh[21307]: ssh child pid is 21319</span><br></pre></td></tr></table></figure></p>
<h2 id="under-mac-osx">4.2 Under Mac OSX</h2>
<p>On Mac, the alternative to service and systemctl is launchctl. Mac OSX relies on <code>launchctl</code> to manage the services that need to be started at boot time. Unfortunately, Systemd, which systemctl is a part of, is a service manager designed specifically for Linux and uses interfaces and constructs specific to it such as <code>cgroups</code>. There is no port of it to Mac OS.</p>
<p><code>launchd</code>, a unified service-management framework, starts, stops and manages daemons, applications, processes, and scripts in mac OS. <code>launchd</code> has two main tasks. The first is to boot the system, and the second is to load and maintain services.</p>
<h1 id="part-5-simplify-your-life-with-an-ssh-config-file-ssh_config_tuto">Part 5: Simplify your life With an SSH Config File <a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></h1>
<p>Create a SSH config file under path <code>~/.ssh/config</code>. This is the per-user configuration file. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> My personal VPS serves as a broker <span class="keyword">for</span> connection from my Mac to my Ubnuntu server</span></span><br><span class="line">Host my_vps</span><br><span class="line">  HostName 51.77.215.18</span><br><span class="line">  User root</span><br><span class="line">  Port 443</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> my remote Ubuntu server</span></span><br><span class="line">Host ubuntu_server</span><br><span class="line"><span class="meta">#</span><span class="bash"> example: ProxyCommand ssh -q my_vps nc -qo hostname.or.IP.address.internal.machine 22</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> change hostname.or.IP.address.internal.machine and port 22 to machine you like to reach</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">if</span> you would from the `my_vps` machine</span></span><br><span class="line">ProxyCommand ssh -q my_vps nc -q0 localhost 22222</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> my vagrant vm running <span class="keyword">in</span> my ubuntu_server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the following ssh <span class="built_in">command</span> options are obtained from `ps aux | grep ssh` on my ubuntu_server.</span></span><br><span class="line">Host sfc103-vm</span><br><span class="line">  ProxyJump qsong@ubuntu_server</span><br><span class="line">  HostName 127.0.0.1</span><br><span class="line">  User vagrant</span><br><span class="line">  Port 2222</span><br><span class="line">  LogLevel FATAL</span><br><span class="line">  Compression yes</span><br><span class="line">  DSAAuthentication yes</span><br><span class="line">  IdentitiesOnly yes</span><br><span class="line">  StrictHostKeyChecking no</span><br><span class="line">  UserKnownHostsFile /dev/null</span><br><span class="line">  IdentityFile ~/Documents/sfc-patch/sfc-demo/sfc103/.vagrant/machines/odl/virtualbox/private_key</span><br></pre></td></tr></table></figure></p>
<p>Also note that now you have a single SSH host target name for it, you can use this in other applications as well. E.g.: SCP to copy files. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp somefile user@internalmachine:~/</span><br></pre></td></tr></table></figure></p>
<p>Copy your public key from A directly to C: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i .ssh/id_rsa.pub qsong@ubuntu_server</span><br></pre></td></tr></table></figure></p>
<p>This allows one to SSH from A to C without password.</p>
<p>On my macbook pro, I have <code>openssh 7.9p1</code> installed. From OpenSSH 7.3, <code>ProxyJump</code> is supported in <code>ssh_config</code>. I find that even though my remote <code>ubuntu_server</code> (having OpenSSH 7.2) have no support for such an option, this does not bother the using of <code>ProxyJump</code> on my macbook pro.</p>
<h1 id="part-6-ssh-connection-with-gui">Part 6: SSH connection with GUI</h1>
<p>This <a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-vnc-on-ubuntu-16-04" target="_blank" rel="noopener">post</a> gives a very detailed tutorial about how to install Xfce and VNC server on Ubuntu 16.04.</p>
<p>One thing we need to indicate is: I have to establish one reverse SSH tunnel with my VPS.</p>
<p>On the Ubunutu server, add the following codes into file <code>~/.ssh/config</code>: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host vnc_tunnel_vps</span><br><span class="line">    HostName &lt;vps.ip.address.or.name&gt;</span><br><span class="line">    User &lt;your-user-name&gt;</span><br><span class="line">    Port 443</span><br><span class="line">    RemoteForward 59000 127.0.0.1:5901</span><br></pre></td></tr></table></figure></p>
<p>Port <code>59000</code> at VPS server will be on state of listening. Any traffic to this port on VPS will be forwarded to port <code>5901</code> on the remote Ubuntu server.</p>
<p>Thus, On the macbook pro, we have to also add some local port forwarding configuration in file <code>~/.ssh/config</code>: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Establish one tunnel between this machine and my vps</span></span><br><span class="line">Host tunnel_vps</span><br><span class="line">  HostName &lt;vps.ip.address.or.name&gt;</span><br><span class="line">  LocalForward 33333 127.0.0.1:22222</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Establish one tunnel to <span class="built_in">bind</span> <span class="built_in">local</span> 59000 with remote 59000 on my vps</span></span><br><span class="line">  LocalForward 59000 127.0.0.1:59000</span><br><span class="line">  User &lt;your-user-name&gt;</span><br><span class="line">  Port 443</span><br></pre></td></tr></table></figure></p>
<p>Note that in the above command, SSH will create two local port forwarding.</p>
<p>If you want to access to the VNC server running on Ubuntu server, you can either install VNC client or use <code>Screen sharing program</code> integrated into Mac OSX.</p>
<p>Open <code>Finder</code> application, click menu <code>Go</code> and further click <code>Connect to Server...</code>. On the prompted window, type the following command: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vnc://127.0.0.1:59000</span><br></pre></td></tr></table></figure></p>
<p>You will be required to type password, which is the one you set when installing VNC server.</p>
<h1 id="part-7-mount-remote-directory-on-a-remote-server-with-sshfs">Part 7: Mount remote directory on a remote server with SSHFS</h1>
<p>If you use SSHFS on MacOS and the end point stops responding or crashes, you need to do new SSHFS connection. You need to either restart your mac or umount the old connection first. I use sshfs to access data on my vmware ( Ubuntu ) – if that restarts, or crashes – I end up with the following error message: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount_osxfuse: mount point /xx/yy/zz is itself on a OSXFUSE volume</span><br></pre></td></tr></table></figure></p>
<p>This post gives the cause and solution<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>. Simply speaking, the remote directory is not correctly unmounted. We need to find its mount point and unmount it another time.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshfs -o defer_permissions root@hostname.or.ip.address:/path/to/your/folder /mnt/path/to/your/mount_point</span><br></pre></td></tr></table></figure>
<ul>
<li>-o <code>defer\_permissions</code>: without this option, we will encounter error <code>permission defined</code> if we try to write something into the mounted directory.</li>
</ul>
<h2 id="problem-description">Problem description</h2>
<p>Now I have three machines: my working laptop (Mac OSX), my remote server (Ubuntu 16.04) and VPS server. I want to mount a directory in my remote Ubuntu server on my working laptop.</p>
<h2 id="fuse-for-os-x">FUSE for OS X</h2>
<p>The first step to using SSHFS is to install <a href="https://osxfuse.github.io/" target="_blank" rel="noopener">FUSE for OS X</a> (There’s a prior version called MacFUSE, you don’t want that). Once installed, reboot your Mac. By itself, FUSE for OS X doesn’t do much, it provides the layer for userspace filesystems, but no filesystems itself, so <a href="https://osxfuse.github.io/" target="_blank" rel="noopener">download</a> (found on the FfOSX page) and install SSHFS as well.</p>
<h2 id="key-idea">key idea</h2>
<p>All one has to do is bind the one local port (e.g. 33333) of my VPS to a port (e.g. 22222) on remote server. The port of remote server is the one used to establish reverse SSH tunnel.</p>
<h2 id="concret-steps">concret steps</h2>
<h3 id="bind-one-local-port-with-port-in-relay-server">1. Bind one local port with port in relay server</h3>
<p>One one terminal and type into the following command: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -L 33333:localhost:22222 &lt;user_on_relay_server&gt;@&lt;relay_server_addr&gt;</span><br></pre></td></tr></table></figure></p>
<p>With above command, one has to keep this terminal window open. If you want to keep this binding running in the background: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ssh -NfL 33333:localhost:22222 &lt;user_on_relay_server&gt;@&lt;relay_server_addr&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Remember to adapt <code>&lt;user_on_relay_server&gt;</code> and <code>&lt;relay_server_addr&gt;</code> for your own case. The <code>-N</code> prevents SSH from executing a command on the remote system. This is useful when just forwarding ports.</p>
<p>If you have a slow network, you may wish to include the <code>-C</code> option in both the ssh and sshfs commands as well to enable compression. Don't bother if you are on a fast network as in the time taken to compress the file and send the smaller version, you can instead just get the uncompressed version quicker.</p>
<h3 id="create-a-local-mount-point-and-mount-the-remote-file-system">2.create a local mount point and mount the remote file system</h3>
<p>Then, mounting the directory <code>my_remote_server:/home/path/to/folder</code> to a local foler for example named <code>pcB</code> on <code>my_working_laptop</code>. First create a mount point: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir /mnt/pcB</span></span><br></pre></td></tr></table></figure></p>
<p>Where you mount it matters as that’s where the drive icon will appear. In the above example, I create the local mount point in the Desktop folder, which makes the drive appear on the Desktop when mounted. The downside of that, is then when the drive is not mounted, you have an empty folder that appear on the Desktop.</p>
<p>Another popular approach is to mount it in <code>/Volumes</code>, where OS X traditionally mounts drives. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir /Volumes/server</span></span><br></pre></td></tr></table></figure></p>
<p>Then mount the folder with the following command: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshfs -o defer_permissions -o port=33333 -o volname=sfc103demo &lt;user_at_my_remote_server&gt;@localhost:/home/path/to/folder /mnt/pcB</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>-o defer_permissions</code>: this option is very important. Without this option, we will encounter error <code>permission defined</code> if we try to write something into the mounted directory.</li>
<li><code>-o volname=Server</code> sets the name that the volume will have in the Finder. Otherwise it’s called something like <code>OSXFUSE Volume 0</code> (sshfs)</li>
</ul>
<p>By default, the file system is only visible to the person that mounted it. To allow other users to see it you can add <code>-o allow_other</code> to the command line. This can be a little dangerous when combined with <code>-o defer_permissions</code> as everyone will have the permissions of the account that was used for the SSH connection. Use this option with care.</p>
<h3 id="unmount-the-file-system">3.unmount the file system</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount /mnt/pcB</span><br></pre></td></tr></table></figure>
<p>Remember to replace <code>/mnt/pcB</code>. In Mac OSX, one can also eject the mounted file system in the Finder. (key combination <code>cmd+shift+G</code> to open any folder within Finder window)。</p>
<p>If you encounter the following messages: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount(/mnt/pcB): Resource busy -- try 'diskutil unmount'</span><br></pre></td></tr></table></figure></p>
<p>or <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> fusermount -u /mnt/pcB/</span></span><br></pre></td></tr></table></figure></p>
<p>You may use: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diskutil unmount /mnt/pcB</span><br></pre></td></tr></table></figure></p>
<p>You can refer to <a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a> for more details.</p>
<h3 id="killing-the-tunnel-mount_remote_fs">4.Killing the tunnel <a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a></h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ps ax | grep <span class="string">"ssh_command"</span> | awk <span class="string">'&#123;print $1&#125;'</span> | \</span></span><br><span class="line">  xargs -i kill &#123;&#125; 2&gt;/dev/null</span><br></pre></td></tr></table></figure>
<p>Firstly, ps is used to find all running processes. We then pipe the output to grep which looks for "ssh_command" (which should be replaced with whichever command you used to establish the tunnel). Then we use awk to return only the PID numbers for the relevant processes and these are finally piped to kill to terminate the process. All errors are redirected to /dev/null. For a simple explanation of output redirection, see this <a href="http://www.xaprb.com/blog/2006/06/06/what-does-devnull-21-mean/" target="_blank" rel="noopener">tutorial</a>.</p>
<h1 id="part-8-git-over-ssh-git_over_ssh">Part 8: Git over SSH <a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a></h1>
<h1 id="part-9-rsync-through-an-ssh-tunnel">Part 9: Rsync through an SSH tunnel</h1>
<p>Ref: http://toddharris.net/blog/2005/10/23/rsyncing-through-an-ssh-tunnel/</p>
<p><code>curl</code>, the HTTP client used by Git, supports SOCKS proxies as provided by <code>ssh -D</code> dynamic tunnel.</p>
<ol type="1">
<li><p>Set up a dynamic (SOCKS) tunnel with: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &lt;username&gt;@serverA -D 1080 -N</span><br></pre></td></tr></table></figure></p></li>
<li><p>Configure Git to use it as a proxy: Globally (or per-repository) <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config [--global] http.proxy socks5://localhost:1080</span><br></pre></td></tr></table></figure></p></li>
</ol>
<p>For a single command: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git -c http.proxy=socks5://localhost:1080 clone http://serverB/repo.git</span><br></pre></td></tr></table></figure></p>
<h1 id="tcpdump-over-ssh-tunnel-and-read-capture-with-local-wireshark">Tcpdump over SSH tunnel and read capture with local wireshark</h1>
<p>It’s often more useful to capture packets using <code>tcpdump</code> rather than <code>wireshark</code>. For example, you might want to do a remote capture and either don’t have GUI access or don’t have Wireshark installed on the remote machine.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i &lt;interface-name&gt; -s 65535 -w &lt;some-file&gt;</span><br></pre></td></tr></table></figure>
<p>Imagine now you want to capture traffic on remote server and use local wirehshark to read captured traffic. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &lt;remote_server&gt; "sudo tcpdump -s0 -w - 'port 8080'" | wireshark -k -i -</span><br></pre></td></tr></table></figure></p>
<p><code>tcpdump</code> requires priveldged right to be launched. To avoid inputing password, it is better enable password-less <code>sudo</code></p>
<h2 id="open-the-etcsudoers-file-as-root-of-course-by-running">Open the /etc/sudoers file (as root, of course!) by running:</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo visudo</span><br></pre></td></tr></table></figure>
<p><strong>Note that you should never edit /etc/sudoers with a regular text editor, such as Vim or nano, because they do not validate the syntax like the visudo editor!</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username     ALL=(ALL) NOPASSWD:ALL</span><br></pre></td></tr></table></figure>
<p>Replace username with your account username, of course. Save the file and exit. If you have any sort of syntax problem, visudo will warn you and you can abort the change or open the file for editing again.</p>
<p>It is important to add this line at the end of the file, so that the other permissions do not override this directive, since they are processed in order.</p>
<h1 id="use-ssh-to-create-vpn">Use SSH to create VPN</h1>
<p>Refer to this tutorial: https://www.kancloud.cn/kancloud/unix-toolbox/50744</p>
<h1 id="rsync-over-ssh">Rsync over ssh</h1>
<p>https://gist.github.com/KartikTalwar/4393116</p>
<p><code>c arcfour</code>: use the weakest but fastest SSH encryption. Must specify "Ciphers arcfour" in sshd_config on destination. 自从 OpenSSH 7.6(?) 之后, OpenSSH 不再支持这么一个Cipher了。https://www.reddit.com/r/archlinux/comments/9wf2nd/ssh_no_arcfour_cipher/ 这个帖子里说，时代在进步，其实有其他的 Cipher 不比 arcfour 慢，但同时还更安全，干嘛不用呢？比如 chacha20-poly1305@openssh.com</p>
<p>Rsync 在大量小文件的情况下，速度要比scp快的多</p>
<p>As a test, you can change into /tmp directory and type as follows: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -aHAXxv --numeric-ids --delete --progress -e &quot;ssh -T -c chacha20-poly1305@openssh.com -o Compression=no -x&quot; ubuntu_server:~/Documents/sfc-patch .</span><br></pre></td></tr></table></figure></p>
<p>关于上述命令的解释:</p>
<ul>
<li>a: archive mode - rescursive, preserves owner, preserves permissions, preserves modification times, preserves group, copies symlinks as symlinks, preserves device files.</li>
<li>H: preserves hard-links</li>
<li>A: preserves ACLs</li>
<li>X: preserves extended attributes</li>
<li>x: don't cross file-system boundaries</li>
<li>--delete: delete extraneous files from destination dirs (differential clean-up during sync)</li>
<li>--progress: show progress during transfer</li>
<li>--numeric-ds: don't map uid/gid values by user/group name</li>
</ul>
<p>离开法国之前，我打算把在里尔的ubuntu_server上所有document下的数据全部拷贝至我的移动硬盘 rsync --exclude-from='rsync_exclude_file.txt' -aHAXxv --numeric-ids --delete --progress -e 'ssh -T -c chacha20-poly1305@openssh.com -o Compression=no -x' ubuntu_server:~/Documents/bake /Volumes/Memory/lille_ubunt_server/bake 注意: 原本bake这个文件夹并不存在，命令执行之后，这个文件夹会被自动创建</p>
<p>最近通过里尔ubuntu_server机器下载了一个新西兰大学网站的一个数据集，该数据集无法通过国内的网址下载获得(不知何故)，现在需要将下载好的文件从ubuntu_server下载到我的Macbook Pro上。但是，通过翻墙服务器建立的SSH链接很不稳定，经常性出现连接中断的问题。导致马上就要下载好的文件，还需要从新下载，很是不方便。经过搜索，发现rsync对于文件夹还是单个文件，都支持断点续传功能。只需要加上<code>--partial</code>参数即可。需要注意的是，对于单个大型文件，用<code>--partial</code>参数的优势非常明显，但是如果在拷贝大量文件（可能有很多小文件不需要进行文件内断点续传）的时候，就要考虑时间上的问题的了。不用-P应该可以节省不少时间。</p>
<p><code>-c aes128-ctr</code>：选择一个较弱但较快的SSH加密。其他人指定arcfour，这将需要在目标主机上手动修改ssh_config。这并非总是可能的，并且这种加密对我来说效果很好。因为传输的是一个单个大文件，所以我发现采用压缩比不压缩的传输效果好。即<code>compression=yes</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">split -a 2 -d -b 10m bigfile.tar.gz bigfile.tar.gz #将压缩包切片</span><br><span class="line">cat bigfile.tar.gz* &gt; bigfile.tar.gz #合并压缩包切片</span><br><span class="line">tar xvf bigfile.tar.gz #解压</span><br></pre></td></tr></table></figure>
<p>对于一个单一的大文件来说, 参考链接: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for d in `ssh ubuntu_server &apos;find ~/Documents/comp_aukland -name &quot;dataset.tar.gz[0-9][0-9]&quot;&apos;`; do</span><br><span class="line">    #d=$&#123;d%$&apos;\n&apos;&#125;   # Remove a trailing newline.</span><br><span class="line">    #echo &quot;Start to fetch $&#123;d&#125;...\n&quot;</span><br><span class="line">    rsync -aHAXxv --numeric-ids --delete --progress --partial -e &apos;ssh -T -c aes128-ctr -o Compression=yes -x&apos; ubuntu_server:&quot;$d&quot; Downloads/comp_aukland/ &amp;</span><br><span class="line">done</span><br></pre></td></tr></table></figure></p>
<p>ssh -t ubuntu_server 'find ~/Documents/comp_aukland -name "dataset.tar.gz[0-9][0-9]"' | parallel -j 4 rsync -aHAXxv --numeric-ids --delete --progress --partial -e "ssh -T -c aes128-ctr -o Compression=yes -x" ubuntu_server:{='uq'=} ~/Downloads/comp_aukland/</p>
<p><code>ssh ubuntu_server 'find ~/Documents/comp_aukland -name "dataset.tar.gz[0-9][0-9]"'</code> 一旦加上<code>-t</code>,则文件末尾会莫名其妙地多了<code>#015</code>，导致无法发现真正的文件 /home/qsong/Documents/comp_aukland/dataset.tar.gz10</p>
<p>parallel通过添加选项<code>v</code>，可以帮助debug. <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rsync -av --progress --partial -e ssh -T -c aes128-ctr -o Compression=yes -x ubuntu_server:&apos;dataset.tar.gz00 &apos; Downloads/comp_aukland/</span><br><span class="line">Unexpected remote arg: ubuntu_server:dataset.tar.gz00</span><br><span class="line">rsync error: syntax or usage error (code 1) at main.c(1374) [sender=3.1.3]</span><br></pre></td></tr></table></figure></p>
<p>不知道为啥文件名dataset.tar.gz00在parallel语句中被额外添加了单引号呢？？？</p>
<p>最终有效的命令是： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat test-rsync.txt | parallel --will-cite -v -j 4 rsync -aHPAXxv --numeric-ids --delete --progress -e \&quot;ssh -T -c aes128-ctr -o Compression=yes -x\&quot; ubuntu_server:&#123;=&apos;uq&apos;=&#125; ~/Downloads/comp_aukland/</span><br></pre></td></tr></table></figure></p>
<p>注意： 1. find命令的name域不采用双引号，即-name dataset.tar.gz[0-9][0-9],则name后面的数据将不会按照正则表达式去解释，无法达到预期效果。 2. parallel里如果需要使用quote,使用转义 3. cat命令输出作为parallel输入的时候，{}作为替换字符串，默认是会加上single quote的，这样会导致rsync出现执行错误，需要使用{='uq'=}避免引入single quote</p>
<p>最终我发现一个很有意思的想象：把一个100M的大文件切割成10多个代销为10M的文件在进行传输，传输的速度是以前的4-10倍！！这一定跟rsync底层实现有关！！！可能是避免了不断来回计算两边的差异么？？？</p>
<h1 id="part-x-troubleshooting-and-tips">Part X: Troubleshooting and tips</h1>
<h2 id="connection-closed-by-remote-host-after-one-month-without-any-activity">1. connection closed by remote host after one month without any activity</h2>
<p>I haven't connected to my Ubuntu server in my office from my Macbook Pro at home since one month. In the meantime, both my VPS and my Ubuntu server have never been shut down. However, I surprisingly observe that the SSH server on my Ubuntu server does not work. When I log into my VPS and further try to ssh into my laptop server, the following error are prompted (in the terminal of my VPS): <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh_exchange_identification: Connection closed by remote host</span><br></pre></td></tr></table></figure></p>
<p>At the terminal of my laptop server at school, such an error message prompts up: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connect_to localhost port 22: failed.</span><br></pre></td></tr></table></figure></p>
<p>I found that <code>sshd</code> daemon is not running at my Ubuntu server. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~ ps aux | grep sshd</span><br><span class="line">qsong    31271  0.0  0.0  15972   952 pts/2    S+   00:40   0:00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn sshd</span><br></pre></td></tr></table></figure></p>
<p>Naturally, I tried to restart sshd service: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">~ sudo service sshd restart</span><br><span class="line">[sudo] password for qsong: </span><br><span class="line">Job for ssh.service failed because the control process exited with error code. See &quot;systemctl status ssh.service&quot; and &quot;journalctl -xe&quot; for details.</span><br><span class="line">~ sudo systemctl restart sshd</span><br><span class="line">Job for ssh.service failed because the control process exited with error code. See &quot;systemctl status ssh.service&quot; and &quot;journalctl -xe&quot; for details.</span><br><span class="line">~ sudo systemctl status ssh.service </span><br><span class="line">● ssh.service - OpenBSD Secure Shell server</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/ssh.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: failed (Result: start-limit-hit) since mer. 2019-03-13 00:42:14 CET; 15s ago</span><br><span class="line">  Process: 31500 ExecStartPre=/usr/sbin/sshd -t (code=exited, status=255)</span><br><span class="line"> Main PID: 12601 (code=exited, status=0/SUCCESS)</span><br><span class="line"></span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: Failed to start OpenBSD Secure Shell server.</span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: ssh.service: Unit entered failed state.</span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: ssh.service: Failed with result &apos;exit-code&apos;.</span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: ssh.service: Service hold-off time over, scheduling restart.</span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: Stopped OpenBSD Secure Shell server.</span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: ssh.service: Start request repeated too quickly.</span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: Failed to start OpenBSD Secure Shell server.</span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: ssh.service: Unit entered failed state.</span><br><span class="line">mars 13 00:42:14 qsong-P650SE systemd[1]: ssh.service: Failed with result &apos;start-limit-hit&apos;.</span><br></pre></td></tr></table></figure></p>
<p>Finally, I solve this issue by reinstalling <code>openssh-server</code> again. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get purge openssh-server</span><br><span class="line">sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure></p>
<p>Now the sshd daemon is runing again. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~ps aux | grep sshd</span><br><span class="line">root      1390  0.0  0.0  65512  5404 ?        Ss   00:46   0:00 /usr/sbin/sshd -D</span><br><span class="line">root      1510  0.0  0.0  96980  6964 ?        Ss   00:47   0:00 sshd: qsong [priv]</span><br><span class="line">qsong     1576  0.0  0.0  96980  3332 ?        S    00:47   0:00 sshd: qsong@pts/15</span><br><span class="line">qsong     2085  0.0  0.0  15940  1020 pts/15   S+   01:07   0:00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn sshd</span><br></pre></td></tr></table></figure></p>
<h2 id="how-to-check-if-a-certain-port-is-open-or-used">How to check if a certain port is open or used?</h2>
<p>We can use <code>lsof</code>. The syntax is: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo lsof -i -P -n</span><br><span class="line">$ sudo lsof -i -P -n | grep LISTEN</span><br><span class="line">$ doas lsof -i -P -n | grep &lt;A port Number&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="section"></h2>
<p>在国内，SSH连接经常会断掉，某一次断掉之后的DEBUG信息(远程VPS的IP地址已经被隐藏)如下: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">debug1: client_input_channel_req: channel 0 rtype keepalive@openssh.com reply 1</span><br><span class="line">debug3: send packet: type 100</span><br><span class="line">debug3: receive packet: type 98</span><br><span class="line">debug1: client_input_channel_req: channel 0 rtype keepalive@openssh.com reply 1</span><br><span class="line">debug3: send packet: type 100</span><br><span class="line">debug3: receive packet: type 98</span><br><span class="line">debug1: client_input_channel_req: channel 0 rtype keepalive@openssh.com reply 1</span><br><span class="line">debug3: send packet: type 100</span><br><span class="line">debug3: send packet: type 1</span><br><span class="line">debug1: channel 0: free: client-session, nchannels 1</span><br><span class="line">debug3: channel 0: status: The following connections are open:</span><br><span class="line">  #0 client-session (t4 r0 i0/0 o0/0 e[write]/0 fd 4/5/6 sock -1 cc -1)</span><br><span class="line"></span><br><span class="line">debug3: fd 1 is not O_NONBLOCK</span><br><span class="line">Connection to XX.XX.XX.XX closed by remote host.</span><br><span class="line">Connection to XX.XX.XX.XX closed.</span><br><span class="line">Transferred: sent 5912, received 8848 bytes, in 2888.1 seconds</span><br><span class="line">Bytes per second: sent 2.0, received 3.1</span><br><span class="line">debug1: Exit status -1</span><br></pre></td></tr></table></figure></p>
<p>Refereces:</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn1" role="doc-endnote"><p>RUTSCHLE YVES, SSLH, http://www.rutschle.net/tech/sslh/README.html.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn2" role="doc-endnote"><p>SSH TUNNELLING FOR FUN AND PROFIT: AUTOSSH, https://www.everythingcli.org/ssh-tunnelling-for-fun-and-profit-autossh/<a href="#fnref2" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn3" role="doc-endnote"><p>Systemd Essentials: Working with Services, Units, and the Journal, https://www.digitalocean.com/community/tutorials/systemd-essentials-working-with-services-units-and-the-journal<a href="#fnref3" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn4" role="doc-endnote"><p>Understanding Systemd Units and Unit Files, https://www.digitalocean.com/community/tutorials/understanding-systemd-units-and-unit-files<a href="#fnref4" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn5" role="doc-endnote"><p>Simplify Your Life With an SSH Config File, https://nerderati.com/2011/03/17/simplify-your-life-with-an-ssh-config-file/<a href="#fnref5" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn6" role="doc-endnote"><p>https://phpsolved.com/mount-point-xyz-osxfuse-volume/<a href="#fnref6" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn7" role="doc-endnote"><p>FUSE and SSHFS on OS X, https://stuff-things.net/2015/05/20/fuse-and-sshfs-on-os-x/<a href="#fnref7" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn8" role="doc-endnote"><p>Mounting file systems over two SSH hops, https://www.larkinweb.co.uk/computing/mounting_file_systems_over_two_ssh_hops.html<a href="#fnref8" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn9" role="doc-endnote"><p>Tunneling git through ssh (to get past a firewall): port specification interperted as relative path?, https://superuser.com/questions/1117698/tunneling-git-through-ssh-to-get-past-a-firewall-port-specification-interpert<a href="#fnref9" class="footnote-back" role="doc-backlink">↩</a></p></li>
</ol>
</section>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rennesong.com/2015/08/01/how-to-install-ns-3-in-Ubuntu-15-04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rennsong">
      <meta itemprop="description" content="Personal blog site, to note technique and life related articles">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rennesong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/08/01/how-to-install-ns-3-in-Ubuntu-15-04/" class="post-title-link" itemprop="url">Ubuntu 15.04下安装NS-3</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-08-01 20:00:41" itemprop="dateCreated datePublished" datetime="2015-08-01T20:00:41+08:00">2015-08-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-25 18:27:10" itemprop="dateModified" datetime="2019-03-25T18:27:10+08:00">2019-03-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>官方教程</p>
<h1 id="prerequists">Prerequists</h1>
<p>关于Ubuntu下的Prerequistes，[1]中有很详细的解释。 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 版本管理软件</span></span><br><span class="line">sudo apt-get install git cvs mercurial</span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">sudo apt-get install gcc g++ python python-dev qt4-dev-tools bzr cmake libc6-dev libc6-dev-i386 g++-multilib gdb valgrind gsl-bin libgsl0-dev libgsl0ldbl flex bison libfl-dev sqlite sqlite3 libsqlite3-dev libxml2 libxml2-dev libgtk2.0-0 libgtk2.0-dev vtun lxc uncrustify doxygen graphviz imagemagick python-sphinx dia python-pygraphviz python-kiwi python-pygoocanvas libgoocanvas-dev libboost-signals-dev libboost-filesystem-dev openmpi-bin openmpi-common openmpi-doc libopenmpi-dev p7zip-full rar unrar autoconf </span><br><span class="line">sudo apt-get install python-pygccxml</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">Note: Sphinx version &gt;= 1.12 required <span class="keyword">for</span> ns-3.15. To check your version, <span class="built_in">type</span> <span class="string">"sphinx-build"</span>. To fetch this package alone, outside of the Ubuntu package system, try <span class="string">"sudo easy_install -U Sphinx"</span>.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">跟Tex有关的包，由于体积交大，所以最后再安装</span></span><br><span class="line">sudo apt-get install texlive texlive-extra-utils texlive-latex-extra</span><br></pre></td></tr></table></figure></p>
<h1 id="安装">安装</h1>
<p>安装方式有好多种，我们选择Bake方法 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir repos &amp;&amp; cd repos</span><br><span class="line">hg clone http://code.nsnam.org/bake</span><br><span class="line">export PATH=$PATH:$BAKE_HOME</span><br><span class="line">export PYTHONPATH=$PYTHONPATH:$BAKE_HOME</span><br></pre></td></tr></table></figure></p>
<p>执行./bake.py check, 输出为： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">qsong@sony:~/Documents/repos/bake$ ./bake.py check</span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> Python - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> GNU C++ compiler - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> Mercurial - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> CVS - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> GIT - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> Bazaar - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> Tar tool - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> Unzip tool - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> Unrar tool - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> 7z  data compression utility - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> XZ data compression utility - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> Make - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> cMake - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> patch tool - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> autoreconf tool - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> Path searched <span class="keyword">for</span> tools: /usr/<span class="built_in">local</span>/sbin /usr/<span class="built_in">local</span>/bin /usr/sbin /usr/bin /sbin /bin /usr/games /usr/<span class="built_in">local</span>/games </span></span><br><span class="line"> /home/qsong/Documents/repos/bake/bake </span><br><span class="line"> /home/qsong/Documents/repos/bake/bake bin  </span><br><span class="line"> /home/qsong/Documents/repos/bake/bake</span><br></pre></td></tr></table></figure></p>
<p>上面的输出表明：一切就绪，可以安装NS-3了。首先需要告诉bake我们需要下载代码，build的版本是 3.23. <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">./bake.py configure -e ns-3.23</span><br><span class="line">./bake.py show</span><br><span class="line">module: pybindgen-0.17.0.886 (enabled)</span><br><span class="line">  No dependencies!</span><br><span class="line">module: g++ (enabled)</span><br><span class="line">  No dependencies!</span><br><span class="line">module: qt4 (enabled)</span><br><span class="line">  No dependencies!</span><br><span class="line">module: python-dev (enabled)</span><br><span class="line">  No dependencies!</span><br><span class="line">module: pygraphviz (enabled)</span><br><span class="line">  No dependencies!</span><br><span class="line">module: pygoocanvas (enabled)</span><br><span class="line">  No dependencies!</span><br><span class="line">module: netanim-3.106 (enabled)</span><br><span class="line">  depends on:</span><br><span class="line">     qt4 (optional:False)</span><br><span class="line">     g++ (optional:False)</span><br><span class="line">module: pyviz-prerequisites (enabled)</span><br><span class="line">  depends on:</span><br><span class="line">     python-dev (optional:True)</span><br><span class="line">     pygraphviz (optional:True)</span><br><span class="line">     pygoocanvas (optional:True)</span><br><span class="line">module: ns-3.23 (enabled)</span><br><span class="line">  depends on:</span><br><span class="line">     netanim-3.106 (optional:True)</span><br><span class="line">     pybindgen-0.17.0.886 (optional:True)</span><br><span class="line">     pyviz-prerequisites (optional:True)</span><br><span class="line"></span><br><span class="line">-- System Dependencies --</span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> g++ - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> pygoocanvas - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> pygraphviz - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> python-dev - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> qt4 - OK</span></span><br></pre></td></tr></table></figure></p>
<p>一切就绪，可以开始Download代码，并且编译(build) <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">qsong@sony:~/Documents/repos/bake$ ./bake.py download</span><br><span class="line"><span class="meta"> &gt;</span><span class="bash">&gt; Downloading pybindgen-0.17.0.886 - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash">&gt; Searching <span class="keyword">for</span> system dependency g++ - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash">&gt; Searching <span class="keyword">for</span> system dependency qt4 - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash">&gt; Searching <span class="keyword">for</span> system dependency python-dev - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash">&gt; Searching <span class="keyword">for</span> system dependency pygraphviz - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash">&gt; Searching <span class="keyword">for</span> system dependency pygoocanvas - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash">&gt; Downloading netanim-3.106 - OK</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash">&gt; Downloading ns-3.23 - OK</span></span><br></pre></td></tr></table></figure></p>
<p>教程里没有提的是，我们需要进入pybindgen-0.17.0.886，执行： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo python setup.py install</span><br></pre></td></tr></table></figure></p>
<p>否则接下来的编译阶段会报错的(其实即使做了上一步还是会有错，出乎意料了，google无果。) <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qsong@sony:~/Documents/repos/bake$ ./bake.py build</span><br></pre></td></tr></table></figure></p>
<p>那不如试试用waf来配置编译吧 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> change into the <span class="built_in">source</span> directory of ns-3.23</span></span><br><span class="line">cd source/ns-3.23</span><br><span class="line"><span class="meta">#</span><span class="bash"> 清楚之前编译配置而生成的文件</span></span><br><span class="line">./waf clean</span><br><span class="line"><span class="meta">#</span><span class="bash"> 采用debug的profile来配置</span></span><br><span class="line">./waf --build-profile=debug --enable-examples --enable-tests configure</span><br><span class="line"><span class="meta">#</span><span class="bash"> 编译, 不需要打 build 命令</span></span><br><span class="line">./waf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 输出结果</span></span><br><span class="line">Modules built:</span><br><span class="line">antenna                   aodv                      applications</span><br><span class="line">bridge                    buildings                 config-store</span><br><span class="line">core                      csma                      csma-layout</span><br><span class="line">dsdv                      dsr                       energy</span><br><span class="line">fd-net-device             flow-monitor              internet</span><br><span class="line">lr-wpan                   lte                       mesh</span><br><span class="line">mobility                  mpi                       netanim (no Python)</span><br><span class="line">network                   nix-vector-routing        olsr</span><br><span class="line">point-to-point            point-to-point-layout     propagation</span><br><span class="line">sixlowpan                 spectrum                  stats</span><br><span class="line">tap-bridge                test (no Python)          topology-read</span><br><span class="line">uan                       virtual-net-device        visualizer</span><br><span class="line">wave                      wifi                      wimax</span><br><span class="line"></span><br><span class="line">Modules not built (see ns-3 tutorial for explanation):</span><br><span class="line">brite                     click                     openflow</span><br></pre></td></tr></table></figure></p>
<p>既然执行test中例子，看是否都可以通过 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">qsong@sony:~/Documents/repos/bake/source/ns-3.23$ ./test.py -c core</span><br><span class="line"><span class="meta">#</span><span class="bash"> 由于输出过程，这里我只贴出部分输出，其他以省略号代替</span></span><br><span class="line">...</span><br><span class="line">PASS: TestSuite lr-wpan-spectrum-value-helper</span><br><span class="line">PASS: TestSuite lte-cqi-generation</span><br><span class="line">PASS: TestSuite lte-x2-handover-measures</span><br><span class="line">PASS: TestSuite lte-frequency-reuse</span><br><span class="line">...</span><br><span class="line">201 of 204 tests passed (201 passed, 3 skipped, 0 failed, 0 crashed, 0 valgrind errors)</span><br><span class="line">List of SKIPped tests: ns3-tcp-cwnd</span><br><span class="line">    ns3-tcp-interoperability</span><br><span class="line">    nsc-tcp-loss</span><br></pre></td></tr></table></figure></p>
<p>结果满意！</p>
<p>CTTC(加泰罗尼亚理工)对NS-3d的贡献(http://networks.cttc.es/mobile-networks/software-tools/ns-3/)</p>
<h1 id="参考资料">参考资料</h1>
<p>[1][NS-3官方Wiki安装文档](https://www.nsnam.org/wiki/Installation) <a href="http://askubuntu.com/questions/162391/how-do-i-fix-my-locale-issue" target="_blank" rel="noopener">How do I fix my locale issue?</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">rennsong</p>
  <div class="site-description" itemprop="description">Personal blog site, to note technique and life related articles</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">67</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hansomesong" title="GitHub → https://github.com/hansomesong" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rennsong</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->



  















  

  

  

</body>
</html>
